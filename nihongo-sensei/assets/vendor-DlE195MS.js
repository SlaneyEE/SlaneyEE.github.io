function e(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function t(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if("function"==typeof t){var n=function e(){return this instanceof e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(t){var i=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,i.get?i:{enumerable:!0,get:function(){return e[t]}})}),n}var n,i,r,o,s={exports:{}},a={},l={exports:{}},u={};function c(){if(n)return u;n=1;var e=Symbol.for("react.element"),t=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),a=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function v(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}function _(){}function y(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},_.prototype=v.prototype;var x=y.prototype=new _;x.constructor=y,m(x,v.prototype),x.isPureReactComponent=!0;var S=Array.isArray,E=Object.prototype.hasOwnProperty,b={current:null},T={key:!0,ref:!0,__self:!0,__source:!0};function w(t,n,i){var r,o={},s=null,a=null;if(null!=n)for(r in void 0!==n.ref&&(a=n.ref),void 0!==n.key&&(s=""+n.key),n)E.call(n,r)&&!T.hasOwnProperty(r)&&(o[r]=n[r]);var l=arguments.length-2;if(1===l)o.children=i;else if(1<l){for(var u=Array(l),c=0;c<l;c++)u[c]=arguments[c+2];o.children=u}if(t&&t.defaultProps)for(r in l=t.defaultProps)void 0===o[r]&&(o[r]=l[r]);return{$$typeof:e,type:t,key:s,ref:a,props:o,_owner:b.current}}function M(t){return"object"==typeof t&&null!==t&&t.$$typeof===e}var A=/\/+/g;function R(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function C(n,i,r,o,s){var a=typeof n;"undefined"!==a&&"boolean"!==a||(n=null);var l=!1;if(null===n)l=!0;else switch(a){case"string":case"number":l=!0;break;case"object":switch(n.$$typeof){case e:case t:l=!0}}if(l)return s=s(l=n),n=""===o?"."+R(l,0):o,S(s)?(r="",null!=n&&(r=n.replace(A,"$&/")+"/"),C(s,i,r,"",function(e){return e})):null!=s&&(M(s)&&(s=function(t,n){return{$$typeof:e,type:t.type,key:n,ref:t.ref,props:t.props,_owner:t._owner}}(s,r+(!s.key||l&&l.key===s.key?"":(""+s.key).replace(A,"$&/")+"/")+n)),i.push(s)),1;if(l=0,o=""===o?".":o+":",S(n))for(var u=0;u<n.length;u++){var c=o+R(a=n[u],u);l+=C(a,i,r,c,s)}else if(c=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=p&&e[p]||e["@@iterator"])?e:null}(n),"function"==typeof c)for(n=c.call(n),u=0;!(a=n.next()).done;)l+=C(a=a.value,i,r,c=o+R(a,u++),s);else if("object"===a)throw i=String(n),Error("Objects are not valid as a React child (found: "+("[object Object]"===i?"object with keys {"+Object.keys(n).join(", ")+"}":i)+"). If you meant to render a collection of children, use an array instead.");return l}function I(e,t,n){if(null==e)return e;var i=[],r=0;return C(e,i,"","",function(e){return t.call(n,e,r++)}),i}function P(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var O={current:null},N={transition:null},L={ReactCurrentDispatcher:O,ReactCurrentBatchConfig:N,ReactCurrentOwner:b};function D(){throw Error("act(...) is not supported in production builds of React.")}return u.Children={map:I,forEach:function(e,t,n){I(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return I(e,function(){t++}),t},toArray:function(e){return I(e,function(e){return e})||[]},only:function(e){if(!M(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},u.Component=v,u.Fragment=i,u.Profiler=o,u.PureComponent=y,u.StrictMode=r,u.Suspense=c,u.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=L,u.act=D,u.cloneElement=function(t,n,i){if(null==t)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=m({},t.props),o=t.key,s=t.ref,a=t._owner;if(null!=n){if(void 0!==n.ref&&(s=n.ref,a=b.current),void 0!==n.key&&(o=""+n.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(u in n)E.call(n,u)&&!T.hasOwnProperty(u)&&(r[u]=void 0===n[u]&&void 0!==l?l[u]:n[u])}var u=arguments.length-2;if(1===u)r.children=i;else if(1<u){l=Array(u);for(var c=0;c<u;c++)l[c]=arguments[c+2];r.children=l}return{$$typeof:e,type:t.type,key:o,ref:s,props:r,_owner:a}},u.createContext=function(e){return(e={$$typeof:a,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},u.createElement=w,u.createFactory=function(e){var t=w.bind(null,e);return t.type=e,t},u.createRef=function(){return{current:null}},u.forwardRef=function(e){return{$$typeof:l,render:e}},u.isValidElement=M,u.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:P}},u.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},u.startTransition=function(e){var t=N.transition;N.transition={};try{e()}finally{N.transition=t}},u.unstable_act=D,u.useCallback=function(e,t){return O.current.useCallback(e,t)},u.useContext=function(e){return O.current.useContext(e)},u.useDebugValue=function(){},u.useDeferredValue=function(e){return O.current.useDeferredValue(e)},u.useEffect=function(e,t){return O.current.useEffect(e,t)},u.useId=function(){return O.current.useId()},u.useImperativeHandle=function(e,t,n){return O.current.useImperativeHandle(e,t,n)},u.useInsertionEffect=function(e,t){return O.current.useInsertionEffect(e,t)},u.useLayoutEffect=function(e,t){return O.current.useLayoutEffect(e,t)},u.useMemo=function(e,t){return O.current.useMemo(e,t)},u.useReducer=function(e,t,n){return O.current.useReducer(e,t,n)},u.useRef=function(e){return O.current.useRef(e)},u.useState=function(e){return O.current.useState(e)},u.useSyncExternalStore=function(e,t,n){return O.current.useSyncExternalStore(e,t,n)},u.useTransition=function(){return O.current.useTransition()},u.version="18.3.1",u}function d(){return i||(i=1,l.exports=c()),l.exports}var h,p,f,m,g,v=(o||(o=1,s.exports=function(){if(r)return a;r=1;var e=d(),t=Symbol.for("react.element"),n=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,o=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function l(e,n,r){var a,l={},u=null,c=null;for(a in void 0!==r&&(u=""+r),void 0!==n.key&&(u=""+n.key),void 0!==n.ref&&(c=n.ref),n)i.call(n,a)&&!s.hasOwnProperty(a)&&(l[a]=n[a]);if(e&&e.defaultProps)for(a in n=e.defaultProps)void 0===l[a]&&(l[a]=n[a]);return{$$typeof:t,type:e,key:u,ref:c,props:l,_owner:o.current}}return a.Fragment=n,a.jsx=l,a.jsxs=l,a}()),s.exports),_={},y={exports:{}},x={},S={exports:{}},E={};function b(){return p||(p=1,S.exports=(h||(h=1,function(e){function t(e,t){var n=e.length;e.push(t);e:for(;0<n;){var i=n-1>>>1,o=e[i];if(!(0<r(o,t)))break e;e[i]=t,e[n]=o,n=i}}function n(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,o=e.length,s=o>>>1;i<s;){var a=2*(i+1)-1,l=e[a],u=a+1,c=e[u];if(0>r(l,n))u<o&&0>r(c,l)?(e[i]=c,e[u]=n,i=u):(e[i]=l,e[a]=n,i=a);else{if(!(u<o&&0>r(c,n)))break e;e[i]=c,e[u]=n,i=u}}}return t}function r(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"==typeof performance&&"function"==typeof performance.now){var o=performance;e.unstable_now=function(){return o.now()}}else{var s=Date,a=s.now();e.unstable_now=function(){return s.now()-a}}var l=[],u=[],c=1,d=null,h=3,p=!1,f=!1,m=!1,g="function"==typeof setTimeout?setTimeout:null,v="function"==typeof clearTimeout?clearTimeout:null,_="undefined"!=typeof setImmediate?setImmediate:null;function y(e){for(var r=n(u);null!==r;){if(null===r.callback)i(u);else{if(!(r.startTime<=e))break;i(u),r.sortIndex=r.expirationTime,t(l,r)}r=n(u)}}function x(e){if(m=!1,y(e),!f)if(null!==n(l))f=!0,O(S);else{var t=n(u);null!==t&&N(x,t.startTime-e)}}function S(t,r){f=!1,m&&(m=!1,v(w),w=-1),p=!0;var o=h;try{for(y(r),d=n(l);null!==d&&(!(d.expirationTime>r)||t&&!R());){var s=d.callback;if("function"==typeof s){d.callback=null,h=d.priorityLevel;var a=s(d.expirationTime<=r);r=e.unstable_now(),"function"==typeof a?d.callback=a:d===n(l)&&i(l),y(r)}else i(l);d=n(l)}if(null!==d)var c=!0;else{var g=n(u);null!==g&&N(x,g.startTime-r),c=!1}return c}finally{d=null,h=o,p=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var E,b=!1,T=null,w=-1,M=5,A=-1;function R(){return!(e.unstable_now()-A<M)}function C(){if(null!==T){var t=e.unstable_now();A=t;var n=!0;try{n=T(!0,t)}finally{n?E():(b=!1,T=null)}}else b=!1}if("function"==typeof _)E=function(){_(C)};else if("undefined"!=typeof MessageChannel){var I=new MessageChannel,P=I.port2;I.port1.onmessage=C,E=function(){P.postMessage(null)}}else E=function(){g(C,0)};function O(e){T=e,b||(b=!0,E())}function N(t,n){w=g(function(){t(e.unstable_now())},n)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(e){e.callback=null},e.unstable_continueExecution=function(){f||p||(f=!0,O(S))},e.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<e?Math.floor(1e3/e):5},e.unstable_getCurrentPriorityLevel=function(){return h},e.unstable_getFirstCallbackNode=function(){return n(l)},e.unstable_next=function(e){switch(h){case 1:case 2:case 3:var t=3;break;default:t=h}var n=h;h=t;try{return e()}finally{h=n}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=h;h=e;try{return t()}finally{h=n}},e.unstable_scheduleCallback=function(i,r,o){var s=e.unstable_now();switch(o="object"==typeof o&&null!==o&&"number"==typeof(o=o.delay)&&0<o?s+o:s,i){case 1:var a=-1;break;case 2:a=250;break;case 5:a=1073741823;break;case 4:a=1e4;break;default:a=5e3}return i={id:c++,callback:r,priorityLevel:i,startTime:o,expirationTime:a=o+a,sortIndex:-1},o>s?(i.sortIndex=o,t(u,i),null===n(l)&&i===n(u)&&(m?(v(w),w=-1):m=!0,N(x,o-s))):(i.sortIndex=a,t(l,i),f||p||(f=!0,O(S))),i},e.unstable_shouldYield=R,e.unstable_wrapCallback=function(e){var t=h;return function(){var n=h;h=t;try{return e.apply(this,arguments)}finally{h=n}}}}(E)),E)),S.exports}function T(){if(f)return x;f=1;var e=d(),t=b();function n(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var i=new Set,r={};function o(e,t){s(e,t),s(e+"Capture",t)}function s(e,t){for(r[e]=t,e=0;e<t.length;e++)i.add(t[e])}var a=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),l=Object.prototype.hasOwnProperty,u=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,c={},h={};function p(e,t,n,i,r,o,s){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=s}var m={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){m[e]=new p(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];m[t]=new p(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){m[e]=new p(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){m[e]=new p(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){m[e]=new p(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){m[e]=new p(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){m[e]=new p(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){m[e]=new p(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){m[e]=new p(e,5,!1,e.toLowerCase(),null,!1,!1)});var g=/[\-:]([a-z])/g;function v(e){return e[1].toUpperCase()}function _(e,t,n,i){var r=m.hasOwnProperty(t)?m[t]:null;(null!==r?0!==r.type:i||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,i){if(null==t||function(e,t,n,i){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,i))return!0;if(i)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,r,i)&&(n=null),i||null===r?function(e){return!!l.call(h,e)||!l.call(c,e)&&(u.test(e)?h[e]=!0:(c[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):r.mustUseProperty?e[r.propertyName]=null===n?3!==r.type&&"":n:(t=r.attributeName,i=r.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(r=r.type)||4===r&&!0===n?"":""+n,i?e.setAttributeNS(i,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(g,v);m[t]=new p(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(g,v);m[t]=new p(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(g,v);m[t]=new p(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){m[e]=new p(e,1,!1,e.toLowerCase(),null,!1,!1)}),m.xlinkHref=new p("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){m[e]=new p(e,1,!1,e.toLowerCase(),null,!0,!0)});var y=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,S=Symbol.for("react.element"),E=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),w=Symbol.for("react.strict_mode"),M=Symbol.for("react.profiler"),A=Symbol.for("react.provider"),R=Symbol.for("react.context"),C=Symbol.for("react.forward_ref"),I=Symbol.for("react.suspense"),P=Symbol.for("react.suspense_list"),O=Symbol.for("react.memo"),N=Symbol.for("react.lazy"),L=Symbol.for("react.offscreen"),D=Symbol.iterator;function U(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=D&&e[D]||e["@@iterator"])?e:null}var k,F=Object.assign;function B(e){if(void 0===k)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);k=t&&t[1]||""}return"\n"+k+e}var H=!1;function V(e,t){if(!e||H)return"";H=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var i=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){i=u}e.call(t.prototype)}else{try{throw Error()}catch(u){i=u}e()}}catch(u){if(u&&i&&"string"==typeof u.stack){for(var r=u.stack.split("\n"),o=i.stack.split("\n"),s=r.length-1,a=o.length-1;1<=s&&0<=a&&r[s]!==o[a];)a--;for(;1<=s&&0<=a;s--,a--)if(r[s]!==o[a]){if(1!==s||1!==a)do{if(s--,0>--a||r[s]!==o[a]){var l="\n"+r[s].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=s&&0<=a);break}}}finally{H=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?B(e):""}function z(e){switch(e.tag){case 5:return B(e.type);case 16:return B("Lazy");case 13:return B("Suspense");case 19:return B("SuspenseList");case 0:case 2:case 15:return e=V(e.type,!1);case 11:return e=V(e.type.render,!1);case 1:return e=V(e.type,!0);default:return""}}function G(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case T:return"Fragment";case E:return"Portal";case M:return"Profiler";case w:return"StrictMode";case I:return"Suspense";case P:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case R:return(e.displayName||"Context")+".Consumer";case A:return(e._context.displayName||"Context")+".Provider";case C:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case O:return null!==(t=e.displayName||null)?t:G(e.type)||"Memo";case N:t=e._payload,e=e._init;try{return G(e(t))}catch(n){}}return null}function W(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return G(t);case 8:return t===w?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"==typeof t)return t.displayName||t.name||null;if("string"==typeof t)return t}return null}function j(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function q(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function X(e){e._valueTracker||(e._valueTracker=function(e){var t=q(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==n&&"function"==typeof n.get&&"function"==typeof n.set){var r=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){i=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function Y(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=q(e)?e.checked?"true":"false":e.value),(e=i)!==n&&(t.setValue(e),!0)}function K(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function J(e,t){var n=t.checked;return F({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function $(e,t){var n=null==t.defaultValue?"":t.defaultValue,i=null!=t.checked?t.checked:t.defaultChecked;n=j(null!=t.value?t.value:n),e._wrapperState={initialChecked:i,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Z(e,t){null!=(t=t.checked)&&_(e,"checked",t,!1)}function Q(e,t){Z(e,t);var n=j(t.value),i=t.type;if(null!=n)"number"===i?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===i||"reset"===i)return void e.removeAttribute("value");t.hasOwnProperty("value")?te(e,t.type,n):t.hasOwnProperty("defaultValue")&&te(e,t.type,j(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function ee(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!("submit"!==i&&"reset"!==i||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function te(e,t,n){"number"===t&&K(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var ne=Array.isArray;function ie(e,t,n,i){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&i&&(e[n].defaultSelected=!0)}else{for(n=""+j(n),t=null,r=0;r<e.length;r++){if(e[r].value===n)return e[r].selected=!0,void(i&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(n(91));return F({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function oe(e,t){var i=t.value;if(null==i){if(i=t.children,t=t.defaultValue,null!=i){if(null!=t)throw Error(n(92));if(ne(i)){if(1<i.length)throw Error(n(93));i=i[0]}t=i}null==t&&(t=""),i=t}e._wrapperState={initialValue:j(i)}}function se(e,t){var n=j(t.value),i=j(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=i&&(e.defaultValue=""+i)}function ae(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function le(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ue(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?le(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,de,he=(de=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,i){MSApp.execUnsafeLocalFunction(function(){return de(e,t)})}:de);function pe(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var fe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},me=["Webkit","ms","Moz","O"];function ge(e,t,n){return null==t||"boolean"==typeof t||""===t?"":n||"number"!=typeof t||0===t||fe.hasOwnProperty(e)&&fe[e]?(""+t).trim():t+"px"}function ve(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var i=0===n.indexOf("--"),r=ge(n,t[n],i);"float"===n&&(n="cssFloat"),i?e.setProperty(n,r):e[n]=r}}Object.keys(fe).forEach(function(e){me.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),fe[t]=fe[e]})});var _e=F({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(_e[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(n(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(n(60));if("object"!=typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(n(61))}if(null!=t.style&&"object"!=typeof t.style)throw Error(n(62))}}function xe(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Se=null;function Ee(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var be=null,Te=null,we=null;function Me(e){if(e=xr(e)){if("function"!=typeof be)throw Error(n(280));var t=e.stateNode;t&&(t=Er(t),be(e.stateNode,e.type,t))}}function Ae(e){Te?we?we.push(e):we=[e]:Te=e}function Re(){if(Te){var e=Te,t=we;if(we=Te=null,Me(e),t)for(e=0;e<t.length;e++)Me(t[e])}}function Ce(e,t){return e(t)}function Ie(){}var Pe=!1;function Oe(e,t,n){if(Pe)return e(t,n);Pe=!0;try{return Ce(e,t,n)}finally{Pe=!1,(null!==Te||null!==we)&&(Ie(),Re())}}function Ne(e,t){var i=e.stateNode;if(null===i)return null;var r=Er(i);if(null===r)return null;i=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(i&&"function"!=typeof i)throw Error(n(231,t,typeof i));return i}var Le=!1;if(a)try{var De={};Object.defineProperty(De,"passive",{get:function(){Le=!0}}),window.addEventListener("test",De,De),window.removeEventListener("test",De,De)}catch(de){Le=!1}function Ue(e,t,n,i,r,o,s,a,l){var u=Array.prototype.slice.call(arguments,3);try{t.apply(n,u)}catch(c){this.onError(c)}}var ke=!1,Fe=null,Be=!1,He=null,Ve={onError:function(e){ke=!0,Fe=e}};function ze(e,t,n,i,r,o,s,a,l){ke=!1,Fe=null,Ue.apply(Ve,arguments)}function Ge(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{!!(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function We(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function je(e){if(Ge(e)!==e)throw Error(n(188))}function qe(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ge(e)))throw Error(n(188));return t!==e?null:e}for(var i=e,r=t;;){var o=i.return;if(null===o)break;var s=o.alternate;if(null===s){if(null!==(r=o.return)){i=r;continue}break}if(o.child===s.child){for(s=o.child;s;){if(s===i)return je(o),e;if(s===r)return je(o),t;s=s.sibling}throw Error(n(188))}if(i.return!==r.return)i=o,r=s;else{for(var a=!1,l=o.child;l;){if(l===i){a=!0,i=o,r=s;break}if(l===r){a=!0,r=o,i=s;break}l=l.sibling}if(!a){for(l=s.child;l;){if(l===i){a=!0,i=s,r=o;break}if(l===r){a=!0,r=s,i=o;break}l=l.sibling}if(!a)throw Error(n(189))}}if(i.alternate!==r)throw Error(n(190))}if(3!==i.tag)throw Error(n(188));return i.stateNode.current===i?e:t}(e))?Xe(e):null}function Xe(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Xe(e);if(null!==t)return t;e=e.sibling}return null}var Ye=t.unstable_scheduleCallback,Ke=t.unstable_cancelCallback,Je=t.unstable_shouldYield,$e=t.unstable_requestPaint,Ze=t.unstable_now,Qe=t.unstable_getCurrentPriorityLevel,et=t.unstable_ImmediatePriority,tt=t.unstable_UserBlockingPriority,nt=t.unstable_NormalPriority,it=t.unstable_LowPriority,rt=t.unstable_IdlePriority,ot=null,st=null;var at=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(lt(e)/ut|0)|0},lt=Math.log,ut=Math.LN2;var ct=64,dt=4194304;function ht(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function pt(e,t){var n=e.pendingLanes;if(0===n)return 0;var i=0,r=e.suspendedLanes,o=e.pingedLanes,s=268435455&n;if(0!==s){var a=s&~r;0!==a?i=ht(a):0!==(o&=s)&&(i=ht(o))}else 0!==(s=n&~r)?i=ht(s):0!==o&&(i=ht(o));if(0===i)return 0;if(0!==t&&t!==i&&0===(t&r)&&((r=i&-i)>=(o=t&-t)||16===r&&4194240&o))return t;if(4&i&&(i|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=i;0<t;)r=1<<(n=31-at(t)),i|=e[n],t&=~r;return i}function ft(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function mt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function gt(){var e=ct;return!(4194240&(ct<<=1))&&(ct=64),e}function vt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function _t(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-at(t)]=n}function yt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-at(n),r=1<<i;r&t|e[i]&t&&(e[i]|=t),n&=~r}}var xt=0;function St(e){return 1<(e&=-e)?4<e?268435455&e?16:536870912:4:1}var Et,bt,Tt,wt,Mt,At=!1,Rt=[],Ct=null,It=null,Pt=null,Ot=new Map,Nt=new Map,Lt=[],Dt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ut(e,t){switch(e){case"focusin":case"focusout":Ct=null;break;case"dragenter":case"dragleave":It=null;break;case"mouseover":case"mouseout":Pt=null;break;case"pointerover":case"pointerout":Ot.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Nt.delete(t.pointerId)}}function kt(e,t,n,i,r,o){return null===e||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:i,nativeEvent:o,targetContainers:[r]},null!==t&&(null!==(t=xr(t))&&bt(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function Ft(e){var t=yr(e.target);if(null!==t){var n=Ge(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=We(n)))return e.blockedOn=t,void Mt(e.priority,function(){Tt(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Bt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Jt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=xr(n))&&bt(t),e.blockedOn=n,!1;var i=new(n=e.nativeEvent).constructor(n.type,n);Se=i,n.target.dispatchEvent(i),Se=null,t.shift()}return!0}function Ht(e,t,n){Bt(e)&&n.delete(t)}function Vt(){At=!1,null!==Ct&&Bt(Ct)&&(Ct=null),null!==It&&Bt(It)&&(It=null),null!==Pt&&Bt(Pt)&&(Pt=null),Ot.forEach(Ht),Nt.forEach(Ht)}function zt(e,n){e.blockedOn===n&&(e.blockedOn=null,At||(At=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,Vt)))}function Gt(e){function t(t){return zt(t,e)}if(0<Rt.length){zt(Rt[0],e);for(var n=1;n<Rt.length;n++){var i=Rt[n];i.blockedOn===e&&(i.blockedOn=null)}}for(null!==Ct&&zt(Ct,e),null!==It&&zt(It,e),null!==Pt&&zt(Pt,e),Ot.forEach(t),Nt.forEach(t),n=0;n<Lt.length;n++)(i=Lt[n]).blockedOn===e&&(i.blockedOn=null);for(;0<Lt.length&&null===(n=Lt[0]).blockedOn;)Ft(n),null===n.blockedOn&&Lt.shift()}var Wt=y.ReactCurrentBatchConfig,jt=!0;function qt(e,t,n,i){var r=xt,o=Wt.transition;Wt.transition=null;try{xt=1,Yt(e,t,n,i)}finally{xt=r,Wt.transition=o}}function Xt(e,t,n,i){var r=xt,o=Wt.transition;Wt.transition=null;try{xt=4,Yt(e,t,n,i)}finally{xt=r,Wt.transition=o}}function Yt(e,t,n,i){if(jt){var r=Jt(e,t,n,i);if(null===r)ji(e,t,i,Kt,n),Ut(e,i);else if(function(e,t,n,i,r){switch(t){case"focusin":return Ct=kt(Ct,e,t,n,i,r),!0;case"dragenter":return It=kt(It,e,t,n,i,r),!0;case"mouseover":return Pt=kt(Pt,e,t,n,i,r),!0;case"pointerover":var o=r.pointerId;return Ot.set(o,kt(Ot.get(o)||null,e,t,n,i,r)),!0;case"gotpointercapture":return o=r.pointerId,Nt.set(o,kt(Nt.get(o)||null,e,t,n,i,r)),!0}return!1}(r,e,t,n,i))i.stopPropagation();else if(Ut(e,i),4&t&&-1<Dt.indexOf(e)){for(;null!==r;){var o=xr(r);if(null!==o&&Et(o),null===(o=Jt(e,t,n,i))&&ji(e,t,i,Kt,n),o===r)break;r=o}null!==r&&i.stopPropagation()}else ji(e,t,i,null,n)}}var Kt=null;function Jt(e,t,n,i){if(Kt=null,null!==(e=yr(e=Ee(i))))if(null===(t=Ge(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=We(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Kt=e,null}function $t(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Qe()){case et:return 1;case tt:return 4;case nt:case it:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Zt=null,Qt=null,en=null;function tn(){if(en)return en;var e,t,n=Qt,i=n.length,r="value"in Zt?Zt.value:Zt.textContent,o=r.length;for(e=0;e<i&&n[e]===r[e];e++);var s=i-e;for(t=1;t<=s&&n[i-t]===r[o-t];t++);return en=r.slice(e,1<t?1-t:void 0)}function nn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function rn(){return!0}function on(){return!1}function sn(e){function t(t,n,i,r,o){for(var s in this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=r,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(s)&&(t=e[s],this[s]=t?t(r):r[s]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?rn:on,this.isPropagationStopped=on,this}return F(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=rn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=rn)},persist:function(){},isPersistent:rn}),t}var an,ln,un,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},dn=sn(cn),hn=F({},cn,{view:0,detail:0}),pn=sn(hn),fn=F({},hn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Mn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==un&&(un&&"mousemove"===e.type?(an=e.screenX-un.screenX,ln=e.screenY-un.screenY):ln=an=0,un=e),an)},movementY:function(e){return"movementY"in e?e.movementY:ln}}),mn=sn(fn),gn=sn(F({},fn,{dataTransfer:0})),vn=sn(F({},hn,{relatedTarget:0})),_n=sn(F({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=F({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),xn=sn(yn),Sn=sn(F({},cn,{data:0})),En={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},bn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Tn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function wn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Tn[e])&&!!t[e]}function Mn(){return wn}var An=F({},hn,{key:function(e){if(e.key){var t=En[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=nn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?bn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Mn,charCode:function(e){return"keypress"===e.type?nn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?nn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Rn=sn(An),Cn=sn(F({},fn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),In=sn(F({},hn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Mn})),Pn=sn(F({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),On=F({},fn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Nn=sn(On),Ln=[9,13,27,32],Dn=a&&"CompositionEvent"in window,Un=null;a&&"documentMode"in document&&(Un=document.documentMode);var kn=a&&"TextEvent"in window&&!Un,Fn=a&&(!Dn||Un&&8<Un&&11>=Un),Bn=String.fromCharCode(32),Hn=!1;function Vn(e,t){switch(e){case"keyup":return-1!==Ln.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function zn(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var Gn=!1;var Wn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function jn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Wn[e.type]:"textarea"===t}function qn(e,t,n,i){Ae(i),0<(t=Xi(t,"onChange")).length&&(n=new dn("onChange","change",null,n,i),e.push({event:n,listeners:t}))}var Xn=null,Yn=null;function Kn(e){Bi(e,0)}function Jn(e){if(Y(Sr(e)))return e}function $n(e,t){if("change"===e)return t}var Zn=!1;if(a){var Qn;if(a){var ei="oninput"in document;if(!ei){var ti=document.createElement("div");ti.setAttribute("oninput","return;"),ei="function"==typeof ti.oninput}Qn=ei}else Qn=!1;Zn=Qn&&(!document.documentMode||9<document.documentMode)}function ni(){Xn&&(Xn.detachEvent("onpropertychange",ii),Yn=Xn=null)}function ii(e){if("value"===e.propertyName&&Jn(Yn)){var t=[];qn(t,Yn,e,Ee(e)),Oe(Kn,t)}}function ri(e,t,n){"focusin"===e?(ni(),Yn=n,(Xn=t).attachEvent("onpropertychange",ii)):"focusout"===e&&ni()}function oi(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Jn(Yn)}function si(e,t){if("click"===e)return Jn(t)}function ai(e,t){if("input"===e||"change"===e)return Jn(t)}var li="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t};function ui(e,t){if(li(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!l.call(t,r)||!li(e[r],t[r]))return!1}return!0}function ci(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function di(e,t){var n,i=ci(e);for(e=0;i;){if(3===i.nodeType){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=ci(i)}}function hi(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?hi(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function pi(){for(var e=window,t=K();t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch(i){n=!1}if(!n)break;t=K((e=t.contentWindow).document)}return t}function fi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function mi(e){var t=pi(),n=e.focusedElem,i=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&hi(n.ownerDocument.documentElement,n)){if(null!==i&&fi(n))if(t=i.start,void 0===(e=i.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var r=n.textContent.length,o=Math.min(i.start,r);i=void 0===i.end?o:Math.min(i.end,r),!e.extend&&o>i&&(r=i,i=o,o=r),r=di(n,o);var s=di(n,i);r&&s&&(1!==e.rangeCount||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==s.node||e.focusOffset!==s.offset)&&((t=t.createRange()).setStart(r.node,r.offset),e.removeAllRanges(),o>i?(e.addRange(t),e.extend(s.node,s.offset)):(t.setEnd(s.node,s.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"==typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var gi=a&&"documentMode"in document&&11>=document.documentMode,vi=null,_i=null,yi=null,xi=!1;function Si(e,t,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;xi||null==vi||vi!==K(i)||("selectionStart"in(i=vi)&&fi(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},yi&&ui(yi,i)||(yi=i,0<(i=Xi(_i,"onSelect")).length&&(t=new dn("onSelect","select",null,t,n),e.push({event:t,listeners:i}),t.target=vi)))}function Ei(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var bi={animationend:Ei("Animation","AnimationEnd"),animationiteration:Ei("Animation","AnimationIteration"),animationstart:Ei("Animation","AnimationStart"),transitionend:Ei("Transition","TransitionEnd")},Ti={},wi={};function Mi(e){if(Ti[e])return Ti[e];if(!bi[e])return e;var t,n=bi[e];for(t in n)if(n.hasOwnProperty(t)&&t in wi)return Ti[e]=n[t];return e}a&&(wi=document.createElement("div").style,"AnimationEvent"in window||(delete bi.animationend.animation,delete bi.animationiteration.animation,delete bi.animationstart.animation),"TransitionEvent"in window||delete bi.transitionend.transition);var Ai=Mi("animationend"),Ri=Mi("animationiteration"),Ci=Mi("animationstart"),Ii=Mi("transitionend"),Pi=new Map,Oi="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ni(e,t){Pi.set(e,t),o(t,[e])}for(var Li=0;Li<Oi.length;Li++){var Di=Oi[Li];Ni(Di.toLowerCase(),"on"+(Di[0].toUpperCase()+Di.slice(1)))}Ni(Ai,"onAnimationEnd"),Ni(Ri,"onAnimationIteration"),Ni(Ci,"onAnimationStart"),Ni("dblclick","onDoubleClick"),Ni("focusin","onFocus"),Ni("focusout","onBlur"),Ni(Ii,"onTransitionEnd"),s("onMouseEnter",["mouseout","mouseover"]),s("onMouseLeave",["mouseout","mouseover"]),s("onPointerEnter",["pointerout","pointerover"]),s("onPointerLeave",["pointerout","pointerover"]),o("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),o("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),o("onBeforeInput",["compositionend","keypress","textInput","paste"]),o("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ui="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ki=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ui));function Fi(e,t,i){var r=e.type||"unknown-event";e.currentTarget=i,function(e,t,i,r,o,s,a,l,u){if(ze.apply(this,arguments),ke){if(!ke)throw Error(n(198));var c=Fe;ke=!1,Fe=null,Be||(Be=!0,He=c)}}(r,t,void 0,e),e.currentTarget=null}function Bi(e,t){t=!!(4&t);for(var n=0;n<e.length;n++){var i=e[n],r=i.event;i=i.listeners;e:{var o=void 0;if(t)for(var s=i.length-1;0<=s;s--){var a=i[s],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==o&&r.isPropagationStopped())break e;Fi(r,a,u),o=l}else for(s=0;s<i.length;s++){if(l=(a=i[s]).instance,u=a.currentTarget,a=a.listener,l!==o&&r.isPropagationStopped())break e;Fi(r,a,u),o=l}}}if(Be)throw e=He,Be=!1,He=null,e}function Hi(e,t){var n=t[gr];void 0===n&&(n=t[gr]=new Set);var i=e+"__bubble";n.has(i)||(Wi(t,e,2,!1),n.add(i))}function Vi(e,t,n){var i=0;t&&(i|=4),Wi(n,e,i,t)}var zi="_reactListening"+Math.random().toString(36).slice(2);function Gi(e){if(!e[zi]){e[zi]=!0,i.forEach(function(t){"selectionchange"!==t&&(ki.has(t)||Vi(t,!1,e),Vi(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[zi]||(t[zi]=!0,Vi("selectionchange",!1,t))}}function Wi(e,t,n,i){switch($t(t)){case 1:var r=qt;break;case 4:r=Xt;break;default:r=Yt}n=r.bind(null,t,n,e),r=void 0,!Le||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),i?void 0!==r?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):void 0!==r?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function ji(e,t,n,i,r){var o=i;if(!(1&t||2&t||null===i))e:for(;;){if(null===i)return;var s=i.tag;if(3===s||4===s){var a=i.stateNode.containerInfo;if(a===r||8===a.nodeType&&a.parentNode===r)break;if(4===s)for(s=i.return;null!==s;){var l=s.tag;if((3===l||4===l)&&((l=s.stateNode.containerInfo)===r||8===l.nodeType&&l.parentNode===r))return;s=s.return}for(;null!==a;){if(null===(s=yr(a)))return;if(5===(l=s.tag)||6===l){i=o=s;continue e}a=a.parentNode}}i=i.return}Oe(function(){var i=o,r=Ee(n),s=[];e:{var a=Pi.get(e);if(void 0!==a){var l=dn,u=e;switch(e){case"keypress":if(0===nn(n))break e;case"keydown":case"keyup":l=Rn;break;case"focusin":u="focus",l=vn;break;case"focusout":u="blur",l=vn;break;case"beforeblur":case"afterblur":l=vn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=mn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=gn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=In;break;case Ai:case Ri:case Ci:l=_n;break;case Ii:l=Pn;break;case"scroll":l=pn;break;case"wheel":l=Nn;break;case"copy":case"cut":case"paste":l=xn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Cn}var c=!!(4&t),d=!c&&"scroll"===e,h=c?null!==a?a+"Capture":null:a;c=[];for(var p,f=i;null!==f;){var m=(p=f).stateNode;if(5===p.tag&&null!==m&&(p=m,null!==h&&(null!=(m=Ne(f,h))&&c.push(qi(f,m,p)))),d)break;f=f.return}0<c.length&&(a=new l(a,u,null,n,r),s.push({event:a,listeners:c}))}}if(!(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(a="mouseover"===e||"pointerover"===e)||n===Se||!(u=n.relatedTarget||n.fromElement)||!yr(u)&&!u[mr])&&(l||a)&&(a=r.window===r?r:(a=r.ownerDocument)?a.defaultView||a.parentWindow:window,l?(l=i,null!==(u=(u=n.relatedTarget||n.toElement)?yr(u):null)&&(u!==(d=Ge(u))||5!==u.tag&&6!==u.tag)&&(u=null)):(l=null,u=i),l!==u)){if(c=mn,m="onMouseLeave",h="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(c=Cn,m="onPointerLeave",h="onPointerEnter",f="pointer"),d=null==l?a:Sr(l),p=null==u?a:Sr(u),(a=new c(m,f+"leave",l,n,r)).target=d,a.relatedTarget=p,m=null,yr(r)===i&&((c=new c(h,f+"enter",u,n,r)).target=p,c.relatedTarget=d,m=c),d=m,l&&u)e:{for(h=u,f=0,p=c=l;p;p=Yi(p))f++;for(p=0,m=h;m;m=Yi(m))p++;for(;0<f-p;)c=Yi(c),f--;for(;0<p-f;)h=Yi(h),p--;for(;f--;){if(c===h||null!==h&&c===h.alternate)break e;c=Yi(c),h=Yi(h)}c=null}else c=null;null!==l&&Ki(s,a,l,c,!1),null!==u&&null!==d&&Ki(s,d,u,c,!0)}if("select"===(l=(a=i?Sr(i):window).nodeName&&a.nodeName.toLowerCase())||"input"===l&&"file"===a.type)var g=$n;else if(jn(a))if(Zn)g=ai;else{g=oi;var v=ri}else(l=a.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===a.type||"radio"===a.type)&&(g=si);switch(g&&(g=g(e,i))?qn(s,g,n,r):(v&&v(e,a,i),"focusout"===e&&(v=a._wrapperState)&&v.controlled&&"number"===a.type&&te(a,"number",a.value)),v=i?Sr(i):window,e){case"focusin":(jn(v)||"true"===v.contentEditable)&&(vi=v,_i=i,yi=null);break;case"focusout":yi=_i=vi=null;break;case"mousedown":xi=!0;break;case"contextmenu":case"mouseup":case"dragend":xi=!1,Si(s,n,r);break;case"selectionchange":if(gi)break;case"keydown":case"keyup":Si(s,n,r)}var _;if(Dn)e:{switch(e){case"compositionstart":var y="onCompositionStart";break e;case"compositionend":y="onCompositionEnd";break e;case"compositionupdate":y="onCompositionUpdate";break e}y=void 0}else Gn?Vn(e,n)&&(y="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(y="onCompositionStart");y&&(Fn&&"ko"!==n.locale&&(Gn||"onCompositionStart"!==y?"onCompositionEnd"===y&&Gn&&(_=tn()):(Qt="value"in(Zt=r)?Zt.value:Zt.textContent,Gn=!0)),0<(v=Xi(i,y)).length&&(y=new Sn(y,e,null,n,r),s.push({event:y,listeners:v}),_?y.data=_:null!==(_=zn(n))&&(y.data=_))),(_=kn?function(e,t){switch(e){case"compositionend":return zn(t);case"keypress":return 32!==t.which?null:(Hn=!0,Bn);case"textInput":return(e=t.data)===Bn&&Hn?null:e;default:return null}}(e,n):function(e,t){if(Gn)return"compositionend"===e||!Dn&&Vn(e,t)?(e=tn(),en=Qt=Zt=null,Gn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Fn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(i=Xi(i,"onBeforeInput")).length&&(r=new Sn("onBeforeInput","beforeinput",null,n,r),s.push({event:r,listeners:i}),r.data=_))}Bi(s,t)})}function qi(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Xi(e,t){for(var n=t+"Capture",i=[];null!==e;){var r=e,o=r.stateNode;5===r.tag&&null!==o&&(r=o,null!=(o=Ne(e,n))&&i.unshift(qi(e,o,r)),null!=(o=Ne(e,t))&&i.push(qi(e,o,r))),e=e.return}return i}function Yi(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Ki(e,t,n,i,r){for(var o=t._reactName,s=[];null!==n&&n!==i;){var a=n,l=a.alternate,u=a.stateNode;if(null!==l&&l===i)break;5===a.tag&&null!==u&&(a=u,r?null!=(l=Ne(n,o))&&s.unshift(qi(n,l,a)):r||null!=(l=Ne(n,o))&&s.push(qi(n,l,a))),n=n.return}0!==s.length&&e.push({event:t,listeners:s})}var Ji=/\r\n?/g,$i=/\u0000|\uFFFD/g;function Zi(e){return("string"==typeof e?e:""+e).replace(Ji,"\n").replace($i,"")}function Qi(e,t,i){if(t=Zi(t),Zi(e)!==t&&i)throw Error(n(425))}function er(){}var tr=null,nr=null;function ir(e,t){return"textarea"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var rr="function"==typeof setTimeout?setTimeout:void 0,or="function"==typeof clearTimeout?clearTimeout:void 0,sr="function"==typeof Promise?Promise:void 0,ar="function"==typeof queueMicrotask?queueMicrotask:void 0!==sr?function(e){return sr.resolve(null).then(e).catch(lr)}:rr;function lr(e){setTimeout(function(){throw e})}function ur(e,t){var n=t,i=0;do{var r=n.nextSibling;if(e.removeChild(n),r&&8===r.nodeType)if("/$"===(n=r.data)){if(0===i)return e.removeChild(r),void Gt(t);i--}else"$"!==n&&"$?"!==n&&"$!"!==n||i++;n=r}while(n);Gt(t)}function cr(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function dr(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var hr=Math.random().toString(36).slice(2),pr="__reactFiber$"+hr,fr="__reactProps$"+hr,mr="__reactContainer$"+hr,gr="__reactEvents$"+hr,vr="__reactListeners$"+hr,_r="__reactHandles$"+hr;function yr(e){var t=e[pr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[mr]||n[pr]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=dr(e);null!==e;){if(n=e[pr])return n;e=dr(e)}return t}n=(e=n).parentNode}return null}function xr(e){return!(e=e[pr]||e[mr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function Sr(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(n(33))}function Er(e){return e[fr]||null}var br=[],Tr=-1;function wr(e){return{current:e}}function Mr(e){0>Tr||(e.current=br[Tr],br[Tr]=null,Tr--)}function Ar(e,t){Tr++,br[Tr]=e.current,e.current=t}var Rr={},Cr=wr(Rr),Ir=wr(!1),Pr=Rr;function Or(e,t){var n=e.type.contextTypes;if(!n)return Rr;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var r,o={};for(r in n)o[r]=t[r];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function Nr(e){return null!=(e=e.childContextTypes)}function Lr(){Mr(Ir),Mr(Cr)}function Dr(e,t,i){if(Cr.current!==Rr)throw Error(n(168));Ar(Cr,t),Ar(Ir,i)}function Ur(e,t,i){var r=e.stateNode;if(t=t.childContextTypes,"function"!=typeof r.getChildContext)return i;for(var o in r=r.getChildContext())if(!(o in t))throw Error(n(108,W(e)||"Unknown",o));return F({},i,r)}function kr(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Rr,Pr=Cr.current,Ar(Cr,e),Ar(Ir,Ir.current),!0}function Fr(e,t,i){var r=e.stateNode;if(!r)throw Error(n(169));i?(e=Ur(e,t,Pr),r.__reactInternalMemoizedMergedChildContext=e,Mr(Ir),Mr(Cr),Ar(Cr,e)):Mr(Ir),Ar(Ir,i)}var Br=null,Hr=!1,Vr=!1;function zr(e){null===Br?Br=[e]:Br.push(e)}function Gr(){if(!Vr&&null!==Br){Vr=!0;var e=0,t=xt;try{var n=Br;for(xt=1;e<n.length;e++){var i=n[e];do{i=i(!0)}while(null!==i)}Br=null,Hr=!1}catch(r){throw null!==Br&&(Br=Br.slice(e+1)),Ye(et,Gr),r}finally{xt=t,Vr=!1}}return null}var Wr=[],jr=0,qr=null,Xr=0,Yr=[],Kr=0,Jr=null,$r=1,Zr="";function Qr(e,t){Wr[jr++]=Xr,Wr[jr++]=qr,qr=e,Xr=t}function eo(e,t,n){Yr[Kr++]=$r,Yr[Kr++]=Zr,Yr[Kr++]=Jr,Jr=e;var i=$r;e=Zr;var r=32-at(i)-1;i&=~(1<<r),n+=1;var o=32-at(t)+r;if(30<o){var s=r-r%5;o=(i&(1<<s)-1).toString(32),i>>=s,r-=s,$r=1<<32-at(t)+r|n<<r|i,Zr=o+e}else $r=1<<o|n<<r|i,Zr=e}function to(e){null!==e.return&&(Qr(e,1),eo(e,1,0))}function no(e){for(;e===qr;)qr=Wr[--jr],Wr[jr]=null,Xr=Wr[--jr],Wr[jr]=null;for(;e===Jr;)Jr=Yr[--Kr],Yr[Kr]=null,Zr=Yr[--Kr],Yr[Kr]=null,$r=Yr[--Kr],Yr[Kr]=null}var io=null,ro=null,oo=!1,so=null;function ao(e,t){var n=Ou(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function lo(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,io=e,ro=cr(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,io=e,ro=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Jr?{id:$r,overflow:Zr}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Ou(18,null,null,0)).stateNode=t,n.return=e,e.child=n,io=e,ro=null,!0);default:return!1}}function uo(e){return!(!(1&e.mode)||128&e.flags)}function co(e){if(oo){var t=ro;if(t){var i=t;if(!lo(e,t)){if(uo(e))throw Error(n(418));t=cr(i.nextSibling);var r=io;t&&lo(e,t)?ao(r,i):(e.flags=-4097&e.flags|2,oo=!1,io=e)}}else{if(uo(e))throw Error(n(418));e.flags=-4097&e.flags|2,oo=!1,io=e}}}function ho(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;io=e}function po(e){if(e!==io)return!1;if(!oo)return ho(e),oo=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ir(e.type,e.memoizedProps)),t&&(t=ro)){if(uo(e))throw fo(),Error(n(418));for(;t;)ao(e,t),t=cr(t.nextSibling)}if(ho(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(n(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var i=e.data;if("/$"===i){if(0===t){ro=cr(e.nextSibling);break e}t--}else"$"!==i&&"$!"!==i&&"$?"!==i||t++}e=e.nextSibling}ro=null}}else ro=io?cr(e.stateNode.nextSibling):null;return!0}function fo(){for(var e=ro;e;)e=cr(e.nextSibling)}function mo(){ro=io=null,oo=!1}function go(e){null===so?so=[e]:so.push(e)}var vo=y.ReactCurrentBatchConfig;function _o(e,t,i){if(null!==(e=i.ref)&&"function"!=typeof e&&"object"!=typeof e){if(i._owner){if(i=i._owner){if(1!==i.tag)throw Error(n(309));var r=i.stateNode}if(!r)throw Error(n(147,e));var o=r,s=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===s?t.ref:((t=function(e){var t=o.refs;null===e?delete t[s]:t[s]=e})._stringRef=s,t)}if("string"!=typeof e)throw Error(n(284));if(!i._owner)throw Error(n(290,e))}return e}function yo(e,t){throw e=Object.prototype.toString.call(t),Error(n(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function xo(e){return(0,e._init)(e._payload)}function So(e){function t(t,n){if(e){var i=t.deletions;null===i?(t.deletions=[n],t.flags|=16):i.push(n)}}function i(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function o(e,t){return(e=Lu(e,t)).index=0,e.sibling=null,e}function s(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags|=2,n):i:(t.flags|=2,n):(t.flags|=1048576,n)}function a(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,n,i){return null===t||6!==t.tag?((t=Fu(n,e.mode,i)).return=e,t):((t=o(t,n)).return=e,t)}function u(e,t,n,i){var r=n.type;return r===T?d(e,t,n.props.children,i,n.key):null!==t&&(t.elementType===r||"object"==typeof r&&null!==r&&r.$$typeof===N&&xo(r)===t.type)?((i=o(t,n.props)).ref=_o(e,t,n),i.return=e,i):((i=Du(n.type,n.key,n.props,null,e.mode,i)).ref=_o(e,t,n),i.return=e,i)}function c(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Bu(n,e.mode,i)).return=e,t):((t=o(t,n.children||[])).return=e,t)}function d(e,t,n,i,r){return null===t||7!==t.tag?((t=Uu(n,e.mode,i,r)).return=e,t):((t=o(t,n)).return=e,t)}function h(e,t,n){if("string"==typeof t&&""!==t||"number"==typeof t)return(t=Fu(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case S:return(n=Du(t.type,t.key,t.props,null,e.mode,n)).ref=_o(e,null,t),n.return=e,n;case E:return(t=Bu(t,e.mode,n)).return=e,t;case N:return h(e,(0,t._init)(t._payload),n)}if(ne(t)||U(t))return(t=Uu(t,e.mode,n,null)).return=e,t;yo(e,t)}return null}function p(e,t,n,i){var r=null!==t?t.key:null;if("string"==typeof n&&""!==n||"number"==typeof n)return null!==r?null:l(e,t,""+n,i);if("object"==typeof n&&null!==n){switch(n.$$typeof){case S:return n.key===r?u(e,t,n,i):null;case E:return n.key===r?c(e,t,n,i):null;case N:return p(e,t,(r=n._init)(n._payload),i)}if(ne(n)||U(n))return null!==r?null:d(e,t,n,i,null);yo(e,n)}return null}function f(e,t,n,i,r){if("string"==typeof i&&""!==i||"number"==typeof i)return l(t,e=e.get(n)||null,""+i,r);if("object"==typeof i&&null!==i){switch(i.$$typeof){case S:return u(t,e=e.get(null===i.key?n:i.key)||null,i,r);case E:return c(t,e=e.get(null===i.key?n:i.key)||null,i,r);case N:return f(e,t,n,(0,i._init)(i._payload),r)}if(ne(i)||U(i))return d(t,e=e.get(n)||null,i,r,null);yo(t,i)}return null}return function l(u,c,d,m){if("object"==typeof d&&null!==d&&d.type===T&&null===d.key&&(d=d.props.children),"object"==typeof d&&null!==d){switch(d.$$typeof){case S:e:{for(var g=d.key,v=c;null!==v;){if(v.key===g){if((g=d.type)===T){if(7===v.tag){i(u,v.sibling),(c=o(v,d.props.children)).return=u,u=c;break e}}else if(v.elementType===g||"object"==typeof g&&null!==g&&g.$$typeof===N&&xo(g)===v.type){i(u,v.sibling),(c=o(v,d.props)).ref=_o(u,v,d),c.return=u,u=c;break e}i(u,v);break}t(u,v),v=v.sibling}d.type===T?((c=Uu(d.props.children,u.mode,m,d.key)).return=u,u=c):((m=Du(d.type,d.key,d.props,null,u.mode,m)).ref=_o(u,c,d),m.return=u,u=m)}return a(u);case E:e:{for(v=d.key;null!==c;){if(c.key===v){if(4===c.tag&&c.stateNode.containerInfo===d.containerInfo&&c.stateNode.implementation===d.implementation){i(u,c.sibling),(c=o(c,d.children||[])).return=u,u=c;break e}i(u,c);break}t(u,c),c=c.sibling}(c=Bu(d,u.mode,m)).return=u,u=c}return a(u);case N:return l(u,c,(v=d._init)(d._payload),m)}if(ne(d))return function(n,o,a,l){for(var u=null,c=null,d=o,m=o=0,g=null;null!==d&&m<a.length;m++){d.index>m?(g=d,d=null):g=d.sibling;var v=p(n,d,a[m],l);if(null===v){null===d&&(d=g);break}e&&d&&null===v.alternate&&t(n,d),o=s(v,o,m),null===c?u=v:c.sibling=v,c=v,d=g}if(m===a.length)return i(n,d),oo&&Qr(n,m),u;if(null===d){for(;m<a.length;m++)null!==(d=h(n,a[m],l))&&(o=s(d,o,m),null===c?u=d:c.sibling=d,c=d);return oo&&Qr(n,m),u}for(d=r(n,d);m<a.length;m++)null!==(g=f(d,n,m,a[m],l))&&(e&&null!==g.alternate&&d.delete(null===g.key?m:g.key),o=s(g,o,m),null===c?u=g:c.sibling=g,c=g);return e&&d.forEach(function(e){return t(n,e)}),oo&&Qr(n,m),u}(u,c,d,m);if(U(d))return function(o,a,l,u){var c=U(l);if("function"!=typeof c)throw Error(n(150));if(null==(l=c.call(l)))throw Error(n(151));for(var d=c=null,m=a,g=a=0,v=null,_=l.next();null!==m&&!_.done;g++,_=l.next()){m.index>g?(v=m,m=null):v=m.sibling;var y=p(o,m,_.value,u);if(null===y){null===m&&(m=v);break}e&&m&&null===y.alternate&&t(o,m),a=s(y,a,g),null===d?c=y:d.sibling=y,d=y,m=v}if(_.done)return i(o,m),oo&&Qr(o,g),c;if(null===m){for(;!_.done;g++,_=l.next())null!==(_=h(o,_.value,u))&&(a=s(_,a,g),null===d?c=_:d.sibling=_,d=_);return oo&&Qr(o,g),c}for(m=r(o,m);!_.done;g++,_=l.next())null!==(_=f(m,o,g,_.value,u))&&(e&&null!==_.alternate&&m.delete(null===_.key?g:_.key),a=s(_,a,g),null===d?c=_:d.sibling=_,d=_);return e&&m.forEach(function(e){return t(o,e)}),oo&&Qr(o,g),c}(u,c,d,m);yo(u,d)}return"string"==typeof d&&""!==d||"number"==typeof d?(d=""+d,null!==c&&6===c.tag?(i(u,c.sibling),(c=o(c,d)).return=u,u=c):(i(u,c),(c=Fu(d,u.mode,m)).return=u,u=c),a(u)):i(u,c)}}var Eo=So(!0),bo=So(!1),To=wr(null),wo=null,Mo=null,Ao=null;function Ro(){Ao=Mo=wo=null}function Co(e){var t=To.current;Mr(To),e._currentValue=t}function Io(e,t,n){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function Po(e,t){wo=e,Ao=Mo=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(xa=!0),e.firstContext=null)}function Oo(e){var t=e._currentValue;if(Ao!==e)if(e={context:e,memoizedValue:t,next:null},null===Mo){if(null===wo)throw Error(n(308));Mo=e,wo.dependencies={lanes:0,firstContext:e}}else Mo=Mo.next=e;return t}var No=null;function Lo(e){null===No?No=[e]:No.push(e)}function Do(e,t,n,i){var r=t.interleaved;return null===r?(n.next=n,Lo(t)):(n.next=r.next,r.next=n),t.interleaved=n,Uo(e,i)}function Uo(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var ko=!1;function Fo(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Bo(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Ho(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Vo(e,t,n){var i=e.updateQueue;if(null===i)return null;if(i=i.shared,2&Cl){var r=i.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),i.pending=t,Uo(e,n)}return null===(r=i.interleaved)?(t.next=t,Lo(i)):(t.next=r.next,r.next=t),i.interleaved=t,Uo(e,n)}function zo(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,4194240&n)){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,yt(e,n)}}function Go(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,o=null;if(null!==(n=n.firstBaseUpdate)){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===o?r=o=s:o=o.next=s,n=n.next}while(null!==n);null===o?r=o=t:o=o.next=t}else r=o=t;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:o,shared:i.shared,effects:i.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Wo(e,t,n,i){var r=e.updateQueue;ko=!1;var o=r.firstBaseUpdate,s=r.lastBaseUpdate,a=r.shared.pending;if(null!==a){r.shared.pending=null;var l=a,u=l.next;l.next=null,null===s?o=u:s.next=u,s=l;var c=e.alternate;null!==c&&((a=(c=c.updateQueue).lastBaseUpdate)!==s&&(null===a?c.firstBaseUpdate=u:a.next=u,c.lastBaseUpdate=l))}if(null!==o){var d=r.baseState;for(s=0,c=u=l=null,a=o;;){var h=a.lane,p=a.eventTime;if((i&h)===h){null!==c&&(c=c.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var f=e,m=a;switch(h=t,p=n,m.tag){case 1:if("function"==typeof(f=m.payload)){d=f.call(p,d,h);break e}d=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null==(h="function"==typeof(f=m.payload)?f.call(p,d,h):f))break e;d=F({},d,h);break e;case 2:ko=!0}}null!==a.callback&&0!==a.lane&&(e.flags|=64,null===(h=r.effects)?r.effects=[a]:h.push(a))}else p={eventTime:p,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===c?(u=c=p,l=d):c=c.next=p,s|=h;if(null===(a=a.next)){if(null===(a=r.shared.pending))break;a=(h=a).next,h.next=null,r.lastBaseUpdate=h,r.shared.pending=null}}if(null===c&&(l=d),r.baseState=l,r.firstBaseUpdate=u,r.lastBaseUpdate=c,null!==(t=r.shared.interleaved)){r=t;do{s|=r.lane,r=r.next}while(r!==t)}else null===o&&(r.shared.lanes=0);kl|=s,e.lanes=s,e.memoizedState=d}}function jo(e,t,i){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],o=r.callback;if(null!==o){if(r.callback=null,r=i,"function"!=typeof o)throw Error(n(191,o));o.call(r)}}}var qo={},Xo=wr(qo),Yo=wr(qo),Ko=wr(qo);function Jo(e){if(e===qo)throw Error(n(174));return e}function $o(e,t){switch(Ar(Ko,t),Ar(Yo,e),Ar(Xo,qo),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ue(null,"");break;default:t=ue(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Mr(Xo),Ar(Xo,t)}function Zo(){Mr(Xo),Mr(Yo),Mr(Ko)}function Qo(e){Jo(Ko.current);var t=Jo(Xo.current),n=ue(t,e.type);t!==n&&(Ar(Yo,e),Ar(Xo,n))}function es(e){Yo.current===e&&(Mr(Xo),Mr(Yo))}var ts=wr(0);function ns(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(128&t.flags)return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var is=[];function rs(){for(var e=0;e<is.length;e++)is[e]._workInProgressVersionPrimary=null;is.length=0}var os=y.ReactCurrentDispatcher,ss=y.ReactCurrentBatchConfig,as=0,ls=null,us=null,cs=null,ds=!1,hs=!1,ps=0,fs=0;function ms(){throw Error(n(321))}function gs(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!li(e[n],t[n]))return!1;return!0}function vs(e,t,i,r,o,s){if(as=s,ls=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,os.current=null===e||null===e.memoizedState?ea:ta,e=i(r,o),hs){s=0;do{if(hs=!1,ps=0,25<=s)throw Error(n(301));s+=1,cs=us=null,t.updateQueue=null,os.current=na,e=i(r,o)}while(hs)}if(os.current=Qs,t=null!==us&&null!==us.next,as=0,cs=us=ls=null,ds=!1,t)throw Error(n(300));return e}function _s(){var e=0!==ps;return ps=0,e}function ys(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===cs?ls.memoizedState=cs=e:cs=cs.next=e,cs}function xs(){if(null===us){var e=ls.alternate;e=null!==e?e.memoizedState:null}else e=us.next;var t=null===cs?ls.memoizedState:cs.next;if(null!==t)cs=t,us=e;else{if(null===e)throw Error(n(310));e={memoizedState:(us=e).memoizedState,baseState:us.baseState,baseQueue:us.baseQueue,queue:us.queue,next:null},null===cs?ls.memoizedState=cs=e:cs=cs.next=e}return cs}function Ss(e,t){return"function"==typeof t?t(e):t}function Es(e){var t=xs(),i=t.queue;if(null===i)throw Error(n(311));i.lastRenderedReducer=e;var r=us,o=r.baseQueue,s=i.pending;if(null!==s){if(null!==o){var a=o.next;o.next=s.next,s.next=a}r.baseQueue=o=s,i.pending=null}if(null!==o){s=o.next,r=r.baseState;var l=a=null,u=null,c=s;do{var d=c.lane;if((as&d)===d)null!==u&&(u=u.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:e(r,c.action);else{var h={lane:d,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};null===u?(l=u=h,a=r):u=u.next=h,ls.lanes|=d,kl|=d}c=c.next}while(null!==c&&c!==s);null===u?a=r:u.next=l,li(r,t.memoizedState)||(xa=!0),t.memoizedState=r,t.baseState=a,t.baseQueue=u,i.lastRenderedState=r}if(null!==(e=i.interleaved)){o=e;do{s=o.lane,ls.lanes|=s,kl|=s,o=o.next}while(o!==e)}else null===o&&(i.lanes=0);return[t.memoizedState,i.dispatch]}function bs(e){var t=xs(),i=t.queue;if(null===i)throw Error(n(311));i.lastRenderedReducer=e;var r=i.dispatch,o=i.pending,s=t.memoizedState;if(null!==o){i.pending=null;var a=o=o.next;do{s=e(s,a.action),a=a.next}while(a!==o);li(s,t.memoizedState)||(xa=!0),t.memoizedState=s,null===t.baseQueue&&(t.baseState=s),i.lastRenderedState=s}return[s,r]}function Ts(){}function ws(e,t){var i=ls,r=xs(),o=t(),s=!li(r.memoizedState,o);if(s&&(r.memoizedState=o,xa=!0),r=r.queue,ks(Rs.bind(null,i,r,e),[e]),r.getSnapshot!==t||s||null!==cs&&1&cs.memoizedState.tag){if(i.flags|=2048,Os(9,As.bind(null,i,r,o,t),void 0,null),null===Il)throw Error(n(349));30&as||Ms(i,t,o)}return o}function Ms(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=ls.updateQueue)?(t={lastEffect:null,stores:null},ls.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function As(e,t,n,i){t.value=n,t.getSnapshot=i,Cs(t)&&Is(e)}function Rs(e,t,n){return n(function(){Cs(t)&&Is(e)})}function Cs(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!li(e,n)}catch(i){return!0}}function Is(e){var t=Uo(e,1);null!==t&&iu(t,e,1,-1)}function Ps(e){var t=ys();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ss,lastRenderedState:e},t.queue=e,e=e.dispatch=Ks.bind(null,ls,e),[t.memoizedState,e]}function Os(e,t,n,i){return e={tag:e,create:t,destroy:n,deps:i,next:null},null===(t=ls.updateQueue)?(t={lastEffect:null,stores:null},ls.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function Ns(){return xs().memoizedState}function Ls(e,t,n,i){var r=ys();ls.flags|=e,r.memoizedState=Os(1|t,n,void 0,void 0===i?null:i)}function Ds(e,t,n,i){var r=xs();i=void 0===i?null:i;var o=void 0;if(null!==us){var s=us.memoizedState;if(o=s.destroy,null!==i&&gs(i,s.deps))return void(r.memoizedState=Os(t,n,o,i))}ls.flags|=e,r.memoizedState=Os(1|t,n,o,i)}function Us(e,t){return Ls(8390656,8,e,t)}function ks(e,t){return Ds(2048,8,e,t)}function Fs(e,t){return Ds(4,2,e,t)}function Bs(e,t){return Ds(4,4,e,t)}function Hs(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Vs(e,t,n){return n=null!=n?n.concat([e]):null,Ds(4,4,Hs.bind(null,t,e),n)}function zs(){}function Gs(e,t){var n=xs();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&gs(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function Ws(e,t){var n=xs();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&gs(t,i[1])?i[0]:(e=e(),n.memoizedState=[e,t],e)}function js(e,t,n){return 21&as?(li(n,t)||(n=gt(),ls.lanes|=n,kl|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,xa=!0),e.memoizedState=n)}function qs(e,t){var n=xt;xt=0!==n&&4>n?n:4,e(!0);var i=ss.transition;ss.transition={};try{e(!1),t()}finally{xt=n,ss.transition=i}}function Xs(){return xs().memoizedState}function Ys(e,t,n){var i=nu(e);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},Js(e))$s(t,n);else if(null!==(n=Do(e,t,n,i))){iu(n,e,i,tu()),Zs(n,t,i)}}function Ks(e,t,n){var i=nu(e),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(Js(e))$s(t,r);else{var o=e.alternate;if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var s=t.lastRenderedState,a=o(s,n);if(r.hasEagerState=!0,r.eagerState=a,li(a,s)){var l=t.interleaved;return null===l?(r.next=r,Lo(t)):(r.next=l.next,l.next=r),void(t.interleaved=r)}}catch(u){}null!==(n=Do(e,t,r,i))&&(iu(n,e,i,r=tu()),Zs(n,t,i))}}function Js(e){var t=e.alternate;return e===ls||null!==t&&t===ls}function $s(e,t){hs=ds=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Zs(e,t,n){if(4194240&n){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,yt(e,n)}}var Qs={readContext:Oo,useCallback:ms,useContext:ms,useEffect:ms,useImperativeHandle:ms,useInsertionEffect:ms,useLayoutEffect:ms,useMemo:ms,useReducer:ms,useRef:ms,useState:ms,useDebugValue:ms,useDeferredValue:ms,useTransition:ms,useMutableSource:ms,useSyncExternalStore:ms,useId:ms,unstable_isNewReconciler:!1},ea={readContext:Oo,useCallback:function(e,t){return ys().memoizedState=[e,void 0===t?null:t],e},useContext:Oo,useEffect:Us,useImperativeHandle:function(e,t,n){return n=null!=n?n.concat([e]):null,Ls(4194308,4,Hs.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Ls(4194308,4,e,t)},useInsertionEffect:function(e,t){return Ls(4,2,e,t)},useMemo:function(e,t){var n=ys();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var i=ys();return t=void 0!==n?n(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=Ys.bind(null,ls,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},ys().memoizedState=e},useState:Ps,useDebugValue:zs,useDeferredValue:function(e){return ys().memoizedState=e},useTransition:function(){var e=Ps(!1),t=e[0];return e=qs.bind(null,e[1]),ys().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,i){var r=ls,o=ys();if(oo){if(void 0===i)throw Error(n(407));i=i()}else{if(i=t(),null===Il)throw Error(n(349));30&as||Ms(r,t,i)}o.memoizedState=i;var s={value:i,getSnapshot:t};return o.queue=s,Us(Rs.bind(null,r,s,e),[e]),r.flags|=2048,Os(9,As.bind(null,r,s,i,t),void 0,null),i},useId:function(){var e=ys(),t=Il.identifierPrefix;if(oo){var n=Zr;t=":"+t+"R"+(n=($r&~(1<<32-at($r)-1)).toString(32)+n),0<(n=ps++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=fs++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},ta={readContext:Oo,useCallback:Gs,useContext:Oo,useEffect:ks,useImperativeHandle:Vs,useInsertionEffect:Fs,useLayoutEffect:Bs,useMemo:Ws,useReducer:Es,useRef:Ns,useState:function(){return Es(Ss)},useDebugValue:zs,useDeferredValue:function(e){return js(xs(),us.memoizedState,e)},useTransition:function(){return[Es(Ss)[0],xs().memoizedState]},useMutableSource:Ts,useSyncExternalStore:ws,useId:Xs,unstable_isNewReconciler:!1},na={readContext:Oo,useCallback:Gs,useContext:Oo,useEffect:ks,useImperativeHandle:Vs,useInsertionEffect:Fs,useLayoutEffect:Bs,useMemo:Ws,useReducer:bs,useRef:Ns,useState:function(){return bs(Ss)},useDebugValue:zs,useDeferredValue:function(e){var t=xs();return null===us?t.memoizedState=e:js(t,us.memoizedState,e)},useTransition:function(){return[bs(Ss)[0],xs().memoizedState]},useMutableSource:Ts,useSyncExternalStore:ws,useId:Xs,unstable_isNewReconciler:!1};function ia(e,t){if(e&&e.defaultProps){for(var n in t=F({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function ra(e,t,n,i){n=null==(n=n(i,t=e.memoizedState))?t:F({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var oa={isMounted:function(e){return!!(e=e._reactInternals)&&Ge(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var i=tu(),r=nu(e),o=Ho(i,r);o.payload=t,null!=n&&(o.callback=n),null!==(t=Vo(e,o,r))&&(iu(t,e,r,i),zo(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=tu(),r=nu(e),o=Ho(i,r);o.tag=1,o.payload=t,null!=n&&(o.callback=n),null!==(t=Vo(e,o,r))&&(iu(t,e,r,i),zo(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=tu(),i=nu(e),r=Ho(n,i);r.tag=2,null!=t&&(r.callback=t),null!==(t=Vo(e,r,i))&&(iu(t,e,i,n),zo(t,e,i))}};function sa(e,t,n,i,r,o,s){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,o,s):!t.prototype||!t.prototype.isPureReactComponent||(!ui(n,i)||!ui(r,o))}function aa(e,t,n){var i=!1,r=Rr,o=t.contextType;return"object"==typeof o&&null!==o?o=Oo(o):(r=Nr(t)?Pr:Cr.current,o=(i=null!=(i=t.contextTypes))?Or(e,r):Rr),t=new t(n,o),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=oa,e.stateNode=t,t._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=o),t}function la(e,t,n,i){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&oa.enqueueReplaceState(t,t.state,null)}function ua(e,t,n,i){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs={},Fo(e);var o=t.contextType;"object"==typeof o&&null!==o?r.context=Oo(o):(o=Nr(t)?Pr:Cr.current,r.context=Or(e,o)),r.state=e.memoizedState,"function"==typeof(o=t.getDerivedStateFromProps)&&(ra(e,t,o,n),r.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof r.getSnapshotBeforeUpdate||"function"!=typeof r.UNSAFE_componentWillMount&&"function"!=typeof r.componentWillMount||(t=r.state,"function"==typeof r.componentWillMount&&r.componentWillMount(),"function"==typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&oa.enqueueReplaceState(r,r.state,null),Wo(e,n,r,i),r.state=e.memoizedState),"function"==typeof r.componentDidMount&&(e.flags|=4194308)}function ca(e,t){try{var n="",i=t;do{n+=z(i),i=i.return}while(i);var r=n}catch(o){r="\nError generating stack: "+o.message+"\n"+o.stack}return{value:e,source:t,stack:r,digest:null}}function da(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function ha(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var pa="function"==typeof WeakMap?WeakMap:Map;function fa(e,t,n){(n=Ho(-1,n)).tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){jl||(jl=!0,ql=i),ha(0,t)},n}function ma(e,t,n){(n=Ho(-1,n)).tag=3;var i=e.type.getDerivedStateFromError;if("function"==typeof i){var r=t.value;n.payload=function(){return i(r)},n.callback=function(){ha(0,t)}}var o=e.stateNode;return null!==o&&"function"==typeof o.componentDidCatch&&(n.callback=function(){ha(0,t),"function"!=typeof i&&(null===Xl?Xl=new Set([this]):Xl.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function ga(e,t,n){var i=e.pingCache;if(null===i){i=e.pingCache=new pa;var r=new Set;i.set(t,r)}else void 0===(r=i.get(t))&&(r=new Set,i.set(t,r));r.has(n)||(r.add(n),e=Mu.bind(null,e,t,n),t.then(e,e))}function va(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function _a(e,t,n,i,r){return 1&e.mode?(e.flags|=65536,e.lanes=r,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Ho(-1,1)).tag=2,Vo(n,t,1))),n.lanes|=1),e)}var ya=y.ReactCurrentOwner,xa=!1;function Sa(e,t,n,i){t.child=null===e?bo(t,null,n,i):Eo(t,e.child,n,i)}function Ea(e,t,n,i,r){n=n.render;var o=t.ref;return Po(t,r),i=vs(e,t,n,i,o,r),n=_s(),null===e||xa?(oo&&n&&to(t),t.flags|=1,Sa(e,t,i,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,ja(e,t,r))}function ba(e,t,n,i,r){if(null===e){var o=n.type;return"function"!=typeof o||Nu(o)||void 0!==o.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Du(n.type,null,i,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,Ta(e,t,o,i,r))}if(o=e.child,0===(e.lanes&r)){var s=o.memoizedProps;if((n=null!==(n=n.compare)?n:ui)(s,i)&&e.ref===t.ref)return ja(e,t,r)}return t.flags|=1,(e=Lu(o,i)).ref=t.ref,e.return=t,t.child=e}function Ta(e,t,n,i,r){if(null!==e){var o=e.memoizedProps;if(ui(o,i)&&e.ref===t.ref){if(xa=!1,t.pendingProps=i=o,0===(e.lanes&r))return t.lanes=e.lanes,ja(e,t,r);131072&e.flags&&(xa=!0)}}return Aa(e,t,n,i,r)}function wa(e,t,n){var i=t.pendingProps,r=i.children,o=null!==e?e.memoizedState:null;if("hidden"===i.mode)if(1&t.mode){if(!(1073741824&n))return e=null!==o?o.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ar(Ll,Nl),Nl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=null!==o?o.baseLanes:n,Ar(Ll,Nl),Nl|=i}else t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ar(Ll,Nl),Nl|=n;else null!==o?(i=o.baseLanes|n,t.memoizedState=null):i=n,Ar(Ll,Nl),Nl|=i;return Sa(e,t,r,n),t.child}function Ma(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Aa(e,t,n,i,r){var o=Nr(n)?Pr:Cr.current;return o=Or(t,o),Po(t,r),n=vs(e,t,n,i,o,r),i=_s(),null===e||xa?(oo&&i&&to(t),t.flags|=1,Sa(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,ja(e,t,r))}function Ra(e,t,n,i,r){if(Nr(n)){var o=!0;kr(t)}else o=!1;if(Po(t,r),null===t.stateNode)Wa(e,t),aa(t,n,i),ua(t,n,i,r),i=!0;else if(null===e){var s=t.stateNode,a=t.memoizedProps;s.props=a;var l=s.context,u=n.contextType;"object"==typeof u&&null!==u?u=Oo(u):u=Or(t,u=Nr(n)?Pr:Cr.current);var c=n.getDerivedStateFromProps,d="function"==typeof c||"function"==typeof s.getSnapshotBeforeUpdate;d||"function"!=typeof s.UNSAFE_componentWillReceiveProps&&"function"!=typeof s.componentWillReceiveProps||(a!==i||l!==u)&&la(t,s,i,u),ko=!1;var h=t.memoizedState;s.state=h,Wo(t,i,s,r),l=t.memoizedState,a!==i||h!==l||Ir.current||ko?("function"==typeof c&&(ra(t,n,c,i),l=t.memoizedState),(a=ko||sa(t,n,a,i,h,l,u))?(d||"function"!=typeof s.UNSAFE_componentWillMount&&"function"!=typeof s.componentWillMount||("function"==typeof s.componentWillMount&&s.componentWillMount(),"function"==typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"==typeof s.componentDidMount&&(t.flags|=4194308)):("function"==typeof s.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=l),s.props=i,s.state=l,s.context=u,i=a):("function"==typeof s.componentDidMount&&(t.flags|=4194308),i=!1)}else{s=t.stateNode,Bo(e,t),a=t.memoizedProps,u=t.type===t.elementType?a:ia(t.type,a),s.props=u,d=t.pendingProps,h=s.context,"object"==typeof(l=n.contextType)&&null!==l?l=Oo(l):l=Or(t,l=Nr(n)?Pr:Cr.current);var p=n.getDerivedStateFromProps;(c="function"==typeof p||"function"==typeof s.getSnapshotBeforeUpdate)||"function"!=typeof s.UNSAFE_componentWillReceiveProps&&"function"!=typeof s.componentWillReceiveProps||(a!==d||h!==l)&&la(t,s,i,l),ko=!1,h=t.memoizedState,s.state=h,Wo(t,i,s,r);var f=t.memoizedState;a!==d||h!==f||Ir.current||ko?("function"==typeof p&&(ra(t,n,p,i),f=t.memoizedState),(u=ko||sa(t,n,u,i,h,f,l)||!1)?(c||"function"!=typeof s.UNSAFE_componentWillUpdate&&"function"!=typeof s.componentWillUpdate||("function"==typeof s.componentWillUpdate&&s.componentWillUpdate(i,f,l),"function"==typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(i,f,l)),"function"==typeof s.componentDidUpdate&&(t.flags|=4),"function"==typeof s.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof s.componentDidUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!=typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=f),s.props=i,s.state=f,s.context=l,i=u):("function"!=typeof s.componentDidUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!=typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),i=!1)}return Ca(e,t,n,i,o,r)}function Ca(e,t,n,i,r,o){Ma(e,t);var s=!!(128&t.flags);if(!i&&!s)return r&&Fr(t,n,!1),ja(e,t,o);i=t.stateNode,ya.current=t;var a=s&&"function"!=typeof n.getDerivedStateFromError?null:i.render();return t.flags|=1,null!==e&&s?(t.child=Eo(t,e.child,null,o),t.child=Eo(t,null,a,o)):Sa(e,t,a,o),t.memoizedState=i.state,r&&Fr(t,n,!0),t.child}function Ia(e){var t=e.stateNode;t.pendingContext?Dr(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Dr(0,t.context,!1),$o(e,t.containerInfo)}function Pa(e,t,n,i,r){return mo(),go(r),t.flags|=256,Sa(e,t,n,i),t.child}var Oa,Na,La,Da,Ua={dehydrated:null,treeContext:null,retryLane:0};function ka(e){return{baseLanes:e,cachePool:null,transitions:null}}function Fa(e,t,i){var r,o=t.pendingProps,s=ts.current,a=!1,l=!!(128&t.flags);if((r=l)||(r=(null===e||null!==e.memoizedState)&&!!(2&s)),r?(a=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(s|=1),Ar(ts,1&s),null===e)return co(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(1&t.mode?"$!"===e.data?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(l=o.children,e=o.fallback,a?(o=t.mode,a=t.child,l={mode:"hidden",children:l},1&o||null===a?a=ku(l,o,0,null):(a.childLanes=0,a.pendingProps=l),e=Uu(e,o,i,null),a.return=t,e.return=t,a.sibling=e,t.child=a,t.child.memoizedState=ka(i),t.memoizedState=Ua,e):Ba(t,l));if(null!==(s=e.memoizedState)&&null!==(r=s.dehydrated))return function(e,t,i,r,o,s,a){if(i)return 256&t.flags?(t.flags&=-257,Ha(e,t,a,r=da(Error(n(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(s=r.fallback,o=t.mode,r=ku({mode:"visible",children:r.children},o,0,null),(s=Uu(s,o,a,null)).flags|=2,r.return=t,s.return=t,r.sibling=s,t.child=r,1&t.mode&&Eo(t,e.child,null,a),t.child.memoizedState=ka(a),t.memoizedState=Ua,s);if(!(1&t.mode))return Ha(e,t,a,null);if("$!"===o.data){if(r=o.nextSibling&&o.nextSibling.dataset)var l=r.dgst;return r=l,Ha(e,t,a,r=da(s=Error(n(419)),r,void 0))}if(l=0!==(a&e.childLanes),xa||l){if(null!==(r=Il)){switch(a&-a){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}0!==(o=0!==(o&(r.suspendedLanes|a))?0:o)&&o!==s.retryLane&&(s.retryLane=o,Uo(e,o),iu(r,e,o,-1))}return gu(),Ha(e,t,a,r=da(Error(n(421))))}return"$?"===o.data?(t.flags|=128,t.child=e.child,t=Ru.bind(null,e),o._reactRetry=t,null):(e=s.treeContext,ro=cr(o.nextSibling),io=t,oo=!0,so=null,null!==e&&(Yr[Kr++]=$r,Yr[Kr++]=Zr,Yr[Kr++]=Jr,$r=e.id,Zr=e.overflow,Jr=t),t=Ba(t,r.children),t.flags|=4096,t)}(e,t,l,o,r,s,i);if(a){a=o.fallback,l=t.mode,r=(s=e.child).sibling;var u={mode:"hidden",children:o.children};return 1&l||t.child===s?(o=Lu(s,u)).subtreeFlags=14680064&s.subtreeFlags:((o=t.child).childLanes=0,o.pendingProps=u,t.deletions=null),null!==r?a=Lu(r,a):(a=Uu(a,l,i,null)).flags|=2,a.return=t,o.return=t,o.sibling=a,t.child=o,o=a,a=t.child,l=null===(l=e.child.memoizedState)?ka(i):{baseLanes:l.baseLanes|i,cachePool:null,transitions:l.transitions},a.memoizedState=l,a.childLanes=e.childLanes&~i,t.memoizedState=Ua,o}return e=(a=e.child).sibling,o=Lu(a,{mode:"visible",children:o.children}),!(1&t.mode)&&(o.lanes=i),o.return=t,o.sibling=null,null!==e&&(null===(i=t.deletions)?(t.deletions=[e],t.flags|=16):i.push(e)),t.child=o,t.memoizedState=null,o}function Ba(e,t){return(t=ku({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Ha(e,t,n,i){return null!==i&&go(i),Eo(t,e.child,null,n),(e=Ba(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Va(e,t,n){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),Io(e.return,t,n)}function za(e,t,n,i,r){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=i,o.tail=n,o.tailMode=r)}function Ga(e,t,n){var i=t.pendingProps,r=i.revealOrder,o=i.tail;if(Sa(e,t,i.children,n),2&(i=ts.current))i=1&i|2,t.flags|=128;else{if(null!==e&&128&e.flags)e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Va(e,n,t);else if(19===e.tag)Va(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(Ar(ts,i),1&t.mode)switch(r){case"forwards":for(n=t.child,r=null;null!==n;)null!==(e=n.alternate)&&null===ns(e)&&(r=n),n=n.sibling;null===(n=r)?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),za(t,!1,r,n,o);break;case"backwards":for(n=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===ns(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}za(t,!0,n,null,o);break;case"together":za(t,!1,null,null,void 0);break;default:t.memoizedState=null}else t.memoizedState=null;return t.child}function Wa(e,t){!(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function ja(e,t,i){if(null!==e&&(t.dependencies=e.dependencies),kl|=t.lanes,0===(i&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(n(153));if(null!==t.child){for(i=Lu(e=t.child,e.pendingProps),t.child=i,i.return=t;null!==e.sibling;)e=e.sibling,(i=i.sibling=Lu(e,e.pendingProps)).return=t;i.sibling=null}return t.child}function qa(e,t){if(!oo)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function Xa(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,i=0;if(t)for(var r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=14680064&r.subtreeFlags,i|=14680064&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=i,e.childLanes=n,t}function Ya(e,t,i){var o=t.pendingProps;switch(no(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Xa(t),null;case 1:case 17:return Nr(t.type)&&Lr(),Xa(t),null;case 3:return o=t.stateNode,Zo(),Mr(Ir),Mr(Cr),rs(),o.pendingContext&&(o.context=o.pendingContext,o.pendingContext=null),null!==e&&null!==e.child||(po(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&!(256&t.flags)||(t.flags|=1024,null!==so&&(au(so),so=null))),Na(e,t),Xa(t),null;case 5:es(t);var s=Jo(Ko.current);if(i=t.type,null!==e&&null!=t.stateNode)La(e,t,i,o,s),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!o){if(null===t.stateNode)throw Error(n(166));return Xa(t),null}if(e=Jo(Xo.current),po(t)){o=t.stateNode,i=t.type;var a=t.memoizedProps;switch(o[pr]=t,o[fr]=a,e=!!(1&t.mode),i){case"dialog":Hi("cancel",o),Hi("close",o);break;case"iframe":case"object":case"embed":Hi("load",o);break;case"video":case"audio":for(s=0;s<Ui.length;s++)Hi(Ui[s],o);break;case"source":Hi("error",o);break;case"img":case"image":case"link":Hi("error",o),Hi("load",o);break;case"details":Hi("toggle",o);break;case"input":$(o,a),Hi("invalid",o);break;case"select":o._wrapperState={wasMultiple:!!a.multiple},Hi("invalid",o);break;case"textarea":oe(o,a),Hi("invalid",o)}for(var l in ye(i,a),s=null,a)if(a.hasOwnProperty(l)){var u=a[l];"children"===l?"string"==typeof u?o.textContent!==u&&(!0!==a.suppressHydrationWarning&&Qi(o.textContent,u,e),s=["children",u]):"number"==typeof u&&o.textContent!==""+u&&(!0!==a.suppressHydrationWarning&&Qi(o.textContent,u,e),s=["children",""+u]):r.hasOwnProperty(l)&&null!=u&&"onScroll"===l&&Hi("scroll",o)}switch(i){case"input":X(o),ee(o,a,!0);break;case"textarea":X(o),ae(o);break;case"select":case"option":break;default:"function"==typeof a.onClick&&(o.onclick=er)}o=s,t.updateQueue=o,null!==o&&(t.flags|=4)}else{l=9===s.nodeType?s:s.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=le(i)),"http://www.w3.org/1999/xhtml"===e?"script"===i?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"==typeof o.is?e=l.createElement(i,{is:o.is}):(e=l.createElement(i),"select"===i&&(l=e,o.multiple?l.multiple=!0:o.size&&(l.size=o.size))):e=l.createElementNS(e,i),e[pr]=t,e[fr]=o,Oa(e,t,!1,!1),t.stateNode=e;e:{switch(l=xe(i,o),i){case"dialog":Hi("cancel",e),Hi("close",e),s=o;break;case"iframe":case"object":case"embed":Hi("load",e),s=o;break;case"video":case"audio":for(s=0;s<Ui.length;s++)Hi(Ui[s],e);s=o;break;case"source":Hi("error",e),s=o;break;case"img":case"image":case"link":Hi("error",e),Hi("load",e),s=o;break;case"details":Hi("toggle",e),s=o;break;case"input":$(e,o),s=J(e,o),Hi("invalid",e);break;case"option":default:s=o;break;case"select":e._wrapperState={wasMultiple:!!o.multiple},s=F({},o,{value:void 0}),Hi("invalid",e);break;case"textarea":oe(e,o),s=re(e,o),Hi("invalid",e)}for(a in ye(i,s),u=s)if(u.hasOwnProperty(a)){var c=u[a];"style"===a?ve(e,c):"dangerouslySetInnerHTML"===a?null!=(c=c?c.__html:void 0)&&he(e,c):"children"===a?"string"==typeof c?("textarea"!==i||""!==c)&&pe(e,c):"number"==typeof c&&pe(e,""+c):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(r.hasOwnProperty(a)?null!=c&&"onScroll"===a&&Hi("scroll",e):null!=c&&_(e,a,c,l))}switch(i){case"input":X(e),ee(e,o,!1);break;case"textarea":X(e),ae(e);break;case"option":null!=o.value&&e.setAttribute("value",""+j(o.value));break;case"select":e.multiple=!!o.multiple,null!=(a=o.value)?ie(e,!!o.multiple,a,!1):null!=o.defaultValue&&ie(e,!!o.multiple,o.defaultValue,!0);break;default:"function"==typeof s.onClick&&(e.onclick=er)}switch(i){case"button":case"input":case"select":case"textarea":o=!!o.autoFocus;break e;case"img":o=!0;break e;default:o=!1}}o&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Xa(t),null;case 6:if(e&&null!=t.stateNode)Da(e,t,e.memoizedProps,o);else{if("string"!=typeof o&&null===t.stateNode)throw Error(n(166));if(i=Jo(Ko.current),Jo(Xo.current),po(t)){if(o=t.stateNode,i=t.memoizedProps,o[pr]=t,(a=o.nodeValue!==i)&&null!==(e=io))switch(e.tag){case 3:Qi(o.nodeValue,i,!!(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Qi(o.nodeValue,i,!!(1&e.mode))}a&&(t.flags|=4)}else(o=(9===i.nodeType?i:i.ownerDocument).createTextNode(o))[pr]=t,t.stateNode=o}return Xa(t),null;case 13:if(Mr(ts),o=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(oo&&null!==ro&&1&t.mode&&!(128&t.flags))fo(),mo(),t.flags|=98560,a=!1;else if(a=po(t),null!==o&&null!==o.dehydrated){if(null===e){if(!a)throw Error(n(318));if(!(a=null!==(a=t.memoizedState)?a.dehydrated:null))throw Error(n(317));a[pr]=t}else mo(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Xa(t),a=!1}else null!==so&&(au(so),so=null),a=!0;if(!a)return 65536&t.flags?t:null}return 128&t.flags?(t.lanes=i,t):((o=null!==o)!==(null!==e&&null!==e.memoizedState)&&o&&(t.child.flags|=8192,1&t.mode&&(null===e||1&ts.current?0===Dl&&(Dl=3):gu())),null!==t.updateQueue&&(t.flags|=4),Xa(t),null);case 4:return Zo(),Na(e,t),null===e&&Gi(t.stateNode.containerInfo),Xa(t),null;case 10:return Co(t.type._context),Xa(t),null;case 19:if(Mr(ts),null===(a=t.memoizedState))return Xa(t),null;if(o=!!(128&t.flags),null===(l=a.rendering))if(o)qa(a,!1);else{if(0!==Dl||null!==e&&128&e.flags)for(e=t.child;null!==e;){if(null!==(l=ns(e))){for(t.flags|=128,qa(a,!1),null!==(o=l.updateQueue)&&(t.updateQueue=o,t.flags|=4),t.subtreeFlags=0,o=i,i=t.child;null!==i;)e=o,(a=i).flags&=14680066,null===(l=a.alternate)?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=l.childLanes,a.lanes=l.lanes,a.child=l.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=l.memoizedProps,a.memoizedState=l.memoizedState,a.updateQueue=l.updateQueue,a.type=l.type,e=l.dependencies,a.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),i=i.sibling;return Ar(ts,1&ts.current|2),t.child}e=e.sibling}null!==a.tail&&Ze()>Gl&&(t.flags|=128,o=!0,qa(a,!1),t.lanes=4194304)}else{if(!o)if(null!==(e=ns(l))){if(t.flags|=128,o=!0,null!==(i=e.updateQueue)&&(t.updateQueue=i,t.flags|=4),qa(a,!0),null===a.tail&&"hidden"===a.tailMode&&!l.alternate&&!oo)return Xa(t),null}else 2*Ze()-a.renderingStartTime>Gl&&1073741824!==i&&(t.flags|=128,o=!0,qa(a,!1),t.lanes=4194304);a.isBackwards?(l.sibling=t.child,t.child=l):(null!==(i=a.last)?i.sibling=l:t.child=l,a.last=l)}return null!==a.tail?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=Ze(),t.sibling=null,i=ts.current,Ar(ts,o?1&i|2:1&i),t):(Xa(t),null);case 22:case 23:return hu(),o=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==o&&(t.flags|=8192),o&&1&t.mode?!!(1073741824&Nl)&&(Xa(t),6&t.subtreeFlags&&(t.flags|=8192)):Xa(t),null;case 24:case 25:return null}throw Error(n(156,t.tag))}function Ka(e,t){switch(no(t),t.tag){case 1:return Nr(t.type)&&Lr(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Zo(),Mr(Ir),Mr(Cr),rs(),65536&(e=t.flags)&&!(128&e)?(t.flags=-65537&e|128,t):null;case 5:return es(t),null;case 13:if(Mr(ts),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(n(340));mo()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Mr(ts),null;case 4:return Zo(),null;case 10:return Co(t.type._context),null;case 22:case 23:return hu(),null;default:return null}}Oa=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Na=function(){},La=function(e,t,n,i){var o=e.memoizedProps;if(o!==i){e=t.stateNode,Jo(Xo.current);var s,a=null;switch(n){case"input":o=J(e,o),i=J(e,i),a=[];break;case"select":o=F({},o,{value:void 0}),i=F({},i,{value:void 0}),a=[];break;case"textarea":o=re(e,o),i=re(e,i),a=[];break;default:"function"!=typeof o.onClick&&"function"==typeof i.onClick&&(e.onclick=er)}for(c in ye(n,i),n=null,o)if(!i.hasOwnProperty(c)&&o.hasOwnProperty(c)&&null!=o[c])if("style"===c){var l=o[c];for(s in l)l.hasOwnProperty(s)&&(n||(n={}),n[s]="")}else"dangerouslySetInnerHTML"!==c&&"children"!==c&&"suppressContentEditableWarning"!==c&&"suppressHydrationWarning"!==c&&"autoFocus"!==c&&(r.hasOwnProperty(c)?a||(a=[]):(a=a||[]).push(c,null));for(c in i){var u=i[c];if(l=null!=o?o[c]:void 0,i.hasOwnProperty(c)&&u!==l&&(null!=u||null!=l))if("style"===c)if(l){for(s in l)!l.hasOwnProperty(s)||u&&u.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in u)u.hasOwnProperty(s)&&l[s]!==u[s]&&(n||(n={}),n[s]=u[s])}else n||(a||(a=[]),a.push(c,n)),n=u;else"dangerouslySetInnerHTML"===c?(u=u?u.__html:void 0,l=l?l.__html:void 0,null!=u&&l!==u&&(a=a||[]).push(c,u)):"children"===c?"string"!=typeof u&&"number"!=typeof u||(a=a||[]).push(c,""+u):"suppressContentEditableWarning"!==c&&"suppressHydrationWarning"!==c&&(r.hasOwnProperty(c)?(null!=u&&"onScroll"===c&&Hi("scroll",e),a||l===u||(a=[])):(a=a||[]).push(c,u))}n&&(a=a||[]).push("style",n);var c=a;(t.updateQueue=c)&&(t.flags|=4)}},Da=function(e,t,n,i){n!==i&&(t.flags|=4)};var Ja=!1,$a=!1,Za="function"==typeof WeakSet?WeakSet:Set,Qa=null;function el(e,t){var n=e.ref;if(null!==n)if("function"==typeof n)try{n(null)}catch(i){wu(e,t,i)}else n.current=null}function tl(e,t,n){try{n()}catch(i){wu(e,t,i)}}var nl=!1;function il(e,t,n){var i=t.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var r=i=i.next;do{if((r.tag&e)===e){var o=r.destroy;r.destroy=void 0,void 0!==o&&tl(t,n,o)}r=r.next}while(r!==i)}}function rl(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var i=n.create;n.destroy=i()}n=n.next}while(n!==t)}}function ol(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"==typeof t?t(e):t.current=e}}function sl(e){var t=e.alternate;null!==t&&(e.alternate=null,sl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[pr],delete t[fr],delete t[gr],delete t[vr],delete t[_r])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function al(e){return 5===e.tag||3===e.tag||4===e.tag}function ll(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||al(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function ul(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!=(n=n._reactRootContainer)||null!==t.onclick||(t.onclick=er));else if(4!==i&&null!==(e=e.child))for(ul(e,t,n),e=e.sibling;null!==e;)ul(e,t,n),e=e.sibling}function cl(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==i&&null!==(e=e.child))for(cl(e,t,n),e=e.sibling;null!==e;)cl(e,t,n),e=e.sibling}var dl=null,hl=!1;function pl(e,t,n){for(n=n.child;null!==n;)fl(e,t,n),n=n.sibling}function fl(e,t,n){if(st&&"function"==typeof st.onCommitFiberUnmount)try{st.onCommitFiberUnmount(ot,n)}catch(a){}switch(n.tag){case 5:$a||el(n,t);case 6:var i=dl,r=hl;dl=null,pl(e,t,n),hl=r,null!==(dl=i)&&(hl?(e=dl,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):dl.removeChild(n.stateNode));break;case 18:null!==dl&&(hl?(e=dl,n=n.stateNode,8===e.nodeType?ur(e.parentNode,n):1===e.nodeType&&ur(e,n),Gt(e)):ur(dl,n.stateNode));break;case 4:i=dl,r=hl,dl=n.stateNode.containerInfo,hl=!0,pl(e,t,n),dl=i,hl=r;break;case 0:case 11:case 14:case 15:if(!$a&&(null!==(i=n.updateQueue)&&null!==(i=i.lastEffect))){r=i=i.next;do{var o=r,s=o.destroy;o=o.tag,void 0!==s&&(2&o||4&o)&&tl(n,t,s),r=r.next}while(r!==i)}pl(e,t,n);break;case 1:if(!$a&&(el(n,t),"function"==typeof(i=n.stateNode).componentWillUnmount))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(a){wu(n,t,a)}pl(e,t,n);break;case 21:pl(e,t,n);break;case 22:1&n.mode?($a=(i=$a)||null!==n.memoizedState,pl(e,t,n),$a=i):pl(e,t,n);break;default:pl(e,t,n)}}function ml(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Za),t.forEach(function(t){var i=Cu.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))})}}function gl(e,t){var i=t.deletions;if(null!==i)for(var r=0;r<i.length;r++){var o=i[r];try{var s=e,a=t,l=a;e:for(;null!==l;){switch(l.tag){case 5:dl=l.stateNode,hl=!1;break e;case 3:case 4:dl=l.stateNode.containerInfo,hl=!0;break e}l=l.return}if(null===dl)throw Error(n(160));fl(s,a,o),dl=null,hl=!1;var u=o.alternate;null!==u&&(u.return=null),o.return=null}catch(c){wu(o,t,c)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)vl(t,e),t=t.sibling}function vl(e,t){var i=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(gl(t,e),_l(e),4&r){try{il(3,e,e.return),rl(3,e)}catch(g){wu(e,e.return,g)}try{il(5,e,e.return)}catch(g){wu(e,e.return,g)}}break;case 1:gl(t,e),_l(e),512&r&&null!==i&&el(i,i.return);break;case 5:if(gl(t,e),_l(e),512&r&&null!==i&&el(i,i.return),32&e.flags){var o=e.stateNode;try{pe(o,"")}catch(g){wu(e,e.return,g)}}if(4&r&&null!=(o=e.stateNode)){var s=e.memoizedProps,a=null!==i?i.memoizedProps:s,l=e.type,u=e.updateQueue;if(e.updateQueue=null,null!==u)try{"input"===l&&"radio"===s.type&&null!=s.name&&Z(o,s),xe(l,a);var c=xe(l,s);for(a=0;a<u.length;a+=2){var d=u[a],h=u[a+1];"style"===d?ve(o,h):"dangerouslySetInnerHTML"===d?he(o,h):"children"===d?pe(o,h):_(o,d,h,c)}switch(l){case"input":Q(o,s);break;case"textarea":se(o,s);break;case"select":var p=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!s.multiple;var f=s.value;null!=f?ie(o,!!s.multiple,f,!1):p!==!!s.multiple&&(null!=s.defaultValue?ie(o,!!s.multiple,s.defaultValue,!0):ie(o,!!s.multiple,s.multiple?[]:"",!1))}o[fr]=s}catch(g){wu(e,e.return,g)}}break;case 6:if(gl(t,e),_l(e),4&r){if(null===e.stateNode)throw Error(n(162));o=e.stateNode,s=e.memoizedProps;try{o.nodeValue=s}catch(g){wu(e,e.return,g)}}break;case 3:if(gl(t,e),_l(e),4&r&&null!==i&&i.memoizedState.isDehydrated)try{Gt(t.containerInfo)}catch(g){wu(e,e.return,g)}break;case 4:default:gl(t,e),_l(e);break;case 13:gl(t,e),_l(e),8192&(o=e.child).flags&&(s=null!==o.memoizedState,o.stateNode.isHidden=s,!s||null!==o.alternate&&null!==o.alternate.memoizedState||(zl=Ze())),4&r&&ml(e);break;case 22:if(d=null!==i&&null!==i.memoizedState,1&e.mode?($a=(c=$a)||d,gl(t,e),$a=c):gl(t,e),_l(e),8192&r){if(c=null!==e.memoizedState,(e.stateNode.isHidden=c)&&!d&&1&e.mode)for(Qa=e,d=e.child;null!==d;){for(h=Qa=d;null!==Qa;){switch(f=(p=Qa).child,p.tag){case 0:case 11:case 14:case 15:il(4,p,p.return);break;case 1:el(p,p.return);var m=p.stateNode;if("function"==typeof m.componentWillUnmount){r=p,i=p.return;try{t=r,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(g){wu(r,i,g)}}break;case 5:el(p,p.return);break;case 22:if(null!==p.memoizedState){El(h);continue}}null!==f?(f.return=p,Qa=f):El(h)}d=d.sibling}e:for(d=null,h=e;;){if(5===h.tag){if(null===d){d=h;try{o=h.stateNode,c?"function"==typeof(s=o.style).setProperty?s.setProperty("display","none","important"):s.display="none":(l=h.stateNode,a=null!=(u=h.memoizedProps.style)&&u.hasOwnProperty("display")?u.display:null,l.style.display=ge("display",a))}catch(g){wu(e,e.return,g)}}}else if(6===h.tag){if(null===d)try{h.stateNode.nodeValue=c?"":h.memoizedProps}catch(g){wu(e,e.return,g)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:gl(t,e),_l(e),4&r&&ml(e);case 21:}}function _l(e){var t=e.flags;if(2&t){try{e:{for(var i=e.return;null!==i;){if(al(i)){var r=i;break e}i=i.return}throw Error(n(160))}switch(r.tag){case 5:var o=r.stateNode;32&r.flags&&(pe(o,""),r.flags&=-33),cl(e,ll(e),o);break;case 3:case 4:var s=r.stateNode.containerInfo;ul(e,ll(e),s);break;default:throw Error(n(161))}}catch(a){wu(e,e.return,a)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function yl(e,t,n){Qa=e,xl(e)}function xl(e,t,n){for(var i=!!(1&e.mode);null!==Qa;){var r=Qa,o=r.child;if(22===r.tag&&i){var s=null!==r.memoizedState||Ja;if(!s){var a=r.alternate,l=null!==a&&null!==a.memoizedState||$a;a=Ja;var u=$a;if(Ja=s,($a=l)&&!u)for(Qa=r;null!==Qa;)l=(s=Qa).child,22===s.tag&&null!==s.memoizedState?bl(r):null!==l?(l.return=s,Qa=l):bl(r);for(;null!==o;)Qa=o,xl(o),o=o.sibling;Qa=r,Ja=a,$a=u}Sl(e)}else 8772&r.subtreeFlags&&null!==o?(o.return=r,Qa=o):Sl(e)}}function Sl(e){for(;null!==Qa;){var t=Qa;if(8772&t.flags){var i=t.alternate;try{if(8772&t.flags)switch(t.tag){case 0:case 11:case 15:$a||rl(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!$a)if(null===i)r.componentDidMount();else{var o=t.elementType===t.type?i.memoizedProps:ia(t.type,i.memoizedProps);r.componentDidUpdate(o,i.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;null!==s&&jo(t,s,r);break;case 3:var a=t.updateQueue;if(null!==a){if(i=null,null!==t.child)switch(t.child.tag){case 5:case 1:i=t.child.stateNode}jo(t,a,i)}break;case 5:var l=t.stateNode;if(null===i&&4&t.flags){i=l;var u=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&i.focus();break;case"img":u.src&&(i.src=u.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var c=t.alternate;if(null!==c){var d=c.memoizedState;if(null!==d){var h=d.dehydrated;null!==h&&Gt(h)}}}break;default:throw Error(n(163))}$a||512&t.flags&&ol(t)}catch(p){wu(t,t.return,p)}}if(t===e){Qa=null;break}if(null!==(i=t.sibling)){i.return=t.return,Qa=i;break}Qa=t.return}}function El(e){for(;null!==Qa;){var t=Qa;if(t===e){Qa=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Qa=n;break}Qa=t.return}}function bl(e){for(;null!==Qa;){var t=Qa;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{rl(4,t)}catch(l){wu(t,n,l)}break;case 1:var i=t.stateNode;if("function"==typeof i.componentDidMount){var r=t.return;try{i.componentDidMount()}catch(l){wu(t,r,l)}}var o=t.return;try{ol(t)}catch(l){wu(t,o,l)}break;case 5:var s=t.return;try{ol(t)}catch(l){wu(t,s,l)}}}catch(l){wu(t,t.return,l)}if(t===e){Qa=null;break}var a=t.sibling;if(null!==a){a.return=t.return,Qa=a;break}Qa=t.return}}var Tl,wl=Math.ceil,Ml=y.ReactCurrentDispatcher,Al=y.ReactCurrentOwner,Rl=y.ReactCurrentBatchConfig,Cl=0,Il=null,Pl=null,Ol=0,Nl=0,Ll=wr(0),Dl=0,Ul=null,kl=0,Fl=0,Bl=0,Hl=null,Vl=null,zl=0,Gl=1/0,Wl=null,jl=!1,ql=null,Xl=null,Yl=!1,Kl=null,Jl=0,$l=0,Zl=null,Ql=-1,eu=0;function tu(){return 6&Cl?Ze():-1!==Ql?Ql:Ql=Ze()}function nu(e){return 1&e.mode?2&Cl&&0!==Ol?Ol&-Ol:null!==vo.transition?(0===eu&&(eu=gt()),eu):0!==(e=xt)?e:e=void 0===(e=window.event)?16:$t(e.type):1}function iu(e,t,i,r){if(50<$l)throw $l=0,Zl=null,Error(n(185));_t(e,i,r),2&Cl&&e===Il||(e===Il&&(!(2&Cl)&&(Fl|=i),4===Dl&&lu(e,Ol)),ru(e,r),1===i&&0===Cl&&!(1&t.mode)&&(Gl=Ze()+500,Hr&&Gr()))}function ru(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,r=e.expirationTimes,o=e.pendingLanes;0<o;){var s=31-at(o),a=1<<s,l=r[s];-1===l?0!==(a&n)&&0===(a&i)||(r[s]=ft(a,t)):l<=t&&(e.expiredLanes|=a),o&=~a}}(e,t);var i=pt(e,e===Il?Ol:0);if(0===i)null!==n&&Ke(n),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(null!=n&&Ke(n),1===t)0===e.tag?function(e){Hr=!0,zr(e)}(uu.bind(null,e)):zr(uu.bind(null,e)),ar(function(){!(6&Cl)&&Gr()}),n=null;else{switch(St(i)){case 1:n=et;break;case 4:n=tt;break;case 16:default:n=nt;break;case 536870912:n=rt}n=Iu(n,ou.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function ou(e,t){if(Ql=-1,eu=0,6&Cl)throw Error(n(327));var i=e.callbackNode;if(bu()&&e.callbackNode!==i)return null;var r=pt(e,e===Il?Ol:0);if(0===r)return null;if(30&r||0!==(r&e.expiredLanes)||t)t=vu(e,r);else{t=r;var o=Cl;Cl|=2;var s=mu();for(Il===e&&Ol===t||(Wl=null,Gl=Ze()+500,pu(e,t));;)try{yu();break}catch(l){fu(e,l)}Ro(),Ml.current=s,Cl=o,null!==Pl?t=0:(Il=null,Ol=0,t=Dl)}if(0!==t){if(2===t&&(0!==(o=mt(e))&&(r=o,t=su(e,o))),1===t)throw i=Ul,pu(e,0),lu(e,r),ru(e,Ze()),i;if(6===t)lu(e,r);else{if(o=e.current.alternate,!(30&r||function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var i=0;i<n.length;i++){var r=n[i],o=r.getSnapshot;r=r.value;try{if(!li(o(),r))return!1}catch(a){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(o)||(t=vu(e,r),2===t&&(s=mt(e),0!==s&&(r=s,t=su(e,s))),1!==t)))throw i=Ul,pu(e,0),lu(e,r),ru(e,Ze()),i;switch(e.finishedWork=o,e.finishedLanes=r,t){case 0:case 1:throw Error(n(345));case 2:case 5:Eu(e,Vl,Wl);break;case 3:if(lu(e,r),(130023424&r)===r&&10<(t=zl+500-Ze())){if(0!==pt(e,0))break;if(((o=e.suspendedLanes)&r)!==r){tu(),e.pingedLanes|=e.suspendedLanes&o;break}e.timeoutHandle=rr(Eu.bind(null,e,Vl,Wl),t);break}Eu(e,Vl,Wl);break;case 4:if(lu(e,r),(4194240&r)===r)break;for(t=e.eventTimes,o=-1;0<r;){var a=31-at(r);s=1<<a,(a=t[a])>o&&(o=a),r&=~s}if(r=o,10<(r=(120>(r=Ze()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*wl(r/1960))-r)){e.timeoutHandle=rr(Eu.bind(null,e,Vl,Wl),r);break}Eu(e,Vl,Wl);break;default:throw Error(n(329))}}}return ru(e,Ze()),e.callbackNode===i?ou.bind(null,e):null}function su(e,t){var n=Hl;return e.current.memoizedState.isDehydrated&&(pu(e,t).flags|=256),2!==(e=vu(e,t))&&(t=Vl,Vl=n,null!==t&&au(t)),e}function au(e){null===Vl?Vl=e:Vl.push.apply(Vl,e)}function lu(e,t){for(t&=~Bl,t&=~Fl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-at(t),i=1<<n;e[n]=-1,t&=~i}}function uu(e){if(6&Cl)throw Error(n(327));bu();var t=pt(e,0);if(!(1&t))return ru(e,Ze()),null;var i=vu(e,t);if(0!==e.tag&&2===i){var r=mt(e);0!==r&&(t=r,i=su(e,r))}if(1===i)throw i=Ul,pu(e,0),lu(e,t),ru(e,Ze()),i;if(6===i)throw Error(n(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Eu(e,Vl,Wl),ru(e,Ze()),null}function cu(e,t){var n=Cl;Cl|=1;try{return e(t)}finally{0===(Cl=n)&&(Gl=Ze()+500,Hr&&Gr())}}function du(e){null!==Kl&&0===Kl.tag&&!(6&Cl)&&bu();var t=Cl;Cl|=1;var n=Rl.transition,i=xt;try{if(Rl.transition=null,xt=1,e)return e()}finally{xt=i,Rl.transition=n,!(6&(Cl=t))&&Gr()}}function hu(){Nl=Ll.current,Mr(Ll)}function pu(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,or(n)),null!==Pl)for(n=Pl.return;null!==n;){var i=n;switch(no(i),i.tag){case 1:null!=(i=i.type.childContextTypes)&&Lr();break;case 3:Zo(),Mr(Ir),Mr(Cr),rs();break;case 5:es(i);break;case 4:Zo();break;case 13:case 19:Mr(ts);break;case 10:Co(i.type._context);break;case 22:case 23:hu()}n=n.return}if(Il=e,Pl=e=Lu(e.current,null),Ol=Nl=t,Dl=0,Ul=null,Bl=Fl=kl=0,Vl=Hl=null,null!==No){for(t=0;t<No.length;t++)if(null!==(i=(n=No[t]).interleaved)){n.interleaved=null;var r=i.next,o=n.pending;if(null!==o){var s=o.next;o.next=r,i.next=s}n.pending=i}No=null}return e}function fu(e,t){for(;;){var i=Pl;try{if(Ro(),os.current=Qs,ds){for(var r=ls.memoizedState;null!==r;){var o=r.queue;null!==o&&(o.pending=null),r=r.next}ds=!1}if(as=0,cs=us=ls=null,hs=!1,ps=0,Al.current=null,null===i||null===i.return){Dl=1,Ul=t,Pl=null;break}e:{var s=e,a=i.return,l=i,u=t;if(t=Ol,l.flags|=32768,null!==u&&"object"==typeof u&&"function"==typeof u.then){var c=u,d=l,h=d.tag;if(!(1&d.mode||0!==h&&11!==h&&15!==h)){var p=d.alternate;p?(d.updateQueue=p.updateQueue,d.memoizedState=p.memoizedState,d.lanes=p.lanes):(d.updateQueue=null,d.memoizedState=null)}var f=va(a);if(null!==f){f.flags&=-257,_a(f,a,l,0,t),1&f.mode&&ga(s,c,t),u=c;var m=(t=f).updateQueue;if(null===m){var g=new Set;g.add(u),t.updateQueue=g}else m.add(u);break e}if(!(1&t)){ga(s,c,t),gu();break e}u=Error(n(426))}else if(oo&&1&l.mode){var v=va(a);if(null!==v){!(65536&v.flags)&&(v.flags|=256),_a(v,a,l,0,t),go(ca(u,l));break e}}s=u=ca(u,l),4!==Dl&&(Dl=2),null===Hl?Hl=[s]:Hl.push(s),s=a;do{switch(s.tag){case 3:s.flags|=65536,t&=-t,s.lanes|=t,Go(s,fa(0,u,t));break e;case 1:l=u;var _=s.type,y=s.stateNode;if(!(128&s.flags||"function"!=typeof _.getDerivedStateFromError&&(null===y||"function"!=typeof y.componentDidCatch||null!==Xl&&Xl.has(y)))){s.flags|=65536,t&=-t,s.lanes|=t,Go(s,ma(s,l,t));break e}}s=s.return}while(null!==s)}Su(i)}catch(x){t=x,Pl===i&&null!==i&&(Pl=i=i.return);continue}break}}function mu(){var e=Ml.current;return Ml.current=Qs,null===e?Qs:e}function gu(){0!==Dl&&3!==Dl&&2!==Dl||(Dl=4),null===Il||!(268435455&kl)&&!(268435455&Fl)||lu(Il,Ol)}function vu(e,t){var i=Cl;Cl|=2;var r=mu();for(Il===e&&Ol===t||(Wl=null,pu(e,t));;)try{_u();break}catch(o){fu(e,o)}if(Ro(),Cl=i,Ml.current=r,null!==Pl)throw Error(n(261));return Il=null,Ol=0,Dl}function _u(){for(;null!==Pl;)xu(Pl)}function yu(){for(;null!==Pl&&!Je();)xu(Pl)}function xu(e){var t=Tl(e.alternate,e,Nl);e.memoizedProps=e.pendingProps,null===t?Su(e):Pl=t,Al.current=null}function Su(e){var t=e;do{var n=t.alternate;if(e=t.return,32768&t.flags){if(null!==(n=Ka(n,t)))return n.flags&=32767,void(Pl=n);if(null===e)return Dl=6,void(Pl=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}else if(null!==(n=Ya(n,t,Nl)))return void(Pl=n);if(null!==(t=t.sibling))return void(Pl=t);Pl=t=e}while(null!==t);0===Dl&&(Dl=5)}function Eu(e,t,i){var r=xt,o=Rl.transition;try{Rl.transition=null,xt=1,function(e,t,i,r){do{bu()}while(null!==Kl);if(6&Cl)throw Error(n(327));i=e.finishedWork;var o=e.finishedLanes;if(null===i)return null;if(e.finishedWork=null,e.finishedLanes=0,i===e.current)throw Error(n(177));e.callbackNode=null,e.callbackPriority=0;var s=i.lanes|i.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<n;){var r=31-at(n),o=1<<r;t[r]=0,i[r]=-1,e[r]=-1,n&=~o}}(e,s),e===Il&&(Pl=Il=null,Ol=0),!(2064&i.subtreeFlags)&&!(2064&i.flags)||Yl||(Yl=!0,Iu(nt,function(){return bu(),null})),s=!!(15990&i.flags),!!(15990&i.subtreeFlags)||s){s=Rl.transition,Rl.transition=null;var a=xt;xt=1;var l=Cl;Cl|=4,Al.current=null,function(e,t){if(tr=jt,fi(e=pi())){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(i=(i=e.ownerDocument)&&i.defaultView||window).getSelection&&i.getSelection();if(r&&0!==r.rangeCount){i=r.anchorNode;var o=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{i.nodeType,s.nodeType}catch(S){i=null;break e}var a=0,l=-1,u=-1,c=0,d=0,h=e,p=null;t:for(;;){for(var f;h!==i||0!==o&&3!==h.nodeType||(l=a+o),h!==s||0!==r&&3!==h.nodeType||(u=a+r),3===h.nodeType&&(a+=h.nodeValue.length),null!==(f=h.firstChild);)p=h,h=f;for(;;){if(h===e)break t;if(p===i&&++c===o&&(l=a),p===s&&++d===r&&(u=a),null!==(f=h.nextSibling))break;p=(h=p).parentNode}h=f}i=-1===l||-1===u?null:{start:l,end:u}}else i=null}i=i||{start:0,end:0}}else i=null;for(nr={focusedElem:e,selectionRange:i},jt=!1,Qa=t;null!==Qa;)if(e=(t=Qa).child,1028&t.subtreeFlags&&null!==e)e.return=t,Qa=e;else for(;null!==Qa;){t=Qa;try{var m=t.alternate;if(1024&t.flags)switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var g=m.memoizedProps,v=m.memoizedState,_=t.stateNode,y=_.getSnapshotBeforeUpdate(t.elementType===t.type?g:ia(t.type,g),v);_.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var x=t.stateNode.containerInfo;1===x.nodeType?x.textContent="":9===x.nodeType&&x.documentElement&&x.removeChild(x.documentElement);break;default:throw Error(n(163))}}catch(S){wu(t,t.return,S)}if(null!==(e=t.sibling)){e.return=t.return,Qa=e;break}Qa=t.return}m=nl,nl=!1}(e,i),vl(i,e),mi(nr),jt=!!tr,nr=tr=null,e.current=i,yl(i),$e(),Cl=l,xt=a,Rl.transition=s}else e.current=i;if(Yl&&(Yl=!1,Kl=e,Jl=o),s=e.pendingLanes,0===s&&(Xl=null),function(e){if(st&&"function"==typeof st.onCommitFiberRoot)try{st.onCommitFiberRoot(ot,e,void 0,!(128&~e.current.flags))}catch(t){}}(i.stateNode),ru(e,Ze()),null!==t)for(r=e.onRecoverableError,i=0;i<t.length;i++)o=t[i],r(o.value,{componentStack:o.stack,digest:o.digest});if(jl)throw jl=!1,e=ql,ql=null,e;!!(1&Jl)&&0!==e.tag&&bu(),s=e.pendingLanes,1&s?e===Zl?$l++:($l=0,Zl=e):$l=0,Gr()}(e,t,i,r)}finally{Rl.transition=o,xt=r}return null}function bu(){if(null!==Kl){var e=St(Jl),t=Rl.transition,i=xt;try{if(Rl.transition=null,xt=16>e?16:e,null===Kl)var r=!1;else{if(e=Kl,Kl=null,Jl=0,6&Cl)throw Error(n(331));var o=Cl;for(Cl|=4,Qa=e.current;null!==Qa;){var s=Qa,a=s.child;if(16&Qa.flags){var l=s.deletions;if(null!==l){for(var u=0;u<l.length;u++){var c=l[u];for(Qa=c;null!==Qa;){var d=Qa;switch(d.tag){case 0:case 11:case 15:il(8,d,s)}var h=d.child;if(null!==h)h.return=d,Qa=h;else for(;null!==Qa;){var p=(d=Qa).sibling,f=d.return;if(sl(d),d===c){Qa=null;break}if(null!==p){p.return=f,Qa=p;break}Qa=f}}}var m=s.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var v=g.sibling;g.sibling=null,g=v}while(null!==g)}}Qa=s}}if(2064&s.subtreeFlags&&null!==a)a.return=s,Qa=a;else e:for(;null!==Qa;){if(2048&(s=Qa).flags)switch(s.tag){case 0:case 11:case 15:il(9,s,s.return)}var _=s.sibling;if(null!==_){_.return=s.return,Qa=_;break e}Qa=s.return}}var y=e.current;for(Qa=y;null!==Qa;){var x=(a=Qa).child;if(2064&a.subtreeFlags&&null!==x)x.return=a,Qa=x;else e:for(a=y;null!==Qa;){if(2048&(l=Qa).flags)try{switch(l.tag){case 0:case 11:case 15:rl(9,l)}}catch(E){wu(l,l.return,E)}if(l===a){Qa=null;break e}var S=l.sibling;if(null!==S){S.return=l.return,Qa=S;break e}Qa=l.return}}if(Cl=o,Gr(),st&&"function"==typeof st.onPostCommitFiberRoot)try{st.onPostCommitFiberRoot(ot,e)}catch(E){}r=!0}return r}finally{xt=i,Rl.transition=t}}return!1}function Tu(e,t,n){e=Vo(e,t=fa(0,t=ca(n,t),1),1),t=tu(),null!==e&&(_t(e,1,t),ru(e,t))}function wu(e,t,n){if(3===e.tag)Tu(e,e,n);else for(;null!==t;){if(3===t.tag){Tu(t,e,n);break}if(1===t.tag){var i=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof i.componentDidCatch&&(null===Xl||!Xl.has(i))){t=Vo(t,e=ma(t,e=ca(n,e),1),1),e=tu(),null!==t&&(_t(t,1,e),ru(t,e));break}}t=t.return}}function Mu(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),t=tu(),e.pingedLanes|=e.suspendedLanes&n,Il===e&&(Ol&n)===n&&(4===Dl||3===Dl&&(130023424&Ol)===Ol&&500>Ze()-zl?pu(e,0):Bl|=n),ru(e,t)}function Au(e,t){0===t&&(1&e.mode?(t=dt,!(130023424&(dt<<=1))&&(dt=4194304)):t=1);var n=tu();null!==(e=Uo(e,t))&&(_t(e,t,n),ru(e,n))}function Ru(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Au(e,n)}function Cu(e,t){var i=0;switch(e.tag){case 13:var r=e.stateNode,o=e.memoizedState;null!==o&&(i=o.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(n(314))}null!==r&&r.delete(t),Au(e,i)}function Iu(e,t){return Ye(e,t)}function Pu(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ou(e,t,n,i){return new Pu(e,t,n,i)}function Nu(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Lu(e,t){var n=e.alternate;return null===n?((n=Ou(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Du(e,t,i,r,o,s){var a=2;if(r=e,"function"==typeof e)Nu(e)&&(a=1);else if("string"==typeof e)a=5;else e:switch(e){case T:return Uu(i.children,o,s,t);case w:a=8,o|=8;break;case M:return(e=Ou(12,i,t,2|o)).elementType=M,e.lanes=s,e;case I:return(e=Ou(13,i,t,o)).elementType=I,e.lanes=s,e;case P:return(e=Ou(19,i,t,o)).elementType=P,e.lanes=s,e;case L:return ku(i,o,s,t);default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case A:a=10;break e;case R:a=9;break e;case C:a=11;break e;case O:a=14;break e;case N:a=16,r=null;break e}throw Error(n(130,null==e?e:typeof e,""))}return(t=Ou(a,i,t,o)).elementType=e,t.type=r,t.lanes=s,t}function Uu(e,t,n,i){return(e=Ou(7,e,i,t)).lanes=n,e}function ku(e,t,n,i){return(e=Ou(22,e,i,t)).elementType=L,e.lanes=n,e.stateNode={isHidden:!1},e}function Fu(e,t,n){return(e=Ou(6,e,null,t)).lanes=n,e}function Bu(e,t,n){return(t=Ou(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Hu(e,t,n,i,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=vt(0),this.expirationTimes=vt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=vt(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Vu(e,t,n,i,r,o,s,a,l){return e=new Hu(e,t,n,a,l),1===t?(t=1,!0===o&&(t|=8)):t=0,o=Ou(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Fo(o),e}function zu(e){if(!e)return Rr;e:{if(Ge(e=e._reactInternals)!==e||1!==e.tag)throw Error(n(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Nr(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(n(171))}if(1===e.tag){var i=e.type;if(Nr(i))return Ur(e,i,t)}return t}function Gu(e,t,n,i,r,o,s,a,l){return(e=Vu(n,i,!0,e,0,o,0,a,l)).context=zu(null),n=e.current,(o=Ho(i=tu(),r=nu(n))).callback=null!=t?t:null,Vo(n,o,r),e.current.lanes=r,_t(e,r,i),ru(e,i),e}function Wu(e,t,n,i){var r=t.current,o=tu(),s=nu(r);return n=zu(n),null===t.context?t.context=n:t.pendingContext=n,(t=Ho(o,s)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),null!==(e=Vo(r,t,s))&&(iu(e,r,s,o),zo(e,r,s)),s}function ju(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function qu(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Xu(e,t){qu(e,t),(e=e.alternate)&&qu(e,t)}Tl=function(e,t,i){if(null!==e)if(e.memoizedProps!==t.pendingProps||Ir.current)xa=!0;else{if(0===(e.lanes&i)&&!(128&t.flags))return xa=!1,function(e,t,n){switch(t.tag){case 3:Ia(t),mo();break;case 5:Qo(t);break;case 1:Nr(t.type)&&kr(t);break;case 4:$o(t,t.stateNode.containerInfo);break;case 10:var i=t.type._context,r=t.memoizedProps.value;Ar(To,i._currentValue),i._currentValue=r;break;case 13:if(null!==(i=t.memoizedState))return null!==i.dehydrated?(Ar(ts,1&ts.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Fa(e,t,n):(Ar(ts,1&ts.current),null!==(e=ja(e,t,n))?e.sibling:null);Ar(ts,1&ts.current);break;case 19:if(i=0!==(n&t.childLanes),128&e.flags){if(i)return Ga(e,t,n);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),Ar(ts,ts.current),i)break;return null;case 22:case 23:return t.lanes=0,wa(e,t,n)}return ja(e,t,n)}(e,t,i);xa=!!(131072&e.flags)}else xa=!1,oo&&1048576&t.flags&&eo(t,Xr,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Wa(e,t),e=t.pendingProps;var o=Or(t,Cr.current);Po(t,i),o=vs(null,t,r,e,o,i);var s=_s();return t.flags|=1,"object"==typeof o&&null!==o&&"function"==typeof o.render&&void 0===o.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Nr(r)?(s=!0,kr(t)):s=!1,t.memoizedState=null!==o.state&&void 0!==o.state?o.state:null,Fo(t),o.updater=oa,t.stateNode=o,o._reactInternals=t,ua(t,r,e,i),t=Ca(null,t,r,!0,s,i)):(t.tag=0,oo&&s&&to(t),Sa(null,t,o,i),t=t.child),t;case 16:r=t.elementType;e:{switch(Wa(e,t),e=t.pendingProps,r=(o=r._init)(r._payload),t.type=r,o=t.tag=function(e){if("function"==typeof e)return Nu(e)?1:0;if(null!=e){if((e=e.$$typeof)===C)return 11;if(e===O)return 14}return 2}(r),e=ia(r,e),o){case 0:t=Aa(null,t,r,e,i);break e;case 1:t=Ra(null,t,r,e,i);break e;case 11:t=Ea(null,t,r,e,i);break e;case 14:t=ba(null,t,r,ia(r.type,e),i);break e}throw Error(n(306,r,""))}return t;case 0:return r=t.type,o=t.pendingProps,Aa(e,t,r,o=t.elementType===r?o:ia(r,o),i);case 1:return r=t.type,o=t.pendingProps,Ra(e,t,r,o=t.elementType===r?o:ia(r,o),i);case 3:e:{if(Ia(t),null===e)throw Error(n(387));r=t.pendingProps,o=(s=t.memoizedState).element,Bo(e,t),Wo(t,r,null,i);var a=t.memoizedState;if(r=a.element,s.isDehydrated){if(s={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=s,t.memoizedState=s,256&t.flags){t=Pa(e,t,r,i,o=ca(Error(n(423)),t));break e}if(r!==o){t=Pa(e,t,r,i,o=ca(Error(n(424)),t));break e}for(ro=cr(t.stateNode.containerInfo.firstChild),io=t,oo=!0,so=null,i=bo(t,null,r,i),t.child=i;i;)i.flags=-3&i.flags|4096,i=i.sibling}else{if(mo(),r===o){t=ja(e,t,i);break e}Sa(e,t,r,i)}t=t.child}return t;case 5:return Qo(t),null===e&&co(t),r=t.type,o=t.pendingProps,s=null!==e?e.memoizedProps:null,a=o.children,ir(r,o)?a=null:null!==s&&ir(r,s)&&(t.flags|=32),Ma(e,t),Sa(e,t,a,i),t.child;case 6:return null===e&&co(t),null;case 13:return Fa(e,t,i);case 4:return $o(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Eo(t,null,r,i):Sa(e,t,r,i),t.child;case 11:return r=t.type,o=t.pendingProps,Ea(e,t,r,o=t.elementType===r?o:ia(r,o),i);case 7:return Sa(e,t,t.pendingProps,i),t.child;case 8:case 12:return Sa(e,t,t.pendingProps.children,i),t.child;case 10:e:{if(r=t.type._context,o=t.pendingProps,s=t.memoizedProps,a=o.value,Ar(To,r._currentValue),r._currentValue=a,null!==s)if(li(s.value,a)){if(s.children===o.children&&!Ir.current){t=ja(e,t,i);break e}}else for(null!==(s=t.child)&&(s.return=t);null!==s;){var l=s.dependencies;if(null!==l){a=s.child;for(var u=l.firstContext;null!==u;){if(u.context===r){if(1===s.tag){(u=Ho(-1,i&-i)).tag=2;var c=s.updateQueue;if(null!==c){var d=(c=c.shared).pending;null===d?u.next=u:(u.next=d.next,d.next=u),c.pending=u}}s.lanes|=i,null!==(u=s.alternate)&&(u.lanes|=i),Io(s.return,i,t),l.lanes|=i;break}u=u.next}}else if(10===s.tag)a=s.type===t.type?null:s.child;else if(18===s.tag){if(null===(a=s.return))throw Error(n(341));a.lanes|=i,null!==(l=a.alternate)&&(l.lanes|=i),Io(a,i,t),a=s.sibling}else a=s.child;if(null!==a)a.return=s;else for(a=s;null!==a;){if(a===t){a=null;break}if(null!==(s=a.sibling)){s.return=a.return,a=s;break}a=a.return}s=a}Sa(e,t,o.children,i),t=t.child}return t;case 9:return o=t.type,r=t.pendingProps.children,Po(t,i),r=r(o=Oo(o)),t.flags|=1,Sa(e,t,r,i),t.child;case 14:return o=ia(r=t.type,t.pendingProps),ba(e,t,r,o=ia(r.type,o),i);case 15:return Ta(e,t,t.type,t.pendingProps,i);case 17:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:ia(r,o),Wa(e,t),t.tag=1,Nr(r)?(e=!0,kr(t)):e=!1,Po(t,i),aa(t,r,o),ua(t,r,o,i),Ca(null,t,r,!0,e,i);case 19:return Ga(e,t,i);case 22:return wa(e,t,i)}throw Error(n(156,t.tag))};var Yu="function"==typeof reportError?reportError:function(e){console.error(e)};function Ku(e){this._internalRoot=e}function Ju(e){this._internalRoot=e}function $u(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Zu(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Qu(){}function ec(e,t,n,i,r){var o=n._reactRootContainer;if(o){var s=o;if("function"==typeof r){var a=r;r=function(){var e=ju(s);a.call(e)}}Wu(t,s,e,r)}else s=function(e,t,n,i,r){if(r){if("function"==typeof i){var o=i;i=function(){var e=ju(s);o.call(e)}}var s=Gu(t,i,e,0,null,!1,0,"",Qu);return e._reactRootContainer=s,e[mr]=s.current,Gi(8===e.nodeType?e.parentNode:e),du(),s}for(;r=e.lastChild;)e.removeChild(r);if("function"==typeof i){var a=i;i=function(){var e=ju(l);a.call(e)}}var l=Vu(e,0,!1,null,0,!1,0,"",Qu);return e._reactRootContainer=l,e[mr]=l.current,Gi(8===e.nodeType?e.parentNode:e),du(function(){Wu(t,l,n,i)}),l}(n,t,e,r,i);return ju(s)}Ju.prototype.render=Ku.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(n(409));Wu(e,t,null,null)},Ju.prototype.unmount=Ku.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;du(function(){Wu(null,e,null,null)}),t[mr]=null}},Ju.prototype.unstable_scheduleHydration=function(e){if(e){var t=wt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Lt.length&&0!==t&&t<Lt[n].priority;n++);Lt.splice(n,0,e),0===n&&Ft(e)}},Et=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ht(t.pendingLanes);0!==n&&(yt(t,1|n),ru(t,Ze()),!(6&Cl)&&(Gl=Ze()+500,Gr()))}break;case 13:du(function(){var t=Uo(e,1);if(null!==t){var n=tu();iu(t,e,1,n)}}),Xu(e,1)}},bt=function(e){if(13===e.tag){var t=Uo(e,134217728);if(null!==t)iu(t,e,134217728,tu());Xu(e,134217728)}},Tt=function(e){if(13===e.tag){var t=nu(e),n=Uo(e,t);if(null!==n)iu(n,e,t,tu());Xu(e,t)}},wt=function(){return xt},Mt=function(e,t){var n=xt;try{return xt=e,t()}finally{xt=n}},be=function(e,t,i){switch(t){case"input":if(Q(e,i),t=i.name,"radio"===i.type&&null!=t){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<i.length;t++){var r=i[t];if(r!==e&&r.form===e.form){var o=Er(r);if(!o)throw Error(n(90));Y(r),Q(r,o)}}}break;case"textarea":se(e,i);break;case"select":null!=(t=i.value)&&ie(e,!!i.multiple,t,!1)}},Ce=cu,Ie=du;var tc={usingClientEntryPoint:!1,Events:[xr,Sr,Er,Ae,Re,cu]},nc={findFiberByHostInstance:yr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ic={bundleType:nc.bundleType,version:nc.version,rendererPackageName:nc.rendererPackageName,rendererConfig:nc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:y.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=qe(e))?null:e.stateNode},findFiberByHostInstance:nc.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var rc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!rc.isDisabled&&rc.supportsFiber)try{ot=rc.inject(ic),st=rc}catch(de){}}return x.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tc,x.createPortal=function(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!$u(t))throw Error(n(200));return function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:E,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}}(e,t,null,i)},x.createRoot=function(e,t){if(!$u(e))throw Error(n(299));var i=!1,r="",o=Yu;return null!=t&&(!0===t.unstable_strictMode&&(i=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(o=t.onRecoverableError)),t=Vu(e,1,!1,null,0,i,0,r,o),e[mr]=t.current,Gi(8===e.nodeType?e.parentNode:e),new Ku(t)},x.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(n(188));throw e=Object.keys(e).join(","),Error(n(268,e))}return e=null===(e=qe(t))?null:e.stateNode},x.flushSync=function(e){return du(e)},x.hydrate=function(e,t,i){if(!Zu(t))throw Error(n(200));return ec(null,e,t,!0,i)},x.hydrateRoot=function(e,t,i){if(!$u(e))throw Error(n(405));var r=null!=i&&i.hydratedSources||null,o=!1,s="",a=Yu;if(null!=i&&(!0===i.unstable_strictMode&&(o=!0),void 0!==i.identifierPrefix&&(s=i.identifierPrefix),void 0!==i.onRecoverableError&&(a=i.onRecoverableError)),t=Gu(t,null,e,1,null!=i?i:null,o,0,s,a),e[mr]=t.current,Gi(e),r)for(e=0;e<r.length;e++)o=(o=(i=r[e])._getVersion)(i._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[i,o]:t.mutableSourceEagerHydrationData.push(i,o);return new Ju(t)},x.render=function(e,t,i){if(!Zu(t))throw Error(n(200));return ec(null,e,t,!1,i)},x.unmountComponentAtNode=function(e){if(!Zu(e))throw Error(n(40));return!!e._reactRootContainer&&(du(function(){ec(null,null,e,!1,function(){e._reactRootContainer=null,e[mr]=null})}),!0)},x.unstable_batchedUpdates=cu,x.unstable_renderSubtreeIntoContainer=function(e,t,i,r){if(!Zu(i))throw Error(n(200));if(null==e||void 0===e._reactInternals)throw Error(n(38));return ec(e,t,i,!1,r)},x.version="18.3.1-next-f1338f8080-20240426",x}const w=e(function(){if(g)return _;g=1;var e=(m||(m=1,function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),y.exports=T()),y.exports);return _.createRoot=e.createRoot,_.hydrateRoot=e.hydrateRoot,_}());var M=d();const A=e(M);var R,C={},I={},P={};var O,N,L,D={};function U(){return O||(O=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=e||"";i&&(o=e.toString().trim().replace(/[A-Za-z0-9\u00C0-\u00FF]+[^\s-]*/g,function(e,n,i){return n>0&&n+e.length!==i.length&&e.search(t)>-1&&":"!==i.charAt(n-2)&&("-"!==i.charAt(n+e.length)||"-"===i.charAt(n-1))&&i.charAt(n-1).search(/[^\s-]/)<0?e.toLowerCase():e.substr(1).search(/[A-Z]|\../)>-1?e:e.charAt(0).toUpperCase()+e.substr(1)}));r&&(o=function(e){if(function(e){return"string"==typeof e&&-1!==e.indexOf("@")}(e))return console.warn("This arg looks like an email address, redacting."),n;return e}(o));return o};var t=/^(a|an|and|as|at|but|by|en|for|if|in|nor|of|on|or|per|the|to|vs?\.?|via)$/i;var n="REDACTED (Potential Email Address)"}(D)),D}function k(){return N||(N=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.GA4=void 0;var t=s((R||(R=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i;"undefined"!=typeof window&&(void 0===window.gtag&&(window.dataLayer=window.dataLayer||[],window.gtag=function(){window.dataLayer.push(arguments)}),(i=window).gtag.apply(i,t))};e.default=t}(P)),P)),n=s(U()),i=["eventCategory","eventAction","eventLabel","eventValue","hitType"],r=["title","location"],o=["page","hitType"];function s(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e){return function(e){if(Array.isArray(e))return f(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||p(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach(function(t){g(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function h(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,o,s,a=[],l=!0,u=!1;try{if(o=(n=n.call(e)).next,0===t);else for(;!(l=(i=o.call(n)).done)&&(a.push(i.value),a.length!==t);l=!0);}catch(c){u=!0,r=c}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(u)throw r}}return a}}(e,t)||p(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){if(e){if("string"==typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(e,t):void 0}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function m(e,t,n){return t&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,v(i.key),i)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function g(e,t,n){return(t=v(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function v(e){var t=function(e,t){if("object"!==l(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!==l(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===l(t)?t:String(t)}var _=function(){function e(){var s=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),g(this,"reset",function(){s.isInitialized=!1,s._testMode=!1,s._currentMeasurementId,s._hasLoadedGA=!1,s._isQueuing=!1,s._queueGtag=[]}),g(this,"_gtag",function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];s._testMode||s._isQueuing?s._queueGtag.push(n):t.default.apply(void 0,n)}),g(this,"_loadGA",function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"https://www.googletagmanager.com/gtag/js";if("undefined"!=typeof window&&"undefined"!=typeof document&&!s._hasLoadedGA){var i=document.createElement("script");i.async=!0,i.src="".concat(n,"?id=").concat(e),t&&i.setAttribute("nonce",t),document.body.appendChild(i),window.dataLayer=window.dataLayer||[],window.gtag=function(){window.dataLayer.push(arguments)},s._hasLoadedGA=!0}}),g(this,"_toGtagOptions",function(e){if(e){var t={cookieUpdate:"cookie_update",cookieExpires:"cookie_expires",cookieDomain:"cookie_domain",cookieFlags:"cookie_flags",userId:"user_id",clientId:"client_id",anonymizeIp:"anonymize_ip",contentGroup1:"content_group1",contentGroup2:"content_group2",contentGroup3:"content_group3",contentGroup4:"content_group4",contentGroup5:"content_group5",allowAdFeatures:"allow_google_signals",allowAdPersonalizationSignals:"allow_ad_personalization_signals",nonInteraction:"non_interaction",page:"page_path",hitCallback:"event_callback"};return Object.entries(e).reduce(function(e,n){var i=h(n,2),r=i[0],o=i[1];return t[r]?e[t[r]]=o:e[r]=o,e},{})}}),g(this,"initialize",function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)throw new Error("Require GA_MEASUREMENT_ID");var n="string"==typeof e?[{trackingId:e}]:e;s._currentMeasurementId=n[0].trackingId;var i=t.gaOptions,r=t.gtagOptions,o=t.nonce,a=t.testMode,l=void 0!==a&&a,c=t.gtagUrl;if(s._testMode=l,l||s._loadGA(s._currentMeasurementId,o,c),s.isInitialized||(s._gtag("js",new Date),n.forEach(function(e){var t=d(d(d({},s._toGtagOptions(d(d({},i),e.gaOptions))),r),e.gtagOptions);Object.keys(t).length?s._gtag("config",e.trackingId,t):s._gtag("config",e.trackingId)})),s.isInitialized=!0,!l){var h=u(s._queueGtag);for(s._queueGtag=[],s._isQueuing=!1;h.length;){var p=h.shift();s._gtag.apply(s,u(p)),"get"===p[0]&&(s._isQueuing=!0)}}}),g(this,"set",function(e){e?"object"===l(e)?(0===Object.keys(e).length&&console.warn("empty `fieldsObject` given to .set()"),s._gaCommand("set",e)):console.warn("Expected `fieldsObject` arg to be an Object"):console.warn("`fieldsObject` is required in .set()")}),g(this,"_gaCommandSendEvent",function(e,t,n,i,r){s._gtag("event",t,d(d({event_category:e,event_label:n,value:i},r&&{non_interaction:r.nonInteraction}),s._toGtagOptions(r)))}),g(this,"_gaCommandSendEventParameters",function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if("string"==typeof t[0])s._gaCommandSendEvent.apply(s,u(t.slice(1)));else{var r=t[0],o=r.eventCategory,l=r.eventAction,c=r.eventLabel,d=r.eventValue;r.hitType;var h=a(r,i);s._gaCommandSendEvent(o,l,c,d,h)}}),g(this,"_gaCommandSendTiming",function(e,t,n,i){s._gtag("event","timing_complete",{name:t,value:n,event_category:e,event_label:i})}),g(this,"_gaCommandSendPageview",function(e,t){if(t&&Object.keys(t).length){var n=s._toGtagOptions(t),i=n.title,o=n.location,l=a(n,r);s._gtag("event","page_view",d(d(d(d({},e&&{page_path:e}),i&&{page_title:i}),o&&{page_location:o}),l))}else e?s._gtag("event","page_view",{page_path:e}):s._gtag("event","page_view")}),g(this,"_gaCommandSendPageviewParameters",function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if("string"==typeof t[0])s._gaCommandSendPageview.apply(s,u(t.slice(1)));else{var i=t[0],r=i.page;i.hitType;var l=a(i,o);s._gaCommandSendPageview(r,l)}}),g(this,"_gaCommandSend",function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i="string"==typeof t[0]?t[0]:t[0].hitType;switch(i){case"event":s._gaCommandSendEventParameters.apply(s,t);break;case"pageview":s._gaCommandSendPageviewParameters.apply(s,t);break;case"timing":s._gaCommandSendTiming.apply(s,u(t.slice(1)));break;case"screenview":case"transaction":case"item":case"social":case"exception":console.warn("Unsupported send command: ".concat(i));break;default:console.warn("Send command doesn't exist: ".concat(i))}}),g(this,"_gaCommandSet",function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];"string"==typeof t[0]&&(t[0]=g({},t[0],t[1])),s._gtag("set",s._toGtagOptions(t[0]))}),g(this,"_gaCommand",function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];switch(e){case"send":s._gaCommandSend.apply(s,n);break;case"set":s._gaCommandSet.apply(s,n);break;default:console.warn("Command doesn't exist: ".concat(e))}}),g(this,"ga",function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if("string"==typeof t[0])s._gaCommand.apply(s,t);else{var i=t[0];s._gtag("get",s._currentMeasurementId,"client_id",function(e){s._isQueuing=!1;var t=s._queueGtag;for(i({get:function(t){return"clientId"===t?e:"trackingId"===t?s._currentMeasurementId:"apiVersion"===t?"1":void 0}});t.length;){var n=t.shift();s._gtag.apply(s,u(n))}}),s._isQueuing=!0}return s.ga}),g(this,"event",function(e,t){if("string"==typeof e)s._gtag("event",e,s._toGtagOptions(t));else{var i=e.action,r=e.category,o=e.label,a=e.value,l=e.nonInteraction,u=e.transport;if(!r||!i)return void console.warn("args.category AND args.action are required in event()");var c={hitType:"event",eventCategory:(0,n.default)(r),eventAction:(0,n.default)(i)};o&&(c.eventLabel=(0,n.default)(o)),void 0!==a&&("number"!=typeof a?console.warn("Expected `args.value` arg to be a Number."):c.eventValue=a),void 0!==l&&("boolean"!=typeof l?console.warn("`args.nonInteraction` must be a boolean."):c.nonInteraction=l),void 0!==u&&("string"!=typeof u?console.warn("`args.transport` must be a string."):(-1===["beacon","xhr","image"].indexOf(u)&&console.warn("`args.transport` must be either one of these values: `beacon`, `xhr` or `image`"),c.transport=u)),s._gaCommand("send",c)}}),g(this,"send",function(e){s._gaCommand("send",e)}),this.reset()}return m(e,[{key:"gtag",value:function(){this._gtag.apply(this,arguments)}}]),e}();e.GA4=_;var y=new _;e.default=y}(I)),I}const F=e((L||(L=1,function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.ReactGAImplementation=void 0;var n=function(e,n){if(e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var r=i(n);if(r&&r.has(e))return r.get(e);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var l=s?Object.getOwnPropertyDescriptor(e,a):null;l&&(l.get||l.set)?Object.defineProperty(o,a,l):o[a]=e[a]}return o.default=e,r&&r.set(e,o),o}(k());function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(i=function(e){return e?n:t})(e)}var r=n.GA4;e.ReactGAImplementation=r;var o=n.default;e.default=o}(C)),C)),B="167",H=0,V=1,z=2,G=0,W=1,j=2,q=3,X=0,Y=1,K=2,J=100,$=101,Z=102,Q=200,ee=201,te=202,ne=203,ie=204,re=205,oe=206,se=207,ae=208,le=209,ue=210,ce=211,de=212,he=213,pe=214,fe="attached",me=301,ge=302,ve=303,_e=306,ye=1e3,xe=1001,Se=1002,Ee=1003,be=1004,Te=1005,we=1006,Me=1007,Ae=1008,Re=1009,Ce=1010,Ie=1011,Pe=1012,Oe=1013,Ne=1014,Le=1015,De=1016,Ue=1017,ke=1018,Fe=1020,Be=35902,He=1023,Ve=1026,ze=1027,Ge=1028,We=1029,je=1031,qe=1033,Xe=33776,Ye=33777,Ke=33778,Je=33779,$e=35840,Ze=35841,Qe=35842,et=35843,tt=36196,nt=37492,it=37496,rt=37808,ot=37809,st=37810,at=37811,lt=37812,ut=37813,ct=37814,dt=37815,ht=37816,pt=37817,ft=37818,mt=37819,gt=37820,vt=37821,_t=36492,yt=36494,xt=36495,St=36284,Et=36285,bt=36286,Tt=2300,wt=2301,Mt=2302,At=2400,Rt=2401,Ct=2402,It=2500,Pt="",Ot="srgb",Nt="srgb-linear",Lt="display-p3",Dt="display-p3-linear",Ut="linear",kt="srgb",Ft="rec709",Bt="p3",Ht=7680,Vt=512,zt=513,Gt=514,Wt=515,jt=516,qt=517,Xt=518,Yt=519,Kt=35044,Jt="300 es",$t=2e3,Zt=2001;class Qt{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,i=n.length;t<i;t++)n[t].call(this,e);e.target=null}}}const en=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let tn=1234567;const nn=Math.PI/180,rn=180/Math.PI;function on(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(en[255&e]+en[e>>8&255]+en[e>>16&255]+en[e>>24&255]+"-"+en[255&t]+en[t>>8&255]+"-"+en[t>>16&15|64]+en[t>>24&255]+"-"+en[63&n|128]+en[n>>8&255]+"-"+en[n>>16&255]+en[n>>24&255]+en[255&i]+en[i>>8&255]+en[i>>16&255]+en[i>>24&255]).toLowerCase()}function sn(e,t,n){return Math.max(t,Math.min(n,e))}function an(e,t){return(e%t+t)%t}function ln(e,t,n){return(1-n)*e+n*t}function un(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function cn(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(4294967295*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(2147483647*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}const dn={DEG2RAD:nn,RAD2DEG:rn,generateUUID:on,clamp:sn,euclideanModulo:an,mapLinear:function(e,t,n,i,r){return i+(e-t)*(r-i)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:ln,damp:function(e,t,n,i){return ln(e,t,1-Math.exp(-n*i))},pingpong:function(e,t=1){return t-Math.abs(an(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(tn=e);let t=tn+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296},degToRad:function(e){return e*nn},radToDeg:function(e){return e*rn},isPowerOfTwo:function(e){return!(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,n,i,r){const o=Math.cos,s=Math.sin,a=o(n/2),l=s(n/2),u=o((t+i)/2),c=s((t+i)/2),d=o((t-i)/2),h=s((t-i)/2),p=o((i-t)/2),f=s((i-t)/2);switch(r){case"XYX":e.set(a*c,l*d,l*h,a*u);break;case"YZY":e.set(l*h,a*c,l*d,a*u);break;case"ZXZ":e.set(l*d,l*h,a*c,a*u);break;case"XZX":e.set(a*c,l*f,l*p,a*u);break;case"YXY":e.set(l*p,a*c,l*f,a*u);break;case"ZYZ":e.set(l*f,l*p,a*c,a*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}},normalize:cn,denormalize:un};class hn{constructor(e=0,t=0){hn.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(sn(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*n-o*i+e.x,this.y=r*i+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class pn{constructor(e,t,n,i,r,o,s,a,l){pn.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,n,i,r,o,s,a,l)}set(e,t,n,i,r,o,s,a,l){const u=this.elements;return u[0]=e,u[1]=i,u[2]=s,u[3]=t,u[4]=r,u[5]=a,u[6]=n,u[7]=o,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,o=n[0],s=n[3],a=n[6],l=n[1],u=n[4],c=n[7],d=n[2],h=n[5],p=n[8],f=i[0],m=i[3],g=i[6],v=i[1],_=i[4],y=i[7],x=i[2],S=i[5],E=i[8];return r[0]=o*f+s*v+a*x,r[3]=o*m+s*_+a*S,r[6]=o*g+s*y+a*E,r[1]=l*f+u*v+c*x,r[4]=l*m+u*_+c*S,r[7]=l*g+u*y+c*E,r[2]=d*f+h*v+p*x,r[5]=d*m+h*_+p*S,r[8]=d*g+h*y+p*E,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],s=e[5],a=e[6],l=e[7],u=e[8];return t*o*u-t*s*l-n*r*u+n*s*a+i*r*l-i*o*a}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],s=e[5],a=e[6],l=e[7],u=e[8],c=u*o-s*l,d=s*a-u*r,h=l*r-o*a,p=t*c+n*d+i*h;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return e[0]=c*f,e[1]=(i*l-u*n)*f,e[2]=(s*n-i*o)*f,e[3]=d*f,e[4]=(u*t-i*a)*f,e[5]=(i*r-s*t)*f,e[6]=h*f,e[7]=(n*a-l*t)*f,e[8]=(o*t-n*r)*f,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,r,o,s){const a=Math.cos(r),l=Math.sin(r);return this.set(n*a,n*l,-n*(a*o+l*s)+o+e,-i*l,i*a,-i*(-l*o+a*s)+s+t,0,0,1),this}scale(e,t){return this.premultiply(fn.makeScale(e,t)),this}rotate(e){return this.premultiply(fn.makeRotation(-e)),this}translate(e,t){return this.premultiply(fn.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const fn=new pn;function mn(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}function gn(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function vn(){const e=gn("canvas");return e.style.display="block",e}const _n={};function yn(e){e in _n||(_n[e]=!0,console.warn(e))}const xn=(new pn).set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),Sn=(new pn).set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),En={[Nt]:{transfer:Ut,primaries:Ft,luminanceCoefficients:[.2126,.7152,.0722],toReference:e=>e,fromReference:e=>e},[Ot]:{transfer:kt,primaries:Ft,luminanceCoefficients:[.2126,.7152,.0722],toReference:e=>e.convertSRGBToLinear(),fromReference:e=>e.convertLinearToSRGB()},[Dt]:{transfer:Ut,primaries:Bt,luminanceCoefficients:[.2289,.6917,.0793],toReference:e=>e.applyMatrix3(Sn),fromReference:e=>e.applyMatrix3(xn)},[Lt]:{transfer:kt,primaries:Bt,luminanceCoefficients:[.2289,.6917,.0793],toReference:e=>e.convertSRGBToLinear().applyMatrix3(Sn),fromReference:e=>e.applyMatrix3(xn).convertLinearToSRGB()}},bn=new Set([Nt,Dt]),Tn={enabled:!0,_workingColorSpace:Nt,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(e){if(!bn.has(e))throw new Error(`Unsupported working color space, "${e}".`);this._workingColorSpace=e},convert:function(e,t,n){if(!1===this.enabled||t===n||!t||!n)return e;const i=En[t].toReference;return(0,En[n].fromReference)(i(e))},fromWorkingColorSpace:function(e,t){return this.convert(e,this._workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this._workingColorSpace)},getPrimaries:function(e){return En[e].primaries},getTransfer:function(e){return e===Pt?Ut:En[e].transfer},getLuminanceCoefficients:function(e,t=this._workingColorSpace){return e.fromArray(En[t].luminanceCoefficients)}};function wn(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Mn(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}let An;class Rn{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===An&&(An=gn("canvas")),An.width=e.width,An.height=e.height;const n=An.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=An}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=gn("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height),r=i.data;for(let e=0;e<r.length;e++)r[e]=255*wn(r[e]/255);return n.putImageData(i,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*wn(t[e]/255)):t[e]=wn(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let Cn=0;class In{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Cn++}),this.uuid=on(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(null!==i){let e;if(Array.isArray(i)){e=[];for(let t=0,n=i.length;t<n;t++)i[t].isDataTexture?e.push(Pn(i[t].image)):e.push(Pn(i[t]))}else e=Pn(i);n.url=e}return t||(e.images[this.uuid]=n),n}}function Pn(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?Rn.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let On=0;class Nn extends Qt{constructor(e=Nn.DEFAULT_IMAGE,t=Nn.DEFAULT_MAPPING,n=1001,i=1001,r=1006,o=1008,s=1023,a=1009,l=Nn.DEFAULT_ANISOTROPY,u=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:On++}),this.uuid=on(),this.name="",this.source=new In(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=o,this.anisotropy=l,this.format=s,this.internalFormat=null,this.type=a,this.offset=new hn(0,0),this.repeat=new hn(1,1),this.center=new hn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new pn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case ye:e.x=e.x-Math.floor(e.x);break;case xe:e.x=e.x<0?0:1;break;case Se:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case ye:e.y=e.y-Math.floor(e.y);break;case xe:e.y=e.y<0?0:1;break;case Se:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){!0===e&&this.pmremVersion++}}Nn.DEFAULT_IMAGE=null,Nn.DEFAULT_MAPPING=300,Nn.DEFAULT_ANISOTROPY=1;class Ln{constructor(e=0,t=0,n=0,i=1){Ln.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*i+o[12]*r,this.y=o[1]*t+o[5]*n+o[9]*i+o[13]*r,this.z=o[2]*t+o[6]*n+o[10]*i+o[14]*r,this.w=o[3]*t+o[7]*n+o[11]*i+o[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,r;const o=.01,s=.1,a=e.elements,l=a[0],u=a[4],c=a[8],d=a[1],h=a[5],p=a[9],f=a[2],m=a[6],g=a[10];if(Math.abs(u-d)<o&&Math.abs(c-f)<o&&Math.abs(p-m)<o){if(Math.abs(u+d)<s&&Math.abs(c+f)<s&&Math.abs(p+m)<s&&Math.abs(l+h+g-3)<s)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,a=(h+1)/2,v=(g+1)/2,_=(u+d)/4,y=(c+f)/4,x=(p+m)/4;return e>a&&e>v?e<o?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(e),i=_/n,r=y/n):a>v?a<o?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(a),n=_/i,r=x/i):v<o?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(v),n=y/r,i=x/r),this.set(n,i,r,t),this}let v=Math.sqrt((m-p)*(m-p)+(c-f)*(c-f)+(d-u)*(d-u));return Math.abs(v)<.001&&(v=1),this.x=(m-p)/v,this.y=(c-f)/v,this.z=(d-u)/v,this.w=Math.acos((l+h+g-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Dn extends Qt{constructor(e=1,t=1,n={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Ln(0,0,e,t),this.scissorTest=!1,this.viewport=new Ln(0,0,e,t);const i={width:e,height:t,depth:1};n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:we,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},n);const r=new Nn(i,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace);r.flipY=!1,r.generateMipmaps=n.generateMipmaps,r.internalFormat=n.internalFormat,this.textures=[];const o=n.count;for(let s=0;s<o;s++)this.textures[s]=r.clone(),this.textures[s].isRenderTargetTexture=!0;this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this.depthTexture=n.depthTexture,this.samples=n.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let i=0,r=this.textures.length;i<r;i++)this.textures[i].image.width=e,this.textures[i].image.height=t,this.textures[i].image.depth=n;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let n=0,i=e.textures.length;n<i;n++)this.textures[n]=e.textures[n].clone(),this.textures[n].isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new In(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Un extends Dn{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}class kn extends Nn{constructor(e=null,t=1,n=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=Ee,this.minFilter=Ee,this.wrapR=xe,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class Fn extends Nn{constructor(e=null,t=1,n=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=Ee,this.minFilter=Ee,this.wrapR=xe,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Bn{constructor(e=0,t=0,n=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=i}static slerpFlat(e,t,n,i,r,o,s){let a=n[i+0],l=n[i+1],u=n[i+2],c=n[i+3];const d=r[o+0],h=r[o+1],p=r[o+2],f=r[o+3];if(0===s)return e[t+0]=a,e[t+1]=l,e[t+2]=u,void(e[t+3]=c);if(1===s)return e[t+0]=d,e[t+1]=h,e[t+2]=p,void(e[t+3]=f);if(c!==f||a!==d||l!==h||u!==p){let e=1-s;const t=a*d+l*h+u*p+c*f,n=t>=0?1:-1,i=1-t*t;if(i>Number.EPSILON){const r=Math.sqrt(i),o=Math.atan2(r,t*n);e=Math.sin(e*o)/r,s=Math.sin(s*o)/r}const r=s*n;if(a=a*e+d*r,l=l*e+h*r,u=u*e+p*r,c=c*e+f*r,e===1-s){const e=1/Math.sqrt(a*a+l*l+u*u+c*c);a*=e,l*=e,u*=e,c*=e}}e[t]=a,e[t+1]=l,e[t+2]=u,e[t+3]=c}static multiplyQuaternionsFlat(e,t,n,i,r,o){const s=n[i],a=n[i+1],l=n[i+2],u=n[i+3],c=r[o],d=r[o+1],h=r[o+2],p=r[o+3];return e[t]=s*p+u*c+a*h-l*d,e[t+1]=a*p+u*d+l*c-s*h,e[t+2]=l*p+u*h+s*d-a*c,e[t+3]=u*p-s*c-a*d-l*h,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const n=e._x,i=e._y,r=e._z,o=e._order,s=Math.cos,a=Math.sin,l=s(n/2),u=s(i/2),c=s(r/2),d=a(n/2),h=a(i/2),p=a(r/2);switch(o){case"XYZ":this._x=d*u*c+l*h*p,this._y=l*h*c-d*u*p,this._z=l*u*p+d*h*c,this._w=l*u*c-d*h*p;break;case"YXZ":this._x=d*u*c+l*h*p,this._y=l*h*c-d*u*p,this._z=l*u*p-d*h*c,this._w=l*u*c+d*h*p;break;case"ZXY":this._x=d*u*c-l*h*p,this._y=l*h*c+d*u*p,this._z=l*u*p+d*h*c,this._w=l*u*c-d*h*p;break;case"ZYX":this._x=d*u*c-l*h*p,this._y=l*h*c+d*u*p,this._z=l*u*p-d*h*c,this._w=l*u*c+d*h*p;break;case"YZX":this._x=d*u*c+l*h*p,this._y=l*h*c+d*u*p,this._z=l*u*p-d*h*c,this._w=l*u*c-d*h*p;break;case"XZY":this._x=d*u*c-l*h*p,this._y=l*h*c-d*u*p,this._z=l*u*p+d*h*c,this._w=l*u*c+d*h*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!0===t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],r=t[8],o=t[1],s=t[5],a=t[9],l=t[2],u=t[6],c=t[10],d=n+s+c;if(d>0){const e=.5/Math.sqrt(d+1);this._w=.25/e,this._x=(u-a)*e,this._y=(r-l)*e,this._z=(o-i)*e}else if(n>s&&n>c){const e=2*Math.sqrt(1+n-s-c);this._w=(u-a)/e,this._x=.25*e,this._y=(i+o)/e,this._z=(r+l)/e}else if(s>c){const e=2*Math.sqrt(1+s-n-c);this._w=(r-l)/e,this._x=(i+o)/e,this._y=.25*e,this._z=(a+u)/e}else{const e=2*Math.sqrt(1+c-n-s);this._w=(o-i)/e,this._x=(r+l)/e,this._y=(a+u)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(sn(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,r=e._z,o=e._w,s=t._x,a=t._y,l=t._z,u=t._w;return this._x=n*u+o*s+i*l-r*a,this._y=i*u+o*a+r*s-n*l,this._z=r*u+o*l+n*a-i*s,this._w=o*u-n*s-i*a-r*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,i=this._y,r=this._z,o=this._w;let s=o*e._w+n*e._x+i*e._y+r*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=o,this._x=n,this._y=i,this._z=r,this;const a=1-s*s;if(a<=Number.EPSILON){const e=1-t;return this._w=e*o+t*this._w,this._x=e*n+t*this._x,this._y=e*i+t*this._y,this._z=e*r+t*this._z,this.normalize(),this}const l=Math.sqrt(a),u=Math.atan2(l,s),c=Math.sin((1-t)*u)/l,d=Math.sin(t*u)/l;return this._w=o*c+this._w*d,this._x=n*c+this._x*d,this._y=i*c+this._y*d,this._z=r*c+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),i=Math.sqrt(1-n),r=Math.sqrt(n);return this.set(i*Math.sin(e),i*Math.cos(e),r*Math.sin(t),r*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Hn{constructor(e=0,t=0,n=0){Hn.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(zn.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(zn.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=e.elements,o=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*o,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*o,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,r=e.x,o=e.y,s=e.z,a=e.w,l=2*(o*i-s*n),u=2*(s*t-r*i),c=2*(r*n-o*t);return this.x=t+a*l+o*c-s*u,this.y=n+a*u+s*l-r*c,this.z=i+a*c+r*u-o*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,r=e.z,o=t.x,s=t.y,a=t.z;return this.x=i*a-r*s,this.y=r*o-n*a,this.z=n*s-i*o,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return Vn.copy(this).projectOnVector(e),this.sub(Vn)}reflect(e){return this.sub(Vn.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(sn(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=2*Math.random()-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Vn=new Hn,zn=new Bn;class Gn{constructor(e=new Hn(1/0,1/0,1/0),t=new Hn(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(jn.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(jn.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=jn.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(void 0!==n){const i=n.getAttribute("position");if(!0===t&&void 0!==i&&!0!==e.isInstancedMesh)for(let t=0,n=i.count;t<n;t++)!0===e.isMesh?e.getVertexPosition(t,jn):jn.fromBufferAttribute(i,t),jn.applyMatrix4(e.matrixWorld),this.expandByPoint(jn);else void 0!==e.boundingBox?(null===e.boundingBox&&e.computeBoundingBox(),qn.copy(e.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),qn.copy(n.boundingBox)),qn.applyMatrix4(e.matrixWorld),this.union(qn)}const i=e.children;for(let r=0,o=i.length;r<o;r++)this.expandByObject(i[r],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,jn),jn.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Qn),ei.subVectors(this.max,Qn),Xn.subVectors(e.a,Qn),Yn.subVectors(e.b,Qn),Kn.subVectors(e.c,Qn),Jn.subVectors(Yn,Xn),$n.subVectors(Kn,Yn),Zn.subVectors(Xn,Kn);let t=[0,-Jn.z,Jn.y,0,-$n.z,$n.y,0,-Zn.z,Zn.y,Jn.z,0,-Jn.x,$n.z,0,-$n.x,Zn.z,0,-Zn.x,-Jn.y,Jn.x,0,-$n.y,$n.x,0,-Zn.y,Zn.x,0];return!!ii(t,Xn,Yn,Kn,ei)&&(t=[1,0,0,0,1,0,0,0,1],!!ii(t,Xn,Yn,Kn,ei)&&(ti.crossVectors(Jn,$n),t=[ti.x,ti.y,ti.z],ii(t,Xn,Yn,Kn,ei)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,jn).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(jn).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Wn[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Wn[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Wn[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Wn[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Wn[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Wn[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Wn[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Wn[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Wn)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Wn=[new Hn,new Hn,new Hn,new Hn,new Hn,new Hn,new Hn,new Hn],jn=new Hn,qn=new Gn,Xn=new Hn,Yn=new Hn,Kn=new Hn,Jn=new Hn,$n=new Hn,Zn=new Hn,Qn=new Hn,ei=new Hn,ti=new Hn,ni=new Hn;function ii(e,t,n,i,r){for(let o=0,s=e.length-3;o<=s;o+=3){ni.fromArray(e,o);const s=r.x*Math.abs(ni.x)+r.y*Math.abs(ni.y)+r.z*Math.abs(ni.z),a=t.dot(ni),l=n.dot(ni),u=i.dot(ni);if(Math.max(-Math.max(a,l,u),Math.min(a,l,u))>s)return!1}return!0}const ri=new Gn,oi=new Hn,si=new Hn;class ai{constructor(e=new Hn,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):ri.setFromPoints(e).getCenter(n);let i=0;for(let r=0,o=e.length;r<o;r++)i=Math.max(i,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;oi.subVectors(e,this.center);const t=oi.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.addScaledVector(oi,n/e),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(si.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(oi.copy(e.center).add(si)),this.expandByPoint(oi.copy(e.center).sub(si))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const li=new Hn,ui=new Hn,ci=new Hn,di=new Hn,hi=new Hn,pi=new Hn,fi=new Hn;class mi{constructor(e=new Hn,t=new Hn(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,li)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=li.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(li.copy(this.origin).addScaledVector(this.direction,t),li.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){ui.copy(e).add(t).multiplyScalar(.5),ci.copy(t).sub(e).normalize(),di.copy(this.origin).sub(ui);const r=.5*e.distanceTo(t),o=-this.direction.dot(ci),s=di.dot(this.direction),a=-di.dot(ci),l=di.lengthSq(),u=Math.abs(1-o*o);let c,d,h,p;if(u>0)if(c=o*a-s,d=o*s-a,p=r*u,c>=0)if(d>=-p)if(d<=p){const e=1/u;c*=e,d*=e,h=c*(c+o*d+2*s)+d*(o*c+d+2*a)+l}else d=r,c=Math.max(0,-(o*d+s)),h=-c*c+d*(d+2*a)+l;else d=-r,c=Math.max(0,-(o*d+s)),h=-c*c+d*(d+2*a)+l;else d<=-p?(c=Math.max(0,-(-o*r+s)),d=c>0?-r:Math.min(Math.max(-r,-a),r),h=-c*c+d*(d+2*a)+l):d<=p?(c=0,d=Math.min(Math.max(-r,-a),r),h=d*(d+2*a)+l):(c=Math.max(0,-(o*r+s)),d=c>0?r:Math.min(Math.max(-r,-a),r),h=-c*c+d*(d+2*a)+l);else d=o>0?-r:r,c=Math.max(0,-(o*d+s)),h=-c*c+d*(d+2*a)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,c),i&&i.copy(ui).addScaledVector(ci,d),h}intersectSphere(e,t){li.subVectors(e.center,this.origin);const n=li.dot(this.direction),i=li.dot(li)-n*n,r=e.radius*e.radius;if(i>r)return null;const o=Math.sqrt(r-i),s=n-o,a=n+o;return a<0?null:s<0?this.at(a,t):this.at(s,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);if(0===t)return!0;return e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,r,o,s,a;const l=1/this.direction.x,u=1/this.direction.y,c=1/this.direction.z,d=this.origin;return l>=0?(n=(e.min.x-d.x)*l,i=(e.max.x-d.x)*l):(n=(e.max.x-d.x)*l,i=(e.min.x-d.x)*l),u>=0?(r=(e.min.y-d.y)*u,o=(e.max.y-d.y)*u):(r=(e.max.y-d.y)*u,o=(e.min.y-d.y)*u),n>o||r>i?null:((r>n||isNaN(n))&&(n=r),(o<i||isNaN(i))&&(i=o),c>=0?(s=(e.min.z-d.z)*c,a=(e.max.z-d.z)*c):(s=(e.max.z-d.z)*c,a=(e.min.z-d.z)*c),n>a||s>i?null:((s>n||n!=n)&&(n=s),(a<i||i!=i)&&(i=a),i<0?null:this.at(n>=0?n:i,t)))}intersectsBox(e){return null!==this.intersectBox(e,li)}intersectTriangle(e,t,n,i,r){hi.subVectors(t,e),pi.subVectors(n,e),fi.crossVectors(hi,pi);let o,s=this.direction.dot(fi);if(s>0){if(i)return null;o=1}else{if(!(s<0))return null;o=-1,s=-s}di.subVectors(this.origin,e);const a=o*this.direction.dot(pi.crossVectors(di,pi));if(a<0)return null;const l=o*this.direction.dot(hi.cross(di));if(l<0)return null;if(a+l>s)return null;const u=-o*di.dot(fi);return u<0?null:this.at(u/s,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class gi{constructor(e,t,n,i,r,o,s,a,l,u,c,d,h,p,f,m){gi.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,n,i,r,o,s,a,l,u,c,d,h,p,f,m)}set(e,t,n,i,r,o,s,a,l,u,c,d,h,p,f,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=i,g[1]=r,g[5]=o,g[9]=s,g[13]=a,g[2]=l,g[6]=u,g[10]=c,g[14]=d,g[3]=h,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new gi).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/vi.setFromMatrixColumn(e,0).length(),r=1/vi.setFromMatrixColumn(e,1).length(),o=1/vi.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,i=e.y,r=e.z,o=Math.cos(n),s=Math.sin(n),a=Math.cos(i),l=Math.sin(i),u=Math.cos(r),c=Math.sin(r);if("XYZ"===e.order){const e=o*u,n=o*c,i=s*u,r=s*c;t[0]=a*u,t[4]=-a*c,t[8]=l,t[1]=n+i*l,t[5]=e-r*l,t[9]=-s*a,t[2]=r-e*l,t[6]=i+n*l,t[10]=o*a}else if("YXZ"===e.order){const e=a*u,n=a*c,i=l*u,r=l*c;t[0]=e+r*s,t[4]=i*s-n,t[8]=o*l,t[1]=o*c,t[5]=o*u,t[9]=-s,t[2]=n*s-i,t[6]=r+e*s,t[10]=o*a}else if("ZXY"===e.order){const e=a*u,n=a*c,i=l*u,r=l*c;t[0]=e-r*s,t[4]=-o*c,t[8]=i+n*s,t[1]=n+i*s,t[5]=o*u,t[9]=r-e*s,t[2]=-o*l,t[6]=s,t[10]=o*a}else if("ZYX"===e.order){const e=o*u,n=o*c,i=s*u,r=s*c;t[0]=a*u,t[4]=i*l-n,t[8]=e*l+r,t[1]=a*c,t[5]=r*l+e,t[9]=n*l-i,t[2]=-l,t[6]=s*a,t[10]=o*a}else if("YZX"===e.order){const e=o*a,n=o*l,i=s*a,r=s*l;t[0]=a*u,t[4]=r-e*c,t[8]=i*c+n,t[1]=c,t[5]=o*u,t[9]=-s*u,t[2]=-l*u,t[6]=n*c+i,t[10]=e-r*c}else if("XZY"===e.order){const e=o*a,n=o*l,i=s*a,r=s*l;t[0]=a*u,t[4]=-c,t[8]=l*u,t[1]=e*c+r,t[5]=o*u,t[9]=n*c-i,t[2]=i*c-n,t[6]=s*u,t[10]=r*c+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(yi,e,xi)}lookAt(e,t,n){const i=this.elements;return bi.subVectors(e,t),0===bi.lengthSq()&&(bi.z=1),bi.normalize(),Si.crossVectors(n,bi),0===Si.lengthSq()&&(1===Math.abs(n.z)?bi.x+=1e-4:bi.z+=1e-4,bi.normalize(),Si.crossVectors(n,bi)),Si.normalize(),Ei.crossVectors(bi,Si),i[0]=Si.x,i[4]=Ei.x,i[8]=bi.x,i[1]=Si.y,i[5]=Ei.y,i[9]=bi.y,i[2]=Si.z,i[6]=Ei.z,i[10]=bi.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,o=n[0],s=n[4],a=n[8],l=n[12],u=n[1],c=n[5],d=n[9],h=n[13],p=n[2],f=n[6],m=n[10],g=n[14],v=n[3],_=n[7],y=n[11],x=n[15],S=i[0],E=i[4],b=i[8],T=i[12],w=i[1],M=i[5],A=i[9],R=i[13],C=i[2],I=i[6],P=i[10],O=i[14],N=i[3],L=i[7],D=i[11],U=i[15];return r[0]=o*S+s*w+a*C+l*N,r[4]=o*E+s*M+a*I+l*L,r[8]=o*b+s*A+a*P+l*D,r[12]=o*T+s*R+a*O+l*U,r[1]=u*S+c*w+d*C+h*N,r[5]=u*E+c*M+d*I+h*L,r[9]=u*b+c*A+d*P+h*D,r[13]=u*T+c*R+d*O+h*U,r[2]=p*S+f*w+m*C+g*N,r[6]=p*E+f*M+m*I+g*L,r[10]=p*b+f*A+m*P+g*D,r[14]=p*T+f*R+m*O+g*U,r[3]=v*S+_*w+y*C+x*N,r[7]=v*E+_*M+y*I+x*L,r[11]=v*b+_*A+y*P+x*D,r[15]=v*T+_*R+y*O+x*U,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],o=e[1],s=e[5],a=e[9],l=e[13],u=e[2],c=e[6],d=e[10],h=e[14];return e[3]*(+r*a*c-i*l*c-r*s*d+n*l*d+i*s*h-n*a*h)+e[7]*(+t*a*h-t*l*d+r*o*d-i*o*h+i*l*u-r*a*u)+e[11]*(+t*l*c-t*s*h-r*o*c+n*o*h+r*s*u-n*l*u)+e[15]*(-i*s*u-t*a*c+t*s*d+i*o*c-n*o*d+n*a*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],s=e[5],a=e[6],l=e[7],u=e[8],c=e[9],d=e[10],h=e[11],p=e[12],f=e[13],m=e[14],g=e[15],v=c*m*l-f*d*l+f*a*h-s*m*h-c*a*g+s*d*g,_=p*d*l-u*m*l-p*a*h+o*m*h+u*a*g-o*d*g,y=u*f*l-p*c*l+p*s*h-o*f*h-u*s*g+o*c*g,x=p*c*a-u*f*a-p*s*d+o*f*d+u*s*m-o*c*m,S=t*v+n*_+i*y+r*x;if(0===S)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const E=1/S;return e[0]=v*E,e[1]=(f*d*r-c*m*r-f*i*h+n*m*h+c*i*g-n*d*g)*E,e[2]=(s*m*r-f*a*r+f*i*l-n*m*l-s*i*g+n*a*g)*E,e[3]=(c*a*r-s*d*r-c*i*l+n*d*l+s*i*h-n*a*h)*E,e[4]=_*E,e[5]=(u*m*r-p*d*r+p*i*h-t*m*h-u*i*g+t*d*g)*E,e[6]=(p*a*r-o*m*r-p*i*l+t*m*l+o*i*g-t*a*g)*E,e[7]=(o*d*r-u*a*r+u*i*l-t*d*l-o*i*h+t*a*h)*E,e[8]=y*E,e[9]=(p*c*r-u*f*r-p*n*h+t*f*h+u*n*g-t*c*g)*E,e[10]=(o*f*r-p*s*r+p*n*l-t*f*l-o*n*g+t*s*g)*E,e[11]=(u*s*r-o*c*r-u*n*l+t*c*l+o*n*h-t*s*h)*E,e[12]=x*E,e[13]=(u*f*i-p*c*i+p*n*d-t*f*d-u*n*m+t*c*m)*E,e[14]=(p*s*i-o*f*i-p*n*a+t*f*a+o*n*m-t*s*m)*E,e[15]=(o*c*i-u*s*i+u*n*a-t*c*a-o*n*d+t*s*d)*E,this}scale(e){const t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),r=1-n,o=e.x,s=e.y,a=e.z,l=r*o,u=r*s;return this.set(l*o+n,l*s-i*a,l*a+i*s,0,l*s+i*a,u*s+n,u*a-i*o,0,l*a-i*s,u*a+i*o,r*a*a+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,r,o){return this.set(1,n,r,0,e,1,o,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,r=t._x,o=t._y,s=t._z,a=t._w,l=r+r,u=o+o,c=s+s,d=r*l,h=r*u,p=r*c,f=o*u,m=o*c,g=s*c,v=a*l,_=a*u,y=a*c,x=n.x,S=n.y,E=n.z;return i[0]=(1-(f+g))*x,i[1]=(h+y)*x,i[2]=(p-_)*x,i[3]=0,i[4]=(h-y)*S,i[5]=(1-(d+g))*S,i[6]=(m+v)*S,i[7]=0,i[8]=(p+_)*E,i[9]=(m-v)*E,i[10]=(1-(d+f))*E,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let r=vi.set(i[0],i[1],i[2]).length();const o=vi.set(i[4],i[5],i[6]).length(),s=vi.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],_i.copy(this);const a=1/r,l=1/o,u=1/s;return _i.elements[0]*=a,_i.elements[1]*=a,_i.elements[2]*=a,_i.elements[4]*=l,_i.elements[5]*=l,_i.elements[6]*=l,_i.elements[8]*=u,_i.elements[9]*=u,_i.elements[10]*=u,t.setFromRotationMatrix(_i),n.x=r,n.y=o,n.z=s,this}makePerspective(e,t,n,i,r,o,s=2e3){const a=this.elements,l=2*r/(t-e),u=2*r/(n-i),c=(t+e)/(t-e),d=(n+i)/(n-i);let h,p;if(s===$t)h=-(o+r)/(o-r),p=-2*o*r/(o-r);else{if(s!==Zt)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+s);h=-o/(o-r),p=-o*r/(o-r)}return a[0]=l,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=u,a[9]=d,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,n,i,r,o,s=2e3){const a=this.elements,l=1/(t-e),u=1/(n-i),c=1/(o-r),d=(t+e)*l,h=(n+i)*u;let p,f;if(s===$t)p=(o+r)*c,f=-2*c;else{if(s!==Zt)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+s);p=r*c,f=-1*c}return a[0]=2*l,a[4]=0,a[8]=0,a[12]=-d,a[1]=0,a[5]=2*u,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=f,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const vi=new Hn,_i=new gi,yi=new Hn(0,0,0),xi=new Hn(1,1,1),Si=new Hn,Ei=new Hn,bi=new Hn,Ti=new gi,wi=new Bn;class Mi{constructor(e=0,t=0,n=0,i=Mi.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i=this._order){return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const i=e.elements,r=i[0],o=i[4],s=i[8],a=i[1],l=i[5],u=i[9],c=i[2],d=i[6],h=i[10];switch(t){case"XYZ":this._y=Math.asin(sn(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-u,h),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(d,l),this._z=0);break;case"YXZ":this._x=Math.asin(-sn(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(s,h),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-c,r),this._z=0);break;case"ZXY":this._x=Math.asin(sn(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-c,h),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(a,r));break;case"ZYX":this._y=Math.asin(-sn(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(d,h),this._z=Math.atan2(a,r)):(this._x=0,this._z=Math.atan2(-o,l));break;case"YZX":this._z=Math.asin(sn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-c,r)):(this._x=0,this._y=Math.atan2(s,h));break;case"XZY":this._z=Math.asin(-sn(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(d,l),this._y=Math.atan2(s,r)):(this._x=Math.atan2(-u,h),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return Ti.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Ti,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return wi.setFromEuler(this),this.setFromQuaternion(wi,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Mi.DEFAULT_ORDER="XYZ";class Ai{constructor(){this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return 0!==(this.mask&e.mask)}isEnabled(e){return!!(this.mask&1<<e)}}let Ri=0;const Ci=new Hn,Ii=new Bn,Pi=new gi,Oi=new Hn,Ni=new Hn,Li=new Hn,Di=new Bn,Ui=new Hn(1,0,0),ki=new Hn(0,1,0),Fi=new Hn(0,0,1),Bi={type:"added"},Hi={type:"removed"},Vi={type:"childadded",child:null},zi={type:"childremoved",child:null};class Gi extends Qt{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Ri++}),this.uuid=on(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Gi.DEFAULT_UP.clone();const e=new Hn,t=new Mi,n=new Bn,i=new Hn(1,1,1);t._onChange(function(){n.setFromEuler(t,!1)}),n._onChange(function(){t.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new gi},normalMatrix:{value:new pn}}),this.matrix=new gi,this.matrixWorld=new gi,this.matrixAutoUpdate=Gi.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Gi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Ai,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Ii.setFromAxisAngle(e,t),this.quaternion.multiply(Ii),this}rotateOnWorldAxis(e,t){return Ii.setFromAxisAngle(e,t),this.quaternion.premultiply(Ii),this}rotateX(e){return this.rotateOnAxis(Ui,e)}rotateY(e){return this.rotateOnAxis(ki,e)}rotateZ(e){return this.rotateOnAxis(Fi,e)}translateOnAxis(e,t){return Ci.copy(e).applyQuaternion(this.quaternion),this.position.add(Ci.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Ui,e)}translateY(e){return this.translateOnAxis(ki,e)}translateZ(e){return this.translateOnAxis(Fi,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Pi.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?Oi.copy(e):Oi.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),Ni.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Pi.lookAt(Ni,Oi,this.up):Pi.lookAt(Oi,Ni,this.up),this.quaternion.setFromRotationMatrix(Pi),i&&(Pi.extractRotation(i.matrixWorld),Ii.setFromRotationMatrix(Pi),this.quaternion.premultiply(Ii.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(Bi),Vi.child=e,this.dispatchEvent(Vi),Vi.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Hi),zi.child=e,this.dispatchEvent(zi),zi.child=null),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Pi.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Pi.multiply(e.parent.matrixWorld)),e.applyMatrix4(Pi),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(Bi),Vi.child=e,this.dispatchEvent(Vi),Vi.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}}getObjectsByProperty(e,t,n=[]){this[e]===t&&n.push(this);const i=this.children;for(let r=0,o=i.length;r<o;r++)i[r].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ni,e,Li),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ni,Di,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++){t[n].updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++){e[t].updateWorldMatrix(!1,!0)}}}toJSON(e){const t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};function r(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.visibility=this._visibility,i.active=this._active,i.bounds=this._bounds.map(e=>({boxInitialized:e.boxInitialized,boxMin:e.box.min.toArray(),boxMax:e.box.max.toArray(),sphereInitialized:e.sphereInitialized,sphereRadius:e.sphere.radius,sphereCenter:e.sphere.center.toArray()})),i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.geometryCount=this._geometryCount,i.matricesTexture=this._matricesTexture.toJSON(e),null!==this._colorsTexture&&(i.colorsTexture=this._colorsTexture.toJSON(e)),null!==this.boundingSphere&&(i.boundingSphere={center:i.boundingSphere.center.toArray(),radius:i.boundingSphere.radius}),null!==this.boundingBox&&(i.boundingBox={min:i.boundingBox.min.toArray(),max:i.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const i=n[t];r(e.shapes,i)}else r(e.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,i=this.material.length;n<i;n++)t.push(r(e.materials,this.material[n]));i.material=t}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(let t=0;t<this.children.length;t++)i.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];i.animations.push(r(e.animations,n))}}if(t){const t=o(e.geometries),i=o(e.materials),r=o(e.textures),s=o(e.images),a=o(e.shapes),l=o(e.skeletons),u=o(e.animations),c=o(e.nodes);t.length>0&&(n.geometries=t),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),s.length>0&&(n.images=s),a.length>0&&(n.shapes=a),l.length>0&&(n.skeletons=l),u.length>0&&(n.animations=u),c.length>0&&(n.nodes=c)}return n.object=i,n;function o(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let n=0;n<e.children.length;n++){const t=e.children[n];this.add(t.clone())}return this}}Gi.DEFAULT_UP=new Hn(0,1,0),Gi.DEFAULT_MATRIX_AUTO_UPDATE=!0,Gi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Wi=new Hn,ji=new Hn,qi=new Hn,Xi=new Hn,Yi=new Hn,Ki=new Hn,Ji=new Hn,$i=new Hn,Zi=new Hn,Qi=new Hn;class er{constructor(e=new Hn,t=new Hn,n=new Hn){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),Wi.subVectors(e,t),i.cross(Wi);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(e,t,n,i,r){Wi.subVectors(i,t),ji.subVectors(n,t),qi.subVectors(e,t);const o=Wi.dot(Wi),s=Wi.dot(ji),a=Wi.dot(qi),l=ji.dot(ji),u=ji.dot(qi),c=o*l-s*s;if(0===c)return r.set(0,0,0),null;const d=1/c,h=(l*a-s*u)*d,p=(o*u-s*a)*d;return r.set(1-h-p,p,h)}static containsPoint(e,t,n,i){return null!==this.getBarycoord(e,t,n,i,Xi)&&(Xi.x>=0&&Xi.y>=0&&Xi.x+Xi.y<=1)}static getInterpolation(e,t,n,i,r,o,s,a){return null===this.getBarycoord(e,t,n,i,Xi)?(a.x=0,a.y=0,"z"in a&&(a.z=0),"w"in a&&(a.w=0),null):(a.setScalar(0),a.addScaledVector(r,Xi.x),a.addScaledVector(o,Xi.y),a.addScaledVector(s,Xi.z),a)}static isFrontFacing(e,t,n,i){return Wi.subVectors(n,t),ji.subVectors(e,t),Wi.cross(ji).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Wi.subVectors(this.c,this.b),ji.subVectors(this.a,this.b),.5*Wi.cross(ji).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return er.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return er.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,i,r){return er.getInterpolation(e,this.a,this.b,this.c,t,n,i,r)}containsPoint(e){return er.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return er.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,i=this.b,r=this.c;let o,s;Yi.subVectors(i,n),Ki.subVectors(r,n),$i.subVectors(e,n);const a=Yi.dot($i),l=Ki.dot($i);if(a<=0&&l<=0)return t.copy(n);Zi.subVectors(e,i);const u=Yi.dot(Zi),c=Ki.dot(Zi);if(u>=0&&c<=u)return t.copy(i);const d=a*c-u*l;if(d<=0&&a>=0&&u<=0)return o=a/(a-u),t.copy(n).addScaledVector(Yi,o);Qi.subVectors(e,r);const h=Yi.dot(Qi),p=Ki.dot(Qi);if(p>=0&&h<=p)return t.copy(r);const f=h*l-a*p;if(f<=0&&l>=0&&p<=0)return s=l/(l-p),t.copy(n).addScaledVector(Ki,s);const m=u*p-h*c;if(m<=0&&c-u>=0&&h-p>=0)return Ji.subVectors(r,i),s=(c-u)/(c-u+(h-p)),t.copy(i).addScaledVector(Ji,s);const g=1/(m+f+d);return o=f*g,s=d*g,t.copy(n).addScaledVector(Yi,o).addScaledVector(Ki,s)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const tr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},nr={h:0,s:0,l:0},ir={h:0,s:0,l:0};function rr(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}class or{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(void 0===t&&void 0===n){const t=e;t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Ot){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,Tn.toWorkingColorSpace(this,t),this}setRGB(e,t,n,i=Tn.workingColorSpace){return this.r=e,this.g=t,this.b=n,Tn.toWorkingColorSpace(this,i),this}setHSL(e,t,n,i=Tn.workingColorSpace){if(e=an(e,1),t=sn(t,0,1),n=sn(n,0,1),0===t)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+t):n+t-n*t,r=2*n-i;this.r=rr(r,i,e+1/3),this.g=rr(r,i,e),this.b=rr(r,i,e-1/3)}return Tn.toWorkingColorSpace(this,i),this}setStyle(e,t=Ot){function n(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let r;const o=i[1],s=i[2];switch(o){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return n(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,t);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return n(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return n(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const n=i[1],r=n.length;if(3===r)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,t);if(6===r)return this.setHex(parseInt(n,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Ot){const n=tr[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=wn(e.r),this.g=wn(e.g),this.b=wn(e.b),this}copyLinearToSRGB(e){return this.r=Mn(e.r),this.g=Mn(e.g),this.b=Mn(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Ot){return Tn.fromWorkingColorSpace(sr.copy(this),e),65536*Math.round(sn(255*sr.r,0,255))+256*Math.round(sn(255*sr.g,0,255))+Math.round(sn(255*sr.b,0,255))}getHexString(e=Ot){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Tn.workingColorSpace){Tn.fromWorkingColorSpace(sr.copy(this),t);const n=sr.r,i=sr.g,r=sr.b,o=Math.max(n,i,r),s=Math.min(n,i,r);let a,l;const u=(s+o)/2;if(s===o)a=0,l=0;else{const e=o-s;switch(l=u<=.5?e/(o+s):e/(2-o-s),o){case n:a=(i-r)/e+(i<r?6:0);break;case i:a=(r-n)/e+2;break;case r:a=(n-i)/e+4}a/=6}return e.h=a,e.s=l,e.l=u,e}getRGB(e,t=Tn.workingColorSpace){return Tn.fromWorkingColorSpace(sr.copy(this),t),e.r=sr.r,e.g=sr.g,e.b=sr.b,e}getStyle(e=Ot){Tn.fromWorkingColorSpace(sr.copy(this),e);const t=sr.r,n=sr.g,i=sr.b;return e!==Ot?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*n)},${Math.round(255*i)})`}offsetHSL(e,t,n){return this.getHSL(nr),this.setHSL(nr.h+e,nr.s+t,nr.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(nr),e.getHSL(ir);const n=ln(nr.h,ir.h,t),i=ln(nr.s,ir.s,t),r=ln(nr.l,ir.l,t);return this.setHSL(n,i,r),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,i=this.b,r=e.elements;return this.r=r[0]*t+r[3]*n+r[6]*i,this.g=r[1]*t+r[4]*n+r[7]*i,this.b=r[2]*t+r[5]*n+r[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const sr=new or;or.NAMES=tr;let ar=0;class lr extends Qt{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:ar++}),this.uuid=on(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=J,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new or(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Ht,this.stencilZFail=Ht,this.stencilZPass=Ht,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const i=this[t];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n:console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`)}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function i(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.dispersion&&(n.dispersion=this.dispersion),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapRotation&&(n.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),204!==this.blendSrc&&(n.blendSrc=this.blendSrc),205!==this.blendDst&&(n.blendDst=this.blendDst),this.blendEquation!==J&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Ht&&(n.stencilFail=this.stencilFail),this.stencilZFail!==Ht&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==Ht&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),t){const t=i(e.textures),r=i(e.images);t.length>0&&(n.textures=t),r.length>0&&(n.images=r)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let i=0;i!==e;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}onBeforeRender(){console.warn("Material: onBeforeRender() has been removed.")}}class ur extends lr{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new or(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Mi,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const cr=new Hn,dr=new hn;class hr{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=n,this.usage=Kt,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=Le,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}get updateRange(){return yn("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)dr.fromBufferAttribute(this,t),dr.applyMatrix3(e),this.setXY(t,dr.x,dr.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)cr.fromBufferAttribute(this,t),cr.applyMatrix3(e),this.setXYZ(t,cr.x,cr.y,cr.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)cr.fromBufferAttribute(this,t),cr.applyMatrix4(e),this.setXYZ(t,cr.x,cr.y,cr.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)cr.fromBufferAttribute(this,t),cr.applyNormalMatrix(e),this.setXYZ(t,cr.x,cr.y,cr.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)cr.fromBufferAttribute(this,t),cr.transformDirection(e),this.setXYZ(t,cr.x,cr.y,cr.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=un(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=cn(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=un(t,this.array)),t}setX(e,t){return this.normalized&&(t=cn(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=un(t,this.array)),t}setY(e,t){return this.normalized&&(t=cn(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=un(t,this.array)),t}setZ(e,t){return this.normalized&&(t=cn(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=un(t,this.array)),t}setW(e,t){return this.normalized&&(t=cn(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=cn(t,this.array),n=cn(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=cn(t,this.array),n=cn(n,this.array),i=cn(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.normalized&&(t=cn(t,this.array),n=cn(n,this.array),i=cn(i,this.array),r=cn(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==Kt&&(e.usage=this.usage),e}}class pr extends hr{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class fr extends hr{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class mr extends hr{constructor(e,t,n){super(new Float32Array(e),t,n)}}let gr=0;const vr=new gi,_r=new Gi,yr=new Hn,xr=new Gn,Sr=new Gn,Er=new Hn;class br extends Qt{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:gr++}),this.uuid=on(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(mn(e)?fr:pr)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new pn).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return vr.makeRotationFromQuaternion(e),this.applyMatrix4(vr),this}rotateX(e){return vr.makeRotationX(e),this.applyMatrix4(vr),this}rotateY(e){return vr.makeRotationY(e),this.applyMatrix4(vr),this}rotateZ(e){return vr.makeRotationZ(e),this.applyMatrix4(vr),this}translate(e,t,n){return vr.makeTranslation(e,t,n),this.applyMatrix4(vr),this}scale(e,t,n){return vr.makeScale(e,t,n),this.applyMatrix4(vr),this}lookAt(e){return _r.lookAt(e),_r.updateMatrix(),this.applyMatrix4(_r.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(yr).negate(),this.translate(yr.x,yr.y,yr.z),this}setFromPoints(e){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new mr(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Gn);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new Hn(-1/0,-1/0,-1/0),new Hn(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,i=t.length;n<i;n++){const e=t[n];xr.setFromBufferAttribute(e),this.morphTargetsRelative?(Er.addVectors(this.boundingBox.min,xr.min),this.boundingBox.expandByPoint(Er),Er.addVectors(this.boundingBox.max,xr.max),this.boundingBox.expandByPoint(Er)):(this.boundingBox.expandByPoint(xr.min),this.boundingBox.expandByPoint(xr.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new ai);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new Hn,1/0);if(e){const n=this.boundingSphere.center;if(xr.setFromBufferAttribute(e),t)for(let e=0,r=t.length;e<r;e++){const n=t[e];Sr.setFromBufferAttribute(n),this.morphTargetsRelative?(Er.addVectors(xr.min,Sr.min),xr.expandByPoint(Er),Er.addVectors(xr.max,Sr.max),xr.expandByPoint(Er)):(xr.expandByPoint(Sr.min),xr.expandByPoint(Sr.max))}xr.getCenter(n);let i=0;for(let t=0,r=e.count;t<r;t++)Er.fromBufferAttribute(e,t),i=Math.max(i,n.distanceToSquared(Er));if(t)for(let r=0,o=t.length;r<o;r++){const o=t[r],s=this.morphTargetsRelative;for(let t=0,r=o.count;t<r;t++)Er.fromBufferAttribute(o,t),s&&(yr.fromBufferAttribute(e,t),Er.add(yr)),i=Math.max(i,n.distanceToSquared(Er))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=t.position,i=t.normal,r=t.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new hr(new Float32Array(4*n.count),4));const o=this.getAttribute("tangent"),s=[],a=[];for(let b=0;b<n.count;b++)s[b]=new Hn,a[b]=new Hn;const l=new Hn,u=new Hn,c=new Hn,d=new hn,h=new hn,p=new hn,f=new Hn,m=new Hn;function g(e,t,i){l.fromBufferAttribute(n,e),u.fromBufferAttribute(n,t),c.fromBufferAttribute(n,i),d.fromBufferAttribute(r,e),h.fromBufferAttribute(r,t),p.fromBufferAttribute(r,i),u.sub(l),c.sub(l),h.sub(d),p.sub(d);const o=1/(h.x*p.y-p.x*h.y);isFinite(o)&&(f.copy(u).multiplyScalar(p.y).addScaledVector(c,-h.y).multiplyScalar(o),m.copy(c).multiplyScalar(h.x).addScaledVector(u,-p.x).multiplyScalar(o),s[e].add(f),s[t].add(f),s[i].add(f),a[e].add(m),a[t].add(m),a[i].add(m))}let v=this.groups;0===v.length&&(v=[{start:0,count:e.count}]);for(let b=0,T=v.length;b<T;++b){const t=v[b],n=t.start;for(let i=n,r=n+t.count;i<r;i+=3)g(e.getX(i+0),e.getX(i+1),e.getX(i+2))}const _=new Hn,y=new Hn,x=new Hn,S=new Hn;function E(e){x.fromBufferAttribute(i,e),S.copy(x);const t=s[e];_.copy(t),_.sub(x.multiplyScalar(x.dot(t))).normalize(),y.crossVectors(S,t);const n=y.dot(a[e])<0?-1:1;o.setXYZW(e,_.x,_.y,_.z,n)}for(let b=0,T=v.length;b<T;++b){const t=v[b],n=t.start;for(let i=n,r=n+t.count;i<r;i+=3)E(e.getX(i+0)),E(e.getX(i+1)),E(e.getX(i+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new hr(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const i=new Hn,r=new Hn,o=new Hn,s=new Hn,a=new Hn,l=new Hn,u=new Hn,c=new Hn;if(e)for(let d=0,h=e.count;d<h;d+=3){const h=e.getX(d+0),p=e.getX(d+1),f=e.getX(d+2);i.fromBufferAttribute(t,h),r.fromBufferAttribute(t,p),o.fromBufferAttribute(t,f),u.subVectors(o,r),c.subVectors(i,r),u.cross(c),s.fromBufferAttribute(n,h),a.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),s.add(u),a.add(u),l.add(u),n.setXYZ(h,s.x,s.y,s.z),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let e=0,d=t.count;e<d;e+=3)i.fromBufferAttribute(t,e+0),r.fromBufferAttribute(t,e+1),o.fromBufferAttribute(t,e+2),u.subVectors(o,r),c.subVectors(i,r),u.cross(c),n.setXYZ(e+0,u.x,u.y,u.z),n.setXYZ(e+1,u.x,u.y,u.z),n.setXYZ(e+2,u.x,u.y,u.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Er.fromBufferAttribute(e,t),Er.normalize(),e.setXYZ(t,Er.x,Er.y,Er.z)}toNonIndexed(){function e(e,t){const n=e.array,i=e.itemSize,r=e.normalized,o=new n.constructor(t.length*i);let s=0,a=0;for(let l=0,u=t.length;l<u;l++){s=e.isInterleavedBufferAttribute?t[l]*e.data.stride+e.offset:t[l]*i;for(let e=0;e<i;e++)o[a++]=n[s++]}return new hr(o,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new br,n=this.index.array,i=this.attributes;for(const s in i){const r=e(i[s],n);t.setAttribute(s,r)}const r=this.morphAttributes;for(const s in r){const i=[],o=r[s];for(let t=0,r=o.length;t<r;t++){const r=e(o[t],n);i.push(r)}t.morphAttributes[s]=i}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let s=0,a=o.length;s<a;s++){const e=o[s];t.addGroup(e.start,e.count,e.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const a in n){const t=n[a];e.data.attributes[a]=t.toJSON(e.data)}const i={};let r=!1;for(const a in this.morphAttributes){const t=this.morphAttributes[a],n=[];for(let i=0,r=t.length;i<r;i++){const r=t[i];n.push(r.toJSON(e.data))}n.length>0&&(i[a]=n,r=!0)}r&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const s=this.boundingSphere;return null!==s&&(e.data.boundingSphere={center:s.center.toArray(),radius:s.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const i=e.attributes;for(const l in i){const e=i[l];this.setAttribute(l,e.clone(t))}const r=e.morphAttributes;for(const l in r){const e=[],n=r[l];for(let i=0,r=n.length;i<r;i++)e.push(n[i].clone(t));this.morphAttributes[l]=e}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let l=0,u=o.length;l<u;l++){const e=o[l];this.addGroup(e.start,e.count,e.materialIndex)}const s=e.boundingBox;null!==s&&(this.boundingBox=s.clone());const a=e.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Tr=new gi,wr=new mi,Mr=new ai,Ar=new Hn,Rr=new Hn,Cr=new Hn,Ir=new Hn,Pr=new Hn,Or=new Hn,Nr=new hn,Lr=new hn,Dr=new hn,Ur=new Hn,kr=new Hn,Fr=new Hn,Br=new Hn,Hr=new Hn;class Vr extends Gi{constructor(e=new br,t=new ur){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){const n=this.geometry,i=n.attributes.position,r=n.morphAttributes.position,o=n.morphTargetsRelative;t.fromBufferAttribute(i,e);const s=this.morphTargetInfluences;if(r&&s){Or.set(0,0,0);for(let n=0,i=r.length;n<i;n++){const i=s[n],a=r[n];0!==i&&(Pr.fromBufferAttribute(a,e),o?Or.addScaledVector(Pr,i):Or.addScaledVector(Pr.sub(t),i))}t.add(Or)}return t}raycast(e,t){const n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0!==i){if(null===n.boundingSphere&&n.computeBoundingSphere(),Mr.copy(n.boundingSphere),Mr.applyMatrix4(r),wr.copy(e.ray).recast(e.near),!1===Mr.containsPoint(wr.origin)){if(null===wr.intersectSphere(Mr,Ar))return;if(wr.origin.distanceToSquared(Ar)>(e.far-e.near)**2)return}Tr.copy(r).invert(),wr.copy(e.ray).applyMatrix4(Tr),null!==n.boundingBox&&!1===wr.intersectsBox(n.boundingBox)||this._computeIntersections(e,t,wr)}}_computeIntersections(e,t,n){let i;const r=this.geometry,o=this.material,s=r.index,a=r.attributes.position,l=r.attributes.uv,u=r.attributes.uv1,c=r.attributes.normal,d=r.groups,h=r.drawRange;if(null!==s)if(Array.isArray(o))for(let p=0,f=d.length;p<f;p++){const r=d[p],a=o[r.materialIndex];for(let o=Math.max(r.start,h.start),d=Math.min(s.count,Math.min(r.start+r.count,h.start+h.count));o<d;o+=3){i=zr(this,a,e,n,l,u,c,s.getX(o),s.getX(o+1),s.getX(o+2)),i&&(i.faceIndex=Math.floor(o/3),i.face.materialIndex=r.materialIndex,t.push(i))}}else{for(let r=Math.max(0,h.start),a=Math.min(s.count,h.start+h.count);r<a;r+=3){i=zr(this,o,e,n,l,u,c,s.getX(r),s.getX(r+1),s.getX(r+2)),i&&(i.faceIndex=Math.floor(r/3),t.push(i))}}else if(void 0!==a)if(Array.isArray(o))for(let p=0,f=d.length;p<f;p++){const r=d[p],s=o[r.materialIndex];for(let o=Math.max(r.start,h.start),d=Math.min(a.count,Math.min(r.start+r.count,h.start+h.count));o<d;o+=3){i=zr(this,s,e,n,l,u,c,o,o+1,o+2),i&&(i.faceIndex=Math.floor(o/3),i.face.materialIndex=r.materialIndex,t.push(i))}}else{for(let r=Math.max(0,h.start),s=Math.min(a.count,h.start+h.count);r<s;r+=3){i=zr(this,o,e,n,l,u,c,r,r+1,r+2),i&&(i.faceIndex=Math.floor(r/3),t.push(i))}}}}function zr(e,t,n,i,r,o,s,a,l,u){e.getVertexPosition(a,Rr),e.getVertexPosition(l,Cr),e.getVertexPosition(u,Ir);const c=function(e,t,n,i,r,o,s,a){let l;if(l=1===t.side?i.intersectTriangle(s,o,r,!0,a):i.intersectTriangle(r,o,s,0===t.side,a),null===l)return null;Hr.copy(a),Hr.applyMatrix4(e.matrixWorld);const u=n.ray.origin.distanceTo(Hr);return u<n.near||u>n.far?null:{distance:u,point:Hr.clone(),object:e}}(e,t,n,i,Rr,Cr,Ir,Br);if(c){r&&(Nr.fromBufferAttribute(r,a),Lr.fromBufferAttribute(r,l),Dr.fromBufferAttribute(r,u),c.uv=er.getInterpolation(Br,Rr,Cr,Ir,Nr,Lr,Dr,new hn)),o&&(Nr.fromBufferAttribute(o,a),Lr.fromBufferAttribute(o,l),Dr.fromBufferAttribute(o,u),c.uv1=er.getInterpolation(Br,Rr,Cr,Ir,Nr,Lr,Dr,new hn)),s&&(Ur.fromBufferAttribute(s,a),kr.fromBufferAttribute(s,l),Fr.fromBufferAttribute(s,u),c.normal=er.getInterpolation(Br,Rr,Cr,Ir,Ur,kr,Fr,new Hn),c.normal.dot(i.direction)>0&&c.normal.multiplyScalar(-1));const e={a:a,b:l,c:u,normal:new Hn,materialIndex:0};er.getNormal(Rr,Cr,Ir,e.normal),c.face=e}return c}class Gr extends br{constructor(e=1,t=1,n=1,i=1,r=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:o};const s=this;i=Math.floor(i),r=Math.floor(r),o=Math.floor(o);const a=[],l=[],u=[],c=[];let d=0,h=0;function p(e,t,n,i,r,o,p,f,m,g,v){const _=o/m,y=p/g,x=o/2,S=p/2,E=f/2,b=m+1,T=g+1;let w=0,M=0;const A=new Hn;for(let s=0;s<T;s++){const o=s*y-S;for(let a=0;a<b;a++){const d=a*_-x;A[e]=d*i,A[t]=o*r,A[n]=E,l.push(A.x,A.y,A.z),A[e]=0,A[t]=0,A[n]=f>0?1:-1,u.push(A.x,A.y,A.z),c.push(a/m),c.push(1-s/g),w+=1}}for(let s=0;s<g;s++)for(let e=0;e<m;e++){const t=d+e+b*s,n=d+e+b*(s+1),i=d+(e+1)+b*(s+1),r=d+(e+1)+b*s;a.push(t,n,r),a.push(n,i,r),M+=6}s.addGroup(h,M,v),h+=M,d+=w}p("z","y","x",-1,-1,n,t,e,o,r,0),p("z","y","x",1,-1,n,t,-e,o,r,1),p("x","z","y",1,1,e,n,t,i,o,2),p("x","z","y",1,-1,e,n,-t,i,o,3),p("x","y","z",1,-1,e,t,n,i,r,4),p("x","y","z",-1,-1,e,t,-n,i,r,5),this.setIndex(a),this.setAttribute("position",new mr(l,3)),this.setAttribute("normal",new mr(u,3)),this.setAttribute("uv",new mr(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Gr(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Wr(e){const t={};for(const n in e){t[n]={};for(const i in e[n]){const r=e[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[n][i]=null):t[n][i]=r.clone():Array.isArray(r)?t[n][i]=r.slice():t[n][i]=r}}return t}function jr(e){const t={};for(let n=0;n<e.length;n++){const i=Wr(e[n]);for(const e in i)t[e]=i[e]}return t}function qr(e){const t=e.getRenderTarget();return null===t?e.outputColorSpace:!0===t.isXRRenderTarget?t.texture.colorSpace:Tn.workingColorSpace}const Xr={clone:Wr,merge:jr};class Yr extends lr{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Wr(e.uniforms),this.uniformsGroups=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?t.uniforms[i]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[i]={type:"m4",value:n.toArray()}:t.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const i in this.extensions)!0===this.extensions[i]&&(n[i]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class Kr extends Gi{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new gi,this.projectionMatrix=new gi,this.projectionMatrixInverse=new gi,this.coordinateSystem=$t}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}const Jr=new Hn,$r=new hn,Zr=new hn;class Qr extends Kr{constructor(e=50,t=1,n=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*rn*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*nn*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*rn*Math.atan(Math.tan(.5*nn*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){Jr.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(Jr.x,Jr.y).multiplyScalar(-e/Jr.z),Jr.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(Jr.x,Jr.y).multiplyScalar(-e/Jr.z)}getViewSize(e,t){return this.getViewBounds(e,$r,Zr),t.subVectors(Zr,$r)}setViewOffset(e,t,n,i,r,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*nn*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i;const o=this.view;if(null!==this.view&&this.view.enabled){const e=o.fullWidth,s=o.fullHeight;r+=o.offsetX*i/e,t-=o.offsetY*n/s,i*=o.width/e,n*=o.height/s}const s=this.filmOffset;0!==s&&(r+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const eo=-90;class to extends Gi{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new Qr(eo,1,e,t);i.layers=this.layers,this.add(i);const r=new Qr(eo,1,e,t);r.layers=this.layers,this.add(r);const o=new Qr(eo,1,e,t);o.layers=this.layers,this.add(o);const s=new Qr(eo,1,e,t);s.layers=this.layers,this.add(s);const a=new Qr(eo,1,e,t);a.layers=this.layers,this.add(a);const l=new Qr(eo,1,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,i,r,o,s,a]=t;for(const l of t)this.remove(l);if(e===$t)n.up.set(0,1,0),n.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),s.up.set(0,1,0),s.lookAt(0,0,1),a.up.set(0,1,0),a.lookAt(0,0,-1);else{if(e!==Zt)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);n.up.set(0,-1,0),n.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),s.up.set(0,-1,0),s.lookAt(0,0,1),a.up.set(0,-1,0),a.lookAt(0,0,-1)}for(const l of t)this.add(l),l.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[r,o,s,a,l,u]=this.children,c=e.getRenderTarget(),d=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),p=e.xr.enabled;e.xr.enabled=!1;const f=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,i),e.render(t,r),e.setRenderTarget(n,1,i),e.render(t,o),e.setRenderTarget(n,2,i),e.render(t,s),e.setRenderTarget(n,3,i),e.render(t,a),e.setRenderTarget(n,4,i),e.render(t,l),n.texture.generateMipmaps=f,e.setRenderTarget(n,5,i),e.render(t,u),e.setRenderTarget(c,d,h),e.xr.enabled=p,n.texture.needsPMREMUpdate=!0}}class no extends Nn{constructor(e,t,n,i,r,o,s,a,l,u){super(e=void 0!==e?e:[],t=void 0!==t?t:me,n,i,r,o,s,a,l,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class io extends Un{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},i=[n,n,n,n,n,n];this.texture=new no(i,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:we}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},i=new Gr(5,5,5),r=new Yr({name:"CubemapFromEquirect",uniforms:Wr(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:1,blending:0});r.uniforms.tEquirect.value=t;const o=new Vr(i,r),s=t.minFilter;t.minFilter===Ae&&(t.minFilter=we);return new to(1,10,this).update(e,o),t.minFilter=s,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,n,i){const r=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,n,i);e.setRenderTarget(r)}}const ro=new Hn,oo=new Hn,so=new pn;class ao{constructor(e=new Hn(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=ro.subVectors(n,t).cross(oo.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(ro),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:t.copy(e.start).addScaledVector(n,r)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||so.getNormalMatrix(e),i=this.coplanarPoint(ro).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const lo=new ai,uo=new Hn;class co{constructor(e=new ao,t=new ao,n=new ao,i=new ao,r=new ao,o=new ao){this.planes=[e,t,n,i,r,o]}set(e,t,n,i,r,o){const s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(n),s[3].copy(i),s[4].copy(r),s[5].copy(o),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=2e3){const n=this.planes,i=e.elements,r=i[0],o=i[1],s=i[2],a=i[3],l=i[4],u=i[5],c=i[6],d=i[7],h=i[8],p=i[9],f=i[10],m=i[11],g=i[12],v=i[13],_=i[14],y=i[15];if(n[0].setComponents(a-r,d-l,m-h,y-g).normalize(),n[1].setComponents(a+r,d+l,m+h,y+g).normalize(),n[2].setComponents(a+o,d+u,m+p,y+v).normalize(),n[3].setComponents(a-o,d-u,m-p,y-v).normalize(),n[4].setComponents(a-s,d-c,m-f,y-_).normalize(),t===$t)n[5].setComponents(a+s,d+c,m+f,y+_).normalize();else{if(t!==Zt)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);n[5].setComponents(s,c,f,_).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),lo.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),lo.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(lo)}intersectsSprite(e){return lo.center.set(0,0,0),lo.radius=.7071067811865476,lo.applyMatrix4(e.matrixWorld),this.intersectsSphere(lo)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let r=0;r<6;r++){if(t[r].distanceToPoint(n)<i)return!1}return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(uo.x=i.normal.x>0?e.max.x:e.min.x,uo.y=i.normal.y>0?e.max.y:e.min.y,uo.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(uo)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function ho(){let e=null,t=!1,n=null,i=null;function r(t,o){n(t,o),i=e.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==n&&(i=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function po(e){const t=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)},remove:function(n){n.isInterleavedBufferAttribute&&(n=n.data);const i=t.get(n);i&&(e.deleteBuffer(i.buffer),t.delete(n))},update:function(n,i){if(n.isInterleavedBufferAttribute&&(n=n.data),n.isGLBufferAttribute){const e=t.get(n);return void((!e||e.version<n.version)&&t.set(n,{buffer:n.buffer,type:n.type,bytesPerElement:n.elementSize,version:n.version}))}const r=t.get(n);if(void 0===r)t.set(n,function(t,n){const i=t.array,r=t.usage,o=i.byteLength,s=e.createBuffer();let a;if(e.bindBuffer(n,s),e.bufferData(n,i,r),t.onUploadCallback(),i instanceof Float32Array)a=e.FLOAT;else if(i instanceof Uint16Array)a=t.isFloat16BufferAttribute?e.HALF_FLOAT:e.UNSIGNED_SHORT;else if(i instanceof Int16Array)a=e.SHORT;else if(i instanceof Uint32Array)a=e.UNSIGNED_INT;else if(i instanceof Int32Array)a=e.INT;else if(i instanceof Int8Array)a=e.BYTE;else if(i instanceof Uint8Array)a=e.UNSIGNED_BYTE;else{if(!(i instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+i);a=e.UNSIGNED_BYTE}return{buffer:s,type:a,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version,size:o}}(n,i));else if(r.version<n.version){if(r.size!==n.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");!function(t,n,i){const r=n.array,o=n._updateRange,s=n.updateRanges;if(e.bindBuffer(i,t),-1===o.count&&0===s.length&&e.bufferSubData(i,0,r),0!==s.length){for(let t=0,n=s.length;t<n;t++){const n=s[t];e.bufferSubData(i,n.start*r.BYTES_PER_ELEMENT,r,n.start,n.count)}n.clearUpdateRanges()}-1!==o.count&&(e.bufferSubData(i,o.offset*r.BYTES_PER_ELEMENT,r,o.offset,o.count),o.count=-1),n.onUploadCallback()}(r.buffer,n,i),r.version=n.version}}}}class fo extends br{constructor(e=1,t=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const r=e/2,o=t/2,s=Math.floor(n),a=Math.floor(i),l=s+1,u=a+1,c=e/s,d=t/a,h=[],p=[],f=[],m=[];for(let g=0;g<u;g++){const e=g*d-o;for(let t=0;t<l;t++){const n=t*c-r;p.push(n,-e,0),f.push(0,0,1),m.push(t/s),m.push(1-g/a)}}for(let g=0;g<a;g++)for(let e=0;e<s;e++){const t=e+l*g,n=e+l*(g+1),i=e+1+l*(g+1),r=e+1+l*g;h.push(t,n,r),h.push(n,i,r)}this.setIndex(h),this.setAttribute("position",new mr(p,3)),this.setAttribute("normal",new mr(f,3)),this.setAttribute("uv",new mr(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new fo(e.width,e.height,e.widthSegments,e.heightSegments)}}const mo={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\t#ifdef ALPHA_TO_COVERAGE\n\tdiffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\tif ( diffuseColor.a < alphaTest ) discard;\n\t#endif\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n\t#if ! defined( GL_ANGLE_multi_draw )\n\t#define gl_DrawID _gl_DrawID\n\tuniform int _gl_DrawID;\n\t#endif\n\tuniform highp sampler2D batchingTexture;\n\tuniform highp usampler2D batchingIdTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n\tfloat getIndirectIndex( const in int i ) {\n\t\tint size = textureSize( batchingIdTexture, 0 ).x;\n\t\tint x = i % size;\n\t\tint y = i / size;\n\t\treturn float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );\n\t}\n#endif\n#ifdef USE_BATCHING_COLOR\n\tuniform sampler2D batchingColorTexture;\n\tvec3 getBatchingColor( const in float i ) {\n\t\tint size = textureSize( batchingColorTexture, 0 ).x;\n\t\tint j = int( i );\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\treturn texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;\n\t}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#ifdef ALPHA_TO_COVERAGE\n\t\tfloat distanceToPlane, distanceGradient;\n\t\tfloat clipOpacity = 1.0;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\tclipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\tif ( clipOpacity == 0.0 ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tfloat unionClipOpacity = 1.0;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\t\tunionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tclipOpacity *= 1.0 - unionClipOpacity;\n\t\t#endif\n\t\tdiffuseColor.a *= clipOpacity;\n\t\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tbool clipped = true;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tif ( clipped ) discard;\n\t\t#endif\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif\n#ifdef USE_BATCHING_COLOR\n\tvec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );\n\tvColor.xyz *= batchingColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"\nconst mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(\n\tvec3( 0.8224621, 0.177538, 0.0 ),\n\tvec3( 0.0331941, 0.9668058, 0.0 ),\n\tvec3( 0.0170827, 0.0723974, 0.9105199 )\n);\nconst mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.2249401, - 0.2249404, 0.0 ),\n\tvec3( - 0.0420569, 1.0420571, 0.0 ),\n\tvec3( - 0.0196376, - 0.0786361, 1.0982735 )\n);\nvec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );\n}\nvec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );\n}\nvec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform mat3 envMapRotation;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif ( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_DISPERSION\n\tmaterial.dispersion = dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\tfloat dispersion;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tgl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvFragDepth = 1.0 + gl_Position.w;\n\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphinstance_vertex:"#ifdef USE_INSTANCING_MORPH\n\tfloat morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\tfloat morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tmorphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n\t}\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_INSTANCING_MORPH\n\t\tuniform float morphTargetBaseInfluence;\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t#endif\n\tuniform sampler2DArray morphTargetsTexture;\n\tuniform ivec2 morphTargetsTextureSize;\n\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t}\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;\nconst float Inv255 = 1. / 255.;\nconst vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );\nconst vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );\nconst vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );\nconst vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );\nvec4 packDepthToRGBA( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec4( 0., 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec4( 1., 1., 1., 1. );\n\tfloat vuf;\n\tfloat af = modf( v * PackFactors.a, vuf );\n\tfloat bf = modf( vuf * ShiftRight8, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );\n}\nvec3 packDepthToRGB( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec3( 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec3( 1., 1., 1. );\n\tfloat vuf;\n\tfloat bf = modf( v * PackFactors.b, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec3( vuf * Inv255, gf * PackUpscale, bf );\n}\nvec2 packDepthToRG( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec2( 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec2( 1., 1. );\n\tfloat vuf;\n\tfloat gf = modf( v * 256., vuf );\n\treturn vec2( vuf * Inv255, gf );\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors4 );\n}\nfloat unpackRGBToDepth( const in vec3 v ) {\n\treturn dot( v, UnpackFactors3 );\n}\nfloat unpackRGToDepth( const in vec2 v ) {\n\treturn v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;\n}\nvec4 pack2HalfToRGBA( const in vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( const in vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tfloat shadow = 1.0;\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\t\n\t\tfloat lightToPositionLength = length( lightToPosition );\n\t\tif ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {\n\t\t\tfloat dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\t\tdp += shadowBias;\n\t\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\t\tshadow = (\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t\t) * ( 1.0 / 9.0 );\n\t\t\t#else\n\t\t\t\tshadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor *= toneMappingExposure;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\tcolor = clamp( color, 0.0, 1.0 );\n\treturn color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n\tconst float StartCompression = 0.8 - 0.04;\n\tconst float Desaturation = 0.15;\n\tcolor *= toneMappingExposure;\n\tfloat x = min( color.r, min( color.g, color.b ) );\n\tfloat offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n\tcolor -= offset;\n\tfloat peak = max( color.r, max( color.g, color.b ) );\n\tif ( peak < StartCompression ) return color;\n\tfloat d = 1. - StartCompression;\n\tfloat newPeak = 1. - d * d / ( peak + d - StartCompression );\n\tcolor *= newPeak / peak;\n\tfloat g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );\n\treturn mix( color, vec3( newPeak ), g );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec4 transmittedLight;\n\t\tvec3 transmittance;\n\t\t#ifdef USE_DISPERSION\n\t\t\tfloat halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;\n\t\t\tvec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );\n\t\t\tfor ( int i = 0; i < 3; i ++ ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\t\t\n\t\t\t\tvec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );\n\t\t\t\ttransmittedLight[ i ] = transmissionSample[ i ];\n\t\t\t\ttransmittedLight.a += transmissionSample.a;\n\t\t\t\ttransmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];\n\t\t\t}\n\t\t\ttransmittedLight.a /= 3.0;\n\t\t\n\t\t#else\n\t\t\n\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\trefractionCoords += 1.0;\n\t\t\trefractionCoords /= 2.0;\n\t\t\ttransmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\t\ttransmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\t\n\t\t#endif\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#elif DEPTH_PACKING == 3202\n\t\tgl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );\n\t#elif DEPTH_PACKING == 3203\n\t\tgl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_DISPERSION\n\tuniform float dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},go={common:{diffuse:{value:new or(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new pn},alphaMap:{value:null},alphaMapTransform:{value:new pn},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new pn}},envmap:{envMap:{value:null},envMapRotation:{value:new pn},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new pn}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new pn}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new pn},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new pn},normalScale:{value:new hn(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new pn},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new pn}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new pn}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new pn}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new or(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new or(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new pn},alphaTest:{value:0},uvTransform:{value:new pn}},sprite:{diffuse:{value:new or(16777215)},opacity:{value:1},center:{value:new hn(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new pn},alphaMap:{value:null},alphaMapTransform:{value:new pn},alphaTest:{value:0}}},vo={basic:{uniforms:jr([go.common,go.specularmap,go.envmap,go.aomap,go.lightmap,go.fog]),vertexShader:mo.meshbasic_vert,fragmentShader:mo.meshbasic_frag},lambert:{uniforms:jr([go.common,go.specularmap,go.envmap,go.aomap,go.lightmap,go.emissivemap,go.bumpmap,go.normalmap,go.displacementmap,go.fog,go.lights,{emissive:{value:new or(0)}}]),vertexShader:mo.meshlambert_vert,fragmentShader:mo.meshlambert_frag},phong:{uniforms:jr([go.common,go.specularmap,go.envmap,go.aomap,go.lightmap,go.emissivemap,go.bumpmap,go.normalmap,go.displacementmap,go.fog,go.lights,{emissive:{value:new or(0)},specular:{value:new or(1118481)},shininess:{value:30}}]),vertexShader:mo.meshphong_vert,fragmentShader:mo.meshphong_frag},standard:{uniforms:jr([go.common,go.envmap,go.aomap,go.lightmap,go.emissivemap,go.bumpmap,go.normalmap,go.displacementmap,go.roughnessmap,go.metalnessmap,go.fog,go.lights,{emissive:{value:new or(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:mo.meshphysical_vert,fragmentShader:mo.meshphysical_frag},toon:{uniforms:jr([go.common,go.aomap,go.lightmap,go.emissivemap,go.bumpmap,go.normalmap,go.displacementmap,go.gradientmap,go.fog,go.lights,{emissive:{value:new or(0)}}]),vertexShader:mo.meshtoon_vert,fragmentShader:mo.meshtoon_frag},matcap:{uniforms:jr([go.common,go.bumpmap,go.normalmap,go.displacementmap,go.fog,{matcap:{value:null}}]),vertexShader:mo.meshmatcap_vert,fragmentShader:mo.meshmatcap_frag},points:{uniforms:jr([go.points,go.fog]),vertexShader:mo.points_vert,fragmentShader:mo.points_frag},dashed:{uniforms:jr([go.common,go.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:mo.linedashed_vert,fragmentShader:mo.linedashed_frag},depth:{uniforms:jr([go.common,go.displacementmap]),vertexShader:mo.depth_vert,fragmentShader:mo.depth_frag},normal:{uniforms:jr([go.common,go.bumpmap,go.normalmap,go.displacementmap,{opacity:{value:1}}]),vertexShader:mo.meshnormal_vert,fragmentShader:mo.meshnormal_frag},sprite:{uniforms:jr([go.sprite,go.fog]),vertexShader:mo.sprite_vert,fragmentShader:mo.sprite_frag},background:{uniforms:{uvTransform:{value:new pn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:mo.background_vert,fragmentShader:mo.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new pn}},vertexShader:mo.backgroundCube_vert,fragmentShader:mo.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:mo.cube_vert,fragmentShader:mo.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:mo.equirect_vert,fragmentShader:mo.equirect_frag},distanceRGBA:{uniforms:jr([go.common,go.displacementmap,{referencePosition:{value:new Hn},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:mo.distanceRGBA_vert,fragmentShader:mo.distanceRGBA_frag},shadow:{uniforms:jr([go.lights,go.fog,{color:{value:new or(0)},opacity:{value:1}}]),vertexShader:mo.shadow_vert,fragmentShader:mo.shadow_frag}};vo.physical={uniforms:jr([vo.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new pn},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new pn},clearcoatNormalScale:{value:new hn(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new pn},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new pn},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new pn},sheen:{value:0},sheenColor:{value:new or(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new pn},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new pn},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new pn},transmissionSamplerSize:{value:new hn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new pn},attenuationDistance:{value:0},attenuationColor:{value:new or(0)},specularColor:{value:new or(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new pn},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new pn},anisotropyVector:{value:new hn},anisotropyMap:{value:null},anisotropyMapTransform:{value:new pn}}]),vertexShader:mo.meshphysical_vert,fragmentShader:mo.meshphysical_frag};const _o={r:0,b:0,g:0},yo=new Mi,xo=new gi;function So(e,t,n,i,r,o,s){const a=new or(0);let l,u,c=!0===o?0:1,d=null,h=0,p=null;function f(e){let i=!0===e.isScene?e.background:null;if(i&&i.isTexture){i=(e.backgroundBlurriness>0?n:t).get(i)}return i}function m(t,n){t.getRGB(_o,qr(e)),i.buffers.color.setClear(_o.r,_o.g,_o.b,n,s)}return{getClearColor:function(){return a},setClearColor:function(e,t=1){a.set(e),c=t,m(a,c)},getClearAlpha:function(){return c},setClearAlpha:function(e){c=e,m(a,c)},render:function(t){let n=!1;const r=f(t);null===r?m(a,c):r&&r.isColor&&(m(r,1),n=!0);const o=e.xr.getEnvironmentBlendMode();"additive"===o?i.buffers.color.setClear(0,0,0,1,s):"alpha-blend"===o&&i.buffers.color.setClear(0,0,0,0,s),(e.autoClear||n)&&(i.buffers.depth.setTest(!0),i.buffers.depth.setMask(!0),i.buffers.color.setMask(!0),e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil))},addToRenderList:function(t,n){const i=f(n);i&&(i.isCubeTexture||i.mapping===_e)?(void 0===u&&(u=new Vr(new Gr(1,1,1),new Yr({name:"BackgroundCubeMaterial",uniforms:Wr(vo.backgroundCube.uniforms),vertexShader:vo.backgroundCube.vertexShader,fragmentShader:vo.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(u)),yo.copy(n.backgroundRotation),yo.x*=-1,yo.y*=-1,yo.z*=-1,i.isCubeTexture&&!1===i.isRenderTargetTexture&&(yo.y*=-1,yo.z*=-1),u.material.uniforms.envMap.value=i,u.material.uniforms.flipEnvMap.value=i.isCubeTexture&&!1===i.isRenderTargetTexture?-1:1,u.material.uniforms.backgroundBlurriness.value=n.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,u.material.uniforms.backgroundRotation.value.setFromMatrix4(xo.makeRotationFromEuler(yo)),u.material.toneMapped=Tn.getTransfer(i.colorSpace)!==kt,d===i&&h===i.version&&p===e.toneMapping||(u.material.needsUpdate=!0,d=i,h=i.version,p=e.toneMapping),u.layers.enableAll(),t.unshift(u,u.geometry,u.material,0,0,null)):i&&i.isTexture&&(void 0===l&&(l=new Vr(new fo(2,2),new Yr({name:"BackgroundMaterial",uniforms:Wr(vo.background.uniforms),vertexShader:vo.background.vertexShader,fragmentShader:vo.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(l)),l.material.uniforms.t2D.value=i,l.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,l.material.toneMapped=Tn.getTransfer(i.colorSpace)!==kt,!0===i.matrixAutoUpdate&&i.updateMatrix(),l.material.uniforms.uvTransform.value.copy(i.matrix),d===i&&h===i.version&&p===e.toneMapping||(l.material.needsUpdate=!0,d=i,h=i.version,p=e.toneMapping),l.layers.enableAll(),t.unshift(l,l.geometry,l.material,0,0,null))}}}function Eo(e,t){const n=e.getParameter(e.MAX_VERTEX_ATTRIBS),i={},r=u(null);let o=r,s=!1;function a(t){return e.bindVertexArray(t)}function l(t){return e.deleteVertexArray(t)}function u(e){const t=[],i=[],r=[];for(let o=0;o<n;o++)t[o]=0,i[o]=0,r[o]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:i,attributeDivisors:r,object:e,attributes:{},index:null}}function c(){const e=o.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function d(e){h(e,0)}function h(t,n){const i=o.newAttributes,r=o.enabledAttributes,s=o.attributeDivisors;i[t]=1,0===r[t]&&(e.enableVertexAttribArray(t),r[t]=1),s[t]!==n&&(e.vertexAttribDivisor(t,n),s[t]=n)}function p(){const t=o.newAttributes,n=o.enabledAttributes;for(let i=0,r=n.length;i<r;i++)n[i]!==t[i]&&(e.disableVertexAttribArray(i),n[i]=0)}function f(t,n,i,r,o,s,a){!0===a?e.vertexAttribIPointer(t,n,i,o,s):e.vertexAttribPointer(t,n,i,r,o,s)}function m(){g(),s=!0,o!==r&&(o=r,a(o.object))}function g(){r.geometry=null,r.program=null,r.wireframe=!1}return{setup:function(n,r,l,m,g){let v=!1;const _=function(t,n,r){const o=!0===r.wireframe;let s=i[t.id];void 0===s&&(s={},i[t.id]=s);let a=s[n.id];void 0===a&&(a={},s[n.id]=a);let l=a[o];void 0===l&&(l=u(e.createVertexArray()),a[o]=l);return l}(m,l,r);o!==_&&(o=_,a(o.object)),v=function(e,t,n,i){const r=o.attributes,s=t.attributes;let a=0;const l=n.getAttributes();for(const o in l){if(l[o].location>=0){const t=r[o];let n=s[o];if(void 0===n&&("instanceMatrix"===o&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===o&&e.instanceColor&&(n=e.instanceColor)),void 0===t)return!0;if(t.attribute!==n)return!0;if(n&&t.data!==n.data)return!0;a++}}return o.attributesNum!==a||o.index!==i}(n,m,l,g),v&&function(e,t,n,i){const r={},s=t.attributes;let a=0;const l=n.getAttributes();for(const o in l){if(l[o].location>=0){let t=s[o];void 0===t&&("instanceMatrix"===o&&e.instanceMatrix&&(t=e.instanceMatrix),"instanceColor"===o&&e.instanceColor&&(t=e.instanceColor));const n={};n.attribute=t,t&&t.data&&(n.data=t.data),r[o]=n,a++}}o.attributes=r,o.attributesNum=a,o.index=i}(n,m,l,g),null!==g&&t.update(g,e.ELEMENT_ARRAY_BUFFER),(v||s)&&(s=!1,function(n,i,r,o){c();const s=o.attributes,a=r.getAttributes(),l=i.defaultAttributeValues;for(const u in a){const i=a[u];if(i.location>=0){let r=s[u];if(void 0===r&&("instanceMatrix"===u&&n.instanceMatrix&&(r=n.instanceMatrix),"instanceColor"===u&&n.instanceColor&&(r=n.instanceColor)),void 0!==r){const s=r.normalized,a=r.itemSize,l=t.get(r);if(void 0===l)continue;const u=l.buffer,c=l.type,p=l.bytesPerElement,m=c===e.INT||c===e.UNSIGNED_INT||r.gpuType===Oe;if(r.isInterleavedBufferAttribute){const t=r.data,l=t.stride,g=r.offset;if(t.isInstancedInterleavedBuffer){for(let e=0;e<i.locationSize;e++)h(i.location+e,t.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=t.meshPerAttribute*t.count)}else for(let e=0;e<i.locationSize;e++)d(i.location+e);e.bindBuffer(e.ARRAY_BUFFER,u);for(let e=0;e<i.locationSize;e++)f(i.location+e,a/i.locationSize,c,s,l*p,(g+a/i.locationSize*e)*p,m)}else{if(r.isInstancedBufferAttribute){for(let e=0;e<i.locationSize;e++)h(i.location+e,r.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=r.meshPerAttribute*r.count)}else for(let e=0;e<i.locationSize;e++)d(i.location+e);e.bindBuffer(e.ARRAY_BUFFER,u);for(let e=0;e<i.locationSize;e++)f(i.location+e,a/i.locationSize,c,s,a*p,a/i.locationSize*e*p,m)}}else if(void 0!==l){const t=l[u];if(void 0!==t)switch(t.length){case 2:e.vertexAttrib2fv(i.location,t);break;case 3:e.vertexAttrib3fv(i.location,t);break;case 4:e.vertexAttrib4fv(i.location,t);break;default:e.vertexAttrib1fv(i.location,t)}}}}p()}(n,r,l,m),null!==g&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.get(g).buffer))},reset:m,resetDefaultState:g,dispose:function(){m();for(const e in i){const t=i[e];for(const e in t){const n=t[e];for(const e in n)l(n[e].object),delete n[e];delete t[e]}delete i[e]}},releaseStatesOfGeometry:function(e){if(void 0===i[e.id])return;const t=i[e.id];for(const n in t){const e=t[n];for(const t in e)l(e[t].object),delete e[t];delete t[n]}delete i[e.id]},releaseStatesOfProgram:function(e){for(const t in i){const n=i[t];if(void 0===n[e.id])continue;const r=n[e.id];for(const e in r)l(r[e].object),delete r[e];delete n[e.id]}},initAttributes:c,enableAttribute:d,disableUnusedAttributes:p}}function bo(e,t,n){let i;function r(t,r,o){0!==o&&(e.drawArraysInstanced(i,t,r,o),n.update(r,i,o))}this.setMode=function(e){i=e},this.render=function(t,r){e.drawArrays(i,t,r),n.update(r,i,1)},this.renderInstances=r,this.renderMultiDraw=function(e,r,o){if(0===o)return;t.get("WEBGL_multi_draw").multiDrawArraysWEBGL(i,e,0,r,0,o);let s=0;for(let t=0;t<o;t++)s+=r[t];n.update(s,i,1)},this.renderMultiDrawInstances=function(e,o,s,a){if(0===s)return;const l=t.get("WEBGL_multi_draw");if(null===l)for(let t=0;t<e.length;t++)r(e[t],o[t],a[t]);else{l.multiDrawArraysInstancedWEBGL(i,e,0,o,0,a,0,s);let t=0;for(let e=0;e<s;e++)t+=o[e];for(let e=0;e<a.length;e++)n.update(t,i,a[e])}}}function To(e,t,n,i){let r;function o(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let s=void 0!==n.precision?n.precision:"highp";const a=o(s);a!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",a,"instead."),s=a);const l=!0===n.logarithmicDepthBuffer,u=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),c=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS);return{isWebGL2:!0,getMaxAnisotropy:function(){if(void 0!==r)return r;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:o,textureFormatReadable:function(t){return t===He||i.convert(t)===e.getParameter(e.IMPLEMENTATION_COLOR_READ_FORMAT)},textureTypeReadable:function(n){const r=n===De&&(t.has("EXT_color_buffer_half_float")||t.has("EXT_color_buffer_float"));return!(n!==Re&&i.convert(n)!==e.getParameter(e.IMPLEMENTATION_COLOR_READ_TYPE)&&n!==Le&&!r)},precision:s,logarithmicDepthBuffer:l,maxTextures:u,maxVertexTextures:c,maxTextureSize:e.getParameter(e.MAX_TEXTURE_SIZE),maxCubemapSize:e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),maxAttributes:e.getParameter(e.MAX_VERTEX_ATTRIBS),maxVertexUniforms:e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),maxVaryings:e.getParameter(e.MAX_VARYING_VECTORS),maxFragmentUniforms:e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),vertexTextures:c>0,maxSamples:e.getParameter(e.MAX_SAMPLES)}}function wo(e){const t=this;let n=null,i=0,r=!1,o=!1;const s=new ao,a=new pn,l={value:null,needsUpdate:!1};function u(e,n,i,r){const o=null!==e?e.length:0;let u=null;if(0!==o){if(u=l.value,!0!==r||null===u){const t=i+4*o,r=n.matrixWorldInverse;a.getNormalMatrix(r),(null===u||u.length<t)&&(u=new Float32Array(t));for(let n=0,l=i;n!==o;++n,l+=4)s.copy(e[n]).applyMatrix4(r,a),s.normal.toArray(u,l),u[l+3]=s.constant}l.value=u,l.needsUpdate=!0}return t.numPlanes=o,t.numIntersection=0,u}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){const n=0!==e.length||t||0!==i||r;return r=t,i=e.length,n},this.beginShadows=function(){o=!0,u(null)},this.endShadows=function(){o=!1},this.setGlobalState=function(e,t){n=u(e,t,0)},this.setState=function(s,a,c){const d=s.clippingPlanes,h=s.clipIntersection,p=s.clipShadows,f=e.get(s);if(!r||null===d||0===d.length||o&&!p)o?u(null):function(){l.value!==n&&(l.value=n,l.needsUpdate=i>0);t.numPlanes=i,t.numIntersection=0}();else{const e=o?0:i,t=4*e;let r=f.clippingState||null;l.value=r,r=u(d,a,t,c);for(let i=0;i!==t;++i)r[i]=n[i];f.clippingState=r,this.numIntersection=h?this.numPlanes:0,this.numPlanes+=e}}}function Mo(e){let t=new WeakMap;function n(e,t){return t===ve?e.mapping=me:304===t&&(e.mapping=ge),e}function i(e){const n=e.target;n.removeEventListener("dispose",i);const r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){const o=r.mapping;if(o===ve||304===o){if(t.has(r)){return n(t.get(r).texture,r.mapping)}{const o=r.image;if(o&&o.height>0){const s=new io(o.height);return s.fromEquirectangularTexture(e,r),t.set(r,s),r.addEventListener("dispose",i),n(s.texture,r.mapping)}return null}}}return r},dispose:function(){t=new WeakMap}}}class Ao extends Kr{constructor(e=-1,t=1,n=1,i=-1,r=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=r,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,r,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-e,o=n+e,s=i+t,a=i-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=e*this.view.offsetX,o=r+e*this.view.width,s-=t*this.view.offsetY,a=s-t*this.view.height}this.projectionMatrix.makeOrthographic(r,o,s,a,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}const Ro=[.125,.215,.35,.446,.526,.582],Co=20,Io=new Ao,Po=new or;let Oo=null,No=0,Lo=0,Do=!1;const Uo=(1+Math.sqrt(5))/2,ko=1/Uo,Fo=[new Hn(-Uo,ko,0),new Hn(Uo,ko,0),new Hn(-ko,0,Uo),new Hn(ko,0,Uo),new Hn(0,Uo,-ko),new Hn(0,Uo,ko),new Hn(-1,1,-1),new Hn(1,1,-1),new Hn(-1,1,1),new Hn(1,1,1)];class Bo{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,i=100){Oo=this._renderer.getRenderTarget(),No=this._renderer.getActiveCubeFace(),Lo=this._renderer.getActiveMipmapLevel(),Do=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,n,i,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=Go(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=zo(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Oo,No,Lo),this._renderer.xr.enabled=Do,e.scissorTest=!1,Vo(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===me||e.mapping===ge?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Oo=this._renderer.getRenderTarget(),No=this._renderer.getActiveCubeFace(),Lo=this._renderer.getActiveMipmapLevel(),Do=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:we,minFilter:we,generateMipmaps:!1,type:De,format:He,colorSpace:Nt,depthBuffer:!1},i=Ho(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Ho(e,t,n);const{_lodMax:i}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){const t=[],n=[],i=[];let r=e;const o=e-4+1+Ro.length;for(let s=0;s<o;s++){const o=Math.pow(2,r);n.push(o);let a=1/o;s>e-4?a=Ro[s-e+4-1]:0===s&&(a=0),i.push(a);const l=1/(o-2),u=-l,c=1+l,d=[u,u,c,u,c,c,u,u,c,c,u,c],h=6,p=6,f=3,m=2,g=1,v=new Float32Array(f*p*h),_=new Float32Array(m*p*h),y=new Float32Array(g*p*h);for(let e=0;e<h;e++){const t=e%3*2/3-1,n=e>2?0:-1,i=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];v.set(i,f*p*e),_.set(d,m*p*e);const r=[e,e,e,e,e,e];y.set(r,g*p*e)}const x=new br;x.setAttribute("position",new hr(v,f)),x.setAttribute("uv",new hr(_,m)),x.setAttribute("faceIndex",new hr(y,g)),t.push(x),r>4&&r--}return{lodPlanes:t,sizeLods:n,sigmas:i}}(i)),this._blurMaterial=function(e,t,n){const i=new Float32Array(Co),r=new Hn(0,1,0),o=new Yr({name:"SphericalGaussianBlur",defines:{n:Co,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:Wo(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1});return o}(i,e,t)}return i}_compileMaterial(e){const t=new Vr(this._lodPlanes[0],e);this._renderer.compile(t,Io)}_sceneToCubeUV(e,t,n,i){const r=new Qr(90,1,t,n),o=[1,-1,1,1,1,1],s=[1,1,1,-1,-1,-1],a=this._renderer,l=a.autoClear,u=a.toneMapping;a.getClearColor(Po),a.toneMapping=0,a.autoClear=!1;const c=new ur({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),d=new Vr(new Gr,c);let h=!1;const p=e.background;p?p.isColor&&(c.color.copy(p),e.background=null,h=!0):(c.color.copy(Po),h=!0);for(let f=0;f<6;f++){const t=f%3;0===t?(r.up.set(0,o[f],0),r.lookAt(s[f],0,0)):1===t?(r.up.set(0,0,o[f]),r.lookAt(0,s[f],0)):(r.up.set(0,o[f],0),r.lookAt(0,0,s[f]));const n=this._cubeSize;Vo(i,t*n,f>2?n:0,n,n),a.setRenderTarget(i),h&&a.render(d,r),a.render(e,r)}d.geometry.dispose(),d.material.dispose(),a.toneMapping=u,a.autoClear=l,e.background=p}_textureToCubeUV(e,t){const n=this._renderer,i=e.mapping===me||e.mapping===ge;i?(null===this._cubemapMaterial&&(this._cubemapMaterial=Go()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=zo());const r=i?this._cubemapMaterial:this._equirectMaterial,o=new Vr(this._lodPlanes[0],r);r.uniforms.envMap.value=e;const s=this._cubeSize;Vo(t,0,0,3*s,2*s),n.setRenderTarget(t),n.render(o,Io)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const i=this._lodPlanes.length;for(let r=1;r<i;r++){const t=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),n=Fo[(i-r-1)%Fo.length];this._blur(e,r-1,r,t,n)}t.autoClear=n}_blur(e,t,n,i,r){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,i,"latitudinal",r),this._halfBlur(o,e,n,n,i,"longitudinal",r)}_halfBlur(e,t,n,i,r,o,s){const a=this._renderer,l=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");const u=new Vr(this._lodPlanes[i],l),c=l.uniforms,d=this._sizeLods[n]-1,h=isFinite(r)?Math.PI/(2*d):2*Math.PI/39,p=r/h,f=isFinite(r)?1+Math.floor(3*p):Co;f>Co&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let g=0;for(let y=0;y<Co;++y){const e=y/p,t=Math.exp(-e*e/2);m.push(t),0===y?g+=t:y<f&&(g+=2*t)}for(let y=0;y<m.length;y++)m[y]=m[y]/g;c.envMap.value=e.texture,c.samples.value=f,c.weights.value=m,c.latitudinal.value="latitudinal"===o,s&&(c.poleAxis.value=s);const{_lodMax:v}=this;c.dTheta.value=h,c.mipInt.value=v-n;const _=this._sizeLods[i];Vo(t,3*_*(i>v-4?i-v+4:0),4*(this._cubeSize-_),3*_,2*_),a.setRenderTarget(t),a.render(u,Io)}}function Ho(e,t,n){const i=new Un(e,t,n);return i.texture.mapping=_e,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function Vo(e,t,n,i,r){e.viewport.set(t,n,i,r),e.scissor.set(t,n,i,r)}function zo(){return new Yr({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Wo(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Go(){return new Yr({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Wo(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Wo(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function jo(e){let t=new WeakMap,n=null;function i(e){const n=e.target;n.removeEventListener("dispose",i);const r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){const o=r.mapping,s=o===ve||304===o,a=o===me||o===ge;if(s||a){let o=t.get(r);const l=void 0!==o?o.texture.pmremVersion:0;if(r.isRenderTargetTexture&&r.pmremVersion!==l)return null===n&&(n=new Bo(e)),o=s?n.fromEquirectangular(r,o):n.fromCubemap(r,o),o.texture.pmremVersion=r.pmremVersion,t.set(r,o),o.texture;if(void 0!==o)return o.texture;{const l=r.image;return s&&l&&l.height>0||a&&l&&function(e){let t=0;const n=6;for(let i=0;i<n;i++)void 0!==e[i]&&t++;return t===n}(l)?(null===n&&(n=new Bo(e)),o=s?n.fromEquirectangular(r):n.fromCubemap(r),o.texture.pmremVersion=r.pmremVersion,t.set(r,o),r.addEventListener("dispose",i),o.texture):null}}}return r},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function qo(e){const t={};function n(n){if(void 0!==t[n])return t[n];let i;switch(n){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(n)}return t[n]=i,i}return{has:function(e){return null!==n(e)},init:function(){n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance"),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture"),n("WEBGL_render_shared_exponent")},get:function(e){const t=n(e);return null===t&&yn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function Xo(e,t,n,i){const r={},o=new WeakMap;function s(e){const a=e.target;null!==a.index&&t.remove(a.index);for(const n in a.attributes)t.remove(a.attributes[n]);for(const n in a.morphAttributes){const e=a.morphAttributes[n];for(let n=0,i=e.length;n<i;n++)t.remove(e[n])}a.removeEventListener("dispose",s),delete r[a.id];const l=o.get(a);l&&(t.remove(l),o.delete(a)),i.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,n.memory.geometries--}function a(e){const n=[],i=e.index,r=e.attributes.position;let s=0;if(null!==i){const e=i.array;s=i.version;for(let t=0,i=e.length;t<i;t+=3){const i=e[t+0],r=e[t+1],o=e[t+2];n.push(i,r,r,o,o,i)}}else{if(void 0===r)return;{const e=r.array;s=r.version;for(let t=0,i=e.length/3-1;t<i;t+=3){const e=t+0,i=t+1,r=t+2;n.push(e,i,i,r,r,e)}}}const a=new(mn(n)?fr:pr)(n,1);a.version=s;const l=o.get(e);l&&t.remove(l),o.set(e,a)}return{get:function(e,t){return!0===r[t.id]||(t.addEventListener("dispose",s),r[t.id]=!0,n.memory.geometries++),t},update:function(n){const i=n.attributes;for(const o in i)t.update(i[o],e.ARRAY_BUFFER);const r=n.morphAttributes;for(const o in r){const n=r[o];for(let i=0,r=n.length;i<r;i++)t.update(n[i],e.ARRAY_BUFFER)}},getWireframeAttribute:function(e){const t=o.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&a(e)}else a(e);return o.get(e)}}}function Yo(e,t,n){let i,r,o;function s(t,s,a){0!==a&&(e.drawElementsInstanced(i,s,r,t*o,a),n.update(s,i,a))}this.setMode=function(e){i=e},this.setIndex=function(e){r=e.type,o=e.bytesPerElement},this.render=function(t,s){e.drawElements(i,s,r,t*o),n.update(s,i,1)},this.renderInstances=s,this.renderMultiDraw=function(e,o,s){if(0===s)return;t.get("WEBGL_multi_draw").multiDrawElementsWEBGL(i,o,0,r,e,0,s);let a=0;for(let t=0;t<s;t++)a+=o[t];n.update(a,i,1)},this.renderMultiDrawInstances=function(e,a,l,u){if(0===l)return;const c=t.get("WEBGL_multi_draw");if(null===c)for(let t=0;t<e.length;t++)s(e[t]/o,a[t],u[t]);else{c.multiDrawElementsInstancedWEBGL(i,a,0,r,e,0,u,0,l);let t=0;for(let e=0;e<l;e++)t+=a[e];for(let e=0;e<u.length;e++)n.update(t,i,u[e])}}}function Ko(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(n,i,r){switch(t.calls++,i){case e.TRIANGLES:t.triangles+=r*(n/3);break;case e.LINES:t.lines+=r*(n/2);break;case e.LINE_STRIP:t.lines+=r*(n-1);break;case e.LINE_LOOP:t.lines+=r*n;break;case e.POINTS:t.points+=r*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function Jo(e,t,n){const i=new WeakMap,r=new Ln;return{update:function(o,s,a){const l=o.morphTargetInfluences,u=s.morphAttributes.position||s.morphAttributes.normal||s.morphAttributes.color,c=void 0!==u?u.length:0;let d=i.get(s);if(void 0===d||d.count!==c){let e=function(){v.dispose(),i.delete(s),s.removeEventListener("dispose",e)};void 0!==d&&d.texture.dispose();const n=void 0!==s.morphAttributes.position,o=void 0!==s.morphAttributes.normal,a=void 0!==s.morphAttributes.color,l=s.morphAttributes.position||[],u=s.morphAttributes.normal||[],h=s.morphAttributes.color||[];let p=0;!0===n&&(p=1),!0===o&&(p=2),!0===a&&(p=3);let f=s.attributes.position.count*p,m=1;f>t.maxTextureSize&&(m=Math.ceil(f/t.maxTextureSize),f=t.maxTextureSize);const g=new Float32Array(f*m*4*c),v=new kn(g,f,m,c);v.type=Le,v.needsUpdate=!0;const _=4*p;for(let t=0;t<c;t++){const e=l[t],i=u[t],s=h[t],c=f*m*4*t;for(let t=0;t<e.count;t++){const l=t*_;!0===n&&(r.fromBufferAttribute(e,t),g[c+l+0]=r.x,g[c+l+1]=r.y,g[c+l+2]=r.z,g[c+l+3]=0),!0===o&&(r.fromBufferAttribute(i,t),g[c+l+4]=r.x,g[c+l+5]=r.y,g[c+l+6]=r.z,g[c+l+7]=0),!0===a&&(r.fromBufferAttribute(s,t),g[c+l+8]=r.x,g[c+l+9]=r.y,g[c+l+10]=r.z,g[c+l+11]=4===s.itemSize?r.w:1)}}d={count:c,texture:v,size:new hn(f,m)},i.set(s,d),s.addEventListener("dispose",e)}if(!0===o.isInstancedMesh&&null!==o.morphTexture)a.getUniforms().setValue(e,"morphTexture",o.morphTexture,n);else{let t=0;for(let e=0;e<l.length;e++)t+=l[e];const n=s.morphTargetsRelative?1:1-t;a.getUniforms().setValue(e,"morphTargetBaseInfluence",n),a.getUniforms().setValue(e,"morphTargetInfluences",l)}a.getUniforms().setValue(e,"morphTargetsTexture",d.texture,n),a.getUniforms().setValue(e,"morphTargetsTextureSize",d.size)}}}function $o(e,t,n,i){let r=new WeakMap;function o(e){const t=e.target;t.removeEventListener("dispose",o),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(s){const a=i.render.frame,l=s.geometry,u=t.get(s,l);if(r.get(u)!==a&&(t.update(u),r.set(u,a)),s.isInstancedMesh&&(!1===s.hasEventListener("dispose",o)&&s.addEventListener("dispose",o),r.get(s)!==a&&(n.update(s.instanceMatrix,e.ARRAY_BUFFER),null!==s.instanceColor&&n.update(s.instanceColor,e.ARRAY_BUFFER),r.set(s,a))),s.isSkinnedMesh){const e=s.skeleton;r.get(e)!==a&&(e.update(),r.set(e,a))}return u},dispose:function(){r=new WeakMap}}}class Zo extends Nn{constructor(e,t,n,i,r,o,s,a,l,u=1026){if(u!==Ve&&u!==ze)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&u===Ve&&(n=Ne),void 0===n&&u===ze&&(n=Fe),super(null,i,r,o,s,a,u,n,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==s?s:Ee,this.minFilter=void 0!==a?a:Ee,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}const Qo=new Nn,es=new Zo(1,1),ts=new kn,ns=new Fn,is=new no,rs=[],os=[],ss=new Float32Array(16),as=new Float32Array(9),ls=new Float32Array(4);function us(e,t,n){const i=e[0];if(i<=0||i>0)return e;const r=t*n;let o=rs[r];if(void 0===o&&(o=new Float32Array(r),rs[r]=o),0!==t){i.toArray(o,0);for(let i=1,r=0;i!==t;++i)r+=n,e[i].toArray(o,r)}return o}function cs(e,t){if(e.length!==t.length)return!1;for(let n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}function ds(e,t){for(let n=0,i=t.length;n<i;n++)e[n]=t[n]}function hs(e,t){let n=os[t];void 0===n&&(n=new Int32Array(t),os[t]=n);for(let i=0;i!==t;++i)n[i]=e.allocateTextureUnit();return n}function ps(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function fs(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(cs(n,t))return;e.uniform2fv(this.addr,t),ds(n,t)}}function ms(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(cs(n,t))return;e.uniform3fv(this.addr,t),ds(n,t)}}function gs(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(cs(n,t))return;e.uniform4fv(this.addr,t),ds(n,t)}}function vs(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(cs(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),ds(n,t)}else{if(cs(n,i))return;ls.set(i),e.uniformMatrix2fv(this.addr,!1,ls),ds(n,i)}}function _s(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(cs(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),ds(n,t)}else{if(cs(n,i))return;as.set(i),e.uniformMatrix3fv(this.addr,!1,as),ds(n,i)}}function ys(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(cs(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),ds(n,t)}else{if(cs(n,i))return;ss.set(i),e.uniformMatrix4fv(this.addr,!1,ss),ds(n,i)}}function xs(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function Ss(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2i(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(cs(n,t))return;e.uniform2iv(this.addr,t),ds(n,t)}}function Es(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3i(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(cs(n,t))return;e.uniform3iv(this.addr,t),ds(n,t)}}function bs(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(cs(n,t))return;e.uniform4iv(this.addr,t),ds(n,t)}}function Ts(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function ws(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2ui(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(cs(n,t))return;e.uniform2uiv(this.addr,t),ds(n,t)}}function Ms(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3ui(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(cs(n,t))return;e.uniform3uiv(this.addr,t),ds(n,t)}}function As(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(cs(n,t))return;e.uniform4uiv(this.addr,t),ds(n,t)}}function Rs(e,t,n){const i=this.cache,r=n.allocateTextureUnit();let o;i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),this.type===e.SAMPLER_2D_SHADOW?(es.compareFunction=515,o=es):o=Qo,n.setTexture2D(t||o,r)}function Cs(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(t||ns,r)}function Is(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTextureCube(t||is,r)}function Ps(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(t||ts,r)}function Os(e,t){e.uniform1fv(this.addr,t)}function Ns(e,t){const n=us(t,this.size,2);e.uniform2fv(this.addr,n)}function Ls(e,t){const n=us(t,this.size,3);e.uniform3fv(this.addr,n)}function Ds(e,t){const n=us(t,this.size,4);e.uniform4fv(this.addr,n)}function Us(e,t){const n=us(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function ks(e,t){const n=us(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function Fs(e,t){const n=us(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function Bs(e,t){e.uniform1iv(this.addr,t)}function Hs(e,t){e.uniform2iv(this.addr,t)}function Vs(e,t){e.uniform3iv(this.addr,t)}function zs(e,t){e.uniform4iv(this.addr,t)}function Gs(e,t){e.uniform1uiv(this.addr,t)}function Ws(e,t){e.uniform2uiv(this.addr,t)}function js(e,t){e.uniform3uiv(this.addr,t)}function qs(e,t){e.uniform4uiv(this.addr,t)}function Xs(e,t,n){const i=this.cache,r=t.length,o=hs(n,r);cs(i,o)||(e.uniform1iv(this.addr,o),ds(i,o));for(let s=0;s!==r;++s)n.setTexture2D(t[s]||Qo,o[s])}function Ys(e,t,n){const i=this.cache,r=t.length,o=hs(n,r);cs(i,o)||(e.uniform1iv(this.addr,o),ds(i,o));for(let s=0;s!==r;++s)n.setTexture3D(t[s]||ns,o[s])}function Ks(e,t,n){const i=this.cache,r=t.length,o=hs(n,r);cs(i,o)||(e.uniform1iv(this.addr,o),ds(i,o));for(let s=0;s!==r;++s)n.setTextureCube(t[s]||is,o[s])}function Js(e,t,n){const i=this.cache,r=t.length,o=hs(n,r);cs(i,o)||(e.uniform1iv(this.addr,o),ds(i,o));for(let s=0;s!==r;++s)n.setTexture2DArray(t[s]||ts,o[s])}class $s{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=function(e){switch(e){case 5126:return ps;case 35664:return fs;case 35665:return ms;case 35666:return gs;case 35674:return vs;case 35675:return _s;case 35676:return ys;case 5124:case 35670:return xs;case 35667:case 35671:return Ss;case 35668:case 35672:return Es;case 35669:case 35673:return bs;case 5125:return Ts;case 36294:return ws;case 36295:return Ms;case 36296:return As;case 35678:case 36198:case 36298:case 36306:case 35682:return Rs;case 35679:case 36299:case 36307:return Cs;case 35680:case 36300:case 36308:case 36293:return Is;case 36289:case 36303:case 36311:case 36292:return Ps}}(t.type)}}class Zs{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=function(e){switch(e){case 5126:return Os;case 35664:return Ns;case 35665:return Ls;case 35666:return Ds;case 35674:return Us;case 35675:return ks;case 35676:return Fs;case 5124:case 35670:return Bs;case 35667:case 35671:return Hs;case 35668:case 35672:return Vs;case 35669:case 35673:return zs;case 5125:return Gs;case 36294:return Ws;case 36295:return js;case 36296:return qs;case 35678:case 36198:case 36298:case 36306:case 35682:return Xs;case 35679:case 36299:case 36307:return Ys;case 35680:case 36300:case 36308:case 36293:return Ks;case 36289:case 36303:case 36311:case 36292:return Js}}(t.type)}}class Qs{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const i=this.seq;for(let r=0,o=i.length;r!==o;++r){const o=i[r];o.setValue(e,t[o.id],n)}}}const ea=/(\w+)(\])?(\[|\.)?/g;function ta(e,t){e.seq.push(t),e.map[t.id]=t}function na(e,t,n){const i=e.name,r=i.length;for(ea.lastIndex=0;;){const o=ea.exec(i),s=ea.lastIndex;let a=o[1];const l="]"===o[2],u=o[3];if(l&&(a|=0),void 0===u||"["===u&&s+2===r){ta(n,void 0===u?new $s(a,e,t):new Zs(a,e,t));break}{let e=n.map[a];void 0===e&&(e=new Qs(a),ta(n,e)),n=e}}}class ia{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<n;++i){const n=e.getActiveUniform(t,i);na(n,e.getUniformLocation(t,n.name),this)}}setValue(e,t,n,i){const r=this.map[t];void 0!==r&&r.setValue(e,n,i)}setOptional(e,t,n){const i=t[n];void 0!==i&&this.setValue(e,n,i)}static upload(e,t,n,i){for(let r=0,o=t.length;r!==o;++r){const o=t[r],s=n[o.id];!1!==s.needsUpdate&&o.setValue(e,s.value,i)}}static seqWithValue(e,t){const n=[];for(let i=0,r=e.length;i!==r;++i){const r=e[i];r.id in t&&n.push(r)}return n}}function ra(e,t,n){const i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),i}let oa=0;function sa(e,t,n){const i=e.getShaderParameter(t,e.COMPILE_STATUS),r=e.getShaderInfoLog(t).trim();if(i&&""===r)return"";const o=/ERROR: 0:(\d+)/.exec(r);if(o){const i=parseInt(o[1]);return n.toUpperCase()+"\n\n"+r+"\n\n"+function(e,t){const n=e.split("\n"),i=[],r=Math.max(t-6,0),o=Math.min(t+6,n.length);for(let s=r;s<o;s++){const e=s+1;i.push(`${e===t?">":" "} ${e}: ${n[s]}`)}return i.join("\n")}(e.getShaderSource(t),i)}return r}function aa(e,t){const n=function(e){const t=Tn.getPrimaries(Tn.workingColorSpace),n=Tn.getPrimaries(e);let i;switch(t===n?i="":t===Bt&&n===Ft?i="LinearDisplayP3ToLinearSRGB":t===Ft&&n===Bt&&(i="LinearSRGBToLinearDisplayP3"),e){case Nt:case Dt:return[i,"LinearTransferOETF"];case Ot:case Lt:return[i,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",e),[i,"LinearTransferOETF"]}}(t);return`vec4 ${e}( vec4 value ) { return ${n[0]}( ${n[1]}( value ) ); }`}function la(e,t){let n;switch(t){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 6:n="AgX";break;case 7:n="Neutral";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}const ua=new Hn;function ca(){Tn.getLuminanceCoefficients(ua);return["float luminance( const in vec3 rgb ) {",`\tconst vec3 weights = vec3( ${ua.x.toFixed(4)}, ${ua.y.toFixed(4)}, ${ua.z.toFixed(4)} );`,"\treturn dot( weights, rgb );","}"].join("\n")}function da(e){return""!==e}function ha(e,t){const n=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function pa(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const fa=/^[ \t]*#include +<([\w\d./]+)>/gm;function ma(e){return e.replace(fa,va)}const ga=new Map;function va(e,t){let n=mo[t];if(void 0===n){const e=ga.get(t);if(void 0===e)throw new Error("Can not resolve #include <"+t+">");n=mo[e],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,e)}return ma(n)}const _a=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function ya(e){return e.replace(_a,xa)}function xa(e,t,n,i){let r="";for(let o=parseInt(t);o<parseInt(n);o++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return r}function Sa(e){let t=`precision ${e.precision} float;\n\tprecision ${e.precision} int;\n\tprecision ${e.precision} sampler2D;\n\tprecision ${e.precision} samplerCube;\n\tprecision ${e.precision} sampler3D;\n\tprecision ${e.precision} sampler2DArray;\n\tprecision ${e.precision} sampler2DShadow;\n\tprecision ${e.precision} samplerCubeShadow;\n\tprecision ${e.precision} sampler2DArrayShadow;\n\tprecision ${e.precision} isampler2D;\n\tprecision ${e.precision} isampler3D;\n\tprecision ${e.precision} isamplerCube;\n\tprecision ${e.precision} isampler2DArray;\n\tprecision ${e.precision} usampler2D;\n\tprecision ${e.precision} usampler3D;\n\tprecision ${e.precision} usamplerCube;\n\tprecision ${e.precision} usampler2DArray;\n\t`;return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function Ea(e,t,n,i){const r=e.getContext(),o=n.defines;let s=n.vertexShader,a=n.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return 1===e.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===e.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===e.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(n),u=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case me:case ge:t="ENVMAP_TYPE_CUBE";break;case _e:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),c=function(e){let t="ENVMAP_MODE_REFLECTION";e.envMap&&e.envMapMode===ge&&(t="ENVMAP_MODE_REFRACTION");return t}(n),d=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(n),h=function(e){const t=e.envMapCubeUVHeight;if(null===t)return null;const n=Math.log2(t)-2,i=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:i,maxMip:n}}(n),p=function(e){return[e.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",e.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(da).join("\n")}(n),f=function(e){const t=[];for(const n in e){const i=e[n];!1!==i&&t.push("#define "+n+" "+i)}return t.join("\n")}(o),m=r.createProgram();let g,v,_=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(g=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter(da).join("\n"),g.length>0&&(g+="\n"),v=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter(da).join("\n"),v.length>0&&(v+="\n")):(g=[Sa(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.batchingColor?"#define USE_BATCHING_COLOR":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","\tuniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(da).join("\n"),v=[Sa(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.envMap?"#define "+c:"",n.envMap?"#define "+d:"",h?"#define CUBEUV_TEXEL_WIDTH "+h.texelWidth:"",h?"#define CUBEUV_TEXEL_HEIGHT "+h.texelHeight:"",h?"#define CUBEUV_MAX_MIP "+h.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.dispersion?"#define USE_DISPERSION":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor||n.batchingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?mo.tonemapping_pars_fragment:"",0!==n.toneMapping?la("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",mo.colorspace_pars_fragment,aa("linearToOutputTexel",n.outputColorSpace),ca(),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(da).join("\n")),s=ma(s),s=ha(s,n),s=pa(s,n),a=ma(a),a=ha(a,n),a=pa(a,n),s=ya(s),a=ya(a),!0!==n.isRawShaderMaterial&&(_="#version 300 es\n",g=[p,"#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,v=["#define varying in",n.glslVersion===Jt?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===Jt?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v);const y=_+g+s,x=_+v+a,S=ra(r,r.VERTEX_SHADER,y),E=ra(r,r.FRAGMENT_SHADER,x);function b(t){if(e.debug.checkShaderErrors){const n=r.getProgramInfoLog(m).trim(),i=r.getShaderInfoLog(S).trim(),o=r.getShaderInfoLog(E).trim();let s=!0,a=!0;if(!1===r.getProgramParameter(m,r.LINK_STATUS))if(s=!1,"function"==typeof e.debug.onShaderError)e.debug.onShaderError(r,m,S,E);else{const e=sa(r,S,"vertex"),i=sa(r,E,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(m,r.VALIDATE_STATUS)+"\n\nMaterial Name: "+t.name+"\nMaterial Type: "+t.type+"\n\nProgram Info Log: "+n+"\n"+e+"\n"+i)}else""!==n?console.warn("THREE.WebGLProgram: Program Info Log:",n):""!==i&&""!==o||(a=!1);a&&(t.diagnostics={runnable:s,programLog:n,vertexShader:{log:i,prefix:g},fragmentShader:{log:o,prefix:v}})}r.deleteShader(S),r.deleteShader(E),T=new ia(r,m),w=function(e,t){const n={},i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const i=e.getActiveAttrib(t,r),o=i.name;let s=1;i.type===e.FLOAT_MAT2&&(s=2),i.type===e.FLOAT_MAT3&&(s=3),i.type===e.FLOAT_MAT4&&(s=4),n[o]={type:i.type,location:e.getAttribLocation(t,o),locationSize:s}}return n}(r,m)}let T,w;r.attachShader(m,S),r.attachShader(m,E),void 0!==n.index0AttributeName?r.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&r.bindAttribLocation(m,0,"position"),r.linkProgram(m),this.getUniforms=function(){return void 0===T&&b(this),T},this.getAttributes=function(){return void 0===w&&b(this),w};let M=!1===n.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===M&&(M=r.getProgramParameter(m,37297)),M},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(m),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=oa++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=S,this.fragmentShader=E,this}let ba=0;class Ta{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,i=this._getShaderStage(t),r=this._getShaderStage(n),o=this._getShaderCacheForMaterial(e);return!1===o.has(i)&&(o.add(i),i.usedTimes++),!1===o.has(r)&&(o.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,0===n.usedTimes&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return void 0===n&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return void 0===n&&(n=new wa(e),t.set(e,n)),n}}class wa{constructor(e){this.id=ba++,this.code=e,this.usedTimes=0}}function Ma(e,t,n,i,r,o,s){const a=new Ai,l=new Ta,u=new Set,c=[],d=r.logarithmicDepthBuffer,h=r.vertexTextures;let p=r.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(e){return u.add(e),0===e?"uv":`uv${e}`}return{getParameters:function(o,a,c,g,v){const _=g.fog,y=v.geometry,x=o.isMeshStandardMaterial?g.environment:null,S=(o.isMeshStandardMaterial?n:t).get(o.envMap||x),E=S&&S.mapping===_e?S.image.height:null,b=f[o.type];null!==o.precision&&(p=r.getMaxPrecision(o.precision),p!==o.precision&&console.warn("THREE.WebGLProgram.getParameters:",o.precision,"not supported, using",p,"instead."));const T=y.morphAttributes.position||y.morphAttributes.normal||y.morphAttributes.color,w=void 0!==T?T.length:0;let M,A,R,C,I=0;if(void 0!==y.morphAttributes.position&&(I=1),void 0!==y.morphAttributes.normal&&(I=2),void 0!==y.morphAttributes.color&&(I=3),b){const e=vo[b];M=e.vertexShader,A=e.fragmentShader}else M=o.vertexShader,A=o.fragmentShader,l.update(o),R=l.getVertexShaderID(o),C=l.getFragmentShaderID(o);const P=e.getRenderTarget(),O=!0===v.isInstancedMesh,N=!0===v.isBatchedMesh,L=!!o.map,D=!!o.matcap,U=!!S,k=!!o.aoMap,F=!!o.lightMap,B=!!o.bumpMap,H=!!o.normalMap,V=!!o.displacementMap,z=!!o.emissiveMap,G=!!o.metalnessMap,W=!!o.roughnessMap,j=o.anisotropy>0,q=o.clearcoat>0,X=o.dispersion>0,Y=o.iridescence>0,K=o.sheen>0,J=o.transmission>0,$=j&&!!o.anisotropyMap,Z=q&&!!o.clearcoatMap,Q=q&&!!o.clearcoatNormalMap,ee=q&&!!o.clearcoatRoughnessMap,te=Y&&!!o.iridescenceMap,ne=Y&&!!o.iridescenceThicknessMap,ie=K&&!!o.sheenColorMap,re=K&&!!o.sheenRoughnessMap,oe=!!o.specularMap,se=!!o.specularColorMap,ae=!!o.specularIntensityMap,le=J&&!!o.transmissionMap,ue=J&&!!o.thicknessMap,ce=!!o.gradientMap,de=!!o.alphaMap,he=o.alphaTest>0,pe=!!o.alphaHash,fe=!!o.extensions;let me=0;o.toneMapped&&(null!==P&&!0!==P.isXRRenderTarget||(me=e.toneMapping));const ge={shaderID:b,shaderType:o.type,shaderName:o.name,vertexShader:M,fragmentShader:A,defines:o.defines,customVertexShaderID:R,customFragmentShaderID:C,isRawShaderMaterial:!0===o.isRawShaderMaterial,glslVersion:o.glslVersion,precision:p,batching:N,batchingColor:N&&null!==v._colorsTexture,instancing:O,instancingColor:O&&null!==v.instanceColor,instancingMorph:O&&null!==v.morphTexture,supportsVertexTextures:h,outputColorSpace:null===P?e.outputColorSpace:!0===P.isXRRenderTarget?P.texture.colorSpace:Nt,alphaToCoverage:!!o.alphaToCoverage,map:L,matcap:D,envMap:U,envMapMode:U&&S.mapping,envMapCubeUVHeight:E,aoMap:k,lightMap:F,bumpMap:B,normalMap:H,displacementMap:h&&V,emissiveMap:z,normalMapObjectSpace:H&&1===o.normalMapType,normalMapTangentSpace:H&&0===o.normalMapType,metalnessMap:G,roughnessMap:W,anisotropy:j,anisotropyMap:$,clearcoat:q,clearcoatMap:Z,clearcoatNormalMap:Q,clearcoatRoughnessMap:ee,dispersion:X,iridescence:Y,iridescenceMap:te,iridescenceThicknessMap:ne,sheen:K,sheenColorMap:ie,sheenRoughnessMap:re,specularMap:oe,specularColorMap:se,specularIntensityMap:ae,transmission:J,transmissionMap:le,thicknessMap:ue,gradientMap:ce,opaque:!1===o.transparent&&1===o.blending&&!1===o.alphaToCoverage,alphaMap:de,alphaTest:he,alphaHash:pe,combine:o.combine,mapUv:L&&m(o.map.channel),aoMapUv:k&&m(o.aoMap.channel),lightMapUv:F&&m(o.lightMap.channel),bumpMapUv:B&&m(o.bumpMap.channel),normalMapUv:H&&m(o.normalMap.channel),displacementMapUv:V&&m(o.displacementMap.channel),emissiveMapUv:z&&m(o.emissiveMap.channel),metalnessMapUv:G&&m(o.metalnessMap.channel),roughnessMapUv:W&&m(o.roughnessMap.channel),anisotropyMapUv:$&&m(o.anisotropyMap.channel),clearcoatMapUv:Z&&m(o.clearcoatMap.channel),clearcoatNormalMapUv:Q&&m(o.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:ee&&m(o.clearcoatRoughnessMap.channel),iridescenceMapUv:te&&m(o.iridescenceMap.channel),iridescenceThicknessMapUv:ne&&m(o.iridescenceThicknessMap.channel),sheenColorMapUv:ie&&m(o.sheenColorMap.channel),sheenRoughnessMapUv:re&&m(o.sheenRoughnessMap.channel),specularMapUv:oe&&m(o.specularMap.channel),specularColorMapUv:se&&m(o.specularColorMap.channel),specularIntensityMapUv:ae&&m(o.specularIntensityMap.channel),transmissionMapUv:le&&m(o.transmissionMap.channel),thicknessMapUv:ue&&m(o.thicknessMap.channel),alphaMapUv:de&&m(o.alphaMap.channel),vertexTangents:!!y.attributes.tangent&&(H||j),vertexColors:o.vertexColors,vertexAlphas:!0===o.vertexColors&&!!y.attributes.color&&4===y.attributes.color.itemSize,pointsUvs:!0===v.isPoints&&!!y.attributes.uv&&(L||de),fog:!!_,useFog:!0===o.fog,fogExp2:!!_&&_.isFogExp2,flatShading:!0===o.flatShading,sizeAttenuation:!0===o.sizeAttenuation,logarithmicDepthBuffer:d,skinning:!0===v.isSkinnedMesh,morphTargets:void 0!==y.morphAttributes.position,morphNormals:void 0!==y.morphAttributes.normal,morphColors:void 0!==y.morphAttributes.color,morphTargetsCount:w,morphTextureStride:I,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numSpotLightMaps:a.spotLightMap.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numSpotLightShadowsWithMaps:a.numSpotLightShadowsWithMaps,numLightProbes:a.numLightProbes,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:o.dithering,shadowMapEnabled:e.shadowMap.enabled&&c.length>0,shadowMapType:e.shadowMap.type,toneMapping:me,decodeVideoTexture:L&&!0===o.map.isVideoTexture&&Tn.getTransfer(o.map.colorSpace)===kt,premultipliedAlpha:o.premultipliedAlpha,doubleSided:2===o.side,flipSided:1===o.side,useDepthPacking:o.depthPacking>=0,depthPacking:o.depthPacking||0,index0AttributeName:o.index0AttributeName,extensionClipCullDistance:fe&&!0===o.extensions.clipCullDistance&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(fe&&!0===o.extensions.multiDraw||N)&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:o.customProgramCacheKey()};return ge.vertexUv1s=u.has(1),ge.vertexUv2s=u.has(2),ge.vertexUv3s=u.has(3),u.clear(),ge},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(!function(e,t){e.push(t.precision),e.push(t.outputColorSpace),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.mapUv),e.push(t.alphaMapUv),e.push(t.lightMapUv),e.push(t.aoMapUv),e.push(t.bumpMapUv),e.push(t.normalMapUv),e.push(t.displacementMapUv),e.push(t.emissiveMapUv),e.push(t.metalnessMapUv),e.push(t.roughnessMapUv),e.push(t.anisotropyMapUv),e.push(t.clearcoatMapUv),e.push(t.clearcoatNormalMapUv),e.push(t.clearcoatRoughnessMapUv),e.push(t.iridescenceMapUv),e.push(t.iridescenceThicknessMapUv),e.push(t.sheenColorMapUv),e.push(t.sheenRoughnessMapUv),e.push(t.specularMapUv),e.push(t.specularColorMapUv),e.push(t.specularIntensityMapUv),e.push(t.transmissionMapUv),e.push(t.thicknessMapUv),e.push(t.combine),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.numLightProbes),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(n,t),function(e,t){a.disableAll(),t.supportsVertexTextures&&a.enable(0);t.instancing&&a.enable(1);t.instancingColor&&a.enable(2);t.instancingMorph&&a.enable(3);t.matcap&&a.enable(4);t.envMap&&a.enable(5);t.normalMapObjectSpace&&a.enable(6);t.normalMapTangentSpace&&a.enable(7);t.clearcoat&&a.enable(8);t.iridescence&&a.enable(9);t.alphaTest&&a.enable(10);t.vertexColors&&a.enable(11);t.vertexAlphas&&a.enable(12);t.vertexUv1s&&a.enable(13);t.vertexUv2s&&a.enable(14);t.vertexUv3s&&a.enable(15);t.vertexTangents&&a.enable(16);t.anisotropy&&a.enable(17);t.alphaHash&&a.enable(18);t.batching&&a.enable(19);t.dispersion&&a.enable(20);t.batchingColor&&a.enable(21);e.push(a.mask),a.disableAll(),t.fog&&a.enable(0);t.useFog&&a.enable(1);t.flatShading&&a.enable(2);t.logarithmicDepthBuffer&&a.enable(3);t.skinning&&a.enable(4);t.morphTargets&&a.enable(5);t.morphNormals&&a.enable(6);t.morphColors&&a.enable(7);t.premultipliedAlpha&&a.enable(8);t.shadowMapEnabled&&a.enable(9);t.doubleSided&&a.enable(10);t.flipSided&&a.enable(11);t.useDepthPacking&&a.enable(12);t.dithering&&a.enable(13);t.transmission&&a.enable(14);t.sheen&&a.enable(15);t.opaque&&a.enable(16);t.pointsUvs&&a.enable(17);t.decodeVideoTexture&&a.enable(18);t.alphaToCoverage&&a.enable(19);e.push(a.mask)}(n,t),n.push(e.outputColorSpace)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=f[e.type];let n;if(t){const e=vo[t];n=Xr.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let i;for(let e=0,r=c.length;e<r;e++){const t=c[e];if(t.cacheKey===n){i=t,++i.usedTimes;break}}return void 0===i&&(i=new Ea(e,n,t,o),c.push(i)),i},releaseProgram:function(e){if(0===--e.usedTimes){const t=c.indexOf(e);c[t]=c[c.length-1],c.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:c,dispose:function(){l.dispose()}}}function Aa(){let e=new WeakMap;return{get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,i){e.get(t)[n]=i},dispose:function(){e=new WeakMap}}}function Ra(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Ca(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Ia(){const e=[];let t=0;const n=[],i=[],r=[];function o(n,i,r,o,s,a){let l=e[t];return void 0===l?(l={id:n.id,object:n,geometry:i,material:r,groupOrder:o,renderOrder:n.renderOrder,z:s,group:a},e[t]=l):(l.id=n.id,l.object=n,l.geometry=i,l.material=r,l.groupOrder=o,l.renderOrder=n.renderOrder,l.z=s,l.group=a),t++,l}return{opaque:n,transmissive:i,transparent:r,init:function(){t=0,n.length=0,i.length=0,r.length=0},push:function(e,t,s,a,l,u){const c=o(e,t,s,a,l,u);s.transmission>0?i.push(c):!0===s.transparent?r.push(c):n.push(c)},unshift:function(e,t,s,a,l,u){const c=o(e,t,s,a,l,u);s.transmission>0?i.unshift(c):!0===s.transparent?r.unshift(c):n.unshift(c)},finish:function(){for(let n=t,i=e.length;n<i;n++){const t=e[n];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){n.length>1&&n.sort(e||Ra),i.length>1&&i.sort(t||Ca),r.length>1&&r.sort(t||Ca)}}}function Pa(){let e=new WeakMap;return{get:function(t,n){const i=e.get(t);let r;return void 0===i?(r=new Ia,e.set(t,[r])):n>=i.length?(r=new Ia,i.push(r)):r=i[n],r},dispose:function(){e=new WeakMap}}}function Oa(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new Hn,color:new or};break;case"SpotLight":n={position:new Hn,direction:new Hn,color:new or,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Hn,color:new or,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Hn,skyColor:new or,groundColor:new or};break;case"RectAreaLight":n={color:new or,position:new Hn,halfWidth:new Hn,halfHeight:new Hn}}return e[t.id]=n,n}}}let Na=0;function La(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function Da(e){const t=new Oa,n=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new hn};break;case"PointLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new hn,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let a=0;a<9;a++)i.probe.push(new Hn);const r=new Hn,o=new gi,s=new gi;return{setup:function(r){let o=0,s=0,a=0;for(let e=0;e<9;e++)i.probe[e].set(0,0,0);let l=0,u=0,c=0,d=0,h=0,p=0,f=0,m=0,g=0,v=0,_=0;r.sort(La);for(let e=0,x=r.length;e<x;e++){const y=r[e],x=y.color,S=y.intensity,E=y.distance,b=y.shadow&&y.shadow.map?y.shadow.map.texture:null;if(y.isAmbientLight)o+=x.r*S,s+=x.g*S,a+=x.b*S;else if(y.isLightProbe){for(let e=0;e<9;e++)i.probe[e].addScaledVector(y.sh.coefficients[e],S);_++}else if(y.isDirectionalLight){const e=t.get(y);if(e.color.copy(y.color).multiplyScalar(y.intensity),y.castShadow){const e=y.shadow,t=n.get(y);t.shadowIntensity=e.intensity,t.shadowBias=e.bias,t.shadowNormalBias=e.normalBias,t.shadowRadius=e.radius,t.shadowMapSize=e.mapSize,i.directionalShadow[l]=t,i.directionalShadowMap[l]=b,i.directionalShadowMatrix[l]=y.shadow.matrix,p++}i.directional[l]=e,l++}else if(y.isSpotLight){const e=t.get(y);e.position.setFromMatrixPosition(y.matrixWorld),e.color.copy(x).multiplyScalar(S),e.distance=E,e.coneCos=Math.cos(y.angle),e.penumbraCos=Math.cos(y.angle*(1-y.penumbra)),e.decay=y.decay,i.spot[c]=e;const r=y.shadow;if(y.map&&(i.spotLightMap[g]=y.map,g++,r.updateMatrices(y),y.castShadow&&v++),i.spotLightMatrix[c]=r.matrix,y.castShadow){const e=n.get(y);e.shadowIntensity=r.intensity,e.shadowBias=r.bias,e.shadowNormalBias=r.normalBias,e.shadowRadius=r.radius,e.shadowMapSize=r.mapSize,i.spotShadow[c]=e,i.spotShadowMap[c]=b,m++}c++}else if(y.isRectAreaLight){const e=t.get(y);e.color.copy(x).multiplyScalar(S),e.halfWidth.set(.5*y.width,0,0),e.halfHeight.set(0,.5*y.height,0),i.rectArea[d]=e,d++}else if(y.isPointLight){const e=t.get(y);if(e.color.copy(y.color).multiplyScalar(y.intensity),e.distance=y.distance,e.decay=y.decay,y.castShadow){const e=y.shadow,t=n.get(y);t.shadowIntensity=e.intensity,t.shadowBias=e.bias,t.shadowNormalBias=e.normalBias,t.shadowRadius=e.radius,t.shadowMapSize=e.mapSize,t.shadowCameraNear=e.camera.near,t.shadowCameraFar=e.camera.far,i.pointShadow[u]=t,i.pointShadowMap[u]=b,i.pointShadowMatrix[u]=y.shadow.matrix,f++}i.point[u]=e,u++}else if(y.isHemisphereLight){const e=t.get(y);e.skyColor.copy(y.color).multiplyScalar(S),e.groundColor.copy(y.groundColor).multiplyScalar(S),i.hemi[h]=e,h++}}d>0&&(!0===e.has("OES_texture_float_linear")?(i.rectAreaLTC1=go.LTC_FLOAT_1,i.rectAreaLTC2=go.LTC_FLOAT_2):(i.rectAreaLTC1=go.LTC_HALF_1,i.rectAreaLTC2=go.LTC_HALF_2)),i.ambient[0]=o,i.ambient[1]=s,i.ambient[2]=a;const y=i.hash;y.directionalLength===l&&y.pointLength===u&&y.spotLength===c&&y.rectAreaLength===d&&y.hemiLength===h&&y.numDirectionalShadows===p&&y.numPointShadows===f&&y.numSpotShadows===m&&y.numSpotMaps===g&&y.numLightProbes===_||(i.directional.length=l,i.spot.length=c,i.rectArea.length=d,i.point.length=u,i.hemi.length=h,i.directionalShadow.length=p,i.directionalShadowMap.length=p,i.pointShadow.length=f,i.pointShadowMap.length=f,i.spotShadow.length=m,i.spotShadowMap.length=m,i.directionalShadowMatrix.length=p,i.pointShadowMatrix.length=f,i.spotLightMatrix.length=m+g-v,i.spotLightMap.length=g,i.numSpotLightShadowsWithMaps=v,i.numLightProbes=_,y.directionalLength=l,y.pointLength=u,y.spotLength=c,y.rectAreaLength=d,y.hemiLength=h,y.numDirectionalShadows=p,y.numPointShadows=f,y.numSpotShadows=m,y.numSpotMaps=g,y.numLightProbes=_,i.version=Na++)},setupView:function(e,t){let n=0,a=0,l=0,u=0,c=0;const d=t.matrixWorldInverse;for(let h=0,p=e.length;h<p;h++){const t=e[h];if(t.isDirectionalLight){const e=i.directional[n];e.direction.setFromMatrixPosition(t.matrixWorld),r.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(r),e.direction.transformDirection(d),n++}else if(t.isSpotLight){const e=i.spot[l];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(d),e.direction.setFromMatrixPosition(t.matrixWorld),r.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(r),e.direction.transformDirection(d),l++}else if(t.isRectAreaLight){const e=i.rectArea[u];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(d),s.identity(),o.copy(t.matrixWorld),o.premultiply(d),s.extractRotation(o),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),e.halfWidth.applyMatrix4(s),e.halfHeight.applyMatrix4(s),u++}else if(t.isPointLight){const e=i.point[a];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(d),a++}else if(t.isHemisphereLight){const e=i.hemi[c];e.direction.setFromMatrixPosition(t.matrixWorld),e.direction.transformDirection(d),c++}}},state:i}}function Ua(e){const t=new Da(e),n=[],i=[];const r={lightsArray:n,shadowsArray:i,camera:null,lights:t,transmissionRenderTarget:{}};return{init:function(e){r.camera=e,n.length=0,i.length=0},state:r,setupLights:function(){t.setup(n)},setupLightsView:function(e){t.setupView(n,e)},pushLight:function(e){n.push(e)},pushShadow:function(e){i.push(e)}}}function ka(e){let t=new WeakMap;return{get:function(n,i=0){const r=t.get(n);let o;return void 0===r?(o=new Ua(e),t.set(n,[o])):i>=r.length?(o=new Ua(e),r.push(o)):o=r[i],o},dispose:function(){t=new WeakMap}}}class Fa extends lr{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class Ba extends lr{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function Ha(e,t,n){let i=new co;const r=new hn,o=new hn,s=new Ln,a=new Fa({depthPacking:3201}),l=new Ba,u={},c=n.maxTextureSize,d={[X]:1,[Y]:0,[K]:2},h=new Yr({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new hn},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),p=h.clone();p.defines.HORIZONTAL_PASS=1;const f=new br;f.setAttribute("position",new hr(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new Vr(f,h),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1;let v=this.type;function _(n,i){const o=t.update(m);h.defines.VSM_SAMPLES!==n.blurSamples&&(h.defines.VSM_SAMPLES=n.blurSamples,p.defines.VSM_SAMPLES=n.blurSamples,h.needsUpdate=!0,p.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new Un(r.x,r.y)),h.uniforms.shadow_pass.value=n.map.texture,h.uniforms.resolution.value=n.mapSize,h.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(i,null,o,h,m,null),p.uniforms.shadow_pass.value=n.mapPass.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(i,null,o,p,m,null)}function y(t,n,i,r){let o=null;const s=!0===i.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==s)o=s;else if(o=!0===i.isPointLight?l:a,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0){const e=o.uuid,t=n.uuid;let i=u[e];void 0===i&&(i={},u[e]=i);let r=i[t];void 0===r&&(r=o.clone(),i[t]=r,n.addEventListener("dispose",S)),o=r}if(o.visible=n.visible,o.wireframe=n.wireframe,o.side=3===r?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:d[n.side],o.alphaMap=n.alphaMap,o.alphaTest=n.alphaTest,o.map=n.map,o.clipShadows=n.clipShadows,o.clippingPlanes=n.clippingPlanes,o.clipIntersection=n.clipIntersection,o.displacementMap=n.displacementMap,o.displacementScale=n.displacementScale,o.displacementBias=n.displacementBias,o.wireframeLinewidth=n.wireframeLinewidth,o.linewidth=n.linewidth,!0===i.isPointLight&&!0===o.isMeshDistanceMaterial){e.properties.get(o).light=i}return o}function x(n,r,o,s,a){if(!1===n.visible)return;if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===a)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,n.matrixWorld);const i=t.update(n),l=n.material;if(Array.isArray(l)){const t=i.groups;for(let u=0,c=t.length;u<c;u++){const c=t[u],d=l[c.materialIndex];if(d&&d.visible){const t=y(n,d,s,a);n.onBeforeShadow(e,n,r,o,i,t,c),e.renderBufferDirect(o,null,i,t,n,c),n.onAfterShadow(e,n,r,o,i,t,c)}}}else if(l.visible){const t=y(n,l,s,a);n.onBeforeShadow(e,n,r,o,i,t,null),e.renderBufferDirect(o,null,i,t,n,null),n.onAfterShadow(e,n,r,o,i,t,null)}}const l=n.children;for(let e=0,t=l.length;e<t;e++)x(l[e],r,o,s,a)}function S(e){e.target.removeEventListener("dispose",S);for(const t in u){const n=u[t],i=e.target.uuid;if(i in n){n[i].dispose(),delete n[i]}}}this.render=function(t,n,a){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),u=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),h=e.state;h.setBlending(0),h.buffers.color.setClear(1,1,1,1),h.buffers.depth.setTest(!0),h.setScissorTest(!1);const p=3!==v&&3===this.type,f=3===v&&3!==this.type;for(let m=0,g=t.length;m<g;m++){const l=t[m],u=l.shadow;if(void 0===u){console.warn("THREE.WebGLShadowMap:",l,"has no shadow.");continue}if(!1===u.autoUpdate&&!1===u.needsUpdate)continue;r.copy(u.mapSize);const d=u.getFrameExtents();if(r.multiply(d),o.copy(u.mapSize),(r.x>c||r.y>c)&&(r.x>c&&(o.x=Math.floor(c/d.x),r.x=o.x*d.x,u.mapSize.x=o.x),r.y>c&&(o.y=Math.floor(c/d.y),r.y=o.y*d.y,u.mapSize.y=o.y)),null===u.map||!0===p||!0===f){const e=3!==this.type?{minFilter:Ee,magFilter:Ee}:{};null!==u.map&&u.map.dispose(),u.map=new Un(r.x,r.y,e),u.map.texture.name=l.name+".shadowMap",u.camera.updateProjectionMatrix()}e.setRenderTarget(u.map),e.clear();const g=u.getViewportCount();for(let e=0;e<g;e++){const t=u.getViewport(e);s.set(o.x*t.x,o.y*t.y,o.x*t.z,o.y*t.w),h.viewport(s),u.updateMatrices(l,e),i=u.getFrustum(),x(n,a,u.camera,l,this.type)}!0!==u.isPointLightShadow&&3===this.type&&_(u,a),u.needsUpdate=!1}v=this.type,g.needsUpdate=!1,e.setRenderTarget(l,u,d)}}function Va(e){const t=new function(){let t=!1;const n=new Ln;let i=null;const r=new Ln(0,0,0,0);return{setMask:function(n){i===n||t||(e.colorMask(n,n,n,n),i=n)},setLocked:function(e){t=e},setClear:function(t,i,o,s,a){!0===a&&(t*=s,i*=s,o*=s),n.set(t,i,o,s),!1===r.equals(n)&&(e.clearColor(t,i,o,s),r.copy(n))},reset:function(){t=!1,i=null,r.set(-1,0,0,0)}}},n=new function(){let t=!1,n=null,i=null,r=null;return{setTest:function(t){t?B(e.DEPTH_TEST):H(e.DEPTH_TEST)},setMask:function(i){n===i||t||(e.depthMask(i),n=i)},setFunc:function(t){if(i!==t){switch(t){case 0:e.depthFunc(e.NEVER);break;case 1:e.depthFunc(e.ALWAYS);break;case 2:e.depthFunc(e.LESS);break;case 3:default:e.depthFunc(e.LEQUAL);break;case 4:e.depthFunc(e.EQUAL);break;case 5:e.depthFunc(e.GEQUAL);break;case 6:e.depthFunc(e.GREATER);break;case 7:e.depthFunc(e.NOTEQUAL)}i=t}},setLocked:function(e){t=e},setClear:function(t){r!==t&&(e.clearDepth(t),r=t)},reset:function(){t=!1,n=null,i=null,r=null}}},i=new function(){let t=!1,n=null,i=null,r=null,o=null,s=null,a=null,l=null,u=null;return{setTest:function(n){t||(n?B(e.STENCIL_TEST):H(e.STENCIL_TEST))},setMask:function(i){n===i||t||(e.stencilMask(i),n=i)},setFunc:function(t,n,s){i===t&&r===n&&o===s||(e.stencilFunc(t,n,s),i=t,r=n,o=s)},setOp:function(t,n,i){s===t&&a===n&&l===i||(e.stencilOp(t,n,i),s=t,a=n,l=i)},setLocked:function(e){t=e},setClear:function(t){u!==t&&(e.clearStencil(t),u=t)},reset:function(){t=!1,n=null,i=null,r=null,o=null,s=null,a=null,l=null,u=null}}},r=new WeakMap,o=new WeakMap;let s={},a={},l=new WeakMap,u=[],c=null,d=!1,h=null,p=null,f=null,m=null,g=null,v=null,_=null,y=new or(0,0,0),x=0,S=!1,E=null,b=null,T=null,w=null,M=null;const A=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let R=!1,C=0;const I=e.getParameter(e.VERSION);-1!==I.indexOf("WebGL")?(C=parseFloat(/^WebGL (\d)/.exec(I)[1]),R=C>=1):-1!==I.indexOf("OpenGL ES")&&(C=parseFloat(/^OpenGL ES (\d)/.exec(I)[1]),R=C>=2);let P=null,O={};const N=e.getParameter(e.SCISSOR_BOX),L=e.getParameter(e.VIEWPORT),D=(new Ln).fromArray(N),U=(new Ln).fromArray(L);function k(t,n,i,r){const o=new Uint8Array(4),s=e.createTexture();e.bindTexture(t,s),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let a=0;a<i;a++)t===e.TEXTURE_3D||t===e.TEXTURE_2D_ARRAY?e.texImage3D(n,0,e.RGBA,1,1,r,0,e.RGBA,e.UNSIGNED_BYTE,o):e.texImage2D(n+a,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,o);return s}const F={};function B(t){!0!==s[t]&&(e.enable(t),s[t]=!0)}function H(t){!1!==s[t]&&(e.disable(t),s[t]=!1)}F[e.TEXTURE_2D]=k(e.TEXTURE_2D,e.TEXTURE_2D,1),F[e.TEXTURE_CUBE_MAP]=k(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),F[e.TEXTURE_2D_ARRAY]=k(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),F[e.TEXTURE_3D]=k(e.TEXTURE_3D,e.TEXTURE_3D,1,1),t.setClear(0,0,0,1),n.setClear(1),i.setClear(0),B(e.DEPTH_TEST),n.setFunc(3),W(!1),j(1),B(e.CULL_FACE),G(0);const V={[J]:e.FUNC_ADD,[$]:e.FUNC_SUBTRACT,[Z]:e.FUNC_REVERSE_SUBTRACT};V[103]=e.MIN,V[104]=e.MAX;const z={[Q]:e.ZERO,[ee]:e.ONE,[te]:e.SRC_COLOR,[ie]:e.SRC_ALPHA,[ue]:e.SRC_ALPHA_SATURATE,[ae]:e.DST_COLOR,[oe]:e.DST_ALPHA,[ne]:e.ONE_MINUS_SRC_COLOR,[re]:e.ONE_MINUS_SRC_ALPHA,[le]:e.ONE_MINUS_DST_COLOR,[se]:e.ONE_MINUS_DST_ALPHA,[ce]:e.CONSTANT_COLOR,[de]:e.ONE_MINUS_CONSTANT_COLOR,[he]:e.CONSTANT_ALPHA,[pe]:e.ONE_MINUS_CONSTANT_ALPHA};function G(t,n,i,r,o,s,a,l,u,c){if(0!==t){if(!1===d&&(B(e.BLEND),d=!0),5===t)o=o||n,s=s||i,a=a||r,n===p&&o===g||(e.blendEquationSeparate(V[n],V[o]),p=n,g=o),i===f&&r===m&&s===v&&a===_||(e.blendFuncSeparate(z[i],z[r],z[s],z[a]),f=i,m=r,v=s,_=a),!1!==l.equals(y)&&u===x||(e.blendColor(l.r,l.g,l.b,u),y.copy(l),x=u),h=t,S=!1;else if(t!==h||c!==S){if(p===J&&g===J||(e.blendEquation(e.FUNC_ADD),p=J,g=J),c)switch(t){case 1:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.ONE,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}f=null,m=null,v=null,_=null,y.set(0,0,0),x=0,h=t,S=c}}else!0===d&&(H(e.BLEND),d=!1)}function W(t){E!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),E=t)}function j(t){0!==t?(B(e.CULL_FACE),t!==b&&(1===t?e.cullFace(e.BACK):2===t?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):H(e.CULL_FACE),b=t}function q(t,n,i){t?(B(e.POLYGON_OFFSET_FILL),w===n&&M===i||(e.polygonOffset(n,i),w=n,M=i)):H(e.POLYGON_OFFSET_FILL)}return{buffers:{color:t,depth:n,stencil:i},enable:B,disable:H,bindFramebuffer:function(t,n){return a[t]!==n&&(e.bindFramebuffer(t,n),a[t]=n,t===e.DRAW_FRAMEBUFFER&&(a[e.FRAMEBUFFER]=n),t===e.FRAMEBUFFER&&(a[e.DRAW_FRAMEBUFFER]=n),!0)},drawBuffers:function(t,n){let i=u,r=!1;if(t){i=l.get(n),void 0===i&&(i=[],l.set(n,i));const o=t.textures;if(i.length!==o.length||i[0]!==e.COLOR_ATTACHMENT0){for(let t=0,n=o.length;t<n;t++)i[t]=e.COLOR_ATTACHMENT0+t;i.length=o.length,r=!0}}else i[0]!==e.BACK&&(i[0]=e.BACK,r=!0);r&&e.drawBuffers(i)},useProgram:function(t){return c!==t&&(e.useProgram(t),c=t,!0)},setBlending:G,setMaterial:function(r,o){2===r.side?H(e.CULL_FACE):B(e.CULL_FACE);let s=1===r.side;o&&(s=!s),W(s),1===r.blending&&!1===r.transparent?G(0):G(r.blending,r.blendEquation,r.blendSrc,r.blendDst,r.blendEquationAlpha,r.blendSrcAlpha,r.blendDstAlpha,r.blendColor,r.blendAlpha,r.premultipliedAlpha),n.setFunc(r.depthFunc),n.setTest(r.depthTest),n.setMask(r.depthWrite),t.setMask(r.colorWrite);const a=r.stencilWrite;i.setTest(a),a&&(i.setMask(r.stencilWriteMask),i.setFunc(r.stencilFunc,r.stencilRef,r.stencilFuncMask),i.setOp(r.stencilFail,r.stencilZFail,r.stencilZPass)),q(r.polygonOffset,r.polygonOffsetFactor,r.polygonOffsetUnits),!0===r.alphaToCoverage?B(e.SAMPLE_ALPHA_TO_COVERAGE):H(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:W,setCullFace:j,setLineWidth:function(t){t!==T&&(R&&e.lineWidth(t),T=t)},setPolygonOffset:q,setScissorTest:function(t){t?B(e.SCISSOR_TEST):H(e.SCISSOR_TEST)},activeTexture:function(t){void 0===t&&(t=e.TEXTURE0+A-1),P!==t&&(e.activeTexture(t),P=t)},bindTexture:function(t,n,i){void 0===i&&(i=null===P?e.TEXTURE0+A-1:P);let r=O[i];void 0===r&&(r={type:void 0,texture:void 0},O[i]=r),r.type===t&&r.texture===n||(P!==i&&(e.activeTexture(i),P=i),e.bindTexture(t,n||F[t]),r.type=t,r.texture=n)},unbindTexture:function(){const t=O[P];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexImage3D:function(){try{e.compressedTexImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},updateUBOMapping:function(t,n){let i=o.get(n);void 0===i&&(i=new WeakMap,o.set(n,i));let r=i.get(t);void 0===r&&(r=e.getUniformBlockIndex(n,t.name),i.set(t,r))},uniformBlockBinding:function(t,n){const i=o.get(n).get(t);r.get(n)!==i&&(e.uniformBlockBinding(n,i,t.__bindingPointIndex),r.set(n,i))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(t){!1===D.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),D.copy(t))},viewport:function(t){!1===U.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),U.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.blendColor(0,0,0,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),s={},P=null,O={},a={},l=new WeakMap,u=[],c=null,d=!1,h=null,p=null,f=null,m=null,g=null,v=null,_=null,y=new or(0,0,0),x=0,S=!1,E=null,b=null,T=null,w=null,M=null,D.set(0,0,e.canvas.width,e.canvas.height),U.set(0,0,e.canvas.width,e.canvas.height),t.reset(),n.reset(),i.reset()}}}function za(e,t,n,i){const r=function(e){switch(e){case Re:case Ce:return{byteLength:1,components:1};case Pe:case Ie:case De:return{byteLength:2,components:1};case Ue:case ke:return{byteLength:2,components:4};case Ne:case Oe:case Le:return{byteLength:4,components:1};case Be:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${e}.`)}(i);switch(n){case 1021:case 1024:return e*t;case 1025:return e*t*2;case Ge:case We:return e*t/r.components*r.byteLength;case 1030:case je:return e*t*2/r.components*r.byteLength;case 1022:return e*t*3/r.components*r.byteLength;case He:case qe:return e*t*4/r.components*r.byteLength;case Xe:case Ye:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case Ke:case Je:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case Ze:case et:return Math.max(e,16)*Math.max(t,8)/4;case $e:case Qe:return Math.max(e,8)*Math.max(t,8)/2;case tt:case nt:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case it:case rt:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case ot:return Math.floor((e+4)/5)*Math.floor((t+3)/4)*16;case st:return Math.floor((e+4)/5)*Math.floor((t+4)/5)*16;case at:return Math.floor((e+5)/6)*Math.floor((t+4)/5)*16;case lt:return Math.floor((e+5)/6)*Math.floor((t+5)/6)*16;case ut:return Math.floor((e+7)/8)*Math.floor((t+4)/5)*16;case ct:return Math.floor((e+7)/8)*Math.floor((t+5)/6)*16;case dt:return Math.floor((e+7)/8)*Math.floor((t+7)/8)*16;case ht:return Math.floor((e+9)/10)*Math.floor((t+4)/5)*16;case pt:return Math.floor((e+9)/10)*Math.floor((t+5)/6)*16;case ft:return Math.floor((e+9)/10)*Math.floor((t+7)/8)*16;case mt:return Math.floor((e+9)/10)*Math.floor((t+9)/10)*16;case gt:return Math.floor((e+11)/12)*Math.floor((t+9)/10)*16;case vt:return Math.floor((e+11)/12)*Math.floor((t+11)/12)*16;case _t:case yt:case xt:return Math.ceil(e/4)*Math.ceil(t/4)*16;case 36283:case St:return Math.ceil(e/4)*Math.ceil(t/4)*8;case Et:case bt:return Math.ceil(e/4)*Math.ceil(t/4)*16}throw new Error(`Unable to determine texture byte length for ${n} format.`)}function Ga(e,t,n,i,r,o,s){const a=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,l="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),u=new hn,c=new WeakMap;let d;const h=new WeakMap;let p=!1;try{p="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(V){}function f(e,t){return p?new OffscreenCanvas(e,t):gn("canvas")}function m(e,t,n){let i=1;const r=H(e);if((r.width>n||r.height>n)&&(i=n/Math.max(r.width,r.height)),i<1){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof VideoFrame&&e instanceof VideoFrame){const n=Math.floor(i*r.width),o=Math.floor(i*r.height);void 0===d&&(d=f(n,o));const s=t?f(n,o):d;s.width=n,s.height=o;return s.getContext("2d").drawImage(e,0,0,n,o),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+r.width+"x"+r.height+") to ("+n+"x"+o+")."),s}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+r.width+"x"+r.height+")."),e}return e}function g(e){return e.generateMipmaps&&e.minFilter!==Ee&&e.minFilter!==we}function v(t){e.generateMipmap(t)}function _(n,i,r,o,s=!1){if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let a=i;if(i===e.RED&&(r===e.FLOAT&&(a=e.R32F),r===e.HALF_FLOAT&&(a=e.R16F),r===e.UNSIGNED_BYTE&&(a=e.R8)),i===e.RED_INTEGER&&(r===e.UNSIGNED_BYTE&&(a=e.R8UI),r===e.UNSIGNED_SHORT&&(a=e.R16UI),r===e.UNSIGNED_INT&&(a=e.R32UI),r===e.BYTE&&(a=e.R8I),r===e.SHORT&&(a=e.R16I),r===e.INT&&(a=e.R32I)),i===e.RG&&(r===e.FLOAT&&(a=e.RG32F),r===e.HALF_FLOAT&&(a=e.RG16F),r===e.UNSIGNED_BYTE&&(a=e.RG8)),i===e.RG_INTEGER&&(r===e.UNSIGNED_BYTE&&(a=e.RG8UI),r===e.UNSIGNED_SHORT&&(a=e.RG16UI),r===e.UNSIGNED_INT&&(a=e.RG32UI),r===e.BYTE&&(a=e.RG8I),r===e.SHORT&&(a=e.RG16I),r===e.INT&&(a=e.RG32I)),i===e.RGB&&r===e.UNSIGNED_INT_5_9_9_9_REV&&(a=e.RGB9_E5),i===e.RGBA){const t=s?Ut:Tn.getTransfer(o);r===e.FLOAT&&(a=e.RGBA32F),r===e.HALF_FLOAT&&(a=e.RGBA16F),r===e.UNSIGNED_BYTE&&(a=t===kt?e.SRGB8_ALPHA8:e.RGBA8),r===e.UNSIGNED_SHORT_4_4_4_4&&(a=e.RGBA4),r===e.UNSIGNED_SHORT_5_5_5_1&&(a=e.RGB5_A1)}return a!==e.R16F&&a!==e.R32F&&a!==e.RG16F&&a!==e.RG32F&&a!==e.RGBA16F&&a!==e.RGBA32F||t.get("EXT_color_buffer_float"),a}function y(t,n){let i;return t?null===n||n===Ne||n===Fe?i=e.DEPTH24_STENCIL8:n===Le?i=e.DEPTH32F_STENCIL8:n===Pe&&(i=e.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):null===n||n===Ne||n===Fe?i=e.DEPTH_COMPONENT24:n===Le?i=e.DEPTH_COMPONENT32F:n===Pe&&(i=e.DEPTH_COMPONENT16),i}function x(e,t){return!0===g(e)||e.isFramebufferTexture&&e.minFilter!==Ee&&e.minFilter!==we?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function S(e){const t=e.target;t.removeEventListener("dispose",S),function(e){const t=i.get(e);if(void 0===t.__webglInit)return;const n=e.source,r=h.get(n);if(r){const i=r[t.__cacheKey];i.usedTimes--,0===i.usedTimes&&b(e),0===Object.keys(r).length&&h.delete(n)}i.remove(e)}(t),t.isVideoTexture&&c.delete(t)}function E(t){const n=t.target;n.removeEventListener("dispose",E),function(t){const n=i.get(t);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(let i=0;i<6;i++){if(Array.isArray(n.__webglFramebuffer[i]))for(let t=0;t<n.__webglFramebuffer[i].length;t++)e.deleteFramebuffer(n.__webglFramebuffer[i][t]);else e.deleteFramebuffer(n.__webglFramebuffer[i]);n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[i])}else{if(Array.isArray(n.__webglFramebuffer))for(let t=0;t<n.__webglFramebuffer.length;t++)e.deleteFramebuffer(n.__webglFramebuffer[t]);else e.deleteFramebuffer(n.__webglFramebuffer);if(n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&e.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer)for(let t=0;t<n.__webglColorRenderbuffer.length;t++)n.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(n.__webglColorRenderbuffer[t]);n.__webglDepthRenderbuffer&&e.deleteRenderbuffer(n.__webglDepthRenderbuffer)}const r=t.textures;for(let o=0,a=r.length;o<a;o++){const t=i.get(r[o]);t.__webglTexture&&(e.deleteTexture(t.__webglTexture),s.memory.textures--),i.remove(r[o])}i.remove(t)}(n)}function b(t){const n=i.get(t);e.deleteTexture(n.__webglTexture);const r=t.source;delete h.get(r)[n.__cacheKey],s.memory.textures--}let T=0;function w(t,r){const o=i.get(t);if(t.isVideoTexture&&function(e){const t=s.render.frame;c.get(e)!==t&&(c.set(e,t),e.update())}(t),!1===t.isRenderTargetTexture&&t.version>0&&o.__version!==t.version){const e=t.image;if(null===e)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==e.complete)return void P(o,t,r);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.bindTexture(e.TEXTURE_2D,o.__webglTexture,e.TEXTURE0+r)}const M={[ye]:e.REPEAT,[xe]:e.CLAMP_TO_EDGE,[Se]:e.MIRRORED_REPEAT},A={[Ee]:e.NEAREST,[be]:e.NEAREST_MIPMAP_NEAREST,[Te]:e.NEAREST_MIPMAP_LINEAR,[we]:e.LINEAR,[Me]:e.LINEAR_MIPMAP_NEAREST,[Ae]:e.LINEAR_MIPMAP_LINEAR},R={[Vt]:e.NEVER,[Yt]:e.ALWAYS,[zt]:e.LESS,[Wt]:e.LEQUAL,[Gt]:e.EQUAL,[Xt]:e.GEQUAL,[jt]:e.GREATER,[qt]:e.NOTEQUAL};function C(n,o){if(o.type!==Le||!1!==t.has("OES_texture_float_linear")||o.magFilter!==we&&o.magFilter!==Me&&o.magFilter!==Te&&o.magFilter!==Ae&&o.minFilter!==we&&o.minFilter!==Me&&o.minFilter!==Te&&o.minFilter!==Ae||console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),e.texParameteri(n,e.TEXTURE_WRAP_S,M[o.wrapS]),e.texParameteri(n,e.TEXTURE_WRAP_T,M[o.wrapT]),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,M[o.wrapR]),e.texParameteri(n,e.TEXTURE_MAG_FILTER,A[o.magFilter]),e.texParameteri(n,e.TEXTURE_MIN_FILTER,A[o.minFilter]),o.compareFunction&&(e.texParameteri(n,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(n,e.TEXTURE_COMPARE_FUNC,R[o.compareFunction])),!0===t.has("EXT_texture_filter_anisotropic")){if(o.magFilter===Ee)return;if(o.minFilter!==Te&&o.minFilter!==Ae)return;if(o.type===Le&&!1===t.has("OES_texture_float_linear"))return;if(o.anisotropy>1||i.get(o).__currentAnisotropy){const s=t.get("EXT_texture_filter_anisotropic");e.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,r.getMaxAnisotropy())),i.get(o).__currentAnisotropy=o.anisotropy}}}function I(t,n){let i=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",S));const r=n.source;let o=h.get(r);void 0===o&&(o={},h.set(r,o));const a=function(e){const t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.colorSpace),t.join()}(n);if(a!==t.__cacheKey){void 0===o[a]&&(o[a]={texture:e.createTexture(),usedTimes:0},s.memory.textures++,i=!0),o[a].usedTimes++;const r=o[t.__cacheKey];void 0!==r&&(o[t.__cacheKey].usedTimes--,0===r.usedTimes&&b(n)),t.__cacheKey=a,t.__webglTexture=o[a].texture}return i}function P(t,s,a){let l=e.TEXTURE_2D;(s.isDataArrayTexture||s.isCompressedArrayTexture)&&(l=e.TEXTURE_2D_ARRAY),s.isData3DTexture&&(l=e.TEXTURE_3D);const u=I(t,s),c=s.source;n.bindTexture(l,t.__webglTexture,e.TEXTURE0+a);const d=i.get(c);if(c.version!==d.__version||!0===u){n.activeTexture(e.TEXTURE0+a);const t=Tn.getPrimaries(Tn.workingColorSpace),i=s.colorSpace===Pt?null:Tn.getPrimaries(s.colorSpace),h=s.colorSpace===Pt||t===i?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,s.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,s.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,h);let p=m(s.image,!1,r.maxTextureSize);p=B(s,p);const f=o.convert(s.format,s.colorSpace),S=o.convert(s.type);let E,b=_(s.internalFormat,f,S,s.colorSpace,s.isVideoTexture);C(l,s);const T=s.mipmaps,w=!0!==s.isVideoTexture,M=void 0===d.__version||!0===u,A=c.dataReady,R=x(s,p);if(s.isDepthTexture)b=y(s.format===ze,s.type),M&&(w?n.texStorage2D(e.TEXTURE_2D,1,b,p.width,p.height):n.texImage2D(e.TEXTURE_2D,0,b,p.width,p.height,0,f,S,null));else if(s.isDataTexture)if(T.length>0){w&&M&&n.texStorage2D(e.TEXTURE_2D,R,b,T[0].width,T[0].height);for(let t=0,i=T.length;t<i;t++)E=T[t],w?A&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,E.width,E.height,f,S,E.data):n.texImage2D(e.TEXTURE_2D,t,b,E.width,E.height,0,f,S,E.data);s.generateMipmaps=!1}else w?(M&&n.texStorage2D(e.TEXTURE_2D,R,b,p.width,p.height),A&&n.texSubImage2D(e.TEXTURE_2D,0,0,0,p.width,p.height,f,S,p.data)):n.texImage2D(e.TEXTURE_2D,0,b,p.width,p.height,0,f,S,p.data);else if(s.isCompressedTexture)if(s.isCompressedArrayTexture){w&&M&&n.texStorage3D(e.TEXTURE_2D_ARRAY,R,b,T[0].width,T[0].height,p.depth);for(let t=0,i=T.length;t<i;t++)if(E=T[t],s.format!==He)if(null!==f)if(w){if(A)if(s.layerUpdates.size>0){const i=za(E.width,E.height,s.format,s.type);for(const r of s.layerUpdates){const o=E.data.subarray(r*i/E.data.BYTES_PER_ELEMENT,(r+1)*i/E.data.BYTES_PER_ELEMENT);n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,r,E.width,E.height,1,f,o,0,0)}s.clearLayerUpdates()}else n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,E.width,E.height,p.depth,f,E.data,0,0)}else n.compressedTexImage3D(e.TEXTURE_2D_ARRAY,t,b,E.width,E.height,p.depth,0,E.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else w?A&&n.texSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,E.width,E.height,p.depth,f,S,E.data):n.texImage3D(e.TEXTURE_2D_ARRAY,t,b,E.width,E.height,p.depth,0,f,S,E.data)}else{w&&M&&n.texStorage2D(e.TEXTURE_2D,R,b,T[0].width,T[0].height);for(let t=0,i=T.length;t<i;t++)E=T[t],s.format!==He?null!==f?w?A&&n.compressedTexSubImage2D(e.TEXTURE_2D,t,0,0,E.width,E.height,f,E.data):n.compressedTexImage2D(e.TEXTURE_2D,t,b,E.width,E.height,0,E.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):w?A&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,E.width,E.height,f,S,E.data):n.texImage2D(e.TEXTURE_2D,t,b,E.width,E.height,0,f,S,E.data)}else if(s.isDataArrayTexture)if(w){if(M&&n.texStorage3D(e.TEXTURE_2D_ARRAY,R,b,p.width,p.height,p.depth),A)if(s.layerUpdates.size>0){const t=za(p.width,p.height,s.format,s.type);for(const i of s.layerUpdates){const r=p.data.subarray(i*t/p.data.BYTES_PER_ELEMENT,(i+1)*t/p.data.BYTES_PER_ELEMENT);n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,i,p.width,p.height,1,f,S,r)}s.clearLayerUpdates()}else n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,p.width,p.height,p.depth,f,S,p.data)}else n.texImage3D(e.TEXTURE_2D_ARRAY,0,b,p.width,p.height,p.depth,0,f,S,p.data);else if(s.isData3DTexture)w?(M&&n.texStorage3D(e.TEXTURE_3D,R,b,p.width,p.height,p.depth),A&&n.texSubImage3D(e.TEXTURE_3D,0,0,0,0,p.width,p.height,p.depth,f,S,p.data)):n.texImage3D(e.TEXTURE_3D,0,b,p.width,p.height,p.depth,0,f,S,p.data);else if(s.isFramebufferTexture){if(M)if(w)n.texStorage2D(e.TEXTURE_2D,R,b,p.width,p.height);else{let t=p.width,i=p.height;for(let r=0;r<R;r++)n.texImage2D(e.TEXTURE_2D,r,b,t,i,0,f,S,null),t>>=1,i>>=1}}else if(T.length>0){if(w&&M){const t=H(T[0]);n.texStorage2D(e.TEXTURE_2D,R,b,t.width,t.height)}for(let t=0,i=T.length;t<i;t++)E=T[t],w?A&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,f,S,E):n.texImage2D(e.TEXTURE_2D,t,b,f,S,E);s.generateMipmaps=!1}else if(w){if(M){const t=H(p);n.texStorage2D(e.TEXTURE_2D,R,b,t.width,t.height)}A&&n.texSubImage2D(e.TEXTURE_2D,0,0,0,f,S,p)}else n.texImage2D(e.TEXTURE_2D,0,b,f,S,p);g(s)&&v(l),d.__version=c.version,s.onUpdate&&s.onUpdate(s)}t.__version=s.version}function O(t,r,s,l,u,c){const d=o.convert(s.format,s.colorSpace),h=o.convert(s.type),p=_(s.internalFormat,d,h,s.colorSpace);if(!i.get(r).__hasExternalTextures){const t=Math.max(1,r.width>>c),i=Math.max(1,r.height>>c);u===e.TEXTURE_3D||u===e.TEXTURE_2D_ARRAY?n.texImage3D(u,c,p,t,i,r.depth,0,d,h,null):n.texImage2D(u,c,p,t,i,0,d,h,null)}n.bindFramebuffer(e.FRAMEBUFFER,t),F(r)?a.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,l,u,i.get(s).__webglTexture,0,k(r)):(u===e.TEXTURE_2D||u>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&u<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,l,u,i.get(s).__webglTexture,c),n.bindFramebuffer(e.FRAMEBUFFER,null)}function N(t,n,i){if(e.bindRenderbuffer(e.RENDERBUFFER,t),n.depthBuffer){const r=n.depthTexture,o=r&&r.isDepthTexture?r.type:null,s=y(n.stencilBuffer,o),l=n.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,u=k(n);F(n)?a.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,u,s,n.width,n.height):i?e.renderbufferStorageMultisample(e.RENDERBUFFER,u,s,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,s,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,l,e.RENDERBUFFER,t)}else{const t=n.textures;for(let r=0;r<t.length;r++){const s=t[r],l=o.convert(s.format,s.colorSpace),u=o.convert(s.type),c=_(s.internalFormat,l,u,s.colorSpace),d=k(n);i&&!1===F(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,d,c,n.width,n.height):F(n)?a.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,d,c,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,c,n.width,n.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function L(t){const r=i.get(t),o=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!r.__autoAllocateDepthBuffer){if(o)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(e.FRAMEBUFFER,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),w(r.depthTexture,0);const o=i.get(r.depthTexture).__webglTexture,s=k(r);if(r.depthTexture.format===Ve)F(r)?a.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,o,0,s):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,o,0);else{if(r.depthTexture.format!==ze)throw new Error("Unknown depthTexture format");F(r)?a.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,o,0,s):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,o,0)}}(r.__webglFramebuffer,t)}else if(o){r.__webglDepthbuffer=[];for(let i=0;i<6;i++)n.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer[i]),r.__webglDepthbuffer[i]=e.createRenderbuffer(),N(r.__webglDepthbuffer[i],t,!1)}else n.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),N(r.__webglDepthbuffer,t,!1);n.bindFramebuffer(e.FRAMEBUFFER,null)}const D=[],U=[];function k(e){return Math.min(r.maxSamples,e.samples)}function F(e){const n=i.get(e);return e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function B(e,t){const n=e.colorSpace,i=e.format,r=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||n!==Nt&&n!==Pt&&(Tn.getTransfer(n)===kt?i===He&&r===Re||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",n)),t}function H(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement?(u.width=e.naturalWidth||e.width,u.height=e.naturalHeight||e.height):"undefined"!=typeof VideoFrame&&e instanceof VideoFrame?(u.width=e.displayWidth,u.height=e.displayHeight):(u.width=e.width,u.height=e.height),u}this.allocateTextureUnit=function(){const e=T;return e>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+r.maxTextures),T+=1,e},this.resetTextureUnits=function(){T=0},this.setTexture2D=w,this.setTexture2DArray=function(t,r){const o=i.get(t);t.version>0&&o.__version!==t.version?P(o,t,r):n.bindTexture(e.TEXTURE_2D_ARRAY,o.__webglTexture,e.TEXTURE0+r)},this.setTexture3D=function(t,r){const o=i.get(t);t.version>0&&o.__version!==t.version?P(o,t,r):n.bindTexture(e.TEXTURE_3D,o.__webglTexture,e.TEXTURE0+r)},this.setTextureCube=function(t,s){const a=i.get(t);t.version>0&&a.__version!==t.version?function(t,s,a){if(6!==s.image.length)return;const l=I(t,s),u=s.source;n.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture,e.TEXTURE0+a);const c=i.get(u);if(u.version!==c.__version||!0===l){n.activeTexture(e.TEXTURE0+a);const t=Tn.getPrimaries(Tn.workingColorSpace),i=s.colorSpace===Pt?null:Tn.getPrimaries(s.colorSpace),d=s.colorSpace===Pt||t===i?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,s.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,s.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,d);const h=s.isCompressedTexture||s.image[0].isCompressedTexture,p=s.image[0]&&s.image[0].isDataTexture,f=[];for(let e=0;e<6;e++)f[e]=h||p?p?s.image[e].image:s.image[e]:m(s.image[e],!0,r.maxCubemapSize),f[e]=B(s,f[e]);const y=f[0],S=o.convert(s.format,s.colorSpace),E=o.convert(s.type),b=_(s.internalFormat,S,E,s.colorSpace),T=!0!==s.isVideoTexture,w=void 0===c.__version||!0===l,M=u.dataReady;let A,R=x(s,y);if(C(e.TEXTURE_CUBE_MAP,s),h){T&&w&&n.texStorage2D(e.TEXTURE_CUBE_MAP,R,b,y.width,y.height);for(let t=0;t<6;t++){A=f[t].mipmaps;for(let i=0;i<A.length;i++){const r=A[i];s.format!==He?null!==S?T?M&&n.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,0,0,r.width,r.height,S,r.data):n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,b,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):T?M&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,0,0,r.width,r.height,S,E,r.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,b,r.width,r.height,0,S,E,r.data)}}}else{if(A=s.mipmaps,T&&w){A.length>0&&R++;const t=H(f[0]);n.texStorage2D(e.TEXTURE_CUBE_MAP,R,b,t.width,t.height)}for(let t=0;t<6;t++)if(p){T?M&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,f[t].width,f[t].height,S,E,f[t].data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,b,f[t].width,f[t].height,0,S,E,f[t].data);for(let i=0;i<A.length;i++){const r=A[i].image[t].image;T?M&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,0,0,r.width,r.height,S,E,r.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,b,r.width,r.height,0,S,E,r.data)}}else{T?M&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,S,E,f[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,b,S,E,f[t]);for(let i=0;i<A.length;i++){const r=A[i];T?M&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,0,0,S,E,r.image[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,b,S,E,r.image[t])}}}g(s)&&v(e.TEXTURE_CUBE_MAP),c.__version=u.version,s.onUpdate&&s.onUpdate(s)}t.__version=s.version}(a,t,s):n.bindTexture(e.TEXTURE_CUBE_MAP,a.__webglTexture,e.TEXTURE0+s)},this.rebindTextures=function(t,n,r){const o=i.get(t);void 0!==n&&O(o.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),void 0!==r&&L(t)},this.setupRenderTarget=function(t){const r=t.texture,a=i.get(t),l=i.get(r);t.addEventListener("dispose",E);const u=t.textures,c=!0===t.isWebGLCubeRenderTarget,d=u.length>1;if(d||(void 0===l.__webglTexture&&(l.__webglTexture=e.createTexture()),l.__version=r.version,s.memory.textures++),c){a.__webglFramebuffer=[];for(let t=0;t<6;t++)if(r.mipmaps&&r.mipmaps.length>0){a.__webglFramebuffer[t]=[];for(let n=0;n<r.mipmaps.length;n++)a.__webglFramebuffer[t][n]=e.createFramebuffer()}else a.__webglFramebuffer[t]=e.createFramebuffer()}else{if(r.mipmaps&&r.mipmaps.length>0){a.__webglFramebuffer=[];for(let t=0;t<r.mipmaps.length;t++)a.__webglFramebuffer[t]=e.createFramebuffer()}else a.__webglFramebuffer=e.createFramebuffer();if(d)for(let t=0,n=u.length;t<n;t++){const n=i.get(u[t]);void 0===n.__webglTexture&&(n.__webglTexture=e.createTexture(),s.memory.textures++)}if(t.samples>0&&!1===F(t)){a.__webglMultisampledFramebuffer=e.createFramebuffer(),a.__webglColorRenderbuffer=[],n.bindFramebuffer(e.FRAMEBUFFER,a.__webglMultisampledFramebuffer);for(let n=0;n<u.length;n++){const i=u[n];a.__webglColorRenderbuffer[n]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,a.__webglColorRenderbuffer[n]);const r=o.convert(i.format,i.colorSpace),s=o.convert(i.type),l=_(i.internalFormat,r,s,i.colorSpace,!0===t.isXRRenderTarget),c=k(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,c,l,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+n,e.RENDERBUFFER,a.__webglColorRenderbuffer[n])}e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(a.__webglDepthRenderbuffer=e.createRenderbuffer(),N(a.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(e.FRAMEBUFFER,null)}}if(c){n.bindTexture(e.TEXTURE_CUBE_MAP,l.__webglTexture),C(e.TEXTURE_CUBE_MAP,r);for(let n=0;n<6;n++)if(r.mipmaps&&r.mipmaps.length>0)for(let i=0;i<r.mipmaps.length;i++)O(a.__webglFramebuffer[n][i],t,r,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,i);else O(a.__webglFramebuffer[n],t,r,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0);g(r)&&v(e.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(d){for(let r=0,o=u.length;r<o;r++){const o=u[r],s=i.get(o);n.bindTexture(e.TEXTURE_2D,s.__webglTexture),C(e.TEXTURE_2D,o),O(a.__webglFramebuffer,t,o,e.COLOR_ATTACHMENT0+r,e.TEXTURE_2D,0),g(o)&&v(e.TEXTURE_2D)}n.unbindTexture()}else{let i=e.TEXTURE_2D;if((t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(i=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY),n.bindTexture(i,l.__webglTexture),C(i,r),r.mipmaps&&r.mipmaps.length>0)for(let n=0;n<r.mipmaps.length;n++)O(a.__webglFramebuffer[n],t,r,e.COLOR_ATTACHMENT0,i,n);else O(a.__webglFramebuffer,t,r,e.COLOR_ATTACHMENT0,i,0);g(r)&&v(i),n.unbindTexture()}t.depthBuffer&&L(t)},this.updateRenderTargetMipmap=function(t){const r=t.textures;for(let o=0,s=r.length;o<s;o++){const s=r[o];if(g(s)){const r=t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,o=i.get(s).__webglTexture;n.bindTexture(r,o),v(r),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(t.samples>0)if(!1===F(t)){const r=t.textures,o=t.width,s=t.height;let a=e.COLOR_BUFFER_BIT;const u=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,c=i.get(t),d=r.length>1;if(d)for(let t=0;t<r.length;t++)n.bindFramebuffer(e.FRAMEBUFFER,c.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,null),n.bindFramebuffer(e.FRAMEBUFFER,c.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,null,0);n.bindFramebuffer(e.READ_FRAMEBUFFER,c.__webglMultisampledFramebuffer),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,c.__webglFramebuffer);for(let n=0;n<r.length;n++){if(t.resolveDepthBuffer&&(t.depthBuffer&&(a|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&t.resolveStencilBuffer&&(a|=e.STENCIL_BUFFER_BIT)),d){e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,c.__webglColorRenderbuffer[n]);const t=i.get(r[n]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}e.blitFramebuffer(0,0,o,s,0,0,o,s,a,e.NEAREST),!0===l&&(D.length=0,U.length=0,D.push(e.COLOR_ATTACHMENT0+n),t.depthBuffer&&!1===t.resolveDepthBuffer&&(D.push(u),U.push(u),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,U)),e.invalidateFramebuffer(e.READ_FRAMEBUFFER,D))}if(n.bindFramebuffer(e.READ_FRAMEBUFFER,null),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),d)for(let t=0;t<r.length;t++){n.bindFramebuffer(e.FRAMEBUFFER,c.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,c.__webglColorRenderbuffer[t]);const o=i.get(r[t]).__webglTexture;n.bindFramebuffer(e.FRAMEBUFFER,c.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,o,0)}n.bindFramebuffer(e.DRAW_FRAMEBUFFER,c.__webglMultisampledFramebuffer)}else if(t.depthBuffer&&!1===t.resolveDepthBuffer&&l){const n=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[n])}},this.setupDepthRenderbuffer=L,this.setupFrameBufferTexture=O,this.useMultisampledRTT=F}function Wa(e,t){return{convert:function(n,i=""){let r;const o=Tn.getTransfer(i);if(n===Re)return e.UNSIGNED_BYTE;if(n===Ue)return e.UNSIGNED_SHORT_4_4_4_4;if(n===ke)return e.UNSIGNED_SHORT_5_5_5_1;if(n===Be)return e.UNSIGNED_INT_5_9_9_9_REV;if(n===Ce)return e.BYTE;if(n===Ie)return e.SHORT;if(n===Pe)return e.UNSIGNED_SHORT;if(n===Oe)return e.INT;if(n===Ne)return e.UNSIGNED_INT;if(n===Le)return e.FLOAT;if(n===De)return e.HALF_FLOAT;if(1021===n)return e.ALPHA;if(1022===n)return e.RGB;if(n===He)return e.RGBA;if(1024===n)return e.LUMINANCE;if(1025===n)return e.LUMINANCE_ALPHA;if(n===Ve)return e.DEPTH_COMPONENT;if(n===ze)return e.DEPTH_STENCIL;if(n===Ge)return e.RED;if(n===We)return e.RED_INTEGER;if(1030===n)return e.RG;if(n===je)return e.RG_INTEGER;if(n===qe)return e.RGBA_INTEGER;if(n===Xe||n===Ye||n===Ke||n===Je)if(o===kt){if(r=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===r)return null;if(n===Xe)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===Ye)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===Ke)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===Je)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(r=t.get("WEBGL_compressed_texture_s3tc"),null===r)return null;if(n===Xe)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===Ye)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===Ke)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===Je)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===$e||n===Ze||n===Qe||n===et){if(r=t.get("WEBGL_compressed_texture_pvrtc"),null===r)return null;if(n===$e)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===Ze)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===Qe)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===et)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===tt||n===nt||n===it){if(r=t.get("WEBGL_compressed_texture_etc"),null===r)return null;if(n===tt||n===nt)return o===kt?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(n===it)return o===kt?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}if(n===rt||n===ot||n===st||n===at||n===lt||n===ut||n===ct||n===dt||n===ht||n===pt||n===ft||n===mt||n===gt||n===vt){if(r=t.get("WEBGL_compressed_texture_astc"),null===r)return null;if(n===rt)return o===kt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===ot)return o===kt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===st)return o===kt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===at)return o===kt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===lt)return o===kt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===ut)return o===kt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===ct)return o===kt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===dt)return o===kt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===ht)return o===kt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===pt)return o===kt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===ft)return o===kt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===mt)return o===kt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===gt)return o===kt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===vt)return o===kt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===_t||n===yt||n===xt){if(r=t.get("EXT_texture_compression_bptc"),null===r)return null;if(n===_t)return o===kt?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===yt)return r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===xt)return r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(36283===n||n===St||n===Et||n===bt){if(r=t.get("EXT_texture_compression_rgtc"),null===r)return null;if(n===_t)return r.COMPRESSED_RED_RGTC1_EXT;if(n===St)return r.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===Et)return r.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===bt)return r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===Fe?e.UNSIGNED_INT_24_8:void 0!==e[n]?e[n]:null}}}class ja extends Qr{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class qa extends Gi{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Xa={type:"move"};class Ya{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new qa,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new qa,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Hn,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Hn),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new qa,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Hn,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Hn),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let i=null,r=null,o=null;const s=this._targetRay,a=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){o=!0;for(const o of e.hand.values()){const e=t.getJointPose(o,n),i=this._getHandJoint(l,o);null!==e&&(i.matrix.fromArray(e.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.matrixWorldNeedsUpdate=!0,i.jointRadius=e.radius),i.visible=null!==e}const i=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],s=i.position.distanceTo(r.position),a=.02,u=.005;l.inputState.pinching&&s>a+u?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&s<=a-u&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==a&&e.gripSpace&&(r=t.getPose(e.gripSpace,n),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1));null!==s&&(i=t.getPose(e.targetRaySpace,n),null===i&&null!==r&&(i=r),null!==i&&(s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,i.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(i.linearVelocity)):s.hasLinearVelocity=!1,i.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(i.angularVelocity)):s.hasAngularVelocity=!1,this.dispatchEvent(Xa)))}return null!==s&&(s.visible=null!==i),null!==a&&(a.visible=null!==r),null!==l&&(l.visible=null!==o),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const n=new qa;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class Ka{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,n){if(null===this.texture){const i=new Nn;e.properties.get(i).__webglTexture=t.texture,t.depthNear==n.depthNear&&t.depthFar==n.depthFar||(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=i}}getMesh(e){if(null!==this.texture&&null===this.mesh){const t=e.cameras[0].viewport,n=new Yr({vertexShader:"\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}",fragmentShader:"\nuniform sampler2DArray depthColor;\nuniform float depthWidth;\nuniform float depthHeight;\n\nvoid main() {\n\n\tvec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );\n\n\tif ( coord.x >= 1.0 ) {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;\n\n\t} else {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;\n\n\t}\n\n}",uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new Vr(new fo(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class Ja extends Qt{constructor(e,t){super();const n=this;let i=null,r=1,o=null,s="local-floor",a=1,l=null,u=null,c=null,d=null,h=null,p=null;const f=new Ka,m=t.getContextAttributes();let g=null,v=null;const _=[],y=[],x=new hn;let S=null;const E=new Qr;E.layers.enable(1),E.viewport=new Ln;const b=new Qr;b.layers.enable(2),b.viewport=new Ln;const T=[E,b],w=new ja;w.layers.enable(1),w.layers.enable(2);let M=null,A=null;function R(e){const t=y.indexOf(e.inputSource);if(-1===t)return;const n=_[t];void 0!==n&&(n.update(e.inputSource,e.frame,l||o),n.dispatchEvent({type:e.type,data:e.inputSource}))}function C(){i.removeEventListener("select",R),i.removeEventListener("selectstart",R),i.removeEventListener("selectend",R),i.removeEventListener("squeeze",R),i.removeEventListener("squeezestart",R),i.removeEventListener("squeezeend",R),i.removeEventListener("end",C),i.removeEventListener("inputsourceschange",I);for(let e=0;e<_.length;e++){const t=y[e];null!==t&&(y[e]=null,_[e].disconnect(t))}M=null,A=null,f.reset(),e.setRenderTarget(g),h=null,d=null,c=null,i=null,v=null,D.stop(),n.isPresenting=!1,e.setPixelRatio(S),e.setSize(x.width,x.height,!1),n.dispatchEvent({type:"sessionend"})}function I(e){for(let t=0;t<e.removed.length;t++){const n=e.removed[t],i=y.indexOf(n);i>=0&&(y[i]=null,_[i].disconnect(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t];let i=y.indexOf(n);if(-1===i){for(let e=0;e<_.length;e++){if(e>=y.length){y.push(n),i=e;break}if(null===y[e]){y[e]=n,i=e;break}}if(-1===i)break}const r=_[i];r&&r.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=_[e];return void 0===t&&(t=new Ya,_[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=_[e];return void 0===t&&(t=new Ya,_[e]=t),t.getGripSpace()},this.getHand=function(e){let t=_[e];return void 0===t&&(t=new Ya,_[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){r=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){s=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||o},this.setReferenceSpace=function(e){l=e},this.getBaseLayer=function(){return null!==d?d:h},this.getBinding=function(){return c},this.getFrame=function(){return p},this.getSession=function(){return i},this.setSession=async function(u){if(i=u,null!==i){if(g=e.getRenderTarget(),i.addEventListener("select",R),i.addEventListener("selectstart",R),i.addEventListener("selectend",R),i.addEventListener("squeeze",R),i.addEventListener("squeezestart",R),i.addEventListener("squeezeend",R),i.addEventListener("end",C),i.addEventListener("inputsourceschange",I),!0!==m.xrCompatible&&await t.makeXRCompatible(),S=e.getPixelRatio(),e.getSize(x),void 0===i.renderState.layers){const n={antialias:m.antialias,alpha:!0,depth:m.depth,stencil:m.stencil,framebufferScaleFactor:r};h=new XRWebGLLayer(i,t,n),i.updateRenderState({baseLayer:h}),e.setPixelRatio(1),e.setSize(h.framebufferWidth,h.framebufferHeight,!1),v=new Un(h.framebufferWidth,h.framebufferHeight,{format:He,type:Re,colorSpace:e.outputColorSpace,stencilBuffer:m.stencil})}else{let n=null,o=null,s=null;m.depth&&(s=m.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,n=m.stencil?ze:Ve,o=m.stencil?Fe:Ne);const a={colorFormat:t.RGBA8,depthFormat:s,scaleFactor:r};c=new XRWebGLBinding(i,t),d=c.createProjectionLayer(a),i.updateRenderState({layers:[d]}),e.setPixelRatio(1),e.setSize(d.textureWidth,d.textureHeight,!1),v=new Un(d.textureWidth,d.textureHeight,{format:He,type:Re,depthTexture:new Zo(d.textureWidth,d.textureHeight,o,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:m.stencil,colorSpace:e.outputColorSpace,samples:m.antialias?4:0,resolveDepthBuffer:!1===d.ignoreDepthValues})}v.isXRRenderTarget=!0,this.setFoveation(a),l=null,o=await i.requestReferenceSpace(s),D.setContext(i),D.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==i)return i.environmentBlendMode},this.getDepthTexture=function(){return f.getDepthTexture()};const P=new Hn,O=new Hn;function N(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===i)return;null!==f.texture&&(e.near=f.depthNear,e.far=f.depthFar),w.near=b.near=E.near=e.near,w.far=b.far=E.far=e.far,M===w.near&&A===w.far||(i.updateRenderState({depthNear:w.near,depthFar:w.far}),M=w.near,A=w.far,E.near=M,E.far=A,b.near=M,b.far=A,E.updateProjectionMatrix(),b.updateProjectionMatrix(),e.updateProjectionMatrix());const t=e.parent,n=w.cameras;N(w,t);for(let i=0;i<n.length;i++)N(n[i],t);2===n.length?function(e,t,n){P.setFromMatrixPosition(t.matrixWorld),O.setFromMatrixPosition(n.matrixWorld);const i=P.distanceTo(O),r=t.projectionMatrix.elements,o=n.projectionMatrix.elements,s=r[14]/(r[10]-1),a=r[14]/(r[10]+1),l=(r[9]+1)/r[5],u=(r[9]-1)/r[5],c=(r[8]-1)/r[0],d=(o[8]+1)/o[0],h=s*c,p=s*d,f=i/(-c+d),m=f*-c;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const g=s+f,v=a+f,_=h-m,y=p+(i-m),x=l*a/v*g,S=u*a/v*g;e.projectionMatrix.makePerspective(_,y,x,S,g,v),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}(w,E,b):w.projectionMatrix.copy(E.projectionMatrix),function(e,t,n){null===n?e.matrix.copy(t.matrixWorld):(e.matrix.copy(n.matrixWorld),e.matrix.invert(),e.matrix.multiply(t.matrixWorld));e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0),e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse),e.isPerspectiveCamera&&(e.fov=2*rn*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)}(e,w,t)},this.getCamera=function(){return w},this.getFoveation=function(){if(null!==d||null!==h)return a},this.setFoveation=function(e){a=e,null!==d&&(d.fixedFoveation=e),null!==h&&void 0!==h.fixedFoveation&&(h.fixedFoveation=e)},this.hasDepthSensing=function(){return null!==f.texture},this.getDepthSensingMesh=function(){return f.getMesh(w)};let L=null;const D=new ho;D.setAnimationLoop(function(t,r){if(u=r.getViewerPose(l||o),p=r,null!==u){const t=u.views;null!==h&&(e.setRenderTargetFramebuffer(v,h.framebuffer),e.setRenderTarget(v));let n=!1;t.length!==w.cameras.length&&(w.cameras.length=0,n=!0);for(let i=0;i<t.length;i++){const r=t[i];let o=null;if(null!==h)o=h.getViewport(r);else{const t=c.getViewSubImage(d,r);o=t.viewport,0===i&&(e.setRenderTargetTextures(v,t.colorTexture,d.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(v))}let s=T[i];void 0===s&&(s=new Qr,s.layers.enable(i),s.viewport=new Ln,T[i]=s),s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.quaternion,s.scale),s.projectionMatrix.fromArray(r.projectionMatrix),s.projectionMatrixInverse.copy(s.projectionMatrix).invert(),s.viewport.set(o.x,o.y,o.width,o.height),0===i&&(w.matrix.copy(s.matrix),w.matrix.decompose(w.position,w.quaternion,w.scale)),!0===n&&w.cameras.push(s)}const r=i.enabledFeatures;if(r&&r.includes("depth-sensing")){const n=c.getDepthInformation(t[0]);n&&n.isValid&&n.texture&&f.init(e,n,i.renderState)}}for(let e=0;e<_.length;e++){const t=y[e],n=_[e];null!==t&&void 0!==n&&n.update(t,r,l||o)}L&&L(t,r),r.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:r}),p=null}),this.setAnimationLoop=function(e){L=e},this.dispose=function(){}}}const $a=new Mi,Za=new gi;function Qa(e,t){function n(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function i(e,i){e.opacity.value=i.opacity,i.color&&e.diffuse.value.copy(i.color),i.emissive&&e.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(e.map.value=i.map,n(i.map,e.mapTransform)),i.alphaMap&&(e.alphaMap.value=i.alphaMap,n(i.alphaMap,e.alphaMapTransform)),i.bumpMap&&(e.bumpMap.value=i.bumpMap,n(i.bumpMap,e.bumpMapTransform),e.bumpScale.value=i.bumpScale,1===i.side&&(e.bumpScale.value*=-1)),i.normalMap&&(e.normalMap.value=i.normalMap,n(i.normalMap,e.normalMapTransform),e.normalScale.value.copy(i.normalScale),1===i.side&&e.normalScale.value.negate()),i.displacementMap&&(e.displacementMap.value=i.displacementMap,n(i.displacementMap,e.displacementMapTransform),e.displacementScale.value=i.displacementScale,e.displacementBias.value=i.displacementBias),i.emissiveMap&&(e.emissiveMap.value=i.emissiveMap,n(i.emissiveMap,e.emissiveMapTransform)),i.specularMap&&(e.specularMap.value=i.specularMap,n(i.specularMap,e.specularMapTransform)),i.alphaTest>0&&(e.alphaTest.value=i.alphaTest);const r=t.get(i),o=r.envMap,s=r.envMapRotation;o&&(e.envMap.value=o,$a.copy(s),$a.x*=-1,$a.y*=-1,$a.z*=-1,o.isCubeTexture&&!1===o.isRenderTargetTexture&&($a.y*=-1,$a.z*=-1),e.envMapRotation.value.setFromMatrix4(Za.makeRotationFromEuler($a)),e.flipEnvMap.value=o.isCubeTexture&&!1===o.isRenderTargetTexture?-1:1,e.reflectivity.value=i.reflectivity,e.ior.value=i.ior,e.refractionRatio.value=i.refractionRatio),i.lightMap&&(e.lightMap.value=i.lightMap,e.lightMapIntensity.value=i.lightMapIntensity,n(i.lightMap,e.lightMapTransform)),i.aoMap&&(e.aoMap.value=i.aoMap,e.aoMapIntensity.value=i.aoMapIntensity,n(i.aoMap,e.aoMapTransform))}return{refreshFogUniforms:function(t,n){n.color.getRGB(t.fogColor.value,qr(e)),n.isFog?(t.fogNear.value=n.near,t.fogFar.value=n.far):n.isFogExp2&&(t.fogDensity.value=n.density)},refreshMaterialUniforms:function(e,r,o,s,a){r.isMeshBasicMaterial||r.isMeshLambertMaterial?i(e,r):r.isMeshToonMaterial?(i(e,r),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,r)):r.isMeshPhongMaterial?(i(e,r),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,r)):r.isMeshStandardMaterial?(i(e,r),function(e,t){e.metalness.value=t.metalness,t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap,n(t.metalnessMap,e.metalnessMapTransform));e.roughness.value=t.roughness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap,n(t.roughnessMap,e.roughnessMapTransform));t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}(e,r),r.isMeshPhysicalMaterial&&function(e,t,i){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap,n(t.sheenColorMap,e.sheenColorMapTransform)),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap,n(t.sheenRoughnessMap,e.sheenRoughnessMapTransform)));t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap,n(t.clearcoatMap,e.clearcoatMapTransform)),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap,n(t.clearcoatRoughnessMap,e.clearcoatRoughnessMapTransform)),t.clearcoatNormalMap&&(e.clearcoatNormalMap.value=t.clearcoatNormalMap,n(t.clearcoatNormalMap,e.clearcoatNormalMapTransform),e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),1===t.side&&e.clearcoatNormalScale.value.negate()));t.dispersion>0&&(e.dispersion.value=t.dispersion);t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap,n(t.iridescenceMap,e.iridescenceMapTransform)),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap,n(t.iridescenceThicknessMap,e.iridescenceThicknessMapTransform)));t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=i.texture,e.transmissionSamplerSize.value.set(i.width,i.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap,n(t.transmissionMap,e.transmissionMapTransform)),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap,n(t.thicknessMap,e.thicknessMapTransform)),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor));t.anisotropy>0&&(e.anisotropyVector.value.set(t.anisotropy*Math.cos(t.anisotropyRotation),t.anisotropy*Math.sin(t.anisotropyRotation)),t.anisotropyMap&&(e.anisotropyMap.value=t.anisotropyMap,n(t.anisotropyMap,e.anisotropyMapTransform)));e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap,n(t.specularColorMap,e.specularColorMapTransform));t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap,n(t.specularIntensityMap,e.specularIntensityMapTransform))}(e,r,a)):r.isMeshMatcapMaterial?(i(e,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,r)):r.isMeshDepthMaterial?i(e,r):r.isMeshDistanceMaterial?(i(e,r),function(e,n){const i=t.get(n).light;e.referencePosition.value.setFromMatrixPosition(i.matrixWorld),e.nearDistance.value=i.shadow.camera.near,e.farDistance.value=i.shadow.camera.far}(e,r)):r.isMeshNormalMaterial?i(e,r):r.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform))}(e,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,r)):r.isPointsMaterial?function(e,t,i,r){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*i,e.scale.value=.5*r,t.map&&(e.map.value=t.map,n(t.map,e.uvTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform));t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,r,o,s):r.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform));t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,r):r.isShadowMaterial?(e.color.value.copy(r.color),e.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function el(e,t,n,i){let r={},o={},s=[];const a=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS);function l(e,t,n,i){const r=e.value,o=t+"_"+n;if(void 0===i[o])return i[o]="number"==typeof r||"boolean"==typeof r?r:r.clone(),!0;{const e=i[o];if("number"==typeof r||"boolean"==typeof r){if(e!==r)return i[o]=r,!0}else if(!1===e.equals(r))return e.copy(r),!0}return!1}function u(e){const t={boundary:0,storage:0};return"number"==typeof e||"boolean"==typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function c(t){const n=t.target;n.removeEventListener("dispose",c);const i=s.indexOf(n.__bindingPointIndex);s.splice(i,1),e.deleteBuffer(r[n.id]),delete r[n.id],delete o[n.id]}return{bind:function(e,t){const n=t.program;i.uniformBlockBinding(e,n)},update:function(n,d){let h=r[n.id];void 0===h&&(!function(e){const t=e.uniforms;let n=0;const i=16;for(let o=0,s=t.length;o<s;o++){const e=Array.isArray(t[o])?t[o]:[t[o]];for(let t=0,r=e.length;t<r;t++){const r=e[t],o=Array.isArray(r.value)?r.value:[r.value];for(let e=0,t=o.length;e<t;e++){const t=u(o[e]),s=n%i,a=s%t.boundary,l=s+a;n+=a,0!==l&&i-l<t.storage&&(n+=i-l),r.__data=new Float32Array(t.storage/Float32Array.BYTES_PER_ELEMENT),r.__offset=n,n+=t.storage}}}const r=n%i;r>0&&(n+=i-r);e.__size=n,e.__cache={}}(n),h=function(t){const n=function(){for(let e=0;e<a;e++)if(-1===s.indexOf(e))return s.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=n;const i=e.createBuffer(),r=t.__size,o=t.usage;return e.bindBuffer(e.UNIFORM_BUFFER,i),e.bufferData(e.UNIFORM_BUFFER,r,o),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,n,i),i}(n),r[n.id]=h,n.addEventListener("dispose",c));const p=d.program;i.updateUBOMapping(n,p);const f=t.render.frame;o[n.id]!==f&&(!function(t){const n=r[t.id],i=t.uniforms,o=t.__cache;e.bindBuffer(e.UNIFORM_BUFFER,n);for(let r=0,s=i.length;r<s;r++){const t=Array.isArray(i[r])?i[r]:[i[r]];for(let n=0,i=t.length;n<i;n++){const i=t[n];if(!0===l(i,r,n,o)){const t=i.__offset,n=Array.isArray(i.value)?i.value:[i.value];let r=0;for(let o=0;o<n.length;o++){const s=n[o],a=u(s);"number"==typeof s||"boolean"==typeof s?(i.__data[0]=s,e.bufferSubData(e.UNIFORM_BUFFER,t+r,i.__data)):s.isMatrix3?(i.__data[0]=s.elements[0],i.__data[1]=s.elements[1],i.__data[2]=s.elements[2],i.__data[3]=0,i.__data[4]=s.elements[3],i.__data[5]=s.elements[4],i.__data[6]=s.elements[5],i.__data[7]=0,i.__data[8]=s.elements[6],i.__data[9]=s.elements[7],i.__data[10]=s.elements[8],i.__data[11]=0):(s.toArray(i.__data,r),r+=a.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,t,i.__data)}}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(n),o[n.id]=f)},dispose:function(){for(const t in r)e.deleteBuffer(r[t]);s=[],r={},o={}}}}class tl{constructor(e={}){const{canvas:t=vn(),context:n=null,depth:i=!0,stencil:r=!1,alpha:o=!1,antialias:s=!1,premultipliedAlpha:a=!0,preserveDrawingBuffer:l=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:c=!1}=e;let d;if(this.isWebGLRenderer=!0,null!==n){if("undefined"!=typeof WebGLRenderingContext&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");d=n.getContextAttributes().alpha}else d=o;const h=new Uint32Array(4),p=new Int32Array(4);let f=null,m=null;const g=[],v=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Ot,this.toneMapping=0,this.toneMappingExposure=1;const _=this;let y=!1,x=0,S=0,E=null,b=-1,T=null;const w=new Ln,M=new Ln;let A=null;const R=new or(0);let C=0,I=t.width,P=t.height,O=1,N=null,L=null;const D=new Ln(0,0,I,P),U=new Ln(0,0,I,P);let k=!1;const F=new co;let H=!1,V=!1;const z=new gi,G=new Hn,W=new Ln,j={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let q=!1;function X(){return null===E?O:1}let Y,K,J,$,Z,Q,ee,te,ne,ie,re,oe,se,ae,le,ue,ce,de,he,pe,fe,me,ge,ve,_e=n;function ye(e,n){return t.getContext(e,n)}try{const e={alpha:!0,depth:i,stencil:r,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:l,powerPreference:u,failIfMajorPerformanceCaveat:c};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${B}`),t.addEventListener("webglcontextlost",Ee,!1),t.addEventListener("webglcontextrestored",be,!1),t.addEventListener("webglcontextcreationerror",Te,!1),null===_e){const t="webgl2";if(_e=ye(t,e),null===_e)throw ye(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(Je){throw console.error("THREE.WebGLRenderer: "+Je.message),Je}function xe(){Y=new qo(_e),Y.init(),me=new Wa(_e,Y),K=new To(_e,Y,e,me),J=new Va(_e),$=new Ko(_e),Z=new Aa,Q=new Ga(_e,Y,J,Z,K,me,$),ee=new Mo(_),te=new jo(_),ne=new po(_e),ge=new Eo(_e,ne),ie=new Xo(_e,ne,$,ge),re=new $o(_e,ie,ne,$),he=new Jo(_e,K,Q),ue=new wo(Z),oe=new Ma(_,ee,te,Y,K,ge,ue),se=new Qa(_,Z),ae=new Pa,le=new ka(Y),de=new So(_,ee,te,J,re,d,a),ce=new Ha(_,re,K),ve=new el(_e,$,K,J),pe=new bo(_e,Y,$),fe=new Yo(_e,Y,$),$.programs=oe.programs,_.capabilities=K,_.extensions=Y,_.properties=Z,_.renderLists=ae,_.shadowMap=ce,_.state=J,_.info=$}xe();const Se=new Ja(_,_e);function Ee(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),y=!0}function be(){console.log("THREE.WebGLRenderer: Context Restored."),y=!1;const e=$.autoReset,t=ce.enabled,n=ce.autoUpdate,i=ce.needsUpdate,r=ce.type;xe(),$.autoReset=e,ce.enabled=t,ce.autoUpdate=n,ce.needsUpdate=i,ce.type=r}function Te(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function we(e){const t=e.target;t.removeEventListener("dispose",we),function(e){(function(e){const t=Z.get(e).programs;void 0!==t&&(t.forEach(function(e){oe.releaseProgram(e)}),e.isShaderMaterial&&oe.releaseShaderCache(e))})(e),Z.remove(e)}(t)}function Me(e,t,n){!0===e.transparent&&2===e.side&&!1===e.forceSinglePass?(e.side=1,e.needsUpdate=!0,Xe(e,t,n),e.side=0,e.needsUpdate=!0,Xe(e,t,n),e.side=2):Xe(e,t,n)}this.xr=Se,this.getContext=function(){return _e},this.getContextAttributes=function(){return _e.getContextAttributes()},this.forceContextLoss=function(){const e=Y.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=Y.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return O},this.setPixelRatio=function(e){void 0!==e&&(O=e,this.setSize(I,P,!1))},this.getSize=function(e){return e.set(I,P)},this.setSize=function(e,n,i=!0){Se.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(I=e,P=n,t.width=Math.floor(e*O),t.height=Math.floor(n*O),!0===i&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return e.set(I*O,P*O).floor()},this.setDrawingBufferSize=function(e,n,i){I=e,P=n,O=i,t.width=Math.floor(e*i),t.height=Math.floor(n*i),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return e.copy(w)},this.getViewport=function(e){return e.copy(D)},this.setViewport=function(e,t,n,i){e.isVector4?D.set(e.x,e.y,e.z,e.w):D.set(e,t,n,i),J.viewport(w.copy(D).multiplyScalar(O).round())},this.getScissor=function(e){return e.copy(U)},this.setScissor=function(e,t,n,i){e.isVector4?U.set(e.x,e.y,e.z,e.w):U.set(e,t,n,i),J.scissor(M.copy(U).multiplyScalar(O).round())},this.getScissorTest=function(){return k},this.setScissorTest=function(e){J.setScissorTest(k=e)},this.setOpaqueSort=function(e){N=e},this.setTransparentSort=function(e){L=e},this.getClearColor=function(e){return e.copy(de.getClearColor())},this.setClearColor=function(){de.setClearColor.apply(de,arguments)},this.getClearAlpha=function(){return de.getClearAlpha()},this.setClearAlpha=function(){de.setClearAlpha.apply(de,arguments)},this.clear=function(e=!0,t=!0,n=!0){let i=0;if(e){let e=!1;if(null!==E){const t=E.texture.format;e=t===qe||t===je||t===We}if(e){const e=E.texture.type,t=e===Re||e===Ne||e===Pe||e===Fe||e===Ue||e===ke,n=de.getClearColor(),i=de.getClearAlpha(),r=n.r,o=n.g,s=n.b;t?(h[0]=r,h[1]=o,h[2]=s,h[3]=i,_e.clearBufferuiv(_e.COLOR,0,h)):(p[0]=r,p[1]=o,p[2]=s,p[3]=i,_e.clearBufferiv(_e.COLOR,0,p))}else i|=_e.COLOR_BUFFER_BIT}t&&(i|=_e.DEPTH_BUFFER_BIT),n&&(i|=_e.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),_e.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Ee,!1),t.removeEventListener("webglcontextrestored",be,!1),t.removeEventListener("webglcontextcreationerror",Te,!1),ae.dispose(),le.dispose(),Z.dispose(),ee.dispose(),te.dispose(),re.dispose(),ge.dispose(),ve.dispose(),oe.dispose(),Se.dispose(),Se.removeEventListener("sessionstart",Ie),Se.removeEventListener("sessionend",Oe),Le.stop()},this.renderBufferDirect=function(e,t,n,i,r,o){null===t&&(t=j);const s=r.isMesh&&r.matrixWorld.determinant()<0,a=function(e,t,n,i,r){!0!==t.isScene&&(t=j);Q.resetTextureUnits();const o=t.fog,s=i.isMeshStandardMaterial?t.environment:null,a=null===E?_.outputColorSpace:!0===E.isXRRenderTarget?E.texture.colorSpace:Nt,l=(i.isMeshStandardMaterial?te:ee).get(i.envMap||s),u=!0===i.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,c=!!n.attributes.tangent&&(!!i.normalMap||i.anisotropy>0),d=!!n.morphAttributes.position,h=!!n.morphAttributes.normal,p=!!n.morphAttributes.color;let f=0;i.toneMapped&&(null!==E&&!0!==E.isXRRenderTarget||(f=_.toneMapping));const g=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,v=void 0!==g?g.length:0,y=Z.get(i),x=m.state.lights;if(!0===H&&(!0===V||e!==T)){const t=e===T&&i.id===b;ue.setState(i,e,t)}let S=!1;i.version===y.__version?y.needsLights&&y.lightsStateVersion!==x.state.version||y.outputColorSpace!==a||r.isBatchedMesh&&!1===y.batching?S=!0:r.isBatchedMesh||!0!==y.batching?r.isBatchedMesh&&!0===y.batchingColor&&null===r.colorTexture||r.isBatchedMesh&&!1===y.batchingColor&&null!==r.colorTexture||r.isInstancedMesh&&!1===y.instancing?S=!0:r.isInstancedMesh||!0!==y.instancing?r.isSkinnedMesh&&!1===y.skinning?S=!0:r.isSkinnedMesh||!0!==y.skinning?r.isInstancedMesh&&!0===y.instancingColor&&null===r.instanceColor||r.isInstancedMesh&&!1===y.instancingColor&&null!==r.instanceColor||r.isInstancedMesh&&!0===y.instancingMorph&&null===r.morphTexture||r.isInstancedMesh&&!1===y.instancingMorph&&null!==r.morphTexture||y.envMap!==l||!0===i.fog&&y.fog!==o?S=!0:void 0===y.numClippingPlanes||y.numClippingPlanes===ue.numPlanes&&y.numIntersection===ue.numIntersection?(y.vertexAlphas!==u||y.vertexTangents!==c||y.morphTargets!==d||y.morphNormals!==h||y.morphColors!==p||y.toneMapping!==f||y.morphTargetsCount!==v)&&(S=!0):S=!0:S=!0:S=!0:S=!0:(S=!0,y.__version=i.version);let w=y.currentProgram;!0===S&&(w=Xe(i,t,r));let M=!1,A=!1,R=!1;const C=w.getUniforms(),I=y.uniforms;J.useProgram(w.program)&&(M=!0,A=!0,R=!0);i.id!==b&&(b=i.id,A=!0);if(M||T!==e){C.setValue(_e,"projectionMatrix",e.projectionMatrix),C.setValue(_e,"viewMatrix",e.matrixWorldInverse);const t=C.map.cameraPosition;void 0!==t&&t.setValue(_e,G.setFromMatrixPosition(e.matrixWorld)),K.logarithmicDepthBuffer&&C.setValue(_e,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&C.setValue(_e,"isOrthographic",!0===e.isOrthographicCamera),T!==e&&(T=e,A=!0,R=!0)}if(r.isSkinnedMesh){C.setOptional(_e,r,"bindMatrix"),C.setOptional(_e,r,"bindMatrixInverse");const e=r.skeleton;e&&(null===e.boneTexture&&e.computeBoneTexture(),C.setValue(_e,"boneTexture",e.boneTexture,Q))}r.isBatchedMesh&&(C.setOptional(_e,r,"batchingTexture"),C.setValue(_e,"batchingTexture",r._matricesTexture,Q),C.setOptional(_e,r,"batchingIdTexture"),C.setValue(_e,"batchingIdTexture",r._indirectTexture,Q),C.setOptional(_e,r,"batchingColorTexture"),null!==r._colorsTexture&&C.setValue(_e,"batchingColorTexture",r._colorsTexture,Q));const N=n.morphAttributes;void 0===N.position&&void 0===N.normal&&void 0===N.color||he.update(r,n,w);(A||y.receiveShadow!==r.receiveShadow)&&(y.receiveShadow=r.receiveShadow,C.setValue(_e,"receiveShadow",r.receiveShadow));i.isMeshGouraudMaterial&&null!==i.envMap&&(I.envMap.value=l,I.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1);i.isMeshStandardMaterial&&null===i.envMap&&null!==t.environment&&(I.envMapIntensity.value=t.environmentIntensity);A&&(C.setValue(_e,"toneMappingExposure",_.toneMappingExposure),y.needsLights&&(D=R,(L=I).ambientLightColor.needsUpdate=D,L.lightProbe.needsUpdate=D,L.directionalLights.needsUpdate=D,L.directionalLightShadows.needsUpdate=D,L.pointLights.needsUpdate=D,L.pointLightShadows.needsUpdate=D,L.spotLights.needsUpdate=D,L.spotLightShadows.needsUpdate=D,L.rectAreaLights.needsUpdate=D,L.hemisphereLights.needsUpdate=D),o&&!0===i.fog&&se.refreshFogUniforms(I,o),se.refreshMaterialUniforms(I,i,O,P,m.state.transmissionRenderTarget[e.id]),ia.upload(_e,Ye(y),I,Q));var L,D;i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(ia.upload(_e,Ye(y),I,Q),i.uniformsNeedUpdate=!1);i.isSpriteMaterial&&C.setValue(_e,"center",r.center);if(C.setValue(_e,"modelViewMatrix",r.modelViewMatrix),C.setValue(_e,"normalMatrix",r.normalMatrix),C.setValue(_e,"modelMatrix",r.matrixWorld),i.isShaderMaterial||i.isRawShaderMaterial){const e=i.uniformsGroups;for(let t=0,n=e.length;t<n;t++){const n=e[t];ve.update(n,w),ve.bind(n,w)}}return w}(e,t,n,i,r);J.setMaterial(i,s);let l=n.index,u=1;if(!0===i.wireframe){if(l=ie.getWireframeAttribute(n),void 0===l)return;u=2}const c=n.drawRange,d=n.attributes.position;let h=c.start*u,p=(c.start+c.count)*u;null!==o&&(h=Math.max(h,o.start*u),p=Math.min(p,(o.start+o.count)*u)),null!==l?(h=Math.max(h,0),p=Math.min(p,l.count)):null!=d&&(h=Math.max(h,0),p=Math.min(p,d.count));const f=p-h;if(f<0||f===1/0)return;let g;ge.setup(r,i,a,n,l);let v=pe;if(null!==l&&(g=ne.get(l),v=fe,v.setIndex(g)),r.isMesh)!0===i.wireframe?(J.setLineWidth(i.wireframeLinewidth*X()),v.setMode(_e.LINES)):v.setMode(_e.TRIANGLES);else if(r.isLine){let e=i.linewidth;void 0===e&&(e=1),J.setLineWidth(e*X()),r.isLineSegments?v.setMode(_e.LINES):r.isLineLoop?v.setMode(_e.LINE_LOOP):v.setMode(_e.LINE_STRIP)}else r.isPoints?v.setMode(_e.POINTS):r.isSprite&&v.setMode(_e.TRIANGLES);if(r.isBatchedMesh)if(null!==r._multiDrawInstances)v.renderMultiDrawInstances(r._multiDrawStarts,r._multiDrawCounts,r._multiDrawCount,r._multiDrawInstances);else if(Y.get("WEBGL_multi_draw"))v.renderMultiDraw(r._multiDrawStarts,r._multiDrawCounts,r._multiDrawCount);else{const e=r._multiDrawStarts,t=r._multiDrawCounts,n=r._multiDrawCount,o=l?ne.get(l).bytesPerElement:1,s=Z.get(i).currentProgram.getUniforms();for(let i=0;i<n;i++)s.setValue(_e,"_gl_DrawID",i),v.render(e[i]/o,t[i])}else if(r.isInstancedMesh)v.renderInstances(h,f,r.count);else if(n.isInstancedBufferGeometry){const e=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,t=Math.min(n.instanceCount,e);v.renderInstances(h,f,t)}else v.render(h,f)},this.compile=function(e,t,n=null){null===n&&(n=e),m=le.get(n),m.init(t),v.push(m),n.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(m.pushLight(e),e.castShadow&&m.pushShadow(e))}),e!==n&&e.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(m.pushLight(e),e.castShadow&&m.pushShadow(e))}),m.setupLights();const i=new Set;return e.traverse(function(e){const t=e.material;if(t)if(Array.isArray(t))for(let r=0;r<t.length;r++){const o=t[r];Me(o,n,e),i.add(o)}else Me(t,n,e),i.add(t)}),v.pop(),m=null,i},this.compileAsync=function(e,t,n=null){const i=this.compile(e,t,n);return new Promise(t=>{function n(){i.forEach(function(e){Z.get(e).currentProgram.isReady()&&i.delete(e)}),0!==i.size?setTimeout(n,10):t(e)}null!==Y.get("KHR_parallel_shader_compile")?n():setTimeout(n,10)})};let Ce=null;function Ie(){Le.stop()}function Oe(){Le.start()}const Le=new ho;function Be(e,t,n,i){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)m.pushLight(e),e.castShadow&&m.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||F.intersectsSprite(e)){i&&W.setFromMatrixPosition(e.matrixWorld).applyMatrix4(z);const t=re.update(e),r=e.material;r.visible&&f.push(e,t,r,n,W.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||F.intersectsObject(e))){const t=re.update(e),r=e.material;if(i&&(void 0!==e.boundingSphere?(null===e.boundingSphere&&e.computeBoundingSphere(),W.copy(e.boundingSphere.center)):(null===t.boundingSphere&&t.computeBoundingSphere(),W.copy(t.boundingSphere.center)),W.applyMatrix4(e.matrixWorld).applyMatrix4(z)),Array.isArray(r)){const i=t.groups;for(let o=0,s=i.length;o<s;o++){const s=i[o],a=r[s.materialIndex];a&&a.visible&&f.push(e,t,a,n,W.z,s)}}else r.visible&&f.push(e,t,r,n,W.z,null)}const r=e.children;for(let o=0,s=r.length;o<s;o++)Be(r[o],t,n,i)}function He(e,t,n,i){const r=e.opaque,o=e.transmissive,s=e.transparent;m.setupLightsView(n),!0===H&&ue.setGlobalState(_.clippingPlanes,n),i&&J.viewport(w.copy(i)),r.length>0&&ze(r,t,n),o.length>0&&ze(o,t,n),s.length>0&&ze(s,t,n),J.buffers.depth.setTest(!0),J.buffers.depth.setMask(!0),J.buffers.color.setMask(!0),J.setPolygonOffset(!1)}function Ve(e,t,n,i){if(null!==(!0===n.isScene?n.overrideMaterial:null))return;void 0===m.state.transmissionRenderTarget[i.id]&&(m.state.transmissionRenderTarget[i.id]=new Un(1,1,{generateMipmaps:!0,type:Y.has("EXT_color_buffer_half_float")||Y.has("EXT_color_buffer_float")?De:Re,minFilter:Ae,samples:4,stencilBuffer:r,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Tn.workingColorSpace}));const o=m.state.transmissionRenderTarget[i.id],s=i.viewport||w;o.setSize(s.z,s.w);const a=_.getRenderTarget();_.setRenderTarget(o),_.getClearColor(R),C=_.getClearAlpha(),C<1&&_.setClearColor(16777215,.5),_.clear(),q&&de.render(n);const l=_.toneMapping;_.toneMapping=0;const u=i.viewport;if(void 0!==i.viewport&&(i.viewport=void 0),m.setupLightsView(i),!0===H&&ue.setGlobalState(_.clippingPlanes,i),ze(e,n,i),Q.updateMultisampleRenderTarget(o),Q.updateRenderTargetMipmap(o),!1===Y.has("WEBGL_multisampled_render_to_texture")){let e=!1;for(let r=0,o=t.length;r<o;r++){const o=t[r],s=o.object,a=o.geometry,l=o.material,u=o.group;if(2===l.side&&s.layers.test(i.layers)){const t=l.side;l.side=1,l.needsUpdate=!0,Ge(s,n,i,a,l,u),l.side=t,l.needsUpdate=!0,e=!0}}!0===e&&(Q.updateMultisampleRenderTarget(o),Q.updateRenderTargetMipmap(o))}_.setRenderTarget(a),_.setClearColor(R,C),void 0!==u&&(i.viewport=u),_.toneMapping=l}function ze(e,t,n){const i=!0===t.isScene?t.overrideMaterial:null;for(let r=0,o=e.length;r<o;r++){const o=e[r],s=o.object,a=o.geometry,l=null===i?o.material:i,u=o.group;s.layers.test(n.layers)&&Ge(s,t,n,a,l,u)}}function Ge(e,t,n,i,r,o){e.onBeforeRender(_,t,n,i,r,o),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),!0===r.transparent&&2===r.side&&!1===r.forceSinglePass?(r.side=1,r.needsUpdate=!0,_.renderBufferDirect(n,t,i,r,e,o),r.side=0,r.needsUpdate=!0,_.renderBufferDirect(n,t,i,r,e,o),r.side=2):_.renderBufferDirect(n,t,i,r,e,o),e.onAfterRender(_,t,n,i,r,o)}function Xe(e,t,n){!0!==t.isScene&&(t=j);const i=Z.get(e),r=m.state.lights,o=m.state.shadowsArray,s=r.state.version,a=oe.getParameters(e,r.state,o,t,n),l=oe.getProgramCacheKey(a);let u=i.programs;i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=(e.isMeshStandardMaterial?te:ee).get(e.envMap||i.environment),i.envMapRotation=null!==i.environment&&null===e.envMap?t.environmentRotation:e.envMapRotation,void 0===u&&(e.addEventListener("dispose",we),u=new Map,i.programs=u);let c=u.get(l);if(void 0!==c){if(i.currentProgram===c&&i.lightsStateVersion===s)return Ke(e,a),c}else a.uniforms=oe.getUniforms(e),e.onBeforeCompile(a,_),c=oe.acquireProgram(a,l),u.set(l,c),i.uniforms=a.uniforms;const d=i.uniforms;return(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(d.clippingPlanes=ue.uniform),Ke(e,a),i.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),i.lightsStateVersion=s,i.needsLights&&(d.ambientLightColor.value=r.state.ambient,d.lightProbe.value=r.state.probe,d.directionalLights.value=r.state.directional,d.directionalLightShadows.value=r.state.directionalShadow,d.spotLights.value=r.state.spot,d.spotLightShadows.value=r.state.spotShadow,d.rectAreaLights.value=r.state.rectArea,d.ltc_1.value=r.state.rectAreaLTC1,d.ltc_2.value=r.state.rectAreaLTC2,d.pointLights.value=r.state.point,d.pointLightShadows.value=r.state.pointShadow,d.hemisphereLights.value=r.state.hemi,d.directionalShadowMap.value=r.state.directionalShadowMap,d.directionalShadowMatrix.value=r.state.directionalShadowMatrix,d.spotShadowMap.value=r.state.spotShadowMap,d.spotLightMatrix.value=r.state.spotLightMatrix,d.spotLightMap.value=r.state.spotLightMap,d.pointShadowMap.value=r.state.pointShadowMap,d.pointShadowMatrix.value=r.state.pointShadowMatrix),i.currentProgram=c,i.uniformsList=null,c}function Ye(e){if(null===e.uniformsList){const t=e.currentProgram.getUniforms();e.uniformsList=ia.seqWithValue(t.seq,e.uniforms)}return e.uniformsList}function Ke(e,t){const n=Z.get(e);n.outputColorSpace=t.outputColorSpace,n.batching=t.batching,n.batchingColor=t.batchingColor,n.instancing=t.instancing,n.instancingColor=t.instancingColor,n.instancingMorph=t.instancingMorph,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}Le.setAnimationLoop(function(e){Ce&&Ce(e)}),"undefined"!=typeof self&&Le.setContext(self),this.setAnimationLoop=function(e){Ce=e,Se.setAnimationLoop(e),null===e?Le.stop():Le.start()},Se.addEventListener("sessionstart",Ie),Se.addEventListener("sessionend",Oe),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===y)return;if(!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===Se.enabled&&!0===Se.isPresenting&&(!0===Se.cameraAutoUpdate&&Se.updateCamera(t),t=Se.getCamera()),!0===e.isScene&&e.onBeforeRender(_,e,t,E),m=le.get(e,v.length),m.init(t),v.push(m),z.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),F.setFromProjectionMatrix(z),V=this.localClippingEnabled,H=ue.init(this.clippingPlanes,V),f=ae.get(e,g.length),f.init(),g.push(f),!0===Se.enabled&&!0===Se.isPresenting){const e=_.xr.getDepthSensingMesh();null!==e&&Be(e,t,-1/0,_.sortObjects)}Be(e,t,0,_.sortObjects),f.finish(),!0===_.sortObjects&&f.sort(N,L),q=!1===Se.enabled||!1===Se.isPresenting||!1===Se.hasDepthSensing(),q&&de.addToRenderList(f,e),this.info.render.frame++,!0===H&&ue.beginShadows();const n=m.state.shadowsArray;ce.render(n,e,t),!0===H&&ue.endShadows(),!0===this.info.autoReset&&this.info.reset();const i=f.opaque,r=f.transmissive;if(m.setupLights(),t.isArrayCamera){const n=t.cameras;if(r.length>0)for(let t=0,o=n.length;t<o;t++){Ve(i,r,e,n[t])}q&&de.render(e);for(let t=0,i=n.length;t<i;t++){const i=n[t];He(f,e,i,i.viewport)}}else r.length>0&&Ve(i,r,e,t),q&&de.render(e),He(f,e,t);null!==E&&(Q.updateMultisampleRenderTarget(E),Q.updateRenderTargetMipmap(E)),!0===e.isScene&&e.onAfterRender(_,e,t),ge.resetDefaultState(),b=-1,T=null,v.pop(),v.length>0?(m=v[v.length-1],!0===H&&ue.setGlobalState(_.clippingPlanes,m.state.camera)):m=null,g.pop(),f=g.length>0?g[g.length-1]:null},this.getActiveCubeFace=function(){return x},this.getActiveMipmapLevel=function(){return S},this.getRenderTarget=function(){return E},this.setRenderTargetTextures=function(e,t,n){Z.get(e.texture).__webglTexture=t,Z.get(e.depthTexture).__webglTexture=n;const i=Z.get(e);i.__hasExternalTextures=!0,i.__autoAllocateDepthBuffer=void 0===n,i.__autoAllocateDepthBuffer||!0===Y.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),i.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(e,t){const n=Z.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e,t=0,n=0){E=e,x=t,S=n;let i=!0,r=null,o=!1,s=!1;if(e){const a=Z.get(e);void 0!==a.__useDefaultFramebuffer?(J.bindFramebuffer(_e.FRAMEBUFFER,null),i=!1):void 0===a.__webglFramebuffer?Q.setupRenderTarget(e):a.__hasExternalTextures&&Q.rebindTextures(e,Z.get(e.texture).__webglTexture,Z.get(e.depthTexture).__webglTexture);const l=e.texture;(l.isData3DTexture||l.isDataArrayTexture||l.isCompressedArrayTexture)&&(s=!0);const u=Z.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(r=Array.isArray(u[t])?u[t][n]:u[t],o=!0):r=e.samples>0&&!1===Q.useMultisampledRTT(e)?Z.get(e).__webglMultisampledFramebuffer:Array.isArray(u)?u[n]:u,w.copy(e.viewport),M.copy(e.scissor),A=e.scissorTest}else w.copy(D).multiplyScalar(O).floor(),M.copy(U).multiplyScalar(O).floor(),A=k;if(J.bindFramebuffer(_e.FRAMEBUFFER,r)&&i&&J.drawBuffers(e,r),J.viewport(w),J.scissor(M),J.setScissorTest(A),o){const i=Z.get(e.texture);_e.framebufferTexture2D(_e.FRAMEBUFFER,_e.COLOR_ATTACHMENT0,_e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i.__webglTexture,n)}else if(s){const i=Z.get(e.texture),r=t||0;_e.framebufferTextureLayer(_e.FRAMEBUFFER,_e.COLOR_ATTACHMENT0,i.__webglTexture,n||0,r)}b=-1},this.readRenderTargetPixels=function(e,t,n,i,r,o,s){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=Z.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==s&&(a=a[s]),a){J.bindFramebuffer(_e.FRAMEBUFFER,a);try{const s=e.texture,a=s.format,l=s.type;if(!K.textureFormatReadable(a))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!K.textureTypeReadable(l))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r&&_e.readPixels(t,n,i,r,me.convert(a),me.convert(l),o)}finally{const e=null!==E?Z.get(E).__webglFramebuffer:null;J.bindFramebuffer(_e.FRAMEBUFFER,e)}}},this.readRenderTargetPixelsAsync=async function(e,t,n,i,r,o,s){if(!e||!e.isWebGLRenderTarget)throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=Z.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==s&&(a=a[s]),a){J.bindFramebuffer(_e.FRAMEBUFFER,a);try{const s=e.texture,a=s.format,l=s.type;if(!K.textureFormatReadable(a))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!K.textureTypeReadable(l))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r){const e=_e.createBuffer();_e.bindBuffer(_e.PIXEL_PACK_BUFFER,e),_e.bufferData(_e.PIXEL_PACK_BUFFER,o.byteLength,_e.STREAM_READ),_e.readPixels(t,n,i,r,me.convert(a),me.convert(l),0),_e.flush();const s=_e.fenceSync(_e.SYNC_GPU_COMMANDS_COMPLETE,0);await function(e,t,n){return new Promise(function(i,r){setTimeout(function o(){switch(e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0)){case e.WAIT_FAILED:r();break;case e.TIMEOUT_EXPIRED:setTimeout(o,n);break;default:i()}},n)})}(_e,s,4);try{_e.bindBuffer(_e.PIXEL_PACK_BUFFER,e),_e.getBufferSubData(_e.PIXEL_PACK_BUFFER,0,o)}finally{_e.deleteBuffer(e),_e.deleteSync(s)}return o}}finally{const e=null!==E?Z.get(E).__webglFramebuffer:null;J.bindFramebuffer(_e.FRAMEBUFFER,e)}}},this.copyFramebufferToTexture=function(e,t=null,n=0){!0!==e.isTexture&&(yn("WebGLRenderer: copyFramebufferToTexture function signature has changed."),t=arguments[0]||null,e=arguments[1]);const i=Math.pow(2,-n),r=Math.floor(e.image.width*i),o=Math.floor(e.image.height*i),s=null!==t?t.x:0,a=null!==t?t.y:0;Q.setTexture2D(e,0),_e.copyTexSubImage2D(_e.TEXTURE_2D,n,0,0,s,a,r,o),J.unbindTexture()},this.copyTextureToTexture=function(e,t,n=null,i=null,r=0){let o,s,a,l,u,c;!0!==e.isTexture&&(yn("WebGLRenderer: copyTextureToTexture function signature has changed."),i=arguments[0]||null,e=arguments[1],t=arguments[2],r=arguments[3]||0,n=null),null!==n?(o=n.max.x-n.min.x,s=n.max.y-n.min.y,a=n.min.x,l=n.min.y):(o=e.image.width,s=e.image.height,a=0,l=0),null!==i?(u=i.x,c=i.y):(u=0,c=0);const d=me.convert(t.format),h=me.convert(t.type);Q.setTexture2D(t,0),_e.pixelStorei(_e.UNPACK_FLIP_Y_WEBGL,t.flipY),_e.pixelStorei(_e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),_e.pixelStorei(_e.UNPACK_ALIGNMENT,t.unpackAlignment);const p=_e.getParameter(_e.UNPACK_ROW_LENGTH),f=_e.getParameter(_e.UNPACK_IMAGE_HEIGHT),m=_e.getParameter(_e.UNPACK_SKIP_PIXELS),g=_e.getParameter(_e.UNPACK_SKIP_ROWS),v=_e.getParameter(_e.UNPACK_SKIP_IMAGES),_=e.isCompressedTexture?e.mipmaps[r]:e.image;_e.pixelStorei(_e.UNPACK_ROW_LENGTH,_.width),_e.pixelStorei(_e.UNPACK_IMAGE_HEIGHT,_.height),_e.pixelStorei(_e.UNPACK_SKIP_PIXELS,a),_e.pixelStorei(_e.UNPACK_SKIP_ROWS,l),e.isDataTexture?_e.texSubImage2D(_e.TEXTURE_2D,r,u,c,o,s,d,h,_.data):e.isCompressedTexture?_e.compressedTexSubImage2D(_e.TEXTURE_2D,r,u,c,_.width,_.height,d,_.data):_e.texSubImage2D(_e.TEXTURE_2D,r,u,c,o,s,d,h,_),_e.pixelStorei(_e.UNPACK_ROW_LENGTH,p),_e.pixelStorei(_e.UNPACK_IMAGE_HEIGHT,f),_e.pixelStorei(_e.UNPACK_SKIP_PIXELS,m),_e.pixelStorei(_e.UNPACK_SKIP_ROWS,g),_e.pixelStorei(_e.UNPACK_SKIP_IMAGES,v),0===r&&t.generateMipmaps&&_e.generateMipmap(_e.TEXTURE_2D),J.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n=null,i=null,r=0){let o,s,a,l,u,c,d,h,p;!0!==e.isTexture&&(yn("WebGLRenderer: copyTextureToTexture3D function signature has changed."),n=arguments[0]||null,i=arguments[1]||null,e=arguments[2],t=arguments[3],r=arguments[4]||0);const f=e.isCompressedTexture?e.mipmaps[r]:e.image;null!==n?(o=n.max.x-n.min.x,s=n.max.y-n.min.y,a=n.max.z-n.min.z,l=n.min.x,u=n.min.y,c=n.min.z):(o=f.width,s=f.height,a=f.depth,l=0,u=0,c=0),null!==i?(d=i.x,h=i.y,p=i.z):(d=0,h=0,p=0);const m=me.convert(t.format),g=me.convert(t.type);let v;if(t.isData3DTexture)Q.setTexture3D(t,0),v=_e.TEXTURE_3D;else{if(!t.isDataArrayTexture&&!t.isCompressedArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");Q.setTexture2DArray(t,0),v=_e.TEXTURE_2D_ARRAY}_e.pixelStorei(_e.UNPACK_FLIP_Y_WEBGL,t.flipY),_e.pixelStorei(_e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),_e.pixelStorei(_e.UNPACK_ALIGNMENT,t.unpackAlignment);const _=_e.getParameter(_e.UNPACK_ROW_LENGTH),y=_e.getParameter(_e.UNPACK_IMAGE_HEIGHT),x=_e.getParameter(_e.UNPACK_SKIP_PIXELS),S=_e.getParameter(_e.UNPACK_SKIP_ROWS),E=_e.getParameter(_e.UNPACK_SKIP_IMAGES);_e.pixelStorei(_e.UNPACK_ROW_LENGTH,f.width),_e.pixelStorei(_e.UNPACK_IMAGE_HEIGHT,f.height),_e.pixelStorei(_e.UNPACK_SKIP_PIXELS,l),_e.pixelStorei(_e.UNPACK_SKIP_ROWS,u),_e.pixelStorei(_e.UNPACK_SKIP_IMAGES,c),e.isDataTexture||e.isData3DTexture?_e.texSubImage3D(v,r,d,h,p,o,s,a,m,g,f.data):t.isCompressedArrayTexture?_e.compressedTexSubImage3D(v,r,d,h,p,o,s,a,m,f.data):_e.texSubImage3D(v,r,d,h,p,o,s,a,m,g,f),_e.pixelStorei(_e.UNPACK_ROW_LENGTH,_),_e.pixelStorei(_e.UNPACK_IMAGE_HEIGHT,y),_e.pixelStorei(_e.UNPACK_SKIP_PIXELS,x),_e.pixelStorei(_e.UNPACK_SKIP_ROWS,S),_e.pixelStorei(_e.UNPACK_SKIP_IMAGES,E),0===r&&t.generateMipmaps&&_e.generateMipmap(v),J.unbindTexture()},this.initRenderTarget=function(e){void 0===Z.get(e).__webglFramebuffer&&Q.setupRenderTarget(e)},this.initTexture=function(e){e.isCubeTexture?Q.setTextureCube(e,0):e.isData3DTexture?Q.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?Q.setTexture2DArray(e,0):Q.setTexture2D(e,0),J.unbindTexture()},this.resetState=function(){x=0,S=0,E=null,J.reset(),ge.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return $t}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===Lt?"display-p3":"srgb",t.unpackColorSpace=Tn.workingColorSpace===Dt?"display-p3":"srgb"}}class nl extends Gi{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Mi,this.environmentIntensity=1,this.environmentRotation=new Mi,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class il{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=Kt,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=on()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}get updateRange(){return yn("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let i=0,r=this.stride;i<r;i++)this.array[e+i]=t.array[n+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=on()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=on()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const rl=new Hn;class ol{constructor(e,t,n,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)rl.fromBufferAttribute(this,t),rl.applyMatrix4(e),this.setXYZ(t,rl.x,rl.y,rl.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)rl.fromBufferAttribute(this,t),rl.applyNormalMatrix(e),this.setXYZ(t,rl.x,rl.y,rl.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)rl.fromBufferAttribute(this,t),rl.transformDirection(e),this.setXYZ(t,rl.x,rl.y,rl.z);return this}getComponent(e,t){let n=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(n=un(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=cn(n,this.array)),this.data.array[e*this.data.stride+this.offset+t]=n,this}setX(e,t){return this.normalized&&(t=cn(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=cn(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=cn(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=cn(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=un(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=un(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=un(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=un(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=cn(t,this.array),n=cn(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=cn(t,this.array),n=cn(n,this.array),i=cn(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=cn(t,this.array),n=cn(n,this.array),i=cn(i,this.array),r=cn(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=r,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new hr(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new ol(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}const sl=new Hn,al=new Ln,ll=new Ln,ul=new Hn,cl=new gi,dl=new Hn,hl=new ai,pl=new gi,fl=new mi;class ml extends Vr{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=fe,this.bindMatrix=new gi,this.bindMatrixInverse=new gi,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;null===this.boundingBox&&(this.boundingBox=new Gn),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,dl),this.boundingBox.expandByPoint(dl)}computeBoundingSphere(){const e=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new ai),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,dl),this.boundingSphere.expandByPoint(dl)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const n=this.material,i=this.matrixWorld;void 0!==n&&(null===this.boundingSphere&&this.computeBoundingSphere(),hl.copy(this.boundingSphere),hl.applyMatrix4(i),!1!==e.ray.intersectsSphere(hl)&&(pl.copy(i).invert(),fl.copy(e.ray).applyMatrix4(pl),null!==this.boundingBox&&!1===fl.intersectsBox(this.boundingBox)||this._computeIntersections(e,t,fl)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Ln,t=this.geometry.attributes.skinWeight;for(let n=0,i=t.count;n<i;n++){e.fromBufferAttribute(t,n);const i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===fe?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const n=this.skeleton,i=this.geometry;al.fromBufferAttribute(i.attributes.skinIndex,e),ll.fromBufferAttribute(i.attributes.skinWeight,e),sl.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){const e=ll.getComponent(r);if(0!==e){const i=al.getComponent(r);cl.multiplyMatrices(n.bones[i].matrixWorld,n.boneInverses[i]),t.addScaledVector(ul.copy(sl).applyMatrix4(cl),e)}}return t.applyMatrix4(this.bindMatrixInverse)}}class gl extends Gi{constructor(){super(),this.isBone=!0,this.type="Bone"}}class vl extends Nn{constructor(e=null,t=1,n=1,i,r,o,s,a,l=1003,u=1003,c,d){super(null,o,s,a,l,u,i,r,c,d),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const _l=new gi,yl=new gi;class xl{constructor(e=[],t=[]){this.uuid=on(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new gi)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new gi;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let r=0,o=e.length;r<o;r++){const i=e[r]?e[r].matrixWorld:yl;_l.multiplyMatrices(i,t[r]),_l.toArray(n,16*r)}null!==i&&(i.needsUpdate=!0)}clone(){return new xl(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=4*Math.ceil(e/4),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new vl(t,e,e,He,Le);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const n=this.bones[t];if(n.name===e)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,i=e.bones.length;n<i;n++){const i=e.bones[n];let r=t[i];void 0===r&&(console.warn("THREE.Skeleton: No bone found with UUID:",i),r=new gl),this.bones.push(r),this.boneInverses.push((new gi).fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let i=0,r=t.length;i<r;i++){const r=t[i];e.bones.push(r.uuid);const o=n[i];e.boneInverses.push(o.toArray())}return e}}class Sl extends hr{constructor(e,t,n,i=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const El=new gi,bl=new gi,Tl=[],wl=new Gn,Ml=new gi,Al=new Vr,Rl=new ai;class Cl extends Vr{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Sl(new Float32Array(16*n),16),this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let i=0;i<n;i++)this.setMatrixAt(i,Ml)}computeBoundingBox(){const e=this.geometry,t=this.count;null===this.boundingBox&&(this.boundingBox=new Gn),null===e.boundingBox&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,El),wl.copy(e.boundingBox).applyMatrix4(El),this.boundingBox.union(wl)}computeBoundingSphere(){const e=this.geometry,t=this.count;null===this.boundingSphere&&(this.boundingSphere=new ai),null===e.boundingSphere&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,El),Rl.copy(e.boundingSphere).applyMatrix4(El),this.boundingSphere.union(Rl)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.morphTexture&&(this.morphTexture=e.morphTexture.clone()),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}getMorphAt(e,t){const n=t.morphTargetInfluences,i=this.morphTexture.source.data.data,r=e*(n.length+1)+1;for(let o=0;o<n.length;o++)n[o]=i[r+o]}raycast(e,t){const n=this.matrixWorld,i=this.count;if(Al.geometry=this.geometry,Al.material=this.material,void 0!==Al.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),Rl.copy(this.boundingSphere),Rl.applyMatrix4(n),!1!==e.ray.intersectsSphere(Rl)))for(let r=0;r<i;r++){this.getMatrixAt(r,El),bl.multiplyMatrices(n,El),Al.matrixWorld=bl,Al.raycast(e,Tl);for(let e=0,n=Tl.length;e<n;e++){const n=Tl[e];n.instanceId=r,n.object=this,t.push(n)}Tl.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new Sl(new Float32Array(3*this.instanceMatrix.count).fill(1),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}setMorphAt(e,t){const n=t.morphTargetInfluences,i=n.length+1;null===this.morphTexture&&(this.morphTexture=new vl(new Float32Array(i*this.count),i,this.count,Ge,Le));const r=this.morphTexture.source.data.data;let o=0;for(let l=0;l<n.length;l++)o+=n[l];const s=this.geometry.morphTargetsRelative?1:1-o,a=i*e;r[a]=s,r.set(n,a+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),null!==this.morphTexture&&(this.morphTexture.dispose(),this.morphTexture=null),this}}class Il extends lr{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new or(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const Pl=new Hn,Ol=new Hn,Nl=new gi,Ll=new mi,Dl=new ai,Ul=new Hn,kl=new Hn;class Fl extends Gi{constructor(e=new br,t=new Il){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,i=t.count;e<i;e++)Pl.fromBufferAttribute(t,e-1),Ol.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=Pl.distanceTo(Ol);e.setAttribute("lineDistance",new mr(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Line.threshold,o=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Dl.copy(n.boundingSphere),Dl.applyMatrix4(i),Dl.radius+=r,!1===e.ray.intersectsSphere(Dl))return;Nl.copy(i).invert(),Ll.copy(e.ray).applyMatrix4(Nl);const s=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=s*s,l=this.isLineSegments?2:1,u=n.index,c=n.attributes.position;if(null!==u){const n=Math.max(0,o.start),i=Math.min(u.count,o.start+o.count);for(let r=n,o=i-1;r<o;r+=l){const n=u.getX(r),i=u.getX(r+1),o=Bl(this,e,Ll,a,n,i);o&&t.push(o)}if(this.isLineLoop){const r=u.getX(i-1),o=u.getX(n),s=Bl(this,e,Ll,a,r,o);s&&t.push(s)}}else{const n=Math.max(0,o.start),i=Math.min(c.count,o.start+o.count);for(let r=n,o=i-1;r<o;r+=l){const n=Bl(this,e,Ll,a,r,r+1);n&&t.push(n)}if(this.isLineLoop){const r=Bl(this,e,Ll,a,i-1,n);r&&t.push(r)}}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function Bl(e,t,n,i,r,o){const s=e.geometry.attributes.position;Pl.fromBufferAttribute(s,r),Ol.fromBufferAttribute(s,o);if(n.distanceSqToSegment(Pl,Ol,Ul,kl)>i)return;Ul.applyMatrix4(e.matrixWorld);const a=t.ray.origin.distanceTo(Ul);return a<t.near||a>t.far?void 0:{distance:a,point:kl.clone().applyMatrix4(e.matrixWorld),index:r,face:null,faceIndex:null,object:e}}const Hl=new Hn,Vl=new Hn;class zl extends Fl{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,i=t.count;e<i;e+=2)Hl.fromBufferAttribute(t,e),Vl.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+Hl.distanceTo(Vl);e.setAttribute("lineDistance",new mr(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class Gl extends Fl{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class Wl extends lr{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new or(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const jl=new gi,ql=new mi,Xl=new ai,Yl=new Hn;class Kl extends Gi{constructor(e=new br,t=new Wl){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Points.threshold,o=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Xl.copy(n.boundingSphere),Xl.applyMatrix4(i),Xl.radius+=r,!1===e.ray.intersectsSphere(Xl))return;jl.copy(i).invert(),ql.copy(e.ray).applyMatrix4(jl);const s=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=s*s,l=n.index,u=n.attributes.position;if(null!==l){for(let n=Math.max(0,o.start),r=Math.min(l.count,o.start+o.count);n<r;n++){const r=l.getX(n);Yl.fromBufferAttribute(u,r),Jl(Yl,r,a,i,e,t,this)}}else{for(let n=Math.max(0,o.start),r=Math.min(u.count,o.start+o.count);n<r;n++)Yl.fromBufferAttribute(u,n),Jl(Yl,n,a,i,e,t,this)}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function Jl(e,t,n,i,r,o,s){const a=ql.distanceSqToPoint(e);if(a<n){const n=new Hn;ql.closestPointToPoint(e,n),n.applyMatrix4(i);const l=r.ray.origin.distanceTo(n);if(l<r.near||l>r.far)return;o.push({distance:l,distanceToRay:Math.sqrt(a),point:n,index:t,face:null,object:s})}}class $l{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,i=this.getPoint(0),r=0;t.push(0);for(let o=1;o<=e;o++)n=this.getPoint(o/e),r+=n.distanceTo(i),t.push(r),i=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let i=0;const r=n.length;let o;o=t||e*n[r-1];let s,a=0,l=r-1;for(;a<=l;)if(i=Math.floor(a+(l-a)/2),s=n[i]-o,s<0)a=i+1;else{if(!(s>0)){l=i;break}l=i-1}if(i=l,n[i]===o)return i/(r-1);const u=n[i];return(i+(o-u)/(n[i+1]-u))/(r-1)}getTangent(e,t){const n=1e-4;let i=e-n,r=e+n;i<0&&(i=0),r>1&&(r=1);const o=this.getPoint(i),s=this.getPoint(r),a=t||(o.isVector2?new hn:new Hn);return a.copy(s).sub(o).normalize(),a}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new Hn,i=[],r=[],o=[],s=new Hn,a=new gi;for(let h=0;h<=e;h++){const t=h/e;i[h]=this.getTangentAt(t,new Hn)}r[0]=new Hn,o[0]=new Hn;let l=Number.MAX_VALUE;const u=Math.abs(i[0].x),c=Math.abs(i[0].y),d=Math.abs(i[0].z);u<=l&&(l=u,n.set(1,0,0)),c<=l&&(l=c,n.set(0,1,0)),d<=l&&n.set(0,0,1),s.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],s),o[0].crossVectors(i[0],r[0]);for(let h=1;h<=e;h++){if(r[h]=r[h-1].clone(),o[h]=o[h-1].clone(),s.crossVectors(i[h-1],i[h]),s.length()>Number.EPSILON){s.normalize();const e=Math.acos(sn(i[h-1].dot(i[h]),-1,1));r[h].applyMatrix4(a.makeRotationAxis(s,e))}o[h].crossVectors(i[h],r[h])}if(!0===t){let t=Math.acos(sn(r[0].dot(r[e]),-1,1));t/=e,i[0].dot(s.crossVectors(r[0],r[e]))>0&&(t=-t);for(let n=1;n<=e;n++)r[n].applyMatrix4(a.makeRotationAxis(i[n],t*n)),o[n].crossVectors(i[n],r[n])}return{tangents:i,normals:r,binormals:o}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Zl extends $l{constructor(e=0,t=0,n=1,i=1,r=0,o=2*Math.PI,s=!1,a=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=o,this.aClockwise=s,this.aRotation=a}getPoint(e,t=new hn){const n=t,i=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const o=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(r=o?0:i),!0!==this.aClockwise||o||(r===i?r=-i:r-=i);const s=this.aStartAngle+e*r;let a=this.aX+this.xRadius*Math.cos(s),l=this.aY+this.yRadius*Math.sin(s);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),n=a-this.aX,i=l-this.aY;a=n*e-i*t+this.aX,l=n*t+i*e+this.aY}return n.set(a,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}function Ql(){let e=0,t=0,n=0,i=0;function r(r,o,s,a){e=r,t=s,n=-3*r+3*o-2*s-a,i=2*r-2*o+s+a}return{initCatmullRom:function(e,t,n,i,o){r(t,n,o*(n-e),o*(i-t))},initNonuniformCatmullRom:function(e,t,n,i,o,s,a){let l=(t-e)/o-(n-e)/(o+s)+(n-t)/s,u=(n-t)/s-(i-t)/(s+a)+(i-n)/a;l*=s,u*=s,r(t,n,l,u)},calc:function(r){const o=r*r;return e+t*r+n*o+i*(o*r)}}}const eu=new Hn,tu=new Ql,nu=new Ql,iu=new Ql;function ru(e,t,n,i,r){const o=.5*(i-t),s=.5*(r-n),a=e*e;return(2*n-2*i+o+s)*(e*a)+(-3*n+3*i-2*o-s)*a+o*e+n}function ou(e,t,n,i){return function(e,t){const n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,i)}function su(e,t,n,i,r){return function(e,t){const n=1-e;return n*n*n*t}(e,t)+function(e,t){const n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,i)+function(e,t){return e*e*e*t}(e,r)}class au extends $l{constructor(e=new hn,t=new hn,n=new hn,i=new hn){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new hn){const n=t,i=this.v0,r=this.v1,o=this.v2,s=this.v3;return n.set(su(e,i.x,r.x,o.x,s.x),su(e,i.y,r.y,o.y,s.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class lu extends $l{constructor(e=new hn,t=new hn){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new hn){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new hn){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class uu extends $l{constructor(e=new hn,t=new hn,n=new hn){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new hn){const n=t,i=this.v0,r=this.v1,o=this.v2;return n.set(ou(e,i.x,r.x,o.x),ou(e,i.y,r.y,o.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class cu extends $l{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new hn){const n=t,i=this.points,r=(i.length-1)*e,o=Math.floor(r),s=r-o,a=i[0===o?o:o-1],l=i[o],u=i[o>i.length-2?i.length-1:o+1],c=i[o>i.length-3?i.length-1:o+2];return n.set(ru(s,a.x,l.x,u.x,c.x),ru(s,a.y,l.y,u.y,c.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new hn).fromArray(n))}return this}}var du=Object.freeze({__proto__:null,ArcCurve:class extends Zl{constructor(e,t,n,i,r,o){super(e,t,n,n,i,r,o),this.isArcCurve=!0,this.type="ArcCurve"}},CatmullRomCurve3:class extends $l{constructor(e=[],t=!1,n="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=i}getPoint(e,t=new Hn){const n=t,i=this.points,r=i.length,o=(r-(this.closed?0:1))*e;let s,a,l=Math.floor(o),u=o-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/r)+1)*r:0===u&&l===r-1&&(l=r-2,u=1),this.closed||l>0?s=i[(l-1)%r]:(eu.subVectors(i[0],i[1]).add(i[0]),s=eu);const c=i[l%r],d=i[(l+1)%r];if(this.closed||l+2<r?a=i[(l+2)%r]:(eu.subVectors(i[r-1],i[r-2]).add(i[r-1]),a=eu),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(s.distanceToSquared(c),e),n=Math.pow(c.distanceToSquared(d),e),i=Math.pow(d.distanceToSquared(a),e);n<1e-4&&(n=1),t<1e-4&&(t=n),i<1e-4&&(i=n),tu.initNonuniformCatmullRom(s.x,c.x,d.x,a.x,t,n,i),nu.initNonuniformCatmullRom(s.y,c.y,d.y,a.y,t,n,i),iu.initNonuniformCatmullRom(s.z,c.z,d.z,a.z,t,n,i)}else"catmullrom"===this.curveType&&(tu.initCatmullRom(s.x,c.x,d.x,a.x,this.tension),nu.initCatmullRom(s.y,c.y,d.y,a.y,this.tension),iu.initCatmullRom(s.z,c.z,d.z,a.z,this.tension));return n.set(tu.calc(u),nu.calc(u),iu.calc(u)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new Hn).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}},CubicBezierCurve:au,CubicBezierCurve3:class extends $l{constructor(e=new Hn,t=new Hn,n=new Hn,i=new Hn){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new Hn){const n=t,i=this.v0,r=this.v1,o=this.v2,s=this.v3;return n.set(su(e,i.x,r.x,o.x,s.x),su(e,i.y,r.y,o.y,s.y),su(e,i.z,r.z,o.z,s.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},EllipseCurve:Zl,LineCurve:lu,LineCurve3:class extends $l{constructor(e=new Hn,t=new Hn){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new Hn){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new Hn){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},QuadraticBezierCurve:uu,QuadraticBezierCurve3:class extends $l{constructor(e=new Hn,t=new Hn,n=new Hn){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Hn){const n=t,i=this.v0,r=this.v1,o=this.v2;return n.set(ou(e,i.x,r.x,o.x),ou(e,i.y,r.y,o.y),ou(e,i.z,r.z,o.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},SplineCurve:cu});class hu extends $l{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const n=!0===e.isVector2?"LineCurve":"LineCurve3";this.curves.push(new du[n](t,e))}return this}getPoint(e,t){const n=e*this.getLength(),i=this.getCurveLengths();let r=0;for(;r<i.length;){if(i[r]>=n){const e=i[r]-n,o=this.curves[r],s=o.getLength(),a=0===s?0:1-e/s;return o.getPointAt(a,t)}r++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let i=0,r=this.curves;i<r.length;i++){const o=r[i],s=o.isEllipseCurve?2*e:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?e*o.points.length:e,a=o.getPoints(s);for(let e=0;e<a.length;e++){const i=a[e];n&&n.equals(i)||(t.push(i),n=i)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push((new du[n.type]).fromJSON(n))}return this}}class pu extends hu{constructor(e){super(),this.type="Path",this.currentPoint=new hn,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new lu(this.currentPoint.clone(),new hn(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,i){const r=new uu(this.currentPoint.clone(),new hn(e,t),new hn(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}bezierCurveTo(e,t,n,i,r,o){const s=new au(this.currentPoint.clone(),new hn(e,t),new hn(n,i),new hn(r,o));return this.curves.push(s),this.currentPoint.set(r,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new cu(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,i,r,o){const s=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(e+s,t+a,n,i,r,o),this}absarc(e,t,n,i,r,o){return this.absellipse(e,t,n,n,i,r,o),this}ellipse(e,t,n,i,r,o,s,a){const l=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+l,t+u,n,i,r,o,s,a),this}absellipse(e,t,n,i,r,o,s,a){const l=new Zl(e,t,n,i,r,o,s,a);if(this.curves.length>0){const e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);const u=l.getPoint(1);return this.currentPoint.copy(u),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class fu extends pu{constructor(e){super(e),this.uuid=on(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push((new pu).fromJSON(n))}return this}}const mu=function(e,t,n=2){const i=t&&t.length,r=i?t[0]*n:e.length;let o=gu(e,0,r,n,!0);const s=[];if(!o||o.next===o.prev)return s;let a,l,u,c,d,h,p;if(i&&(o=function(e,t,n,i){const r=[];let o,s,a,l,u;for(o=0,s=t.length;o<s;o++)a=t[o]*i,l=o<s-1?t[o+1]*i:e.length,u=gu(e,a,l,i,!1),u===u.next&&(u.steiner=!0),r.push(Au(u));for(r.sort(bu),o=0;o<r.length;o++)n=Tu(r[o],n);return n}(e,t,o,n)),e.length>80*n){a=u=e[0],l=c=e[1];for(let t=n;t<r;t+=n)d=e[t],h=e[t+1],d<a&&(a=d),h<l&&(l=h),d>u&&(u=d),h>c&&(c=h);p=Math.max(u-a,c-l),p=0!==p?32767/p:0}return _u(o,s,n,a,l,p,0),s};function gu(e,t,n,i,r){let o,s;if(r===function(e,t,n,i){let r=0;for(let o=t,s=n-i;o<n;o+=i)r+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return r}(e,t,n,i)>0)for(o=t;o<n;o+=i)s=ku(o,e[o],e[o+1],s);else for(o=n-i;o>=t;o-=i)s=ku(o,e[o],e[o+1],s);return s&&Pu(s,s.next)&&(Fu(s),s=s.next),s}function vu(e,t){if(!e)return e;t||(t=e);let n,i=e;do{if(n=!1,i.steiner||!Pu(i,i.next)&&0!==Iu(i.prev,i,i.next))i=i.next;else{if(Fu(i),i=t=i.prev,i===i.next)break;n=!0}}while(n||i!==t);return t}function _u(e,t,n,i,r,o,s){if(!e)return;!s&&o&&function(e,t,n,i){let r=e;do{0===r.z&&(r.z=Mu(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){let t,n,i,r,o,s,a,l,u=1;do{for(n=e,e=null,o=null,s=0;n;){for(s++,i=n,a=0,t=0;t<u&&(a++,i=i.nextZ,i);t++);for(l=u;a>0||l>0&&i;)0!==a&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,l--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;n=i}o.nextZ=null,u*=2}while(s>1)}(r)}(e,i,r,o);let a,l,u=e;for(;e.prev!==e.next;)if(a=e.prev,l=e.next,o?xu(e,i,r,o):yu(e))t.push(a.i/n|0),t.push(e.i/n|0),t.push(l.i/n|0),Fu(e),e=l.next,u=l.next;else if((e=l)===u){s?1===s?_u(e=Su(vu(e),t,n),t,n,i,r,o,2):2===s&&Eu(e,t,n,i,r,o):_u(vu(e),t,n,i,r,o,1);break}}function yu(e){const t=e.prev,n=e,i=e.next;if(Iu(t,n,i)>=0)return!1;const r=t.x,o=n.x,s=i.x,a=t.y,l=n.y,u=i.y,c=r<o?r<s?r:s:o<s?o:s,d=a<l?a<u?a:u:l<u?l:u,h=r>o?r>s?r:s:o>s?o:s,p=a>l?a>u?a:u:l>u?l:u;let f=i.next;for(;f!==t;){if(f.x>=c&&f.x<=h&&f.y>=d&&f.y<=p&&Ru(r,a,o,l,s,u,f.x,f.y)&&Iu(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function xu(e,t,n,i){const r=e.prev,o=e,s=e.next;if(Iu(r,o,s)>=0)return!1;const a=r.x,l=o.x,u=s.x,c=r.y,d=o.y,h=s.y,p=a<l?a<u?a:u:l<u?l:u,f=c<d?c<h?c:h:d<h?d:h,m=a>l?a>u?a:u:l>u?l:u,g=c>d?c>h?c:h:d>h?d:h,v=Mu(p,f,t,n,i),_=Mu(m,g,t,n,i);let y=e.prevZ,x=e.nextZ;for(;y&&y.z>=v&&x&&x.z<=_;){if(y.x>=p&&y.x<=m&&y.y>=f&&y.y<=g&&y!==r&&y!==s&&Ru(a,c,l,d,u,h,y.x,y.y)&&Iu(y.prev,y,y.next)>=0)return!1;if(y=y.prevZ,x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==s&&Ru(a,c,l,d,u,h,x.x,x.y)&&Iu(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;y&&y.z>=v;){if(y.x>=p&&y.x<=m&&y.y>=f&&y.y<=g&&y!==r&&y!==s&&Ru(a,c,l,d,u,h,y.x,y.y)&&Iu(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;x&&x.z<=_;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==s&&Ru(a,c,l,d,u,h,x.x,x.y)&&Iu(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function Su(e,t,n){let i=e;do{const r=i.prev,o=i.next.next;!Pu(r,o)&&Ou(r,i,i.next,o)&&Du(r,o)&&Du(o,r)&&(t.push(r.i/n|0),t.push(i.i/n|0),t.push(o.i/n|0),Fu(i),Fu(i.next),i=e=o),i=i.next}while(i!==e);return vu(i)}function Eu(e,t,n,i,r,o){let s=e;do{let e=s.next.next;for(;e!==s.prev;){if(s.i!==e.i&&Cu(s,e)){let a=Uu(s,e);return s=vu(s,s.next),a=vu(a,a.next),_u(s,t,n,i,r,o,0),void _u(a,t,n,i,r,o,0)}e=e.next}s=s.next}while(s!==e)}function bu(e,t){return e.x-t.x}function Tu(e,t){const n=function(e,t){let n,i=t,r=-1/0;const o=e.x,s=e.y;do{if(s<=i.y&&s>=i.next.y&&i.next.y!==i.y){const e=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=o&&e>r&&(r=e,n=i.x<i.next.x?i:i.next,e===o))return n}i=i.next}while(i!==t);if(!n)return null;const a=n,l=n.x,u=n.y;let c,d=1/0;i=n;do{o>=i.x&&i.x>=l&&o!==i.x&&Ru(s<u?o:r,s,l,u,s<u?r:o,s,i.x,i.y)&&(c=Math.abs(s-i.y)/(o-i.x),Du(i,e)&&(c<d||c===d&&(i.x>n.x||i.x===n.x&&wu(n,i)))&&(n=i,d=c)),i=i.next}while(i!==a);return n}(e,t);if(!n)return t;const i=Uu(n,e);return vu(i,i.next),vu(n,n.next)}function wu(e,t){return Iu(e.prev,e,t.prev)<0&&Iu(t.next,e,e.next)<0}function Mu(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Au(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Ru(e,t,n,i,r,o,s,a){return(r-s)*(t-a)>=(e-s)*(o-a)&&(e-s)*(i-a)>=(n-s)*(t-a)&&(n-s)*(o-a)>=(r-s)*(i-a)}function Cu(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Ou(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(Du(e,t)&&Du(t,e)&&function(e,t){let n=e,i=!1;const r=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(Iu(e.prev,e,t.prev)||Iu(e,t.prev,t))||Pu(e,t)&&Iu(e.prev,e,e.next)>0&&Iu(t.prev,t,t.next)>0)}function Iu(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Pu(e,t){return e.x===t.x&&e.y===t.y}function Ou(e,t,n,i){const r=Lu(Iu(e,t,n)),o=Lu(Iu(e,t,i)),s=Lu(Iu(n,i,e)),a=Lu(Iu(n,i,t));return r!==o&&s!==a||(!(0!==r||!Nu(e,n,t))||(!(0!==o||!Nu(e,i,t))||(!(0!==s||!Nu(n,e,i))||!(0!==a||!Nu(n,t,i)))))}function Nu(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Lu(e){return e>0?1:e<0?-1:0}function Du(e,t){return Iu(e.prev,e,e.next)<0?Iu(e,t,e.next)>=0&&Iu(e,e.prev,t)>=0:Iu(e,t,e.prev)<0||Iu(e,e.next,t)<0}function Uu(e,t){const n=new Bu(e.i,e.x,e.y),i=new Bu(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,o.next=i,i.prev=o,i}function ku(e,t,n,i){const r=new Bu(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Fu(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Bu(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class Hu{static area(e){const t=e.length;let n=0;for(let i=t-1,r=0;r<t;i=r++)n+=e[i].x*e[r].y-e[r].x*e[i].y;return.5*n}static isClockWise(e){return Hu.area(e)<0}static triangulateShape(e,t){const n=[],i=[],r=[];Vu(e),zu(n,e);let o=e.length;t.forEach(Vu);for(let a=0;a<t.length;a++)i.push(o),o+=t[a].length,zu(n,t[a]);const s=mu(n,i);for(let a=0;a<s.length;a+=3)r.push(s.slice(a,a+3));return r}}function Vu(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function zu(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}class Gu extends br{constructor(e=new fu([new hn(.5,.5),new hn(-.5,.5),new hn(-.5,-.5),new hn(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,i=[],r=[];for(let s=0,a=e.length;s<a;s++){o(e[s])}function o(e){const o=[],s=void 0!==t.curveSegments?t.curveSegments:12,a=void 0!==t.steps?t.steps:1,l=void 0!==t.depth?t.depth:1;let u=void 0===t.bevelEnabled||t.bevelEnabled,c=void 0!==t.bevelThickness?t.bevelThickness:.2,d=void 0!==t.bevelSize?t.bevelSize:c-.1,h=void 0!==t.bevelOffset?t.bevelOffset:0,p=void 0!==t.bevelSegments?t.bevelSegments:3;const f=t.extrudePath,m=void 0!==t.UVGenerator?t.UVGenerator:Wu;let g,v,_,y,x,S=!1;f&&(g=f.getSpacedPoints(a),S=!0,u=!1,v=f.computeFrenetFrames(a,!1),_=new Hn,y=new Hn,x=new Hn),u||(p=0,c=0,d=0,h=0);const E=e.extractPoints(s);let b=E.shape;const T=E.holes;if(!Hu.isClockWise(b)){b=b.reverse();for(let e=0,t=T.length;e<t;e++){const t=T[e];Hu.isClockWise(t)&&(T[e]=t.reverse())}}const w=Hu.triangulateShape(b,T),M=b;for(let t=0,n=T.length;t<n;t++){const e=T[t];b=b.concat(e)}function A(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().addScaledVector(t,n)}const R=b.length,C=w.length;function I(e,t,n){let i,r,o;const s=e.x-t.x,a=e.y-t.y,l=n.x-e.x,u=n.y-e.y,c=s*s+a*a,d=s*u-a*l;if(Math.abs(d)>Number.EPSILON){const d=Math.sqrt(c),h=Math.sqrt(l*l+u*u),p=t.x-a/d,f=t.y+s/d,m=((n.x-u/h-p)*u-(n.y+l/h-f)*l)/(s*u-a*l);i=p+s*m-e.x,r=f+a*m-e.y;const g=i*i+r*r;if(g<=2)return new hn(i,r);o=Math.sqrt(g/2)}else{let e=!1;s>Number.EPSILON?l>Number.EPSILON&&(e=!0):s<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(a)===Math.sign(u)&&(e=!0),e?(i=-a,r=s,o=Math.sqrt(c)):(i=s,r=a,o=Math.sqrt(c/2))}return new hn(i/o,r/o)}const P=[];for(let t=0,n=M.length,i=n-1,r=t+1;t<n;t++,i++,r++)i===n&&(i=0),r===n&&(r=0),P[t]=I(M[t],M[i],M[r]);const O=[];let N,L=P.concat();for(let t=0,n=T.length;t<n;t++){const e=T[t];N=[];for(let t=0,n=e.length,i=n-1,r=t+1;t<n;t++,i++,r++)i===n&&(i=0),r===n&&(r=0),N[t]=I(e[t],e[i],e[r]);O.push(N),L=L.concat(N)}for(let t=0;t<p;t++){const e=t/p,n=c*Math.cos(e*Math.PI/2),i=d*Math.sin(e*Math.PI/2)+h;for(let t=0,r=M.length;t<r;t++){const e=A(M[t],P[t],i);k(e.x,e.y,-n)}for(let t=0,r=T.length;t<r;t++){const e=T[t];N=O[t];for(let t=0,r=e.length;t<r;t++){const r=A(e[t],N[t],i);k(r.x,r.y,-n)}}}const D=d+h;for(let t=0;t<R;t++){const e=u?A(b[t],L[t],D):b[t];S?(y.copy(v.normals[0]).multiplyScalar(e.x),_.copy(v.binormals[0]).multiplyScalar(e.y),x.copy(g[0]).add(y).add(_),k(x.x,x.y,x.z)):k(e.x,e.y,0)}for(let t=1;t<=a;t++)for(let e=0;e<R;e++){const n=u?A(b[e],L[e],D):b[e];S?(y.copy(v.normals[t]).multiplyScalar(n.x),_.copy(v.binormals[t]).multiplyScalar(n.y),x.copy(g[t]).add(y).add(_),k(x.x,x.y,x.z)):k(n.x,n.y,l/a*t)}for(let t=p-1;t>=0;t--){const e=t/p,n=c*Math.cos(e*Math.PI/2),i=d*Math.sin(e*Math.PI/2)+h;for(let t=0,r=M.length;t<r;t++){const e=A(M[t],P[t],i);k(e.x,e.y,l+n)}for(let t=0,r=T.length;t<r;t++){const e=T[t];N=O[t];for(let t=0,r=e.length;t<r;t++){const r=A(e[t],N[t],i);S?k(r.x,r.y+g[a-1].y,g[a-1].x+n):k(r.x,r.y,l+n)}}}function U(e,t){let n=e.length;for(;--n>=0;){const i=n;let r=n-1;r<0&&(r=e.length-1);for(let e=0,n=a+2*p;e<n;e++){const n=R*e,o=R*(e+1);B(t+i+n,t+r+n,t+r+o,t+i+o)}}}function k(e,t,n){o.push(e),o.push(t),o.push(n)}function F(e,t,r){H(e),H(t),H(r);const o=i.length/3,s=m.generateTopUV(n,i,o-3,o-2,o-1);V(s[0]),V(s[1]),V(s[2])}function B(e,t,r,o){H(e),H(t),H(o),H(t),H(r),H(o);const s=i.length/3,a=m.generateSideWallUV(n,i,s-6,s-3,s-2,s-1);V(a[0]),V(a[1]),V(a[3]),V(a[1]),V(a[2]),V(a[3])}function H(e){i.push(o[3*e+0]),i.push(o[3*e+1]),i.push(o[3*e+2])}function V(e){r.push(e.x),r.push(e.y)}!function(){const e=i.length/3;if(u){let e=0,t=R*e;for(let n=0;n<C;n++){const e=w[n];F(e[2]+t,e[1]+t,e[0]+t)}e=a+2*p,t=R*e;for(let n=0;n<C;n++){const e=w[n];F(e[0]+t,e[1]+t,e[2]+t)}}else{for(let e=0;e<C;e++){const t=w[e];F(t[2],t[1],t[0])}for(let e=0;e<C;e++){const t=w[e];F(t[0]+R*a,t[1]+R*a,t[2]+R*a)}}n.addGroup(e,i.length/3-e,0)}(),function(){const e=i.length/3;let t=0;U(M,t),t+=M.length;for(let n=0,i=T.length;n<i;n++){const e=T[n];U(e,t),t+=e.length}n.addGroup(e,i.length/3-e,1)}()}this.setAttribute("position",new mr(i,3)),this.setAttribute("uv",new mr(r,2)),this.computeVertexNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(let i=0,r=e.length;i<r;i++){const t=e[i];n.shapes.push(t.uuid)}else n.shapes.push(e.uuid);n.options=Object.assign({},t),void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const n=[];for(let r=0,o=e.shapes.length;r<o;r++){const i=t[e.shapes[r]];n.push(i)}const i=e.options.extrudePath;return void 0!==i&&(e.options.extrudePath=(new du[i.type]).fromJSON(i)),new Gu(n,e.options)}}const Wu={generateTopUV:function(e,t,n,i,r){const o=t[3*n],s=t[3*n+1],a=t[3*i],l=t[3*i+1],u=t[3*r],c=t[3*r+1];return[new hn(o,s),new hn(a,l),new hn(u,c)]},generateSideWallUV:function(e,t,n,i,r,o){const s=t[3*n],a=t[3*n+1],l=t[3*n+2],u=t[3*i],c=t[3*i+1],d=t[3*i+2],h=t[3*r],p=t[3*r+1],f=t[3*r+2],m=t[3*o],g=t[3*o+1],v=t[3*o+2];return Math.abs(a-c)<Math.abs(s-u)?[new hn(s,1-l),new hn(u,1-d),new hn(h,1-f),new hn(m,1-v)]:[new hn(a,1-l),new hn(c,1-d),new hn(p,1-f),new hn(g,1-v)]}};class ju extends lr{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new or(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new or(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new hn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Mi,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class qu extends ju{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new hn(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return sn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new or(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new or(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new or(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class Xu extends lr{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new or(16777215),this.specular=new or(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new or(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new hn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Mi,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Yu extends lr{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new or(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new or(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new hn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Mi,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}function Ku(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}function Ju(e){const t=e.length,n=new Array(t);for(let i=0;i!==t;++i)n[i]=i;return n.sort(function(t,n){return e[t]-e[n]}),n}function $u(e,t,n){const i=e.length,r=new e.constructor(i);for(let o=0,s=0;s!==i;++o){const i=n[o]*t;for(let n=0;n!==t;++n)r[s++]=e[i+n]}return r}function Zu(e,t,n,i){let r=1,o=e[0];for(;void 0!==o&&void 0===o[i];)o=e[r++];if(void 0===o)return;let s=o[i];if(void 0!==s)if(Array.isArray(s))do{s=o[i],void 0!==s&&(t.push(o.time),n.push.apply(n,s)),o=e[r++]}while(void 0!==o);else if(void 0!==s.toArray)do{s=o[i],void 0!==s&&(t.push(o.time),s.toArray(n,n.length)),o=e[r++]}while(void 0!==o);else do{s=o[i],void 0!==s&&(t.push(o.time),n.push(s)),o=e[r++]}while(void 0!==o)}class Qu{constructor(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{let o;n:{i:if(!(e<i)){for(let o=n+2;;){if(void 0===i){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===o)break;if(r=i,i=t[++n],e<i)break t}o=t.length;break n}if(!(e>=r)){const s=t[1];e<s&&(n=2,r=s);for(let o=n-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(n===o)break;if(i=r,r=t[--n-1],e>=r)break t}o=n,n=0;break n}break e}for(;n<o;){const i=n+o>>>1;e<t[i]?o=i:n=i+1}if(i=t[n],r=t[n-1],void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===i)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i;for(let o=0;o!==i;++o)t[o]=n[r+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class ec extends Qu{constructor(e,t,n,i){super(e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:At,endingEnd:At}}intervalChanged_(e,t,n){const i=this.parameterPositions;let r=e-2,o=e+1,s=i[r],a=i[o];if(void 0===s)switch(this.getSettings_().endingStart){case Rt:r=e,s=2*t-n;break;case Ct:r=i.length-2,s=t+i[r]-i[r+1];break;default:r=e,s=n}if(void 0===a)switch(this.getSettings_().endingEnd){case Rt:o=e,a=2*n-t;break;case Ct:o=1,a=n+i[1]-i[0];break;default:o=e-1,a=t}const l=.5*(n-t),u=this.valueSize;this._weightPrev=l/(t-s),this._weightNext=l/(a-n),this._offsetPrev=r*u,this._offsetNext=o*u}interpolate_(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,l=a-s,u=this._offsetPrev,c=this._offsetNext,d=this._weightPrev,h=this._weightNext,p=(n-t)/(i-t),f=p*p,m=f*p,g=-d*m+2*d*f-d*p,v=(1+d)*m+(-1.5-2*d)*f+(-.5+d)*p+1,_=(-1-h)*m+(1.5+h)*f+.5*p,y=h*m-h*f;for(let x=0;x!==s;++x)r[x]=g*o[u+x]+v*o[l+x]+_*o[a+x]+y*o[c+x];return r}}class tc extends Qu{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,l=a-s,u=(n-t)/(i-t),c=1-u;for(let d=0;d!==s;++d)r[d]=o[l+d]*c+o[a+d]*u;return r}}class nc extends Qu{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class ic{constructor(e,t,n,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Ku(t,this.TimeBufferType),this.values=Ku(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:Ku(e.times,Array),values:Ku(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new nc(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new tc(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new ec(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Tt:t=this.InterpolantFactoryMethodDiscrete;break;case wt:t=this.InterpolantFactoryMethodLinear;break;case Mt:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Tt;case this.InterpolantFactoryMethodLinear:return wt;case this.InterpolantFactoryMethodSmooth:return Mt}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this}trim(e,t){const n=this.times,i=n.length;let r=0,o=i-1;for(;r!==i&&n[r]<e;)++r;for(;-1!==o&&n[o]>t;)--o;if(++o,0!==r||o!==i){r>=o&&(o=Math.max(o,1),r=o-1);const e=this.getValueSize();this.times=n.slice(r,o),this.values=this.values.slice(r*e,o*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let a=0;a!==r;a++){const t=n[a];if("number"==typeof t&&isNaN(t)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,t),e=!1;break}if(null!==o&&o>t){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,t,o),e=!1;break}o=t}if(void 0!==i&&(s=i,ArrayBuffer.isView(s)&&!(s instanceof DataView)))for(let a=0,l=i.length;a!==l;++a){const t=i[a];if(isNaN(t)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,t),e=!1;break}}var s;return e}optimize(){const e=this.times.slice(),t=this.values.slice(),n=this.getValueSize(),i=this.getInterpolation()===Mt,r=e.length-1;let o=1;for(let s=1;s<r;++s){let r=!1;const a=e[s];if(a!==e[s+1]&&(1!==s||a!==e[0]))if(i)r=!0;else{const e=s*n,i=e-n,o=e+n;for(let s=0;s!==n;++s){const n=t[e+s];if(n!==t[i+s]||n!==t[o+s]){r=!0;break}}}if(r){if(s!==o){e[o]=e[s];const i=s*n,r=o*n;for(let e=0;e!==n;++e)t[r+e]=t[i+e]}++o}}if(r>0){e[o]=e[r];for(let e=r*n,i=o*n,s=0;s!==n;++s)t[i+s]=t[e+s];++o}return o!==e.length?(this.times=e.slice(0,o),this.values=t.slice(0,o*n)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}ic.prototype.TimeBufferType=Float32Array,ic.prototype.ValueBufferType=Float32Array,ic.prototype.DefaultInterpolation=wt;class rc extends ic{constructor(e,t,n){super(e,t,n)}}rc.prototype.ValueTypeName="bool",rc.prototype.ValueBufferType=Array,rc.prototype.DefaultInterpolation=Tt,rc.prototype.InterpolantFactoryMethodLinear=void 0,rc.prototype.InterpolantFactoryMethodSmooth=void 0;class oc extends ic{}oc.prototype.ValueTypeName="color";class sc extends ic{}sc.prototype.ValueTypeName="number";class ac extends Qu{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=(n-t)/(i-t);let l=e*s;for(let u=l+s;l!==u;l+=4)Bn.slerpFlat(r,0,o,l-s,o,l,a);return r}}class lc extends ic{InterpolantFactoryMethodLinear(e){return new ac(this.times,this.values,this.getValueSize(),e)}}lc.prototype.ValueTypeName="quaternion",lc.prototype.InterpolantFactoryMethodSmooth=void 0;class uc extends ic{constructor(e,t,n){super(e,t,n)}}uc.prototype.ValueTypeName="string",uc.prototype.ValueBufferType=Array,uc.prototype.DefaultInterpolation=Tt,uc.prototype.InterpolantFactoryMethodLinear=void 0,uc.prototype.InterpolantFactoryMethodSmooth=void 0;class cc extends ic{}cc.prototype.ValueTypeName="vector";class dc{constructor(e="",t=-1,n=[],i=2500){this.name=e,this.tracks=n,this.duration=t,this.blendMode=i,this.uuid=on(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,i=1/(e.fps||1);for(let o=0,s=n.length;o!==s;++o)t.push(hc(n[o]).scale(i));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,o=n.length;r!==o;++r)t.push(ic.toJSON(n[r]));return i}static CreateFromMorphTargetSequence(e,t,n,i){const r=t.length,o=[];for(let s=0;s<r;s++){let e=[],a=[];e.push((s+r-1)%r,s,(s+1)%r),a.push(0,1,0);const l=Ju(e);e=$u(e,1,l),a=$u(a,1,l),i||0!==e[0]||(e.push(r),a.push(a[0])),o.push(new sc(".morphTargetInfluences["+t[s].name+"]",e,a).scale(1/n))}return new this(e,-1,o)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const t=e;n=t.geometry&&t.geometry.animations||t.animations}for(let i=0;i<n.length;i++)if(n[i].name===t)return n[i];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const i={},r=/^([\w-]*?)([\d]+)$/;for(let s=0,a=e.length;s<a;s++){const t=e[s],n=t.name.match(r);if(n&&n.length>1){const e=n[1];let r=i[e];r||(i[e]=r=[]),r.push(t)}}const o=[];for(const s in i)o.push(this.CreateFromMorphTargetSequence(s,i[s],t,n));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(e,t,n,i,r){if(0!==n.length){const o=[],s=[];Zu(n,o,s,i),0!==o.length&&r.push(new e(t,o,s))}},i=[],r=e.name||"default",o=e.fps||30,s=e.blendMode;let a=e.length||-1;const l=e.hierarchy||[];for(let u=0;u<l.length;u++){const e=l[u].keys;if(e&&0!==e.length)if(e[0].morphTargets){const t={};let n;for(n=0;n<e.length;n++)if(e[n].morphTargets)for(let i=0;i<e[n].morphTargets.length;i++)t[e[n].morphTargets[i]]=-1;for(const r in t){const t=[],o=[];for(let i=0;i!==e[n].morphTargets.length;++i){const i=e[n];t.push(i.time),o.push(i.morphTarget===r?1:0)}i.push(new sc(".morphTargetInfluence["+r+"]",t,o))}a=t.length*o}else{const r=".bones["+t[u].name+"]";n(cc,r+".position",e,"pos",i),n(lc,r+".quaternion",e,"rot",i),n(cc,r+".scale",e,"scl",i)}}if(0===i.length)return null;return new this(r,a,i,s)}resetDuration(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){const n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function hc(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return sc;case"vector":case"vector2":case"vector3":case"vector4":return cc;case"color":return oc;case"quaternion":return lc;case"bool":case"boolean":return rc;case"string":return uc}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],n=[];Zu(e.keys,t,n,"value"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const pc={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class fc{constructor(e,t,n){const i=this;let r,o=!1,s=0,a=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){a++,!1===o&&void 0!==i.onStart&&i.onStart(e,s,a),o=!0},this.itemEnd=function(e){s++,void 0!==i.onProgress&&i.onProgress(e,s,a),s===a&&(o=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(e){void 0!==i.onError&&i.onError(e)},this.resolveURL=function(e){return r?r(e):e},this.setURLModifier=function(e){return r=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=l.length;t<n;t+=2){const n=l[t],i=l[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return i}return null}}}const mc=new fc;class gc{constructor(e){this.manager=void 0!==e?e:mc,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(i,r){n.load(e,i,t,r)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}gc.DEFAULT_MATERIAL_NAME="__DEFAULT";const vc={};class _c extends Error{constructor(e,t){super(e),this.response=t}}class yc extends gc{constructor(e){super(e)}load(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=pc.get(e);if(void 0!==r)return this.manager.itemStart(e),setTimeout(()=>{t&&t(r),this.manager.itemEnd(e)},0),r;if(void 0!==vc[e])return void vc[e].push({onLoad:t,onProgress:n,onError:i});vc[e]=[],vc[e].push({onLoad:t,onProgress:n,onError:i});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),s=this.mimeType,a=this.responseType;fetch(o).then(t=>{if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;const n=vc[e],i=t.body.getReader(),r=t.headers.get("X-File-Size")||t.headers.get("Content-Length"),o=r?parseInt(r):0,s=0!==o;let a=0;const l=new ReadableStream({start(e){!function t(){i.read().then(({done:i,value:r})=>{if(i)e.close();else{a+=r.byteLength;const i=new ProgressEvent("progress",{lengthComputable:s,loaded:a,total:o});for(let e=0,t=n.length;e<t;e++){const t=n[e];t.onProgress&&t.onProgress(i)}e.enqueue(r),t()}},t=>{e.error(t)})}()}});return new Response(l)}throw new _c(`fetch for "${t.url}" responded with ${t.status}: ${t.statusText}`,t)}).then(e=>{switch(a){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then(e=>(new DOMParser).parseFromString(e,s));case"json":return e.json();default:if(void 0===s)return e.text();{const t=/charset="?([^;"\s]*)"?/i.exec(s),n=t&&t[1]?t[1].toLowerCase():void 0,i=new TextDecoder(n);return e.arrayBuffer().then(e=>i.decode(e))}}}).then(t=>{pc.add(e,t);const n=vc[e];delete vc[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onLoad&&i.onLoad(t)}}).catch(t=>{const n=vc[e];if(void 0===n)throw this.manager.itemError(e),t;delete vc[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onError&&i.onError(t)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class xc extends gc{constructor(e){super(e)}load(e,t,n,i){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=pc.get(e);if(void 0!==o)return r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o;const s=gn("img");function a(){u(),pc.add(e,this),t&&t(this),r.manager.itemEnd(e)}function l(t){u(),i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)}function u(){s.removeEventListener("load",a,!1),s.removeEventListener("error",l,!1)}return s.addEventListener("load",a,!1),s.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),r.manager.itemStart(e),s.src=e,s}}class Sc extends gc{constructor(e){super(e)}load(e,t,n,i){const r=new Nn,o=new xc(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(e){r.image=e,r.needsUpdate=!0,void 0!==t&&t(r)},n,i),r}}class Ec extends Gi{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new or(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),void 0!==this.target&&(t.object.target=this.target.uuid),t}}const bc=new gi,Tc=new Hn,wc=new Hn;class Mc{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new hn(512,512),this.map=null,this.mapPass=null,this.matrix=new gi,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new co,this._frameExtents=new hn(1,1),this._viewportCount=1,this._viewports=[new Ln(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;Tc.setFromMatrixPosition(e.matrixWorld),t.position.copy(Tc),wc.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(wc),t.updateMatrixWorld(),bc.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(bc),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(bc)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 1!==this.intensity&&(e.intensity=this.intensity),0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Ac extends Mc{constructor(){super(new Qr(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,n=2*rn*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;n===t.fov&&i===t.aspect&&r===t.far||(t.fov=n,t.aspect=i,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class Rc extends Ec{constructor(e,t,n=0,i=Math.PI/3,r=0,o=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Gi.DEFAULT_UP),this.updateMatrix(),this.target=new Gi,this.distance=n,this.angle=i,this.penumbra=r,this.decay=o,this.map=null,this.shadow=new Ac}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const Cc=new gi,Ic=new Hn,Pc=new Hn;class Oc extends Mc{constructor(){super(new Qr(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new hn(4,2),this._viewportCount=6,this._viewports=[new Ln(2,1,1,1),new Ln(0,1,1,1),new Ln(3,1,1,1),new Ln(1,1,1,1),new Ln(3,0,1,1),new Ln(1,0,1,1)],this._cubeDirections=[new Hn(1,0,0),new Hn(-1,0,0),new Hn(0,0,1),new Hn(0,0,-1),new Hn(0,1,0),new Hn(0,-1,0)],this._cubeUps=[new Hn(0,1,0),new Hn(0,1,0),new Hn(0,1,0),new Hn(0,1,0),new Hn(0,0,1),new Hn(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,i=this.matrix,r=e.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),Ic.setFromMatrixPosition(e.matrixWorld),n.position.copy(Ic),Pc.copy(n.position),Pc.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(Pc),n.updateMatrixWorld(),i.makeTranslation(-Ic.x,-Ic.y,-Ic.z),Cc.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Cc)}}class Nc extends Ec{constructor(e,t,n=0,i=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new Oc}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class Lc extends Mc{constructor(){super(new Ao(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Dc extends Ec{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Gi.DEFAULT_UP),this.updateMatrix(),this.target=new Gi,this.shadow=new Lc}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class Uc extends Ec{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class kc{static decodeText(e){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),"undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let i=0,r=e.length;i<r;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch(n){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class Fc extends gc{constructor(e){super(e),this.isImageBitmapLoader=!0,"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=pc.get(e);if(void 0!==o)return r.manager.itemStart(e),o.then?void o.then(n=>{t&&t(n),r.manager.itemEnd(e)}).catch(e=>{i&&i(e)}):(setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o);const s={};s.credentials="anonymous"===this.crossOrigin?"same-origin":"include",s.headers=this.requestHeader;const a=fetch(e,s).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(n){return pc.add(e,n),t&&t(n),r.manager.itemEnd(e),n}).catch(function(t){i&&i(t),pc.remove(e),r.manager.itemError(e),r.manager.itemEnd(e)});pc.add(e,a),r.manager.itemStart(e)}}let Bc;class Hc{static getContext(){return void 0===Bc&&(Bc=new(window.AudioContext||window.webkitAudioContext)),Bc}static setContext(e){Bc=e}}class Vc extends gc{constructor(e){super(e)}load(e,t,n,i){const r=this,o=new yc(this.manager);function s(t){i?i(t):console.error(t),r.manager.itemError(e)}o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(e){try{const n=e.slice(0);Hc.getContext().decodeAudioData(n,function(e){t(e)}).catch(s)}catch(n){s(n)}},n,i)}}class zc{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Gc(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=Gc();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function Gc(){return("undefined"==typeof performance?Date:performance).now()}const Wc=new Hn,jc=new Bn,qc=new Hn,Xc=new Hn;class Yc extends Gi{constructor(){super(),this.type="AudioListener",this.context=Hc.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new zc}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Wc,jc,qc),Xc.set(0,0,-1).applyQuaternion(jc),t.positionX){const e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Wc.x,e),t.positionY.linearRampToValueAtTime(Wc.y,e),t.positionZ.linearRampToValueAtTime(Wc.z,e),t.forwardX.linearRampToValueAtTime(Xc.x,e),t.forwardY.linearRampToValueAtTime(Xc.y,e),t.forwardZ.linearRampToValueAtTime(Xc.z,e),t.upX.linearRampToValueAtTime(n.x,e),t.upY.linearRampToValueAtTime(n.y,e),t.upZ.linearRampToValueAtTime(n.z,e)}else t.setPosition(Wc.x,Wc.y,Wc.z),t.setOrientation(Xc.x,Xc.y,Xc.z,n.x,n.y,n.z)}}class Kc extends Gi{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,null!==this.source&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(!1!==this._connected){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,!0===this.isPlaying&&void 0!==this.source.detune&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}class Jc{constructor(e,t,n){let i,r,o;switch(this.binding=e,this.valueSize=n,t){case"quaternion":i=this._slerp,r=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:i=this._lerp,r=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,i=this.valueSize,r=e*i+i;let o=this.cumulativeWeight;if(0===o){for(let e=0;e!==i;++e)n[r+e]=n[e];o=t}else{o+=t;const e=t/o;this._mixBufferRegion(n,r,0,e,i)}this.cumulativeWeight=o}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,i=e*t+t,r=this.cumulativeWeight,o=this.cumulativeWeightAdditive,s=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const e=t*this._origIndex;this._mixBufferRegion(n,i,e,1-r,t)}o>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*t,1,t);for(let a=t,l=t+t;a!==l;++a)if(n[a]!==n[a+t]){s.setValue(n,i);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,i=n*this._origIndex;e.getValue(t,i);for(let r=n,o=i;r!==o;++r)t[r]=t[i+r%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,i,r){if(i>=.5)for(let o=0;o!==r;++o)e[t+o]=e[n+o]}_slerp(e,t,n,i){Bn.slerpFlat(e,t,e,t,e,n,i)}_slerpAdditive(e,t,n,i,r){const o=this._workIndex*r;Bn.multiplyQuaternionsFlat(e,o,e,t,e,n),Bn.slerpFlat(e,t,e,t,e,o,i)}_lerp(e,t,n,i,r){const o=1-i;for(let s=0;s!==r;++s){const r=t+s;e[r]=e[r]*o+e[n+s]*i}}_lerpAdditive(e,t,n,i,r){for(let o=0;o!==r;++o){const r=t+o;e[r]=e[r]+e[n+o]*i}}}const $c="\\[\\]\\.:\\/",Zc=new RegExp("["+$c+"]","g"),Qc="[^"+$c+"]",ed="[^"+$c.replace("\\.","")+"]",td=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",Qc)+/(WCOD+)?/.source.replace("WCOD",ed)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Qc)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Qc)+"$"),nd=["material","materials","bones","map"];class id{constructor(e,t,n){this.path=t,this.parsedPath=n||id.parseTrackName(t),this.node=id.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new id.Composite(e,t,n):new id(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Zc,"")}static parseTrackName(e){const t=td.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const e=n.nodeName.substring(i+1);-1!==nd.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let i=0;i<e.length;i++){const r=e[i];if(r.name===t||r.uuid===t)return r;const o=n(r.children);if(o)return o}return null},i=n(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)e[t++]=n[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,i=t.propertyName;let r=t.propertyIndex;if(e||(e=id.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(n){let i=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===i){i=t;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==i){if(void 0===e[i])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[i]}}const o=e[i];if(void 0===o){const n=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+i+" but it wasn't found.",e)}let s=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?s=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(s=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[r]&&(r=e.morphTargetDictionary[r])}a=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else void 0!==o.fromArray&&void 0!==o.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(a=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=i;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][s]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}id.Composite=class{constructor(e,t,n){const i=n||id.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},id.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},id.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},id.prototype.GetterByBindingType=[id.prototype._getValue_direct,id.prototype._getValue_array,id.prototype._getValue_arrayElement,id.prototype._getValue_toArray],id.prototype.SetterByBindingTypeAndVersioning=[[id.prototype._setValue_direct,id.prototype._setValue_direct_setNeedsUpdate,id.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[id.prototype._setValue_array,id.prototype._setValue_array_setNeedsUpdate,id.prototype._setValue_array_setMatrixWorldNeedsUpdate],[id.prototype._setValue_arrayElement,id.prototype._setValue_arrayElement_setNeedsUpdate,id.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[id.prototype._setValue_fromArray,id.prototype._setValue_fromArray_setNeedsUpdate,id.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class rd{constructor(e,t,n=null,i=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=i;const r=t.tracks,o=r.length,s=new Array(o),a={endingStart:At,endingEnd:At};for(let l=0;l!==o;++l){const e=r[l].createInterpolant(null);s[l]=e,e.settings=a}this._interpolantSettings=a,this._interpolants=s,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const n=this._clip.duration,i=e._clip.duration,r=i/n,o=n/i;e.warp(1,r,t),this.warp(o,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const i=this._mixer,r=i.time,o=this.timeScale;let s=this._timeScaleInterpolant;null===s&&(s=i._lendControlInterpolant(),this._timeScaleInterpolant=s);const a=s.parameterPositions,l=s.sampleValues;return a[0]=r,a[1]=r+n,l[0]=e/o,l[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,i){if(!this.enabled)return void this._updateWeight(e);const r=this._startTime;if(null!==r){const i=(e-r)*n;i<0||0===n?t=0:(this._startTime=null,t=n*i)}t*=this._updateTimeScale(e);const o=this._updateTime(t),s=this._updateWeight(e);if(s>0){const e=this._interpolants,t=this._propertyBindings;if(2501===this.blendMode)for(let n=0,i=e.length;n!==i;++n)e[n].evaluate(o),t[n].accumulateAdditive(s);else for(let n=0,r=e.length;n!==r;++n)e[n].evaluate(o),t[n].accumulate(i,s)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(null!==n){const i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;if(null!==n){t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let i=this.time+e,r=this._loopCount;const o=2202===n;if(0===e)return-1===r||!o||1&~r?i:t-i;if(2200===n){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else{if(!(i<0)){this.time=i;break e}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===r&&(e>=0?(r=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),i>=t||i<0){const n=Math.floor(i/t);i-=t*n,r+=Math.abs(n);const s=this.repetitions-r;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){const t=e<0;this._setEndings(t,!t,o)}else this._setEndings(!1,!1,o);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=i;if(o&&!(1&~r))return t-i}return i}_setEndings(e,t,n){const i=this._interpolantSettings;n?(i.endingStart=Rt,i.endingEnd=Rt):(i.endingStart=e?this.zeroSlopeAtStart?Rt:At:Ct,i.endingEnd=t?this.zeroSlopeAtEnd?Rt:At:Ct)}_scheduleFading(e,t,n){const i=this._mixer,r=i.time;let o=this._weightInterpolant;null===o&&(o=i._lendControlInterpolant(),this._weightInterpolant=o);const s=o.parameterPositions,a=o.sampleValues;return s[0]=r,a[0]=t,s[1]=r+e,a[1]=n,this}}const od=new Float32Array(1);class sd extends Qt{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,i=e._clip.tracks,r=i.length,o=e._propertyBindings,s=e._interpolants,a=n.uuid,l=this._bindingsByRootAndName;let u=l[a];void 0===u&&(u={},l[a]=u);for(let c=0;c!==r;++c){const e=i[c],r=e.name;let l=u[r];if(void 0!==l)++l.referenceCount,o[c]=l;else{if(l=o[c],void 0!==l){null===l._cacheIndex&&(++l.referenceCount,this._addInactiveBinding(l,a,r));continue}const i=t&&t._propertyBindings[c].binding.parsedPath;l=new Jc(id.create(n,r,i),e.ValueTypeName,e.getValueSize()),++l.referenceCount,this._addInactiveBinding(l,a,r),o[c]=l}s[c].resultBuffer=l.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,n=e._clip.uuid,i=this._actionsByClip[n];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,n,t)}const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0===n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0===--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,n){const i=this._actions,r=this._actionsByClip;let o=r[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=o;else{const t=o.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=i.length,i.push(e),o.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;const r=e._clip.uuid,o=this._actionsByClip,s=o[r],a=s.knownActions,l=a[a.length-1],u=e._byClipCacheIndex;l._byClipCacheIndex=u,a[u]=l,a.pop(),e._byClipCacheIndex=null;delete s.actionByRoot[(e._localRoot||this._root).uuid],0===a.length&&delete o[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const e=t[n];0===--e.referenceCount&&this._removeInactiveBinding(e)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_addInactiveBinding(e,t,n){const i=this._bindingsByRootAndName,r=this._bindings;let o=i[t];void 0===o&&(o={},i[t]=o),o[n]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,i=n.rootNode.uuid,r=n.path,o=this._bindingsByRootAndName,s=o[i],a=t[t.length-1],l=e._cacheIndex;a._cacheIndex=l,t[l]=a,t.pop(),delete s[r],0===Object.keys(s).length&&delete o[i]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return void 0===n&&(n=new tc(new Float32Array(2),new Float32Array(2),1,od),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,r=t[i];e.__cacheIndex=i,t[i]=e,r.__cacheIndex=n,t[n]=r}clipAction(e,t,n){const i=t||this._root,r=i.uuid;let o="string"==typeof e?dc.findByName(i,e):e;const s=null!==o?o.uuid:e,a=this._actionsByClip[s];let l=null;if(void 0===n&&(n=null!==o?o.blendMode:It),void 0!==a){const e=a.actionByRoot[r];if(void 0!==e&&e.blendMode===n)return e;l=a.knownActions[0],null===o&&(o=l._clip)}if(null===o)return null;const u=new rd(this,o,t,n);return this._bindAction(u,l),this._addInactiveAction(u,s,r),u}existingAction(e,t){const n=t||this._root,i=n.uuid,r="string"==typeof e?dc.findByName(n,e):e,o=r?r.uuid:e,s=this._actionsByClip[o];return void 0!==s&&s.actionByRoot[i]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,i=this.time+=e,r=Math.sign(e),o=this._accuIndex^=1;for(let l=0;l!==n;++l){t[l]._update(i,e,r,o)}const s=this._bindings,a=this._nActiveBindings;for(let l=0;l!==a;++l)s[l].apply(o);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){const e=r.knownActions;for(let n=0,i=e.length;n!==i;++n){const i=e[n];this._deactivateAction(i);const r=i._cacheIndex,o=t[t.length-1];i._cacheIndex=null,i._byClipCacheIndex=null,o._cacheIndex=r,t[r]=o,t.pop(),this._removeInactiveBindingsForAction(i)}delete i[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const r in n){const e=n[r].actionByRoot[t];void 0!==e&&(this._deactivateAction(e),this._removeInactiveAction(e))}const i=this._bindingsByRootAndName[t];if(void 0!==i)for(const r in i){const e=i[r];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(e,t){const n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class ad{constructor(e,t,n,i,r){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=i,this.count=r,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}class ld{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(sn(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class ud extends zl{constructor(e=10,t=10,n=4473924,i=8947848){n=new or(n),i=new or(i);const r=t/2,o=e/t,s=e/2,a=[],l=[];for(let c=0,d=0,h=-s;c<=t;c++,h+=o){a.push(-s,0,h,s,0,h),a.push(h,0,-s,h,0,s);const e=c===r?n:i;e.toArray(l,d),d+=3,e.toArray(l,d),d+=3,e.toArray(l,d),d+=3,e.toArray(l,d),d+=3}const u=new br;u.setAttribute("position",new mr(a,3)),u.setAttribute("color",new mr(l,3));super(u,new Il({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class cd extends zl{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=new br;n.setAttribute("position",new mr(t,3)),n.setAttribute("color",new mr([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(n,new Il({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,n){const i=new or,r=this.geometry.attributes.color.array;return i.set(e),i.toArray(r,0),i.toArray(r,3),i.set(t),i.toArray(r,6),i.toArray(r,9),i.set(n),i.toArray(r,12),i.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class dd{constructor(){this.type="ShapePath",this.color=new or,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new pu,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,i){return this.currentPath.quadraticCurveTo(e,t,n,i),this}bezierCurveTo(e,t,n,i,r,o){return this.currentPath.bezierCurveTo(e,t,n,i,r,o),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(e,t){const n=t.length;let i=!1;for(let r=n-1,o=0;o<n;r=o++){let n=t[r],s=t[o],a=s.x-n.x,l=s.y-n.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(n=t[o],a=-a,s=t[r],l=-l),e.y<n.y||e.y>s.y)continue;if(e.y===n.y){if(e.x===n.x)return!0}else{const t=l*(e.x-n.x)-a*(e.y-n.y);if(0===t)return!0;if(t<0)continue;i=!i}}else{if(e.y!==n.y)continue;if(s.x<=e.x&&e.x<=n.x||n.x<=e.x&&e.x<=s.x)return!0}}return i}const n=Hu.isClockWise,i=this.subPaths;if(0===i.length)return[];let r,o,s;const a=[];if(1===i.length)return o=i[0],s=new fu,s.curves=o.curves,a.push(s),a;let l=!n(i[0].getPoints());l=e?!l:l;const u=[],c=[];let d,h,p=[],f=0;c[f]=void 0,p[f]=[];for(let m=0,g=i.length;m<g;m++)o=i[m],d=o.getPoints(),r=n(d),r=e?!r:r,r?(!l&&c[f]&&f++,c[f]={s:new fu,p:d},c[f].s.curves=o.curves,l&&f++,p[f]=[]):p[f].push({h:o,p:d[0]});if(!c[0])return function(e){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n],r=new fu;r.curves=i.curves,t.push(r)}return t}(i);if(c.length>1){let e=!1,n=0;for(let t=0,i=c.length;t<i;t++)u[t]=[];for(let i=0,r=c.length;i<r;i++){const r=p[i];for(let o=0;o<r.length;o++){const s=r[o];let a=!0;for(let r=0;r<c.length;r++)t(s.p,c[r].p)&&(i!==r&&n++,a?(a=!1,u[r].push(s)):e=!0);a&&u[i].push(s)}}n>0&&!1===e&&(p=u)}for(let m=0,g=c.length;m<g;m++){s=c[m].s,a.push(s),h=p[m];for(let e=0,t=h.length;e<t;e++)s.holes.push(h[e].h)}return a}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:B}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=B);const hd={type:"change"},pd={type:"start"},fd={type:"end"},md=new mi,gd=new ao,vd=Math.cos(70*dn.DEG2RAD);class _d extends Qt{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new Hn,this.cursor=new Hn,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:H,MIDDLE:V,RIGHT:z},this.touches={ONE:G,TWO:j},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return s.phi},this.getAzimuthalAngle=function(){return s.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(e){e.addEventListener("keydown",ne),this._domElementKeyEvents=e},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",ne),this._domElementKeyEvents=null},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(hd),n.update(),r=i.NONE},this.update=function(){const t=new Hn,c=(new Bn).setFromUnitVectors(e.up,new Hn(0,1,0)),d=c.clone().invert(),h=new Hn,p=new Bn,f=new Hn,m=2*Math.PI;return function(g=null){const v=n.object.position;t.copy(v).sub(n.target),t.applyQuaternion(c),s.setFromVector3(t),n.autoRotate&&r===i.NONE&&M(function(e){return null!==e?2*Math.PI/60*n.autoRotateSpeed*e:2*Math.PI/60/60*n.autoRotateSpeed}(g)),n.enableDamping?(s.theta+=a.theta*n.dampingFactor,s.phi+=a.phi*n.dampingFactor):(s.theta+=a.theta,s.phi+=a.phi);let _=n.minAzimuthAngle,E=n.maxAzimuthAngle;isFinite(_)&&isFinite(E)&&(_<-Math.PI?_+=m:_>Math.PI&&(_-=m),E<-Math.PI?E+=m:E>Math.PI&&(E-=m),s.theta=_<=E?Math.max(_,Math.min(E,s.theta)):s.theta>(_+E)/2?Math.max(_,s.theta):Math.min(E,s.theta)),s.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,s.phi)),s.makeSafe(),!0===n.enableDamping?n.target.addScaledVector(u,n.dampingFactor):n.target.add(u),n.target.sub(n.cursor),n.target.clampLength(n.minTargetRadius,n.maxTargetRadius),n.target.add(n.cursor);let b=!1;if(n.zoomToCursor&&S||n.object.isOrthographicCamera)s.radius=L(s.radius);else{const e=s.radius;s.radius=L(s.radius*l),b=e!=s.radius}if(t.setFromSpherical(s),t.applyQuaternion(d),v.copy(n.target).add(t),n.object.lookAt(n.target),!0===n.enableDamping?(a.theta*=1-n.dampingFactor,a.phi*=1-n.dampingFactor,u.multiplyScalar(1-n.dampingFactor)):(a.set(0,0,0),u.set(0,0,0)),n.zoomToCursor&&S){let i=null;if(n.object.isPerspectiveCamera){const e=t.length();i=L(e*l);const r=e-i;n.object.position.addScaledVector(y,r),n.object.updateMatrixWorld(),b=!!r}else if(n.object.isOrthographicCamera){const e=new Hn(x.x,x.y,0);e.unproject(n.object);const r=n.object.zoom;n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/l)),n.object.updateProjectionMatrix(),b=r!==n.object.zoom;const o=new Hn(x.x,x.y,0);o.unproject(n.object),n.object.position.sub(o).add(e),n.object.updateMatrixWorld(),i=t.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),n.zoomToCursor=!1;null!==i&&(this.screenSpacePanning?n.target.set(0,0,-1).transformDirection(n.object.matrix).multiplyScalar(i).add(n.object.position):(md.origin.copy(n.object.position),md.direction.set(0,0,-1).transformDirection(n.object.matrix),Math.abs(n.object.up.dot(md.direction))<vd?e.lookAt(n.target):(gd.setFromNormalAndCoplanarPoint(n.object.up,n.target),md.intersectPlane(gd,n.target))))}else if(n.object.isOrthographicCamera){const e=n.object.zoom;n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/l)),e!==n.object.zoom&&(n.object.updateProjectionMatrix(),b=!0)}return l=1,S=!1,!!(b||h.distanceToSquared(n.object.position)>o||8*(1-p.dot(n.object.quaternion))>o||f.distanceToSquared(n.target)>o)&&(n.dispatchEvent(hd),h.copy(n.object.position),p.copy(n.object.quaternion),f.copy(n.target),!0)}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",re),n.domElement.removeEventListener("pointerdown",J),n.domElement.removeEventListener("pointercancel",Z),n.domElement.removeEventListener("wheel",Q),n.domElement.removeEventListener("pointermove",$),n.domElement.removeEventListener("pointerup",Z);n.domElement.getRootNode().removeEventListener("keydown",ee,{capture:!0}),null!==n._domElementKeyEvents&&(n._domElementKeyEvents.removeEventListener("keydown",ne),n._domElementKeyEvents=null)};const n=this,i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let r=i.NONE;const o=1e-6,s=new ld,a=new ld;let l=1;const u=new Hn,c=new hn,d=new hn,h=new hn,p=new hn,f=new hn,m=new hn,g=new hn,v=new hn,_=new hn,y=new Hn,x=new hn;let S=!1;const E=[],b={};let T=!1;function w(e){const t=Math.abs(.01*e);return Math.pow(.95,n.zoomSpeed*t)}function M(e){a.theta-=e}function A(e){a.phi-=e}const R=function(){const e=new Hn;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),u.add(e)}}(),C=function(){const e=new Hn;return function(t,i){!0===n.screenSpacePanning?e.setFromMatrixColumn(i,1):(e.setFromMatrixColumn(i,0),e.crossVectors(n.object.up,e)),e.multiplyScalar(t),u.add(e)}}(),I=function(){const e=new Hn;return function(t,i){const r=n.domElement;if(n.object.isPerspectiveCamera){const o=n.object.position;e.copy(o).sub(n.target);let s=e.length();s*=Math.tan(n.object.fov/2*Math.PI/180),R(2*t*s/r.clientHeight,n.object.matrix),C(2*i*s/r.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(R(t*(n.object.right-n.object.left)/n.object.zoom/r.clientWidth,n.object.matrix),C(i*(n.object.top-n.object.bottom)/n.object.zoom/r.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function P(e){n.object.isPerspectiveCamera||n.object.isOrthographicCamera?l/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function O(e){n.object.isPerspectiveCamera||n.object.isOrthographicCamera?l*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function N(e,t){if(!n.zoomToCursor)return;S=!0;const i=n.domElement.getBoundingClientRect(),r=e-i.left,o=t-i.top,s=i.width,a=i.height;x.x=r/s*2-1,x.y=-o/a*2+1,y.set(x.x,x.y,1).unproject(n.object).sub(n.object.position).normalize()}function L(e){return Math.max(n.minDistance,Math.min(n.maxDistance,e))}function D(e){c.set(e.clientX,e.clientY)}function U(e){p.set(e.clientX,e.clientY)}function k(e){if(1===E.length)c.set(e.pageX,e.pageY);else{const t=se(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);c.set(n,i)}}function F(e){if(1===E.length)p.set(e.pageX,e.pageY);else{const t=se(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);p.set(n,i)}}function B(e){const t=se(e),n=e.pageX-t.x,i=e.pageY-t.y,r=Math.sqrt(n*n+i*i);g.set(0,r)}function X(e){if(1==E.length)d.set(e.pageX,e.pageY);else{const t=se(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);d.set(n,i)}h.subVectors(d,c).multiplyScalar(n.rotateSpeed);const t=n.domElement;M(2*Math.PI*h.x/t.clientHeight),A(2*Math.PI*h.y/t.clientHeight),c.copy(d)}function Y(e){if(1===E.length)f.set(e.pageX,e.pageY);else{const t=se(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);f.set(n,i)}m.subVectors(f,p).multiplyScalar(n.panSpeed),I(m.x,m.y),p.copy(f)}function K(e){const t=se(e),i=e.pageX-t.x,r=e.pageY-t.y,o=Math.sqrt(i*i+r*r);v.set(0,o),_.set(0,Math.pow(v.y/g.y,n.zoomSpeed)),P(_.y),g.copy(v);N(.5*(e.pageX+t.x),.5*(e.pageY+t.y))}function J(e){!1!==n.enabled&&(0===E.length&&(n.domElement.setPointerCapture(e.pointerId),n.domElement.addEventListener("pointermove",$),n.domElement.addEventListener("pointerup",Z)),function(e){for(let t=0;t<E.length;t++)if(E[t]==e.pointerId)return!0;return!1}(e)||(function(e){E.push(e.pointerId)}(e),"touch"===e.pointerType?ie(e):function(e){let t;switch(e.button){case 0:t=n.mouseButtons.LEFT;break;case 1:t=n.mouseButtons.MIDDLE;break;case 2:t=n.mouseButtons.RIGHT;break;default:t=-1}switch(t){case V:if(!1===n.enableZoom)return;!function(e){N(e.clientX,e.clientX),g.set(e.clientX,e.clientY)}(e),r=i.DOLLY;break;case H:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enablePan)return;U(e),r=i.PAN}else{if(!1===n.enableRotate)return;D(e),r=i.ROTATE}break;case z:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enableRotate)return;D(e),r=i.ROTATE}else{if(!1===n.enablePan)return;U(e),r=i.PAN}break;default:r=i.NONE}r!==i.NONE&&n.dispatchEvent(pd)}(e)))}function $(e){!1!==n.enabled&&("touch"===e.pointerType?function(e){switch(oe(e),r){case i.TOUCH_ROTATE:if(!1===n.enableRotate)return;X(e),n.update();break;case i.TOUCH_PAN:if(!1===n.enablePan)return;Y(e),n.update();break;case i.TOUCH_DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(e){n.enableZoom&&K(e),n.enablePan&&Y(e)}(e),n.update();break;case i.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(e){n.enableZoom&&K(e),n.enableRotate&&X(e)}(e),n.update();break;default:r=i.NONE}}(e):function(e){switch(r){case i.ROTATE:if(!1===n.enableRotate)return;!function(e){d.set(e.clientX,e.clientY),h.subVectors(d,c).multiplyScalar(n.rotateSpeed);const t=n.domElement;M(2*Math.PI*h.x/t.clientHeight),A(2*Math.PI*h.y/t.clientHeight),c.copy(d),n.update()}(e);break;case i.DOLLY:if(!1===n.enableZoom)return;!function(e){v.set(e.clientX,e.clientY),_.subVectors(v,g),_.y>0?P(w(_.y)):_.y<0&&O(w(_.y)),g.copy(v),n.update()}(e);break;case i.PAN:if(!1===n.enablePan)return;!function(e){f.set(e.clientX,e.clientY),m.subVectors(f,p).multiplyScalar(n.panSpeed),I(m.x,m.y),p.copy(f),n.update()}(e)}}(e))}function Z(e){switch(function(e){delete b[e.pointerId];for(let t=0;t<E.length;t++)if(E[t]==e.pointerId)return void E.splice(t,1)}(e),E.length){case 0:n.domElement.releasePointerCapture(e.pointerId),n.domElement.removeEventListener("pointermove",$),n.domElement.removeEventListener("pointerup",Z),n.dispatchEvent(fd),r=i.NONE;break;case 1:const t=E[0],o=b[t];ie({pointerId:t,pageX:o.x,pageY:o.y})}}function Q(e){!1!==n.enabled&&!1!==n.enableZoom&&r===i.NONE&&(e.preventDefault(),n.dispatchEvent(pd),function(e){N(e.clientX,e.clientY),e.deltaY<0?O(w(e.deltaY)):e.deltaY>0&&P(w(e.deltaY)),n.update()}(function(e){const t=e.deltaMode,n={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:n.deltaY*=16;break;case 2:n.deltaY*=100}e.ctrlKey&&!T&&(n.deltaY*=10);return n}(e)),n.dispatchEvent(fd))}function ee(e){if("Control"===e.key){T=!0;n.domElement.getRootNode().addEventListener("keyup",te,{passive:!0,capture:!0})}}function te(e){if("Control"===e.key){T=!1;n.domElement.getRootNode().removeEventListener("keyup",te,{passive:!0,capture:!0})}}function ne(e){!1!==n.enabled&&!1!==n.enablePan&&function(e){let t=!1;switch(e.code){case n.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?A(2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):I(0,n.keyPanSpeed),t=!0;break;case n.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?A(-2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):I(0,-n.keyPanSpeed),t=!0;break;case n.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?M(2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):I(n.keyPanSpeed,0),t=!0;break;case n.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?M(-2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):I(-n.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),n.update())}(e)}function ie(e){switch(oe(e),E.length){case 1:switch(n.touches.ONE){case G:if(!1===n.enableRotate)return;k(e),r=i.TOUCH_ROTATE;break;case W:if(!1===n.enablePan)return;F(e),r=i.TOUCH_PAN;break;default:r=i.NONE}break;case 2:switch(n.touches.TWO){case j:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(e){n.enableZoom&&B(e),n.enablePan&&F(e)}(e),r=i.TOUCH_DOLLY_PAN;break;case q:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(e){n.enableZoom&&B(e),n.enableRotate&&k(e)}(e),r=i.TOUCH_DOLLY_ROTATE;break;default:r=i.NONE}break;default:r=i.NONE}r!==i.NONE&&n.dispatchEvent(pd)}function re(e){!1!==n.enabled&&e.preventDefault()}function oe(e){let t=b[e.pointerId];void 0===t&&(t=new hn,b[e.pointerId]=t),t.set(e.pageX,e.pageY)}function se(e){const t=e.pointerId===E[0]?E[1]:E[0];return b[t]}n.domElement.addEventListener("contextmenu",re),n.domElement.addEventListener("pointerdown",J),n.domElement.addEventListener("pointercancel",Z),n.domElement.addEventListener("wheel",Q,{passive:!1});n.domElement.getRootNode().addEventListener("keydown",ee,{passive:!0,capture:!0}),this.update()}}var yd=(e,t,n)=>new Promise((i,r)=>{var o=e=>{try{a(n.next(e))}catch(t){r(t)}},s=e=>{try{a(n.throw(e))}catch(t){r(t)}},a=e=>e.done?i(e.value):Promise.resolve(e.value).then(o,s);a((n=n.apply(e,t)).next())}),xd=(e,t,n)=>new Promise((i,r)=>{var o=e=>{try{a(n.next(e))}catch(t){r(t)}},s=e=>{try{a(n.throw(e))}catch(t){r(t)}},a=e=>e.done?i(e.value):Promise.resolve(e.value).then(o,s);a((n=n.apply(e,t)).next())}),Sd=class extends Gi{constructor(e){super(),this.weight=0,this.isBinary=!1,this.overrideBlink="none",this.overrideLookAt="none",this.overrideMouth="none",this._binds=[],this.name=`VRMExpression_${e}`,this.expressionName=e,this.type="VRMExpression",this.visible=!1}get binds(){return this._binds}get overrideBlinkAmount(){return"block"===this.overrideBlink?0<this.outputWeight?1:0:"blend"===this.overrideBlink?this.outputWeight:0}get overrideLookAtAmount(){return"block"===this.overrideLookAt?0<this.outputWeight?1:0:"blend"===this.overrideLookAt?this.outputWeight:0}get overrideMouthAmount(){return"block"===this.overrideMouth?0<this.outputWeight?1:0:"blend"===this.overrideMouth?this.outputWeight:0}get outputWeight(){return this.isBinary?this.weight>.5?1:0:this.weight}addBind(e){this._binds.push(e)}deleteBind(e){const t=this._binds.indexOf(e);t>=0&&this._binds.splice(t,1)}applyWeight(e){var t;let n=this.outputWeight;n*=null!=(t=null==e?void 0:e.multiplier)?t:1,this.isBinary&&n<1&&(n=0),this._binds.forEach(e=>e.applyWeight(n))}clearAppliedWeight(){this._binds.forEach(e=>e.clearAppliedWeight())}};function Ed(e,t,n){var i,r;const o=e.parser.json,s=null==(i=o.nodes)?void 0:i[t];if(null==s)return console.warn(`extractPrimitivesInternal: Attempt to use nodes[${t}] of glTF but the node doesn't exist`),null;const a=s.mesh;if(null==a)return null;const l=null==(r=o.meshes)?void 0:r[a];if(null==l)return console.warn(`extractPrimitivesInternal: Attempt to use meshes[${a}] of glTF but the mesh doesn't exist`),null;const u=l.primitives.length,c=[];return n.traverse(e=>{c.length<u&&e.isMesh&&c.push(e)}),c}function bd(e,t){return xd(this,null,function*(){const n=yield e.parser.getDependency("node",t);return Ed(e,t,n)})}function Td(e){return xd(this,null,function*(){const t=yield e.parser.getDependencies("node"),n=new Map;return t.forEach((t,i)=>{const r=Ed(e,i,t);null!=r&&n.set(i,r)}),n})}var wd={Aa:"aa",Ih:"ih",Ou:"ou",Ee:"ee",Oh:"oh",Blink:"blink",Happy:"happy",Angry:"angry",Sad:"sad",Relaxed:"relaxed",LookUp:"lookUp",Surprised:"surprised",LookDown:"lookDown",LookLeft:"lookLeft",LookRight:"lookRight",BlinkLeft:"blinkLeft",BlinkRight:"blinkRight",Neutral:"neutral"};function Md(e){return Math.max(Math.min(e,1),0)}var Ad=class e{constructor(){this.blinkExpressionNames=["blink","blinkLeft","blinkRight"],this.lookAtExpressionNames=["lookLeft","lookRight","lookUp","lookDown"],this.mouthExpressionNames=["aa","ee","ih","oh","ou"],this._expressions=[],this._expressionMap={}}get expressions(){return this._expressions.concat()}get expressionMap(){return Object.assign({},this._expressionMap)}get presetExpressionMap(){const e={},t=new Set(Object.values(wd));return Object.entries(this._expressionMap).forEach(([n,i])=>{t.has(n)&&(e[n]=i)}),e}get customExpressionMap(){const e={},t=new Set(Object.values(wd));return Object.entries(this._expressionMap).forEach(([n,i])=>{t.has(n)||(e[n]=i)}),e}copy(e){return this._expressions.concat().forEach(e=>{this.unregisterExpression(e)}),e._expressions.forEach(e=>{this.registerExpression(e)}),this.blinkExpressionNames=e.blinkExpressionNames.concat(),this.lookAtExpressionNames=e.lookAtExpressionNames.concat(),this.mouthExpressionNames=e.mouthExpressionNames.concat(),this}clone(){return(new e).copy(this)}getExpression(e){var t;return null!=(t=this._expressionMap[e])?t:null}registerExpression(e){this._expressions.push(e),this._expressionMap[e.expressionName]=e}unregisterExpression(e){const t=this._expressions.indexOf(e);-1===t&&console.warn("VRMExpressionManager: The specified expressions is not registered"),this._expressions.splice(t,1),delete this._expressionMap[e.expressionName]}getValue(e){var t;const n=this.getExpression(e);return null!=(t=null==n?void 0:n.weight)?t:null}setValue(e,t){const n=this.getExpression(e);n&&(n.weight=Md(t))}resetValues(){this._expressions.forEach(e=>{e.weight=0})}getExpressionTrackName(e){const t=this.getExpression(e);return t?`${t.name}.weight`:null}update(){const e=this._calculateWeightMultipliers();this._expressions.forEach(e=>{e.clearAppliedWeight()}),this._expressions.forEach(t=>{let n=1;const i=t.expressionName;-1!==this.blinkExpressionNames.indexOf(i)&&(n*=e.blink),-1!==this.lookAtExpressionNames.indexOf(i)&&(n*=e.lookAt),-1!==this.mouthExpressionNames.indexOf(i)&&(n*=e.mouth),t.applyWeight({multiplier:n})})}_calculateWeightMultipliers(){let e=1,t=1,n=1;return this._expressions.forEach(i=>{e-=i.overrideBlinkAmount,t-=i.overrideLookAtAmount,n-=i.overrideMouthAmount}),e=Math.max(0,e),t=Math.max(0,t),n=Math.max(0,n),{blink:e,lookAt:t,mouth:n}}},Rd={_Color:"color",_EmissionColor:"emissionColor",_ShadeColor:"shadeColor",_RimColor:"rimColor",_OutlineColor:"outlineColor"},Cd=new or,Id=class e{constructor({material:e,type:t,targetValue:n,targetAlpha:i}){this.material=e,this.type=t,this.targetValue=n,this.targetAlpha=null!=i?i:1;const r=this._initColorBindState(),o=this._initAlphaBindState();this._state={color:r,alpha:o}}applyWeight(e){const{color:t,alpha:n}=this._state;if(null!=t){const{propertyName:n,deltaValue:i}=t,r=this.material[n];null!=r&&r.add(Cd.copy(i).multiplyScalar(e))}if(null!=n){const{propertyName:t,deltaValue:i}=n;null!=this.material[t]&&(this.material[t]+=i*e)}}clearAppliedWeight(){const{color:e,alpha:t}=this._state;if(null!=e){const{propertyName:t,initialValue:n}=e,i=this.material[t];null!=i&&i.copy(n)}if(null!=t){const{propertyName:e,initialValue:n}=t;null!=this.material[e]&&(this.material[e]=n)}}_initColorBindState(){var e,t,n;const{material:i,type:r,targetValue:o}=this,s=this._getPropertyNameMap(),a=null!=(t=null==(e=null==s?void 0:s[r])?void 0:e[0])?t:null;if(null==a)return console.warn(`Tried to add a material color bind to the material ${null!=(n=i.name)?n:"(no name)"}, the type ${r} but the material or the type is not supported.`),null;const l=i[a].clone();return{propertyName:a,initialValue:l,deltaValue:new or(o.r-l.r,o.g-l.g,o.b-l.b)}}_initAlphaBindState(){var e,t,n;const{material:i,type:r,targetAlpha:o}=this,s=this._getPropertyNameMap(),a=null!=(t=null==(e=null==s?void 0:s[r])?void 0:e[1])?t:null;if(null==a&&1!==o)return console.warn(`Tried to add a material alpha bind to the material ${null!=(n=i.name)?n:"(no name)"}, the type ${r} but the material or the type does not support alpha.`),null;if(null==a)return null;const l=i[a];return{propertyName:a,initialValue:l,deltaValue:o-l}}_getPropertyNameMap(){var t,n;return null!=(n=null==(t=Object.entries(e._propertyNameMapMap).find(([e])=>!0===this.material[e]))?void 0:t[1])?n:null}};Id._propertyNameMapMap={isMeshStandardMaterial:{color:["color","opacity"],emissionColor:["emissive",null]},isMeshBasicMaterial:{color:["color","opacity"]},isMToonMaterial:{color:["color","opacity"],emissionColor:["emissive",null],outlineColor:["outlineColorFactor",null],matcapColor:["matcapFactor",null],rimColor:["parametricRimColorFactor",null],shadeColor:["shadeColorFactor",null]}};var Pd=Id,Od=class{constructor({primitives:e,index:t,weight:n}){this.primitives=e,this.index=t,this.weight=n}applyWeight(e){this.primitives.forEach(t=>{var n;null!=(null==(n=t.morphTargetInfluences)?void 0:n[this.index])&&(t.morphTargetInfluences[this.index]+=this.weight*e)})}clearAppliedWeight(){this.primitives.forEach(e=>{var t;null!=(null==(t=e.morphTargetInfluences)?void 0:t[this.index])&&(e.morphTargetInfluences[this.index]=0)})}},Nd=new hn,Ld=class e{constructor({material:t,scale:n,offset:i}){var r,o;this.material=t,this.scale=n,this.offset=i;const s=null==(r=Object.entries(e._propertyNamesMap).find(([e])=>!0===t[e]))?void 0:r[1];null==s?(console.warn(`Tried to add a texture transform bind to the material ${null!=(o=t.name)?o:"(no name)"} but the material is not supported.`),this._properties=[]):(this._properties=[],s.forEach(e=>{var r;const o=null==(r=t[e])?void 0:r.clone();if(!o)return null;t[e]=o;const s=o.offset.clone(),a=o.repeat.clone(),l=i.clone().sub(s),u=n.clone().sub(a);this._properties.push({name:e,initialOffset:s,deltaOffset:l,initialScale:a,deltaScale:u})}))}applyWeight(e){this._properties.forEach(t=>{const n=this.material[t.name];void 0!==n&&(n.offset.add(Nd.copy(t.deltaOffset).multiplyScalar(e)),n.repeat.add(Nd.copy(t.deltaScale).multiplyScalar(e)))})}clearAppliedWeight(){this._properties.forEach(e=>{const t=this.material[e.name];void 0!==t&&(t.offset.copy(e.initialOffset),t.repeat.copy(e.initialScale))})}};Ld._propertyNamesMap={isMeshStandardMaterial:["map","emissiveMap","bumpMap","normalMap","displacementMap","roughnessMap","metalnessMap","alphaMap"],isMeshBasicMaterial:["map","specularMap","alphaMap"],isMToonMaterial:["map","normalMap","emissiveMap","shadeMultiplyTexture","rimMultiplyTexture","outlineWidthMultiplyTexture","uvAnimationMaskTexture"]};var Dd=Ld,Ud=new Set(["1.0","1.0-beta"]),kd=class e{get name(){return"VRMExpressionLoaderPlugin"}constructor(e){this.parser=e}afterRoot(e){return xd(this,null,function*(){e.userData.vrmExpressionManager=yield this._import(e)})}_import(e){return xd(this,null,function*(){const t=yield this._v1Import(e);if(t)return t;const n=yield this._v0Import(e);return n||null})}_v1Import(e){return xd(this,null,function*(){var t,n;const i=this.parser.json;if(!(-1!==(null==(t=i.extensionsUsed)?void 0:t.indexOf("VRMC_vrm"))))return null;const r=null==(n=i.extensions)?void 0:n.VRMC_vrm;if(!r)return null;const o=r.specVersion;if(!Ud.has(o))return console.warn(`VRMExpressionLoaderPlugin: Unknown VRMC_vrm specVersion "${o}"`),null;const s=r.expressions;if(!s)return null;const a=new Set(Object.values(wd)),l=new Map;null!=s.preset&&Object.entries(s.preset).forEach(([e,t])=>{null!=t&&(a.has(e)?l.set(e,t):console.warn(`VRMExpressionLoaderPlugin: Unknown preset name "${e}" detected. Ignoring the expression`))}),null!=s.custom&&Object.entries(s.custom).forEach(([e,t])=>{a.has(e)?console.warn(`VRMExpressionLoaderPlugin: Custom expression cannot have preset name "${e}". Ignoring the expression`):l.set(e,t)});const u=new Ad;return yield Promise.all(Array.from(l.entries()).map(t=>xd(this,[t],function*([t,n]){var i,r,o,s,a,l,c;const d=new Sd(t);if(e.scene.add(d),d.isBinary=null!=(i=n.isBinary)&&i,d.overrideBlink=null!=(r=n.overrideBlink)?r:"none",d.overrideLookAt=null!=(o=n.overrideLookAt)?o:"none",d.overrideMouth=null!=(s=n.overrideMouth)?s:"none",null==(a=n.morphTargetBinds)||a.forEach(t=>xd(this,null,function*(){var i;if(void 0===t.node||void 0===t.index)return;const r=yield bd(e,t.node),o=t.index;r.every(e=>Array.isArray(e.morphTargetInfluences)&&o<e.morphTargetInfluences.length)?d.addBind(new Od({primitives:r,index:o,weight:null!=(i=t.weight)?i:1})):console.warn(`VRMExpressionLoaderPlugin: ${n.name} attempts to index morph #${o} but not found.`)})),n.materialColorBinds||n.textureTransformBinds){const t=[];e.scene.traverse(e=>{const n=e.material;n&&(Array.isArray(n)?t.push(...n):t.push(n))}),null==(l=n.materialColorBinds)||l.forEach(e=>xd(this,null,function*(){t.filter(t=>{var n;const i=null==(n=this.parser.associations.get(t))?void 0:n.materials;return e.material===i}).forEach(t=>{d.addBind(new Pd({material:t,type:e.type,targetValue:(new or).fromArray(e.targetValue),targetAlpha:e.targetValue[3]}))})})),null==(c=n.textureTransformBinds)||c.forEach(e=>xd(this,null,function*(){t.filter(t=>{var n;const i=null==(n=this.parser.associations.get(t))?void 0:n.materials;return e.material===i}).forEach(t=>{var n,i;d.addBind(new Dd({material:t,offset:(new hn).fromArray(null!=(n=e.offset)?n:[0,0]),scale:(new hn).fromArray(null!=(i=e.scale)?i:[1,1])}))})}))}u.registerExpression(d)}))),u})}_v0Import(t){return xd(this,null,function*(){var n;const i=this.parser.json,r=null==(n=i.extensions)?void 0:n.VRM;if(!r)return null;const o=r.blendShapeMaster;if(!o)return null;const s=new Ad,a=o.blendShapeGroups;if(!a)return s;const l=new Set;return yield Promise.all(a.map(n=>xd(this,null,function*(){var r;const o=n.presetName,a=null!=o&&e.v0v1PresetNameMap[o]||null,u=null!=a?a:n.name;if(null==u)return void console.warn("VRMExpressionLoaderPlugin: One of custom expressions has no name. Ignoring the expression");if(l.has(u))return void console.warn(`VRMExpressionLoaderPlugin: An expression preset ${o} has duplicated entries. Ignoring the expression`);l.add(u);const c=new Sd(u);t.scene.add(c),c.isBinary=null!=(r=n.isBinary)&&r,n.binds&&n.binds.forEach(e=>xd(this,null,function*(){var r;if(void 0===e.mesh||void 0===e.index)return;const o=[];null==(r=i.nodes)||r.forEach((t,n)=>{t.mesh===e.mesh&&o.push(n)});const s=e.index;yield Promise.all(o.map(i=>xd(this,null,function*(){var r;const o=yield bd(t,i);o.every(e=>Array.isArray(e.morphTargetInfluences)&&s<e.morphTargetInfluences.length)?c.addBind(new Od({primitives:o,index:s,weight:.01*(null!=(r=e.weight)?r:100)})):console.warn(`VRMExpressionLoaderPlugin: ${n.name} attempts to index ${s}th morph but not found.`)})))}));const d=n.materialValues;d&&0!==d.length&&d.forEach(e=>{if(void 0===e.materialName||void 0===e.propertyName||void 0===e.targetValue)return;const n=[];t.scene.traverse(t=>{if(t.material){const i=t.material;Array.isArray(i)?n.push(...i.filter(t=>(t.name===e.materialName||t.name===e.materialName+" (Outline)")&&-1===n.indexOf(t))):i.name===e.materialName&&-1===n.indexOf(i)&&n.push(i)}});const i=e.propertyName;n.forEach(t=>{if("_MainTex_ST"===i){const n=new hn(e.targetValue[0],e.targetValue[1]),i=new hn(e.targetValue[2],e.targetValue[3]);return i.y=1-i.y-n.y,void c.addBind(new Dd({material:t,scale:n,offset:i}))}const n=Rd[i];n?c.addBind(new Pd({material:t,type:n,targetValue:(new or).fromArray(e.targetValue),targetAlpha:e.targetValue[3]})):console.warn(i+" is not supported")})}),s.registerExpression(c)}))),s})}};kd.v0v1PresetNameMap={a:"aa",e:"ee",i:"ih",o:"oh",u:"ou",blink:"blink",joy:"happy",angry:"angry",sorrow:"sad",fun:"relaxed",lookup:"lookUp",lookdown:"lookDown",lookleft:"lookLeft",lookright:"lookRight",blink_l:"blinkLeft",blink_r:"blinkRight",neutral:"neutral"};var Fd=kd,Bd=class e{constructor(t,n){this._firstPersonOnlyLayer=e.DEFAULT_FIRSTPERSON_ONLY_LAYER,this._thirdPersonOnlyLayer=e.DEFAULT_THIRDPERSON_ONLY_LAYER,this._initializedLayers=!1,this.humanoid=t,this.meshAnnotations=n}copy(e){if(this.humanoid!==e.humanoid)throw new Error("VRMFirstPerson: humanoid must be same in order to copy");return this.meshAnnotations=e.meshAnnotations.map(e=>({meshes:e.meshes.concat(),type:e.type})),this}clone(){return new e(this.humanoid,this.meshAnnotations).copy(this)}get firstPersonOnlyLayer(){return this._firstPersonOnlyLayer}get thirdPersonOnlyLayer(){return this._thirdPersonOnlyLayer}setup({firstPersonOnlyLayer:t=e.DEFAULT_FIRSTPERSON_ONLY_LAYER,thirdPersonOnlyLayer:n=e.DEFAULT_THIRDPERSON_ONLY_LAYER}={}){this._initializedLayers||(this._firstPersonOnlyLayer=t,this._thirdPersonOnlyLayer=n,this.meshAnnotations.forEach(e=>{e.meshes.forEach(t=>{"firstPersonOnly"===e.type?(t.layers.set(this._firstPersonOnlyLayer),t.traverse(e=>e.layers.set(this._firstPersonOnlyLayer))):"thirdPersonOnly"===e.type?(t.layers.set(this._thirdPersonOnlyLayer),t.traverse(e=>e.layers.set(this._thirdPersonOnlyLayer))):"auto"===e.type&&this._createHeadlessModel(t)})}),this._initializedLayers=!0)}_excludeTriangles(e,t,n,i){let r=0;if(null!=t&&t.length>0)for(let o=0;o<e.length;o+=3){const s=e[o],a=e[o+1],l=e[o+2],u=t[s],c=n[s];if(u[0]>0&&i.includes(c[0]))continue;if(u[1]>0&&i.includes(c[1]))continue;if(u[2]>0&&i.includes(c[2]))continue;if(u[3]>0&&i.includes(c[3]))continue;const d=t[a],h=n[a];if(d[0]>0&&i.includes(h[0]))continue;if(d[1]>0&&i.includes(h[1]))continue;if(d[2]>0&&i.includes(h[2]))continue;if(d[3]>0&&i.includes(h[3]))continue;const p=t[l],f=n[l];p[0]>0&&i.includes(f[0])||(p[1]>0&&i.includes(f[1])||p[2]>0&&i.includes(f[2])||p[3]>0&&i.includes(f[3])||(e[r++]=s,e[r++]=a,e[r++]=l))}return r}_createErasedMesh(e,t){const n=new ml(e.geometry.clone(),e.material);n.name=`${e.name}(erase)`,n.frustumCulled=e.frustumCulled,n.layers.set(this._firstPersonOnlyLayer);const i=n.geometry,r=i.getAttribute("skinIndex"),o=r instanceof ad?[]:r.array,s=[];for(let f=0;f<o.length;f+=4)s.push([o[f],o[f+1],o[f+2],o[f+3]]);const a=i.getAttribute("skinWeight"),l=a instanceof ad?[]:a.array,u=[];for(let f=0;f<l.length;f+=4)u.push([l[f],l[f+1],l[f+2],l[f+3]]);const c=i.getIndex();if(!c)throw new Error("The geometry doesn't have an index buffer");const d=Array.from(c.array),h=this._excludeTriangles(d,u,s,t),p=[];for(let f=0;f<h;f++)p[f]=d[f];return i.setIndex(p),e.onBeforeRender&&(n.onBeforeRender=e.onBeforeRender),n.bind(new xl(e.skeleton.bones,e.skeleton.boneInverses),new gi),n}_createHeadlessModelForSkinnedMesh(e,t){const n=[];if(t.skeleton.bones.forEach((e,t)=>{this._isEraseTarget(e)&&n.push(t)}),!n.length)return t.layers.enable(this._thirdPersonOnlyLayer),void t.layers.enable(this._firstPersonOnlyLayer);t.layers.set(this._thirdPersonOnlyLayer);const i=this._createErasedMesh(t,n);e.add(i)}_createHeadlessModel(e){if("Group"===e.type)if(e.layers.set(this._thirdPersonOnlyLayer),this._isEraseTarget(e))e.traverse(e=>e.layers.set(this._thirdPersonOnlyLayer));else{const t=new qa;t.name=`_headless_${e.name}`,t.layers.set(this._firstPersonOnlyLayer),e.parent.add(t),e.children.filter(e=>"SkinnedMesh"===e.type).forEach(e=>{const n=e;this._createHeadlessModelForSkinnedMesh(t,n)})}else if("SkinnedMesh"===e.type){const t=e;this._createHeadlessModelForSkinnedMesh(e.parent,t)}else this._isEraseTarget(e)&&(e.layers.set(this._thirdPersonOnlyLayer),e.traverse(e=>e.layers.set(this._thirdPersonOnlyLayer)))}_isEraseTarget(e){return e===this.humanoid.getRawBoneNode("head")||!!e.parent&&this._isEraseTarget(e.parent)}};Bd.DEFAULT_FIRSTPERSON_ONLY_LAYER=9,Bd.DEFAULT_THIRDPERSON_ONLY_LAYER=10;var Hd=Bd,Vd=new Set(["1.0","1.0-beta"]),zd=class{get name(){return"VRMFirstPersonLoaderPlugin"}constructor(e){this.parser=e}afterRoot(e){return xd(this,null,function*(){const t=e.userData.vrmHumanoid;if(null!==t){if(void 0===t)throw new Error("VRMFirstPersonLoaderPlugin: vrmHumanoid is undefined. VRMHumanoidLoaderPlugin have to be used first");e.userData.vrmFirstPerson=yield this._import(e,t)}})}_import(e,t){return xd(this,null,function*(){if(null==t)return null;const n=yield this._v1Import(e,t);if(n)return n;const i=yield this._v0Import(e,t);return i||null})}_v1Import(e,t){return xd(this,null,function*(){var n,i;const r=this.parser.json;if(!(-1!==(null==(n=r.extensionsUsed)?void 0:n.indexOf("VRMC_vrm"))))return null;const o=null==(i=r.extensions)?void 0:i.VRMC_vrm;if(!o)return null;const s=o.specVersion;if(!Vd.has(s))return console.warn(`VRMFirstPersonLoaderPlugin: Unknown VRMC_vrm specVersion "${s}"`),null;const a=o.firstPerson,l=[],u=yield Td(e);return Array.from(u.entries()).forEach(([e,t])=>{var n,i;const r=null==(n=null==a?void 0:a.meshAnnotations)?void 0:n.find(t=>t.node===e);l.push({meshes:t,type:null!=(i=null==r?void 0:r.type)?i:"auto"})}),new Hd(t,l)})}_v0Import(e,t){return xd(this,null,function*(){var n;const i=this.parser.json,r=null==(n=i.extensions)?void 0:n.VRM;if(!r)return null;const o=r.firstPerson;if(!o)return null;const s=[],a=yield Td(e);return Array.from(a.entries()).forEach(([e,t])=>{const n=i.nodes[e],r=o.meshAnnotations?o.meshAnnotations.find(e=>e.mesh===n.mesh):void 0;s.push({meshes:t,type:this._convertV0FlagToV1Type(null==r?void 0:r.firstPersonFlag)})}),new Hd(t,s)})}_convertV0FlagToV1Type(e){return"FirstPersonOnly"===e?"firstPersonOnly":"ThirdPersonOnly"===e?"thirdPersonOnly":"Both"===e?"both":"auto"}},Gd=new Hn,Wd=new Hn,jd=new Bn,qd=class extends qa{constructor(e){super(),this.vrmHumanoid=e,this._boneAxesMap=new Map,Object.values(e.humanBones).forEach(e=>{const t=new cd(1);t.matrixAutoUpdate=!1,t.material.depthTest=!1,t.material.depthWrite=!1,this.add(t),this._boneAxesMap.set(e,t)})}dispose(){Array.from(this._boneAxesMap.values()).forEach(e=>{e.geometry.dispose(),e.material.dispose()})}updateMatrixWorld(e){Array.from(this._boneAxesMap.entries()).forEach(([e,t])=>{e.node.updateWorldMatrix(!0,!1),e.node.matrixWorld.decompose(Gd,jd,Wd);const n=Gd.set(.1,.1,.1).divide(Wd);t.matrix.copy(e.node.matrixWorld).scale(n)}),super.updateMatrixWorld(e)}},Xd=["hips","spine","chest","upperChest","neck","head","leftEye","rightEye","jaw","leftUpperLeg","leftLowerLeg","leftFoot","leftToes","rightUpperLeg","rightLowerLeg","rightFoot","rightToes","leftShoulder","leftUpperArm","leftLowerArm","leftHand","rightShoulder","rightUpperArm","rightLowerArm","rightHand","leftThumbMetacarpal","leftThumbProximal","leftThumbDistal","leftIndexProximal","leftIndexIntermediate","leftIndexDistal","leftMiddleProximal","leftMiddleIntermediate","leftMiddleDistal","leftRingProximal","leftRingIntermediate","leftRingDistal","leftLittleProximal","leftLittleIntermediate","leftLittleDistal","rightThumbMetacarpal","rightThumbProximal","rightThumbDistal","rightIndexProximal","rightIndexIntermediate","rightIndexDistal","rightMiddleProximal","rightMiddleIntermediate","rightMiddleDistal","rightRingProximal","rightRingIntermediate","rightRingDistal","rightLittleProximal","rightLittleIntermediate","rightLittleDistal"],Yd={hips:null,spine:"hips",chest:"spine",upperChest:"chest",neck:"upperChest",head:"neck",leftEye:"head",rightEye:"head",jaw:"head",leftUpperLeg:"hips",leftLowerLeg:"leftUpperLeg",leftFoot:"leftLowerLeg",leftToes:"leftFoot",rightUpperLeg:"hips",rightLowerLeg:"rightUpperLeg",rightFoot:"rightLowerLeg",rightToes:"rightFoot",leftShoulder:"upperChest",leftUpperArm:"leftShoulder",leftLowerArm:"leftUpperArm",leftHand:"leftLowerArm",rightShoulder:"upperChest",rightUpperArm:"rightShoulder",rightLowerArm:"rightUpperArm",rightHand:"rightLowerArm",leftThumbMetacarpal:"leftHand",leftThumbProximal:"leftThumbMetacarpal",leftThumbDistal:"leftThumbProximal",leftIndexProximal:"leftHand",leftIndexIntermediate:"leftIndexProximal",leftIndexDistal:"leftIndexIntermediate",leftMiddleProximal:"leftHand",leftMiddleIntermediate:"leftMiddleProximal",leftMiddleDistal:"leftMiddleIntermediate",leftRingProximal:"leftHand",leftRingIntermediate:"leftRingProximal",leftRingDistal:"leftRingIntermediate",leftLittleProximal:"leftHand",leftLittleIntermediate:"leftLittleProximal",leftLittleDistal:"leftLittleIntermediate",rightThumbMetacarpal:"rightHand",rightThumbProximal:"rightThumbMetacarpal",rightThumbDistal:"rightThumbProximal",rightIndexProximal:"rightHand",rightIndexIntermediate:"rightIndexProximal",rightIndexDistal:"rightIndexIntermediate",rightMiddleProximal:"rightHand",rightMiddleIntermediate:"rightMiddleProximal",rightMiddleDistal:"rightMiddleIntermediate",rightRingProximal:"rightHand",rightRingIntermediate:"rightRingProximal",rightRingDistal:"rightRingIntermediate",rightLittleProximal:"rightHand",rightLittleIntermediate:"rightLittleProximal",rightLittleDistal:"rightLittleIntermediate"};function Kd(e){return e.invert?e.invert():e.inverse(),e}var Jd=new Hn,$d=new Bn,Zd=class{constructor(e){this.humanBones=e,this.restPose=this.getAbsolutePose()}getAbsolutePose(){const e={};return Object.keys(this.humanBones).forEach(t=>{const n=t,i=this.getBoneNode(n);i&&(Jd.copy(i.position),$d.copy(i.quaternion),e[n]={position:Jd.toArray(),rotation:$d.toArray()})}),e}getPose(){const e={};return Object.keys(this.humanBones).forEach(t=>{const n=t,i=this.getBoneNode(n);if(!i)return;Jd.set(0,0,0),$d.identity();const r=this.restPose[n];(null==r?void 0:r.position)&&Jd.fromArray(r.position).negate(),(null==r?void 0:r.rotation)&&Kd($d.fromArray(r.rotation)),Jd.add(i.position),$d.premultiply(i.quaternion),e[n]={position:Jd.toArray(),rotation:$d.toArray()}}),e}setPose(e){Object.entries(e).forEach(([e,t])=>{const n=e,i=this.getBoneNode(n);if(!i)return;const r=this.restPose[n];r&&((null==t?void 0:t.position)&&(i.position.fromArray(t.position),r.position&&i.position.add(Jd.fromArray(r.position))),(null==t?void 0:t.rotation)&&(i.quaternion.fromArray(t.rotation),r.rotation&&i.quaternion.multiply($d.fromArray(r.rotation))))})}resetPose(){Object.entries(this.restPose).forEach(([e,t])=>{const n=this.getBoneNode(e);n&&((null==t?void 0:t.position)&&n.position.fromArray(t.position),(null==t?void 0:t.rotation)&&n.quaternion.fromArray(t.rotation))})}getBone(e){var t;return null!=(t=this.humanBones[e])?t:void 0}getBoneNode(e){var t,n;return null!=(n=null==(t=this.humanBones[e])?void 0:t.node)?n:null}},Qd=new Hn,eh=new Bn,th=new Hn,nh=class e extends Zd{static _setupTransforms(e){const t=new Gi;t.name="VRMHumanoidRig";const n={},i={},r={};Xd.forEach(t=>{var o;const s=e.getBoneNode(t);if(s){const e=new Hn,a=new Bn;s.updateWorldMatrix(!0,!1),s.matrixWorld.decompose(e,a,Qd),n[t]=e,i[t]=s.quaternion.clone();const l=new Bn;null==(o=s.parent)||o.matrixWorld.decompose(Qd,l,Qd),r[t]=l}});const o={};return Xd.forEach(i=>{var r;const s=e.getBoneNode(i);if(s){const e=n[i];let a,l=i;for(;null==a&&(l=Yd[l],null!=l);)a=n[l];const u=new Gi;u.name="Normalized_"+s.name;(l?null==(r=o[l])?void 0:r.node:t).add(u),u.position.copy(e),a&&u.position.sub(a),o[i]={node:u}}}),{rigBones:o,root:t,parentWorldRotations:r,boneRotations:i}}constructor(t){const{rigBones:n,root:i,parentWorldRotations:r,boneRotations:o}=e._setupTransforms(t);super(n),this.original=t,this.root=i,this._parentWorldRotations=r,this._boneRotations=o}update(){Xd.forEach(e=>{const t=this.original.getBoneNode(e);if(null!=t){const n=this.getBoneNode(e),i=this._parentWorldRotations[e],r=eh.copy(i).invert(),o=this._boneRotations[e];if(t.quaternion.copy(n.quaternion).multiply(i).premultiply(r).multiply(o),"hips"===e){const e=n.getWorldPosition(th);t.parent.updateWorldMatrix(!0,!1);const i=t.parent.matrixWorld,r=e.applyMatrix4(i.invert());t.position.copy(r)}}})}},ih=class e{get restPose(){return console.warn("VRMHumanoid: restPose is deprecated. Use either rawRestPose or normalizedRestPose instead."),this.rawRestPose}get rawRestPose(){return this._rawHumanBones.restPose}get normalizedRestPose(){return this._normalizedHumanBones.restPose}get humanBones(){return this._rawHumanBones.humanBones}get rawHumanBones(){return this._rawHumanBones.humanBones}get normalizedHumanBones(){return this._normalizedHumanBones.humanBones}get normalizedHumanBonesRoot(){return this._normalizedHumanBones.root}constructor(e,t){var n;this.autoUpdateHumanBones=null==(n=null==t?void 0:t.autoUpdateHumanBones)||n,this._rawHumanBones=new Zd(e),this._normalizedHumanBones=new nh(this._rawHumanBones)}copy(e){return this.autoUpdateHumanBones=e.autoUpdateHumanBones,this._rawHumanBones=new Zd(e.humanBones),this._normalizedHumanBones=new nh(this._rawHumanBones),this}clone(){return new e(this.humanBones,{autoUpdateHumanBones:this.autoUpdateHumanBones}).copy(this)}getAbsolutePose(){return console.warn("VRMHumanoid: getAbsolutePose() is deprecated. Use either getRawAbsolutePose() or getNormalizedAbsolutePose() instead."),this.getRawAbsolutePose()}getRawAbsolutePose(){return this._rawHumanBones.getAbsolutePose()}getNormalizedAbsolutePose(){return this._normalizedHumanBones.getAbsolutePose()}getPose(){return console.warn("VRMHumanoid: getPose() is deprecated. Use either getRawPose() or getNormalizedPose() instead."),this.getRawPose()}getRawPose(){return this._rawHumanBones.getPose()}getNormalizedPose(){return this._normalizedHumanBones.getPose()}setPose(e){return console.warn("VRMHumanoid: setPose() is deprecated. Use either setRawPose() or setNormalizedPose() instead."),this.setRawPose(e)}setRawPose(e){return this._rawHumanBones.setPose(e)}setNormalizedPose(e){return this._normalizedHumanBones.setPose(e)}resetPose(){return console.warn("VRMHumanoid: resetPose() is deprecated. Use either resetRawPose() or resetNormalizedPose() instead."),this.resetRawPose()}resetRawPose(){return this._rawHumanBones.resetPose()}resetNormalizedPose(){return this._normalizedHumanBones.resetPose()}getBone(e){return console.warn("VRMHumanoid: getBone() is deprecated. Use either getRawBone() or getNormalizedBone() instead."),this.getRawBone(e)}getRawBone(e){return this._rawHumanBones.getBone(e)}getNormalizedBone(e){return this._normalizedHumanBones.getBone(e)}getBoneNode(e){return console.warn("VRMHumanoid: getBoneNode() is deprecated. Use either getRawBoneNode() or getNormalizedBoneNode() instead."),this.getRawBoneNode(e)}getRawBoneNode(e){return this._rawHumanBones.getBoneNode(e)}getNormalizedBoneNode(e){return this._normalizedHumanBones.getBoneNode(e)}update(){this.autoUpdateHumanBones&&this._normalizedHumanBones.update()}},rh={Hips:"hips",Spine:"spine",Head:"head",LeftUpperLeg:"leftUpperLeg",LeftLowerLeg:"leftLowerLeg",LeftFoot:"leftFoot",RightUpperLeg:"rightUpperLeg",RightLowerLeg:"rightLowerLeg",RightFoot:"rightFoot",LeftUpperArm:"leftUpperArm",LeftLowerArm:"leftLowerArm",LeftHand:"leftHand",RightUpperArm:"rightUpperArm",RightLowerArm:"rightLowerArm",RightHand:"rightHand"},oh=new Set(["1.0","1.0-beta"]),sh={leftThumbProximal:"leftThumbMetacarpal",leftThumbIntermediate:"leftThumbProximal",rightThumbProximal:"rightThumbMetacarpal",rightThumbIntermediate:"rightThumbProximal"},ah=class{get name(){return"VRMHumanoidLoaderPlugin"}constructor(e,t){this.parser=e,this.helperRoot=null==t?void 0:t.helperRoot,this.autoUpdateHumanBones=null==t?void 0:t.autoUpdateHumanBones}afterRoot(e){return xd(this,null,function*(){e.userData.vrmHumanoid=yield this._import(e)})}_import(e){return xd(this,null,function*(){const t=yield this._v1Import(e);if(t)return t;const n=yield this._v0Import(e);return n||null})}_v1Import(e){return xd(this,null,function*(){var t,n;const i=this.parser.json;if(!(-1!==(null==(t=i.extensionsUsed)?void 0:t.indexOf("VRMC_vrm"))))return null;const r=null==(n=i.extensions)?void 0:n.VRMC_vrm;if(!r)return null;const o=r.specVersion;if(!oh.has(o))return console.warn(`VRMHumanoidLoaderPlugin: Unknown VRMC_vrm specVersion "${o}"`),null;const s=r.humanoid;if(!s)return null;const a=null!=s.humanBones.leftThumbIntermediate||null!=s.humanBones.rightThumbIntermediate,l={};null!=s.humanBones&&(yield Promise.all(Object.entries(s.humanBones).map(e=>xd(this,[e],function*([e,t]){let n=e;const i=t.node;if(a){const e=sh[n];null!=e&&(n=e)}const r=yield this.parser.getDependency("node",i);null!=r?l[n]={node:r}:console.warn(`A glTF node bound to the humanoid bone ${n} (index = ${i}) does not exist`)}))));const u=new ih(this._ensureRequiredBonesExist(l),{autoUpdateHumanBones:this.autoUpdateHumanBones});if(e.scene.add(u.normalizedHumanBonesRoot),this.helperRoot){const e=new qd(u);this.helperRoot.add(e),e.renderOrder=this.helperRoot.renderOrder}return u})}_v0Import(e){return xd(this,null,function*(){var t;const n=null==(t=this.parser.json.extensions)?void 0:t.VRM;if(!n)return null;const i=n.humanoid;if(!i)return null;const r={};null!=i.humanBones&&(yield Promise.all(i.humanBones.map(e=>xd(this,null,function*(){const t=e.bone,n=e.node;if(null==t||null==n)return;const i=yield this.parser.getDependency("node",n);if(null==i)return void console.warn(`A glTF node bound to the humanoid bone ${t} (index = ${n}) does not exist`);const o=sh[t],s=null!=o?o:t;null==r[s]?r[s]={node:i}:console.warn(`Multiple bone entries for ${s} detected (index = ${n}), ignoring duplicated entries.`)}))));const o=new ih(this._ensureRequiredBonesExist(r),{autoUpdateHumanBones:this.autoUpdateHumanBones});if(e.scene.add(o.normalizedHumanBonesRoot),this.helperRoot){const e=new qd(o);this.helperRoot.add(e),e.renderOrder=this.helperRoot.renderOrder}return o})}_ensureRequiredBonesExist(e){const t=Object.values(rh).filter(t=>null==e[t]);if(t.length>0)throw new Error(`VRMHumanoidLoaderPlugin: These humanoid bones are required but not exist: ${t.join(", ")}`);return e}},lh=class extends br{constructor(){super(),this._currentTheta=0,this._currentRadius=0,this.theta=0,this.radius=0,this._currentTheta=0,this._currentRadius=0,this._attrPos=new hr(new Float32Array(195),3),this.setAttribute("position",this._attrPos),this._attrIndex=new hr(new Uint16Array(189),1),this.setIndex(this._attrIndex),this._buildIndex(),this.update()}update(){let e=!1;this._currentTheta!==this.theta&&(this._currentTheta=this.theta,e=!0),this._currentRadius!==this.radius&&(this._currentRadius=this.radius,e=!0),e&&this._buildPosition()}_buildPosition(){this._attrPos.setXYZ(0,0,0,0);for(let e=0;e<64;e++){const t=e/63*this._currentTheta;this._attrPos.setXYZ(e+1,this._currentRadius*Math.sin(t),0,this._currentRadius*Math.cos(t))}this._attrPos.needsUpdate=!0}_buildIndex(){for(let e=0;e<63;e++)this._attrIndex.setXYZ(3*e,0,e+1,e+2);this._attrIndex.needsUpdate=!0}},uh=class extends br{constructor(){super(),this.radius=0,this._currentRadius=0,this.tail=new Hn,this._currentTail=new Hn,this._attrPos=new hr(new Float32Array(294),3),this.setAttribute("position",this._attrPos),this._attrIndex=new hr(new Uint16Array(194),1),this.setIndex(this._attrIndex),this._buildIndex(),this.update()}update(){let e=!1;this._currentRadius!==this.radius&&(this._currentRadius=this.radius,e=!0),this._currentTail.equals(this.tail)||(this._currentTail.copy(this.tail),e=!0),e&&this._buildPosition()}_buildPosition(){for(let e=0;e<32;e++){const t=e/16*Math.PI;this._attrPos.setXYZ(e,Math.cos(t),Math.sin(t),0),this._attrPos.setXYZ(32+e,0,Math.cos(t),Math.sin(t)),this._attrPos.setXYZ(64+e,Math.sin(t),0,Math.cos(t))}this.scale(this._currentRadius,this._currentRadius,this._currentRadius),this.translate(this._currentTail.x,this._currentTail.y,this._currentTail.z),this._attrPos.setXYZ(96,0,0,0),this._attrPos.setXYZ(97,this._currentTail.x,this._currentTail.y,this._currentTail.z),this._attrPos.needsUpdate=!0}_buildIndex(){for(let e=0;e<32;e++){const t=(e+1)%32;this._attrIndex.setXY(2*e,e,t),this._attrIndex.setXY(64+2*e,32+e,32+t),this._attrIndex.setXY(128+2*e,64+e,64+t)}this._attrIndex.setXY(192,96,97),this._attrIndex.needsUpdate=!0}},ch=new Bn,dh=new Bn,hh=new Hn,ph=new Hn,fh=Math.sqrt(2)/2,mh=new Bn(0,0,-fh,fh),gh=new Hn(0,1,0),vh=class extends qa{constructor(e){super(),this.matrixAutoUpdate=!1,this.vrmLookAt=e;{const e=new lh;e.radius=.5;const t=new ur({color:65280,transparent:!0,opacity:.5,side:2,depthTest:!1,depthWrite:!1});this._meshPitch=new Vr(e,t),this.add(this._meshPitch)}{const e=new lh;e.radius=.5;const t=new ur({color:16711680,transparent:!0,opacity:.5,side:2,depthTest:!1,depthWrite:!1});this._meshYaw=new Vr(e,t),this.add(this._meshYaw)}{const e=new uh;e.radius=.1;const t=new Il({color:16777215,depthTest:!1,depthWrite:!1});this._lineTarget=new zl(e,t),this._lineTarget.frustumCulled=!1,this.add(this._lineTarget)}}dispose(){this._meshYaw.geometry.dispose(),this._meshYaw.material.dispose(),this._meshPitch.geometry.dispose(),this._meshPitch.material.dispose(),this._lineTarget.geometry.dispose(),this._lineTarget.material.dispose()}updateMatrixWorld(e){const t=dn.DEG2RAD*this.vrmLookAt.yaw;this._meshYaw.geometry.theta=t,this._meshYaw.geometry.update();const n=dn.DEG2RAD*this.vrmLookAt.pitch;this._meshPitch.geometry.theta=n,this._meshPitch.geometry.update(),this.vrmLookAt.getLookAtWorldPosition(hh),this.vrmLookAt.getLookAtWorldQuaternion(ch),ch.multiply(this.vrmLookAt.getFaceFrontQuaternion(dh)),this._meshYaw.position.copy(hh),this._meshYaw.quaternion.copy(ch),this._meshPitch.position.copy(hh),this._meshPitch.quaternion.copy(ch),this._meshPitch.quaternion.multiply(dh.setFromAxisAngle(gh,t)),this._meshPitch.quaternion.multiply(mh);const{target:i,autoUpdate:r}=this.vrmLookAt;null!=i&&r&&(i.getWorldPosition(ph).sub(hh),this._lineTarget.geometry.tail.copy(ph),this._lineTarget.geometry.update(),this._lineTarget.position.copy(hh)),super.updateMatrixWorld(e)}},_h=new Hn,yh=new Hn;function xh(e,t){return e.matrixWorld.decompose(_h,t,yh),t}function Sh(e){return[Math.atan2(-e.z,e.x),Math.atan2(e.y,Math.sqrt(e.x*e.x+e.z*e.z))]}function Eh(e){const t=Math.round(e/2/Math.PI);return e-2*Math.PI*t}var bh=new Hn(0,0,1),Th=new Hn,wh=new Hn,Mh=new Hn,Ah=new Bn,Rh=new Bn,Ch=new Bn,Ih=new Bn,Ph=new Mi,Oh=class e{constructor(e,t){this.offsetFromHeadBone=new Hn,this.autoUpdate=!0,this.faceFront=new Hn(0,0,1),this.humanoid=e,this.applier=t,this._yaw=0,this._pitch=0,this._needsUpdate=!0,this._restHeadWorldQuaternion=this.getLookAtWorldQuaternion(new Bn)}get yaw(){return this._yaw}set yaw(e){this._yaw=e,this._needsUpdate=!0}get pitch(){return this._pitch}set pitch(e){this._pitch=e,this._needsUpdate=!0}get euler(){return console.warn("VRMLookAt: euler is deprecated. use getEuler() instead."),this.getEuler(new Mi)}getEuler(e){return e.set(dn.DEG2RAD*this._pitch,dn.DEG2RAD*this._yaw,0,"YXZ")}copy(e){if(this.humanoid!==e.humanoid)throw new Error("VRMLookAt: humanoid must be same in order to copy");return this.offsetFromHeadBone.copy(e.offsetFromHeadBone),this.applier=e.applier,this.autoUpdate=e.autoUpdate,this.target=e.target,this.faceFront.copy(e.faceFront),this}clone(){return new e(this.humanoid,this.applier).copy(this)}reset(){this._yaw=0,this._pitch=0,this._needsUpdate=!0}getLookAtWorldPosition(e){const t=this.humanoid.getRawBoneNode("head");return e.copy(this.offsetFromHeadBone).applyMatrix4(t.matrixWorld)}getLookAtWorldQuaternion(e){return xh(this.humanoid.getRawBoneNode("head"),e)}getFaceFrontQuaternion(e){if(this.faceFront.distanceToSquared(bh)<.01)return e.copy(this._restHeadWorldQuaternion).invert();const[t,n]=Sh(this.faceFront);return Ph.set(0,.5*Math.PI+t,n,"YZX"),e.setFromEuler(Ph).premultiply(Ih.copy(this._restHeadWorldQuaternion).invert())}getLookAtWorldDirection(e){return this.getLookAtWorldQuaternion(Rh),this.getFaceFrontQuaternion(Ch),e.copy(bh).applyQuaternion(Rh).applyQuaternion(Ch).applyEuler(this.getEuler(Ph))}lookAt(e){const t=Ah.copy(this._restHeadWorldQuaternion).multiply(Kd(this.getLookAtWorldQuaternion(Rh))),n=this.getLookAtWorldPosition(wh),i=Mh.copy(e).sub(n).applyQuaternion(t).normalize(),[r,o]=Sh(this.faceFront),[s,a]=Sh(i),l=Eh(s-r),u=Eh(o-a);this._yaw=dn.RAD2DEG*l,this._pitch=dn.RAD2DEG*u,this._needsUpdate=!0}update(e){null!=this.target&&this.autoUpdate&&this.lookAt(this.target.getWorldPosition(Th)),this._needsUpdate&&(this._needsUpdate=!1,this.applier.applyYawPitch(this._yaw,this._pitch))}};Oh.EULER_ORDER="YXZ";var Nh=Oh,Lh=new Hn(0,0,1),Dh=new Bn,Uh=new Bn,kh=new Mi(0,0,0,"YXZ"),Fh=class{constructor(e,t,n,i,r){this.humanoid=e,this.rangeMapHorizontalInner=t,this.rangeMapHorizontalOuter=n,this.rangeMapVerticalDown=i,this.rangeMapVerticalUp=r,this.faceFront=new Hn(0,0,1),this._restQuatLeftEye=new Bn,this._restQuatRightEye=new Bn,this._restLeftEyeParentWorldQuat=new Bn,this._restRightEyeParentWorldQuat=new Bn;const o=this.humanoid.getRawBoneNode("leftEye"),s=this.humanoid.getRawBoneNode("rightEye");o&&(this._restQuatLeftEye.copy(o.quaternion),xh(o.parent,this._restLeftEyeParentWorldQuat)),s&&(this._restQuatRightEye.copy(s.quaternion),xh(s.parent,this._restRightEyeParentWorldQuat))}applyYawPitch(e,t){const n=this.humanoid.getRawBoneNode("leftEye"),i=this.humanoid.getRawBoneNode("rightEye"),r=this.humanoid.getNormalizedBoneNode("leftEye"),o=this.humanoid.getNormalizedBoneNode("rightEye");n&&(kh.x=t<0?-dn.DEG2RAD*this.rangeMapVerticalDown.map(-t):dn.DEG2RAD*this.rangeMapVerticalUp.map(t),kh.y=e<0?-dn.DEG2RAD*this.rangeMapHorizontalInner.map(-e):dn.DEG2RAD*this.rangeMapHorizontalOuter.map(e),Dh.setFromEuler(kh),this._getWorldFaceFrontQuat(Uh),r.quaternion.copy(Uh).multiply(Dh).multiply(Uh.invert()),Dh.copy(this._restLeftEyeParentWorldQuat),n.quaternion.copy(r.quaternion).multiply(Dh).premultiply(Dh.invert()).multiply(this._restQuatLeftEye)),i&&(kh.x=t<0?-dn.DEG2RAD*this.rangeMapVerticalDown.map(-t):dn.DEG2RAD*this.rangeMapVerticalUp.map(t),kh.y=e<0?-dn.DEG2RAD*this.rangeMapHorizontalOuter.map(-e):dn.DEG2RAD*this.rangeMapHorizontalInner.map(e),Dh.setFromEuler(kh),this._getWorldFaceFrontQuat(Uh),o.quaternion.copy(Uh).multiply(Dh).multiply(Uh.invert()),Dh.copy(this._restRightEyeParentWorldQuat),i.quaternion.copy(o.quaternion).multiply(Dh).premultiply(Dh.invert()).multiply(this._restQuatRightEye))}lookAt(e){console.warn("VRMLookAtBoneApplier: lookAt() is deprecated. use apply() instead.");const t=dn.RAD2DEG*e.y,n=dn.RAD2DEG*e.x;this.applyYawPitch(t,n)}_getWorldFaceFrontQuat(e){if(this.faceFront.distanceToSquared(Lh)<.01)return e.identity();const[t,n]=Sh(this.faceFront);return kh.set(0,.5*Math.PI+t,n,"YZX"),e.setFromEuler(kh)}};Fh.type="bone";var Bh=class{constructor(e,t,n,i,r){this.expressions=e,this.rangeMapHorizontalInner=t,this.rangeMapHorizontalOuter=n,this.rangeMapVerticalDown=i,this.rangeMapVerticalUp=r}applyYawPitch(e,t){t<0?(this.expressions.setValue("lookDown",0),this.expressions.setValue("lookUp",this.rangeMapVerticalUp.map(-t))):(this.expressions.setValue("lookUp",0),this.expressions.setValue("lookDown",this.rangeMapVerticalDown.map(t))),e<0?(this.expressions.setValue("lookLeft",0),this.expressions.setValue("lookRight",this.rangeMapHorizontalOuter.map(-e))):(this.expressions.setValue("lookRight",0),this.expressions.setValue("lookLeft",this.rangeMapHorizontalOuter.map(e)))}lookAt(e){console.warn("VRMLookAtBoneApplier: lookAt() is deprecated. use apply() instead.");const t=dn.RAD2DEG*e.y,n=dn.RAD2DEG*e.x;this.applyYawPitch(t,n)}};Bh.type="expression";var Hh=class{constructor(e,t){this.inputMaxValue=e,this.outputScale=t}map(e){return this.outputScale*Md(e/this.inputMaxValue)}},Vh=new Set(["1.0","1.0-beta"]),zh=.01,Gh=class{get name(){return"VRMLookAtLoaderPlugin"}constructor(e,t){this.parser=e,this.helperRoot=null==t?void 0:t.helperRoot}afterRoot(e){return xd(this,null,function*(){const t=e.userData.vrmHumanoid;if(null===t)return;if(void 0===t)throw new Error("VRMLookAtLoaderPlugin: vrmHumanoid is undefined. VRMHumanoidLoaderPlugin have to be used first");const n=e.userData.vrmExpressionManager;if(null!==n){if(void 0===n)throw new Error("VRMLookAtLoaderPlugin: vrmExpressionManager is undefined. VRMExpressionLoaderPlugin have to be used first");e.userData.vrmLookAt=yield this._import(e,t,n)}})}_import(e,t,n){return xd(this,null,function*(){if(null==t||null==n)return null;const i=yield this._v1Import(e,t,n);if(i)return i;const r=yield this._v0Import(e,t,n);return r||null})}_v1Import(e,t,n){return xd(this,null,function*(){var e,i,r;const o=this.parser.json;if(!(-1!==(null==(e=o.extensionsUsed)?void 0:e.indexOf("VRMC_vrm"))))return null;const s=null==(i=o.extensions)?void 0:i.VRMC_vrm;if(!s)return null;const a=s.specVersion;if(!Vh.has(a))return console.warn(`VRMLookAtLoaderPlugin: Unknown VRMC_vrm specVersion "${a}"`),null;const l=s.lookAt;if(!l)return null;const u="expression"===l.type?1:10,c=this._v1ImportRangeMap(l.rangeMapHorizontalInner,u),d=this._v1ImportRangeMap(l.rangeMapHorizontalOuter,u),h=this._v1ImportRangeMap(l.rangeMapVerticalDown,u),p=this._v1ImportRangeMap(l.rangeMapVerticalUp,u);let f;f="expression"===l.type?new Bh(n,c,d,h,p):new Fh(t,c,d,h,p);const m=this._importLookAt(t,f);return m.offsetFromHeadBone.fromArray(null!=(r=l.offsetFromHeadBone)?r:[0,.06,0]),m})}_v1ImportRangeMap(e,t){var n,i;let r=null!=(n=null==e?void 0:e.inputMaxValue)?n:90;const o=null!=(i=null==e?void 0:e.outputScale)?i:t;return r<zh&&(console.warn("VRMLookAtLoaderPlugin: inputMaxValue of a range map is too small. Consider reviewing the range map!"),r=zh),new Hh(r,o)}_v0Import(e,t,n){return xd(this,null,function*(){var e,i,r,o;const s=null==(e=this.parser.json.extensions)?void 0:e.VRM;if(!s)return null;const a=s.firstPerson;if(!a)return null;const l="BlendShape"===a.lookAtTypeName?1:10,u=this._v0ImportDegreeMap(a.lookAtHorizontalInner,l),c=this._v0ImportDegreeMap(a.lookAtHorizontalOuter,l),d=this._v0ImportDegreeMap(a.lookAtVerticalDown,l),h=this._v0ImportDegreeMap(a.lookAtVerticalUp,l);let p;p="BlendShape"===a.lookAtTypeName?new Bh(n,u,c,d,h):new Fh(t,u,c,d,h);const f=this._importLookAt(t,p);return a.firstPersonBoneOffset?f.offsetFromHeadBone.set(null!=(i=a.firstPersonBoneOffset.x)?i:0,null!=(r=a.firstPersonBoneOffset.y)?r:.06,-(null!=(o=a.firstPersonBoneOffset.z)?o:0)):f.offsetFromHeadBone.set(0,.06,0),f.faceFront.set(0,0,-1),p instanceof Fh&&p.faceFront.set(0,0,-1),f})}_v0ImportDegreeMap(e,t){var n,i;const r=null==e?void 0:e.curve;"[0,0,0,1,1,1,1,0]"!==JSON.stringify(r)&&console.warn("Curves of LookAtDegreeMap defined in VRM 0.0 are not supported");let o=null!=(n=null==e?void 0:e.xRange)?n:90;const s=null!=(i=null==e?void 0:e.yRange)?i:t;return o<zh&&(console.warn("VRMLookAtLoaderPlugin: xRange of a degree map is too small. Consider reviewing the degree map!"),o=zh),new Hh(o,s)}_importLookAt(e,t){const n=new Nh(e,t);if(this.helperRoot){const e=new vh(n);this.helperRoot.add(e),e.renderOrder=this.helperRoot.renderOrder}return n}};var Wh=new Set(["1.0","1.0-beta"]),jh=class{get name(){return"VRMMetaLoaderPlugin"}constructor(e,t){var n,i,r;this.parser=e,this.needThumbnailImage=null!=(n=null==t?void 0:t.needThumbnailImage)&&n,this.acceptLicenseUrls=null!=(i=null==t?void 0:t.acceptLicenseUrls)?i:["https://vrm.dev/licenses/1.0/"],this.acceptV0Meta=null==(r=null==t?void 0:t.acceptV0Meta)||r}afterRoot(e){return xd(this,null,function*(){e.userData.vrmMeta=yield this._import(e)})}_import(e){return xd(this,null,function*(){const t=yield this._v1Import(e);if(null!=t)return t;const n=yield this._v0Import(e);return null!=n?n:null})}_v1Import(e){return xd(this,null,function*(){var e,t,n;const i=this.parser.json;if(!(-1!==(null==(e=i.extensionsUsed)?void 0:e.indexOf("VRMC_vrm"))))return null;const r=null==(t=i.extensions)?void 0:t.VRMC_vrm;if(null==r)return null;const o=r.specVersion;if(!Wh.has(o))return console.warn(`VRMMetaLoaderPlugin: Unknown VRMC_vrm specVersion "${o}"`),null;const s=r.meta;if(!s)return null;const a=s.licenseUrl;if(!new Set(this.acceptLicenseUrls).has(a))throw new Error(`VRMMetaLoaderPlugin: The license url "${a}" is not accepted`);let l;return this.needThumbnailImage&&null!=s.thumbnailImage&&(l=null!=(n=yield this._extractGLTFImage(s.thumbnailImage))?n:void 0),{metaVersion:"1",name:s.name,version:s.version,authors:s.authors,copyrightInformation:s.copyrightInformation,contactInformation:s.contactInformation,references:s.references,thirdPartyLicenses:s.thirdPartyLicenses,thumbnailImage:l,licenseUrl:s.licenseUrl,avatarPermission:s.avatarPermission,allowExcessivelyViolentUsage:s.allowExcessivelyViolentUsage,allowExcessivelySexualUsage:s.allowExcessivelySexualUsage,commercialUsage:s.commercialUsage,allowPoliticalOrReligiousUsage:s.allowPoliticalOrReligiousUsage,allowAntisocialOrHateUsage:s.allowAntisocialOrHateUsage,creditNotation:s.creditNotation,allowRedistribution:s.allowRedistribution,modification:s.modification,otherLicenseUrl:s.otherLicenseUrl}})}_v0Import(e){return xd(this,null,function*(){var e;const t=null==(e=this.parser.json.extensions)?void 0:e.VRM;if(!t)return null;const n=t.meta;if(!n)return null;if(!this.acceptV0Meta)throw new Error("VRMMetaLoaderPlugin: Attempted to load VRM0.0 meta but acceptV0Meta is false");let i;return this.needThumbnailImage&&null!=n.texture&&-1!==n.texture&&(i=yield this.parser.getDependency("texture",n.texture)),{metaVersion:"0",allowedUserName:n.allowedUserName,author:n.author,commercialUssageName:n.commercialUssageName,contactInformation:n.contactInformation,licenseName:n.licenseName,otherLicenseUrl:n.otherLicenseUrl,otherPermissionUrl:n.otherPermissionUrl,reference:n.reference,sexualUssageName:n.sexualUssageName,texture:null!=i?i:void 0,title:n.title,version:n.version,violentUssageName:n.violentUssageName}})}_extractGLTFImage(e){return xd(this,null,function*(){var t;const n=null==(t=this.parser.json.images)?void 0:t[e];if(null==n)return console.warn(`VRMMetaLoaderPlugin: Attempt to use images[${e}] of glTF as a thumbnail but the image doesn't exist`),null;let i=n.uri;if(null!=n.bufferView){const e=yield this.parser.getDependency("bufferView",n.bufferView),t=new Blob([e],{type:n.mimeType});i=URL.createObjectURL(t)}if(null==i)return console.warn(`VRMMetaLoaderPlugin: Attempt to use images[${e}] of glTF as a thumbnail but the image couldn't load properly`),null;const r=new xc;return yield r.loadAsync((o=i,s=this.parser.options.path,"string"!=typeof o||""===o?"":(/^https?:\/\//i.test(s)&&/^\//.test(o)&&(s=s.replace(/(^https?:\/\/[^/]+).*/i,"$1")),/^(https?:)?\/\//i.test(o)||/^data:.*,.*$/i.test(o)||/^blob:.*$/i.test(o)?o:s+o))).catch(e=>(console.error(e),console.warn("VRMMetaLoaderPlugin: Failed to load a thumbnail image"),null));var o,s})}},qh=class{constructor(e){this.scene=e.scene,this.meta=e.meta,this.humanoid=e.humanoid,this.expressionManager=e.expressionManager,this.firstPerson=e.firstPerson,this.lookAt=e.lookAt}update(e){this.humanoid.update(),this.lookAt&&this.lookAt.update(e),this.expressionManager&&this.expressionManager.update()}},Xh=class extends qh{constructor(e){super(e),this.materials=e.materials,this.springBoneManager=e.springBoneManager,this.nodeConstraintManager=e.nodeConstraintManager}update(e){super.update(e),this.nodeConstraintManager&&this.nodeConstraintManager.update(),this.springBoneManager&&this.springBoneManager.update(e),this.materials&&this.materials.forEach(t=>{t.update&&t.update(e)})}},Yh=Object.defineProperty,Kh=Object.getOwnPropertySymbols,Jh=Object.prototype.hasOwnProperty,$h=Object.prototype.propertyIsEnumerable,Zh=(e,t,n)=>t in e?Yh(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Qh=(e,t)=>{for(var n in t||(t={}))Jh.call(t,n)&&Zh(e,n,t[n]);if(Kh)for(var n of Kh(t))$h.call(t,n)&&Zh(e,n,t[n]);return e},ep=(e,t,n)=>new Promise((i,r)=>{var o=e=>{try{a(n.next(e))}catch(t){r(t)}},s=e=>{try{a(n.throw(e))}catch(t){r(t)}},a=e=>e.done?i(e.value):Promise.resolve(e.value).then(o,s);a((n=n.apply(e,t)).next())}),tp={"":3e3,srgb:3001};var np=class{get pending(){return Promise.all(this._pendings)}constructor(e,t){this._parser=e,this._materialParams=t,this._pendings=[]}assignPrimitive(e,t){null!=t&&(this._materialParams[e]=t)}assignColor(e,t,n){if(null!=t){const i=(new or).fromArray(t);n&&i.convertSRGBToLinear(),this._materialParams[e]=i}}assignTexture(e,t,n){return ep(this,null,function*(){const i=(()=>ep(this,null,function*(){null!=t&&(yield this._parser.assignTexture(this._materialParams,e,t),n&&function(e,t){parseInt(B,10)>=152?e.colorSpace=t:e.encoding=tp[t]}(this._materialParams[e],"srgb"))}))();return this._pendings.push(i),i})}assignTextureByIndex(e,t,n){return ep(this,null,function*(){return this.assignTexture(e,null!=t?{index:t}:void 0,n)})}},ip="none",rp="none",op="screenCoordinates",sp={3e3:"",3001:"srgb"};function ap(e){return parseInt(B,10)>=152?e.colorSpace:sp[e.encoding]}var lp=class extends Yr{constructor(e={}){var t;super({vertexShader:"// #define PHONG\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n  varying vec3 vNormal;\n#endif\n\n#include <common>\n\n// #include <uv_pars_vertex>\n#ifdef MTOON_USE_UV\n  varying vec2 vUv;\n\n  // COMPAT: pre-r151 uses a common uvTransform\n  #if THREE_VRM_THREE_REVISION < 151\n    uniform mat3 uvTransform;\n  #endif\n#endif\n\n// #include <uv2_pars_vertex>\n// COMAPT: pre-r151 uses uv2 for lightMap and aoMap\n#if THREE_VRM_THREE_REVISION < 151\n  #if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n    attribute vec2 uv2;\n    varying vec2 vUv2;\n    uniform mat3 uv2Transform;\n  #endif\n#endif\n\n// #include <displacementmap_pars_vertex>\n// #include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\n#ifdef USE_OUTLINEWIDTHMULTIPLYTEXTURE\n  uniform sampler2D outlineWidthMultiplyTexture;\n  uniform mat3 outlineWidthMultiplyTextureUvTransform;\n#endif\n\nuniform float outlineWidthFactor;\n\nvoid main() {\n\n  // #include <uv_vertex>\n  #ifdef MTOON_USE_UV\n    // COMPAT: pre-r151 uses a common uvTransform\n    #if THREE_VRM_THREE_REVISION >= 151\n      vUv = uv;\n    #else\n      vUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n    #endif\n  #endif\n\n  // #include <uv2_vertex>\n  // COMAPT: pre-r151 uses uv2 for lightMap and aoMap\n  #if THREE_VRM_THREE_REVISION < 151\n    #if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n      vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n    #endif\n  #endif\n\n  #include <color_vertex>\n\n  #include <beginnormal_vertex>\n  #include <morphnormal_vertex>\n  #include <skinbase_vertex>\n  #include <skinnormal_vertex>\n\n  // we need this to compute the outline properly\n  objectNormal = normalize( objectNormal );\n\n  #include <defaultnormal_vertex>\n\n  #ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n    vNormal = normalize( transformedNormal );\n  #endif\n\n  #include <begin_vertex>\n\n  #include <morphtarget_vertex>\n  #include <skinning_vertex>\n  // #include <displacementmap_vertex>\n  #include <project_vertex>\n  #include <logdepthbuf_vertex>\n  #include <clipping_planes_vertex>\n\n  vViewPosition = - mvPosition.xyz;\n\n  #ifdef OUTLINE\n    float worldNormalLength = length( transformedNormal );\n    vec3 outlineOffset = outlineWidthFactor * worldNormalLength * objectNormal;\n\n    #ifdef USE_OUTLINEWIDTHMULTIPLYTEXTURE\n      vec2 outlineWidthMultiplyTextureUv = ( outlineWidthMultiplyTextureUvTransform * vec3( vUv, 1 ) ).xy;\n      float outlineTex = texture2D( outlineWidthMultiplyTexture, outlineWidthMultiplyTextureUv ).g;\n      outlineOffset *= outlineTex;\n    #endif\n\n    #ifdef OUTLINE_WIDTH_SCREEN\n      outlineOffset *= vViewPosition.z / projectionMatrix[ 1 ].y;\n    #endif\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( outlineOffset + transformed, 1.0 );\n\n    gl_Position.z += 1E-6 * gl_Position.w; // anti-artifact magic\n  #endif\n\n  #include <worldpos_vertex>\n  // #include <envmap_vertex>\n  #include <shadowmap_vertex>\n  #include <fog_vertex>\n\n}",fragmentShader:"// #define PHONG\n\nuniform vec3 litFactor;\n\nuniform float opacity;\n\nuniform vec3 shadeColorFactor;\n#ifdef USE_SHADEMULTIPLYTEXTURE\n  uniform sampler2D shadeMultiplyTexture;\n  uniform mat3 shadeMultiplyTextureUvTransform;\n#endif\n\nuniform float shadingShiftFactor;\nuniform float shadingToonyFactor;\n\n#ifdef USE_SHADINGSHIFTTEXTURE\n  uniform sampler2D shadingShiftTexture;\n  uniform mat3 shadingShiftTextureUvTransform;\n  uniform float shadingShiftTextureScale;\n#endif\n\nuniform float giEqualizationFactor;\n\nuniform vec3 parametricRimColorFactor;\n#ifdef USE_RIMMULTIPLYTEXTURE\n  uniform sampler2D rimMultiplyTexture;\n  uniform mat3 rimMultiplyTextureUvTransform;\n#endif\nuniform float rimLightingMixFactor;\nuniform float parametricRimFresnelPowerFactor;\nuniform float parametricRimLiftFactor;\n\n#ifdef USE_MATCAPTEXTURE\n  uniform vec3 matcapFactor;\n  uniform sampler2D matcapTexture;\n  uniform mat3 matcapTextureUvTransform;\n#endif\n\nuniform vec3 emissive;\nuniform float emissiveIntensity;\n\nuniform vec3 outlineColorFactor;\nuniform float outlineLightingMixFactor;\n\n#ifdef USE_UVANIMATIONMASKTEXTURE\n  uniform sampler2D uvAnimationMaskTexture;\n  uniform mat3 uvAnimationMaskTextureUvTransform;\n#endif\n\nuniform float uvAnimationScrollXOffset;\nuniform float uvAnimationScrollYOffset;\nuniform float uvAnimationRotationPhase;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n\n// #include <uv_pars_fragment>\n#if ( defined( MTOON_USE_UV ) && !defined( MTOON_UVS_VERTEX_ONLY ) )\n  varying vec2 vUv;\n#endif\n\n// #include <uv2_pars_fragment>\n// COMAPT: pre-r151 uses uv2 for lightMap and aoMap\n#if THREE_VRM_THREE_REVISION < 151\n  #if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n    varying vec2 vUv2;\n  #endif\n#endif\n\n#include <map_pars_fragment>\n\n#ifdef USE_MAP\n  uniform mat3 mapUvTransform;\n#endif\n\n// #include <alphamap_pars_fragment>\n\n#include <alphatest_pars_fragment>\n\n#include <aomap_pars_fragment>\n// #include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n\n#ifdef USE_EMISSIVEMAP\n  uniform mat3 emissiveMapUvTransform;\n#endif\n\n// #include <envmap_common_pars_fragment>\n// #include <envmap_pars_fragment>\n// #include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n\n// #include <bsdfs>\n// COMPAT: pre-r151 doesn't have BRDF_Lambert in <common>\n#if THREE_VRM_THREE_REVISION < 151\n  vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n    return RECIPROCAL_PI * diffuseColor;\n  }\n#endif\n\n#include <lights_pars_begin>\n\n#include <normal_pars_fragment>\n\n// #include <lights_phong_pars_fragment>\nvarying vec3 vViewPosition;\n\nstruct MToonMaterial {\n  vec3 diffuseColor;\n  vec3 shadeColor;\n  float shadingShift;\n};\n\nfloat linearstep( float a, float b, float t ) {\n  return clamp( ( t - a ) / ( b - a ), 0.0, 1.0 );\n}\n\n/**\n * Convert NdotL into toon shading factor using shadingShift and shadingToony\n */\nfloat getShading(\n  const in float dotNL,\n  const in float shadow,\n  const in float shadingShift\n) {\n  float shading = dotNL;\n  shading = shading + shadingShift;\n  shading = linearstep( -1.0 + shadingToonyFactor, 1.0 - shadingToonyFactor, shading );\n  shading *= shadow;\n  return shading;\n}\n\n/**\n * Mix diffuseColor and shadeColor using shading factor and light color\n */\nvec3 getDiffuse(\n  const in MToonMaterial material,\n  const in float shading,\n  in vec3 lightColor\n) {\n  #ifdef DEBUG_LITSHADERATE\n    return vec3( BRDF_Lambert( shading * lightColor ) );\n  #endif\n\n  vec3 col = lightColor * BRDF_Lambert( mix( material.shadeColor, material.diffuseColor, shading ) );\n\n  // The \"comment out if you want to PBR absolutely\" line\n  #ifdef V0_COMPAT_SHADE\n    col = min( col, material.diffuseColor );\n  #endif\n\n  return col;\n}\n\n// COMPAT: pre-r156 uses a struct GeometricContext\n#if THREE_VRM_THREE_REVISION >= 157\n  void RE_Direct_MToon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in MToonMaterial material, const in float shadow, inout ReflectedLight reflectedLight ) {\n    float dotNL = clamp( dot( geometryNormal, directLight.direction ), -1.0, 1.0 );\n    vec3 irradiance = directLight.color;\n\n    // directSpecular will be used for rim lighting, not an actual specular\n    reflectedLight.directSpecular += irradiance;\n\n    irradiance *= dotNL;\n\n    float shading = getShading( dotNL, shadow, material.shadingShift );\n\n    // toon shaded diffuse\n    reflectedLight.directDiffuse += getDiffuse( material, shading, directLight.color );\n  }\n\n  void RE_IndirectDiffuse_MToon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in MToonMaterial material, inout ReflectedLight reflectedLight ) {\n    // indirect diffuse will use diffuseColor, no shadeColor involved\n    reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\n    // directSpecular will be used for rim lighting, not an actual specular\n    reflectedLight.directSpecular += irradiance;\n  }\n#else\n  void RE_Direct_MToon( const in IncidentLight directLight, const in GeometricContext geometry, const in MToonMaterial material, const in float shadow, inout ReflectedLight reflectedLight ) {\n    float dotNL = clamp( dot( geometry.normal, directLight.direction ), -1.0, 1.0 );\n    vec3 irradiance = directLight.color;\n\n    // directSpecular will be used for rim lighting, not an actual specular\n    reflectedLight.directSpecular += irradiance;\n\n    irradiance *= dotNL;\n\n    float shading = getShading( dotNL, shadow, material.shadingShift );\n\n    // toon shaded diffuse\n    reflectedLight.directDiffuse += getDiffuse( material, shading, directLight.color );\n  }\n\n  void RE_IndirectDiffuse_MToon( const in vec3 irradiance, const in GeometricContext geometry, const in MToonMaterial material, inout ReflectedLight reflectedLight ) {\n    // indirect diffuse will use diffuseColor, no shadeColor involved\n    reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\n    // directSpecular will be used for rim lighting, not an actual specular\n    reflectedLight.directSpecular += irradiance;\n  }\n#endif\n\n#define RE_Direct RE_Direct_MToon\n#define RE_IndirectDiffuse RE_IndirectDiffuse_MToon\n#define Material_LightProbeLOD( material ) (0)\n\n#include <shadowmap_pars_fragment>\n// #include <bumpmap_pars_fragment>\n\n// #include <normalmap_pars_fragment>\n#ifdef USE_NORMALMAP\n\n  uniform sampler2D normalMap;\n  uniform mat3 normalMapUvTransform;\n  uniform vec2 normalScale;\n\n#endif\n\n// COMPAT: pre-r151\n// USE_NORMALMAP_OBJECTSPACE used to be OBJECTSPACE_NORMALMAP in pre-r151\n#if defined( USE_NORMALMAP_OBJECTSPACE ) || defined( OBJECTSPACE_NORMALMAP )\n\n  uniform mat3 normalMatrix;\n\n#endif\n\n// COMPAT: pre-r151\n// USE_NORMALMAP_TANGENTSPACE used to be TANGENTSPACE_NORMALMAP in pre-r151\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( TANGENTSPACE_NORMALMAP ) )\n\n  // Per-Pixel Tangent Space Normal Mapping\n  // http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n  // three-vrm specific change: it requires `uv` as an input in order to support uv scrolls\n\n  // Temporary compat against shader change @ Three.js r126, r151\n  #if THREE_VRM_THREE_REVISION >= 151\n\n    mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\n      vec3 q0 = dFdx( eye_pos.xyz );\n      vec3 q1 = dFdy( eye_pos.xyz );\n      vec2 st0 = dFdx( uv.st );\n      vec2 st1 = dFdy( uv.st );\n\n      vec3 N = surf_norm;\n\n      vec3 q1perp = cross( q1, N );\n      vec3 q0perp = cross( N, q0 );\n\n      vec3 T = q1perp * st0.x + q0perp * st1.x;\n      vec3 B = q1perp * st0.y + q0perp * st1.y;\n\n      float det = max( dot( T, T ), dot( B, B ) );\n      float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\n      return mat3( T * scale, B * scale, N );\n\n    }\n\n  #else\n\n    vec3 perturbNormal2Arb( vec2 uv, vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\n      vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n      vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n      vec2 st0 = dFdx( uv.st );\n      vec2 st1 = dFdy( uv.st );\n\n      vec3 N = normalize( surf_norm );\n\n      vec3 q1perp = cross( q1, N );\n      vec3 q0perp = cross( N, q0 );\n\n      vec3 T = q1perp * st0.x + q0perp * st1.x;\n      vec3 B = q1perp * st0.y + q0perp * st1.y;\n\n      // three-vrm specific change: Workaround for the issue that happens when delta of uv = 0.0\n      // TODO: Is this still required? Or shall I make a PR about it?\n      if ( length( T ) == 0.0 || length( B ) == 0.0 ) {\n        return surf_norm;\n      }\n\n      float det = max( dot( T, T ), dot( B, B ) );\n      float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\n      return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\n    }\n\n  #endif\n\n#endif\n\n// #include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\n// == post correction ==========================================================\nvoid postCorrection() {\n  #include <tonemapping_fragment>\n  #include <colorspace_fragment>\n  #include <fog_fragment>\n  #include <premultiplied_alpha_fragment>\n  #include <dithering_fragment>\n}\n\n// == main procedure ===========================================================\nvoid main() {\n  #include <clipping_planes_fragment>\n\n  vec2 uv = vec2(0.5, 0.5);\n\n  #if ( defined( MTOON_USE_UV ) && !defined( MTOON_UVS_VERTEX_ONLY ) )\n    uv = vUv;\n\n    float uvAnimMask = 1.0;\n    #ifdef USE_UVANIMATIONMASKTEXTURE\n      vec2 uvAnimationMaskTextureUv = ( uvAnimationMaskTextureUvTransform * vec3( uv, 1 ) ).xy;\n      uvAnimMask = texture2D( uvAnimationMaskTexture, uvAnimationMaskTextureUv ).b;\n    #endif\n\n    float uvRotCos = cos( uvAnimationRotationPhase * uvAnimMask );\n    float uvRotSin = sin( uvAnimationRotationPhase * uvAnimMask );\n    uv = mat2( uvRotCos, -uvRotSin, uvRotSin, uvRotCos ) * ( uv - 0.5 ) + 0.5;\n    uv = uv + vec2( uvAnimationScrollXOffset, uvAnimationScrollYOffset ) * uvAnimMask;\n  #endif\n\n  #ifdef DEBUG_UV\n    gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n    #if ( defined( MTOON_USE_UV ) && !defined( MTOON_UVS_VERTEX_ONLY ) )\n      gl_FragColor = vec4( uv, 0.0, 1.0 );\n    #endif\n    return;\n  #endif\n\n  vec4 diffuseColor = vec4( litFactor, opacity );\n  ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n  vec3 totalEmissiveRadiance = emissive * emissiveIntensity;\n\n  #include <logdepthbuf_fragment>\n\n  // #include <map_fragment>\n  #ifdef USE_MAP\n    vec2 mapUv = ( mapUvTransform * vec3( uv, 1 ) ).xy;\n    vec4 sampledDiffuseColor = texture2D( map, mapUv );\n    #ifdef DECODE_VIDEO_TEXTURE\n      sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n    #endif\n    diffuseColor *= sampledDiffuseColor;\n  #endif\n\n  // #include <color_fragment>\n  #if ( defined( USE_COLOR ) && !defined( IGNORE_VERTEX_COLOR ) )\n    diffuseColor.rgb *= vColor;\n  #endif\n\n  // #include <alphamap_fragment>\n\n  #include <alphatest_fragment>\n\n  // #include <specularmap_fragment>\n\n  // #include <normal_fragment_begin>\n  float faceDirection = gl_FrontFacing ? 1.0 : -1.0;\n\n  #ifdef FLAT_SHADED\n\n    vec3 fdx = dFdx( vViewPosition );\n    vec3 fdy = dFdy( vViewPosition );\n    vec3 normal = normalize( cross( fdx, fdy ) );\n\n  #else\n\n    vec3 normal = normalize( vNormal );\n\n    #ifdef DOUBLE_SIDED\n\n      normal *= faceDirection;\n\n    #endif\n\n  #endif\n\n  #ifdef USE_NORMALMAP\n\n    vec2 normalMapUv = ( normalMapUvTransform * vec3( uv, 1 ) ).xy;\n\n  #endif\n\n  #ifdef USE_NORMALMAP_TANGENTSPACE\n\n    #ifdef USE_TANGENT\n\n      mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\n    #else\n\n      mat3 tbn = getTangentFrame( - vViewPosition, normal, normalMapUv );\n\n    #endif\n\n    #if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\n      tbn[0] *= faceDirection;\n      tbn[1] *= faceDirection;\n\n    #endif\n\n  #endif\n\n  #ifdef USE_CLEARCOAT_NORMALMAP\n\n    #ifdef USE_TANGENT\n\n      mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\n    #else\n\n      mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\n    #endif\n\n    #if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\n      tbn2[0] *= faceDirection;\n      tbn2[1] *= faceDirection;\n\n    #endif\n\n  #endif\n\n  // non perturbed normal for clearcoat among others\n\n  vec3 nonPerturbedNormal = normal;\n\n  #ifdef OUTLINE\n    normal *= -1.0;\n  #endif\n\n  // #include <normal_fragment_maps>\n\n  // COMPAT: pre-r151\n  // USE_NORMALMAP_OBJECTSPACE used to be OBJECTSPACE_NORMALMAP in pre-r151\n  #if defined( USE_NORMALMAP_OBJECTSPACE ) || defined( OBJECTSPACE_NORMALMAP )\n\n    normal = texture2D( normalMap, normalMapUv ).xyz * 2.0 - 1.0; // overrides both flatShading and attribute normals\n\n    #ifdef FLIP_SIDED\n\n      normal = - normal;\n\n    #endif\n\n    #ifdef DOUBLE_SIDED\n\n      normal = normal * faceDirection;\n\n    #endif\n\n    normal = normalize( normalMatrix * normal );\n\n  // COMPAT: pre-r151\n  // USE_NORMALMAP_TANGENTSPACE used to be TANGENTSPACE_NORMALMAP in pre-r151\n  #elif defined( USE_NORMALMAP_TANGENTSPACE ) || defined( TANGENTSPACE_NORMALMAP )\n\n    vec3 mapN = texture2D( normalMap, normalMapUv ).xyz * 2.0 - 1.0;\n    mapN.xy *= normalScale;\n\n    // COMPAT: pre-r151\n    #if THREE_VRM_THREE_REVISION >= 151 || defined( USE_TANGENT )\n\n      normal = normalize( tbn * mapN );\n\n    #else\n\n      normal = perturbNormal2Arb( uv, -vViewPosition, normal, mapN, faceDirection );\n\n    #endif\n\n  #endif\n\n  // #include <emissivemap_fragment>\n  #ifdef USE_EMISSIVEMAP\n    vec2 emissiveMapUv = ( emissiveMapUvTransform * vec3( uv, 1 ) ).xy;\n    totalEmissiveRadiance *= texture2D( emissiveMap, emissiveMapUv ).rgb;\n  #endif\n\n  #ifdef DEBUG_NORMAL\n    gl_FragColor = vec4( 0.5 + 0.5 * normal, 1.0 );\n    return;\n  #endif\n\n  // -- MToon: lighting --------------------------------------------------------\n  // accumulation\n  // #include <lights_phong_fragment>\n  MToonMaterial material;\n\n  material.diffuseColor = diffuseColor.rgb;\n\n  material.shadeColor = shadeColorFactor;\n  #ifdef USE_SHADEMULTIPLYTEXTURE\n    vec2 shadeMultiplyTextureUv = ( shadeMultiplyTextureUvTransform * vec3( uv, 1 ) ).xy;\n    material.shadeColor *= texture2D( shadeMultiplyTexture, shadeMultiplyTextureUv ).rgb;\n  #endif\n\n  #if ( defined( USE_COLOR ) && !defined( IGNORE_VERTEX_COLOR ) )\n    material.shadeColor.rgb *= vColor;\n  #endif\n\n  material.shadingShift = shadingShiftFactor;\n  #ifdef USE_SHADINGSHIFTTEXTURE\n    vec2 shadingShiftTextureUv = ( shadingShiftTextureUvTransform * vec3( uv, 1 ) ).xy;\n    material.shadingShift += texture2D( shadingShiftTexture, shadingShiftTextureUv ).r * shadingShiftTextureScale;\n  #endif\n\n  // #include <lights_fragment_begin>\n\n  // MToon Specific changes:\n  // Since we want to take shadows into account of shading instead of irradiance,\n  // we had to modify the codes that multiplies the results of shadowmap into color of direct lights.\n\n  // COMPAT: pre-r156 uses a struct GeometricContext\n  #if THREE_VRM_THREE_REVISION >= 157\n    vec3 geometryPosition = - vViewPosition;\n    vec3 geometryNormal = normal;\n    vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n\n    vec3 geometryClearcoatNormal;\n\n    #ifdef USE_CLEARCOAT\n\n      geometryClearcoatNormal = clearcoatNormal;\n\n    #endif\n  #else\n    GeometricContext geometry;\n\n    geometry.position = - vViewPosition;\n    geometry.normal = normal;\n    geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n\n    #ifdef USE_CLEARCOAT\n\n      geometry.clearcoatNormal = clearcoatNormal;\n\n    #endif\n  #endif\n\n  IncidentLight directLight;\n\n  // since these variables will be used in unrolled loop, we have to define in prior\n  float shadow;\n\n  #if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\n    PointLight pointLight;\n    #if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n    PointLightShadow pointLightShadow;\n    #endif\n\n    #pragma unroll_loop_start\n    for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n      pointLight = pointLights[ i ];\n\n      // COMPAT: pre-r156 uses a struct GeometricContext\n      #if THREE_VRM_THREE_REVISION >= 157\n        getPointLightInfo( pointLight, geometryPosition, directLight );\n      #else\n        getPointLightInfo( pointLight, geometry, directLight );\n      #endif\n\n      shadow = 1.0;\n      #if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n      pointLightShadow = pointLightShadows[ i ];\n      // COMPAT: pre-r166\n      // r166 introduced shadowIntensity\n      #if THREE_VRM_THREE_REVISION >= 166\n        shadow = all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n      #else\n        shadow = all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n      #endif\n      #endif\n\n      // COMPAT: pre-r156 uses a struct GeometricContext\n      #if THREE_VRM_THREE_REVISION >= 157\n        RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, shadow, reflectedLight );\n      #else\n        RE_Direct( directLight, geometry, material, shadow, reflectedLight );\n      #endif\n\n    }\n    #pragma unroll_loop_end\n\n  #endif\n\n  #if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\n    SpotLight spotLight;\n    // COMPAT: pre-r144 uses NUM_SPOT_LIGHT_SHADOWS, r144+ uses NUM_SPOT_LIGHT_COORDS\n    #if THREE_VRM_THREE_REVISION >= 144\n      #if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_COORDS > 0\n      SpotLightShadow spotLightShadow;\n      #endif\n    #elif defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n    SpotLightShadow spotLightShadow;\n    #endif\n\n    #pragma unroll_loop_start\n    for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n      spotLight = spotLights[ i ];\n\n      // COMPAT: pre-r156 uses a struct GeometricContext\n      #if THREE_VRM_THREE_REVISION >= 157\n        getSpotLightInfo( spotLight, geometryPosition, directLight );\n      #else\n        getSpotLightInfo( spotLight, geometry, directLight );\n      #endif\n\n      shadow = 1.0;\n      // COMPAT: pre-r144 uses NUM_SPOT_LIGHT_SHADOWS and vSpotShadowCoord, r144+ uses NUM_SPOT_LIGHT_COORDS and vSpotLightCoord\n      // COMPAT: pre-r166 does not have shadowIntensity, r166+ has shadowIntensity\n      #if THREE_VRM_THREE_REVISION >= 166\n        #if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_COORDS )\n        spotLightShadow = spotLightShadows[ i ];\n        shadow = all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n        #endif\n      #elif THREE_VRM_THREE_REVISION >= 144\n        #if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_COORDS )\n        spotLightShadow = spotLightShadows[ i ];\n        shadow = all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n        #endif\n      #elif defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n      spotLightShadow = spotLightShadows[ i ];\n      shadow = all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n      #endif\n\n      // COMPAT: pre-r156 uses a struct GeometricContext\n      #if THREE_VRM_THREE_REVISION >= 157\n        RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, shadow, reflectedLight );\n      #else\n        RE_Direct( directLight, geometry, material, shadow, reflectedLight );\n      #endif\n\n    }\n    #pragma unroll_loop_end\n\n  #endif\n\n  #if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\n    DirectionalLight directionalLight;\n    #if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n    DirectionalLightShadow directionalLightShadow;\n    #endif\n\n    #pragma unroll_loop_start\n    for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n      directionalLight = directionalLights[ i ];\n\n      // COMPAT: pre-r156 uses a struct GeometricContext\n      #if THREE_VRM_THREE_REVISION >= 157\n        getDirectionalLightInfo( directionalLight, directLight );\n      #else\n        getDirectionalLightInfo( directionalLight, geometry, directLight );\n      #endif\n\n      shadow = 1.0;\n      #if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n      directionalLightShadow = directionalLightShadows[ i ];\n      // COMPAT: pre-r166\n      // r166 introduced shadowIntensity\n      #if THREE_VRM_THREE_REVISION >= 166\n        shadow = all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n      #else\n        shadow = all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n      #endif\n      #endif\n\n      // COMPAT: pre-r156 uses a struct GeometricContext\n      #if THREE_VRM_THREE_REVISION >= 157\n        RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, shadow, reflectedLight );\n      #else\n        RE_Direct( directLight, geometry, material, shadow, reflectedLight );\n      #endif\n\n    }\n    #pragma unroll_loop_end\n\n  #endif\n\n  // #if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\n  //   RectAreaLight rectAreaLight;\n\n  //   #pragma unroll_loop_start\n  //   for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\n  //     rectAreaLight = rectAreaLights[ i ];\n  //     RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\n  //   }\n  //   #pragma unroll_loop_end\n\n  // #endif\n\n  #if defined( RE_IndirectDiffuse )\n\n    vec3 iblIrradiance = vec3( 0.0 );\n\n    vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\n    // COMPAT: pre-r156 uses a struct GeometricContext\n    // COMPAT: pre-r156 doesn't have a define USE_LIGHT_PROBES\n    #if THREE_VRM_THREE_REVISION >= 157\n      #if defined( USE_LIGHT_PROBES )\n        irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n      #endif\n    #else\n      irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n    #endif\n\n    #if ( NUM_HEMI_LIGHTS > 0 )\n\n      #pragma unroll_loop_start\n      for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\n        // COMPAT: pre-r156 uses a struct GeometricContext\n        #if THREE_VRM_THREE_REVISION >= 157\n          irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n        #else\n          irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n        #endif\n\n      }\n      #pragma unroll_loop_end\n\n    #endif\n\n  #endif\n\n  // #if defined( RE_IndirectSpecular )\n\n  //   vec3 radiance = vec3( 0.0 );\n  //   vec3 clearcoatRadiance = vec3( 0.0 );\n\n  // #endif\n\n  #include <lights_fragment_maps>\n  #include <lights_fragment_end>\n\n  // modulation\n  #include <aomap_fragment>\n\n  vec3 col = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\n  #ifdef DEBUG_LITSHADERATE\n    gl_FragColor = vec4( col, diffuseColor.a );\n    postCorrection();\n    return;\n  #endif\n\n  // -- MToon: rim lighting -----------------------------------------\n  vec3 viewDir = normalize( vViewPosition );\n\n  #ifndef PHYSICALLY_CORRECT_LIGHTS\n    reflectedLight.directSpecular /= PI;\n  #endif\n  vec3 rimMix = mix( vec3( 1.0 ), reflectedLight.directSpecular, 1.0 );\n\n  vec3 rim = parametricRimColorFactor * pow( saturate( 1.0 - dot( viewDir, normal ) + parametricRimLiftFactor ), parametricRimFresnelPowerFactor );\n\n  #ifdef USE_MATCAPTEXTURE\n    {\n      vec3 x = normalize( vec3( viewDir.z, 0.0, -viewDir.x ) );\n      vec3 y = cross( viewDir, x ); // guaranteed to be normalized\n      vec2 sphereUv = 0.5 + 0.5 * vec2( dot( x, normal ), -dot( y, normal ) );\n      sphereUv = ( matcapTextureUvTransform * vec3( sphereUv, 1 ) ).xy;\n      vec3 matcap = texture2D( matcapTexture, sphereUv ).rgb;\n      rim += matcapFactor * matcap;\n    }\n  #endif\n\n  #ifdef USE_RIMMULTIPLYTEXTURE\n    vec2 rimMultiplyTextureUv = ( rimMultiplyTextureUvTransform * vec3( uv, 1 ) ).xy;\n    rim *= texture2D( rimMultiplyTexture, rimMultiplyTextureUv ).rgb;\n  #endif\n\n  col += rimMix * rim;\n\n  // -- MToon: Emission --------------------------------------------------------\n  col += totalEmissiveRadiance;\n\n  // #include <envmap_fragment>\n\n  // -- Almost done! -----------------------------------------------------------\n  #if defined( OUTLINE )\n    col = outlineColorFactor.rgb * mix( vec3( 1.0 ), col, outlineLightingMixFactor );\n  #endif\n\n  #ifdef OPAQUE\n    diffuseColor.a = 1.0;\n  #endif\n\n  gl_FragColor = vec4( col, diffuseColor.a );\n  postCorrection();\n}\n"}),this.uvAnimationScrollXSpeedFactor=0,this.uvAnimationScrollYSpeedFactor=0,this.uvAnimationRotationSpeedFactor=0,this.fog=!0,this.normalMapType=0,this._ignoreVertexColor=!0,this._v0CompatShade=!1,this._debugMode=ip,this._outlineWidthMode=rp,this._isOutline=!1,e.transparentWithZWrite&&(e.depthWrite=!0),delete e.transparentWithZWrite,e.fog=!0,e.lights=!0,e.clipping=!0,this.uniforms=Xr.merge([go.common,go.normalmap,go.emissivemap,go.fog,go.lights,{litFactor:{value:new or(1,1,1)},mapUvTransform:{value:new pn},colorAlpha:{value:1},normalMapUvTransform:{value:new pn},shadeColorFactor:{value:new or(0,0,0)},shadeMultiplyTexture:{value:null},shadeMultiplyTextureUvTransform:{value:new pn},shadingShiftFactor:{value:0},shadingShiftTexture:{value:null},shadingShiftTextureUvTransform:{value:new pn},shadingShiftTextureScale:{value:1},shadingToonyFactor:{value:.9},giEqualizationFactor:{value:.9},matcapFactor:{value:new or(1,1,1)},matcapTexture:{value:null},matcapTextureUvTransform:{value:new pn},parametricRimColorFactor:{value:new or(0,0,0)},rimMultiplyTexture:{value:null},rimMultiplyTextureUvTransform:{value:new pn},rimLightingMixFactor:{value:1},parametricRimFresnelPowerFactor:{value:5},parametricRimLiftFactor:{value:0},emissive:{value:new or(0,0,0)},emissiveIntensity:{value:1},emissiveMapUvTransform:{value:new pn},outlineWidthMultiplyTexture:{value:null},outlineWidthMultiplyTextureUvTransform:{value:new pn},outlineWidthFactor:{value:0},outlineColorFactor:{value:new or(0,0,0)},outlineLightingMixFactor:{value:1},uvAnimationMaskTexture:{value:null},uvAnimationMaskTextureUvTransform:{value:new pn},uvAnimationScrollXOffset:{value:0},uvAnimationScrollYOffset:{value:0},uvAnimationRotationPhase:{value:0}},null!=(t=e.uniforms)?t:{}]),this.setValues(e),this._uploadUniformsWorkaround(),this.customProgramCacheKey=()=>[...Object.entries(this._generateDefines()).map(([e,t])=>`${e}:${t}`),this.matcapTexture?`matcapTextureColorSpace:${ap(this.matcapTexture)}`:"",this.shadeMultiplyTexture?`shadeMultiplyTextureColorSpace:${ap(this.shadeMultiplyTexture)}`:"",this.rimMultiplyTexture?`rimMultiplyTextureColorSpace:${ap(this.rimMultiplyTexture)}`:""].join(","),this.onBeforeCompile=e=>{const t=parseInt(B,10),n=Object.entries(Qh(Qh({},this._generateDefines()),this.defines)).filter(([e,t])=>!!t).map(([e,t])=>`#define ${e} ${t}`).join("\n")+"\n";e.vertexShader=n+e.vertexShader,e.fragmentShader=n+e.fragmentShader,t<154&&(e.fragmentShader=e.fragmentShader.replace("#include <colorspace_fragment>","#include <encodings_fragment>"))}}get color(){return this.uniforms.litFactor.value}set color(e){this.uniforms.litFactor.value=e}get map(){return this.uniforms.map.value}set map(e){this.uniforms.map.value=e}get normalMap(){return this.uniforms.normalMap.value}set normalMap(e){this.uniforms.normalMap.value=e}get normalScale(){return this.uniforms.normalScale.value}set normalScale(e){this.uniforms.normalScale.value=e}get emissive(){return this.uniforms.emissive.value}set emissive(e){this.uniforms.emissive.value=e}get emissiveIntensity(){return this.uniforms.emissiveIntensity.value}set emissiveIntensity(e){this.uniforms.emissiveIntensity.value=e}get emissiveMap(){return this.uniforms.emissiveMap.value}set emissiveMap(e){this.uniforms.emissiveMap.value=e}get shadeColorFactor(){return this.uniforms.shadeColorFactor.value}set shadeColorFactor(e){this.uniforms.shadeColorFactor.value=e}get shadeMultiplyTexture(){return this.uniforms.shadeMultiplyTexture.value}set shadeMultiplyTexture(e){this.uniforms.shadeMultiplyTexture.value=e}get shadingShiftFactor(){return this.uniforms.shadingShiftFactor.value}set shadingShiftFactor(e){this.uniforms.shadingShiftFactor.value=e}get shadingShiftTexture(){return this.uniforms.shadingShiftTexture.value}set shadingShiftTexture(e){this.uniforms.shadingShiftTexture.value=e}get shadingShiftTextureScale(){return this.uniforms.shadingShiftTextureScale.value}set shadingShiftTextureScale(e){this.uniforms.shadingShiftTextureScale.value=e}get shadingToonyFactor(){return this.uniforms.shadingToonyFactor.value}set shadingToonyFactor(e){this.uniforms.shadingToonyFactor.value=e}get giEqualizationFactor(){return this.uniforms.giEqualizationFactor.value}set giEqualizationFactor(e){this.uniforms.giEqualizationFactor.value=e}get matcapFactor(){return this.uniforms.matcapFactor.value}set matcapFactor(e){this.uniforms.matcapFactor.value=e}get matcapTexture(){return this.uniforms.matcapTexture.value}set matcapTexture(e){this.uniforms.matcapTexture.value=e}get parametricRimColorFactor(){return this.uniforms.parametricRimColorFactor.value}set parametricRimColorFactor(e){this.uniforms.parametricRimColorFactor.value=e}get rimMultiplyTexture(){return this.uniforms.rimMultiplyTexture.value}set rimMultiplyTexture(e){this.uniforms.rimMultiplyTexture.value=e}get rimLightingMixFactor(){return this.uniforms.rimLightingMixFactor.value}set rimLightingMixFactor(e){this.uniforms.rimLightingMixFactor.value=e}get parametricRimFresnelPowerFactor(){return this.uniforms.parametricRimFresnelPowerFactor.value}set parametricRimFresnelPowerFactor(e){this.uniforms.parametricRimFresnelPowerFactor.value=e}get parametricRimLiftFactor(){return this.uniforms.parametricRimLiftFactor.value}set parametricRimLiftFactor(e){this.uniforms.parametricRimLiftFactor.value=e}get outlineWidthMultiplyTexture(){return this.uniforms.outlineWidthMultiplyTexture.value}set outlineWidthMultiplyTexture(e){this.uniforms.outlineWidthMultiplyTexture.value=e}get outlineWidthFactor(){return this.uniforms.outlineWidthFactor.value}set outlineWidthFactor(e){this.uniforms.outlineWidthFactor.value=e}get outlineColorFactor(){return this.uniforms.outlineColorFactor.value}set outlineColorFactor(e){this.uniforms.outlineColorFactor.value=e}get outlineLightingMixFactor(){return this.uniforms.outlineLightingMixFactor.value}set outlineLightingMixFactor(e){this.uniforms.outlineLightingMixFactor.value=e}get uvAnimationMaskTexture(){return this.uniforms.uvAnimationMaskTexture.value}set uvAnimationMaskTexture(e){this.uniforms.uvAnimationMaskTexture.value=e}get uvAnimationScrollXOffset(){return this.uniforms.uvAnimationScrollXOffset.value}set uvAnimationScrollXOffset(e){this.uniforms.uvAnimationScrollXOffset.value=e}get uvAnimationScrollYOffset(){return this.uniforms.uvAnimationScrollYOffset.value}set uvAnimationScrollYOffset(e){this.uniforms.uvAnimationScrollYOffset.value=e}get uvAnimationRotationPhase(){return this.uniforms.uvAnimationRotationPhase.value}set uvAnimationRotationPhase(e){this.uniforms.uvAnimationRotationPhase.value=e}get ignoreVertexColor(){return this._ignoreVertexColor}set ignoreVertexColor(e){this._ignoreVertexColor=e,this.needsUpdate=!0}get v0CompatShade(){return this._v0CompatShade}set v0CompatShade(e){this._v0CompatShade=e,this.needsUpdate=!0}get debugMode(){return this._debugMode}set debugMode(e){this._debugMode=e,this.needsUpdate=!0}get outlineWidthMode(){return this._outlineWidthMode}set outlineWidthMode(e){this._outlineWidthMode=e,this.needsUpdate=!0}get isOutline(){return this._isOutline}set isOutline(e){this._isOutline=e,this.needsUpdate=!0}get isMToonMaterial(){return!0}update(e){this._uploadUniformsWorkaround(),this._updateUVAnimation(e)}copy(e){return super.copy(e),this.map=e.map,this.normalMap=e.normalMap,this.emissiveMap=e.emissiveMap,this.shadeMultiplyTexture=e.shadeMultiplyTexture,this.shadingShiftTexture=e.shadingShiftTexture,this.matcapTexture=e.matcapTexture,this.rimMultiplyTexture=e.rimMultiplyTexture,this.outlineWidthMultiplyTexture=e.outlineWidthMultiplyTexture,this.uvAnimationMaskTexture=e.uvAnimationMaskTexture,this.normalMapType=e.normalMapType,this.uvAnimationScrollXSpeedFactor=e.uvAnimationScrollXSpeedFactor,this.uvAnimationScrollYSpeedFactor=e.uvAnimationScrollYSpeedFactor,this.uvAnimationRotationSpeedFactor=e.uvAnimationRotationSpeedFactor,this.ignoreVertexColor=e.ignoreVertexColor,this.v0CompatShade=e.v0CompatShade,this.debugMode=e.debugMode,this.outlineWidthMode=e.outlineWidthMode,this.isOutline=e.isOutline,this.needsUpdate=!0,this}_updateUVAnimation(e){this.uniforms.uvAnimationScrollXOffset.value+=e*this.uvAnimationScrollXSpeedFactor,this.uniforms.uvAnimationScrollYOffset.value+=e*this.uvAnimationScrollYSpeedFactor,this.uniforms.uvAnimationRotationPhase.value+=e*this.uvAnimationRotationSpeedFactor,this.uniforms.alphaTest.value=this.alphaTest,this.uniformsNeedUpdate=!0}_uploadUniformsWorkaround(){this.uniforms.opacity.value=this.opacity,this._updateTextureMatrix(this.uniforms.map,this.uniforms.mapUvTransform),this._updateTextureMatrix(this.uniforms.normalMap,this.uniforms.normalMapUvTransform),this._updateTextureMatrix(this.uniforms.emissiveMap,this.uniforms.emissiveMapUvTransform),this._updateTextureMatrix(this.uniforms.shadeMultiplyTexture,this.uniforms.shadeMultiplyTextureUvTransform),this._updateTextureMatrix(this.uniforms.shadingShiftTexture,this.uniforms.shadingShiftTextureUvTransform),this._updateTextureMatrix(this.uniforms.matcapTexture,this.uniforms.matcapTextureUvTransform),this._updateTextureMatrix(this.uniforms.rimMultiplyTexture,this.uniforms.rimMultiplyTextureUvTransform),this._updateTextureMatrix(this.uniforms.outlineWidthMultiplyTexture,this.uniforms.outlineWidthMultiplyTextureUvTransform),this._updateTextureMatrix(this.uniforms.uvAnimationMaskTexture,this.uniforms.uvAnimationMaskTextureUvTransform),this.uniformsNeedUpdate=!0}_generateDefines(){const e=parseInt(B,10),t=null!==this.outlineWidthMultiplyTexture,n=null!==this.map||null!==this.normalMap||null!==this.emissiveMap||null!==this.shadeMultiplyTexture||null!==this.shadingShiftTexture||null!==this.rimMultiplyTexture||null!==this.uvAnimationMaskTexture;return{THREE_VRM_THREE_REVISION:e,OUTLINE:this._isOutline,MTOON_USE_UV:t||n,MTOON_UVS_VERTEX_ONLY:t&&!n,V0_COMPAT_SHADE:this._v0CompatShade,USE_SHADEMULTIPLYTEXTURE:null!==this.shadeMultiplyTexture,USE_SHADINGSHIFTTEXTURE:null!==this.shadingShiftTexture,USE_MATCAPTEXTURE:null!==this.matcapTexture,USE_RIMMULTIPLYTEXTURE:null!==this.rimMultiplyTexture,USE_OUTLINEWIDTHMULTIPLYTEXTURE:this._isOutline&&null!==this.outlineWidthMultiplyTexture,USE_UVANIMATIONMASKTEXTURE:null!==this.uvAnimationMaskTexture,IGNORE_VERTEX_COLOR:!0===this._ignoreVertexColor,DEBUG_NORMAL:"normal"===this._debugMode,DEBUG_LITSHADERATE:"litShadeRate"===this._debugMode,DEBUG_UV:"uv"===this._debugMode,OUTLINE_WIDTH_SCREEN:this._isOutline&&this._outlineWidthMode===op}}_updateTextureMatrix(e,t){e.value&&(e.value.matrixAutoUpdate&&e.value.updateMatrix(),t.value.copy(e.value.matrix))}},up=new Set(["1.0","1.0-beta"]),cp=class e{get name(){return e.EXTENSION_NAME}constructor(e,t={}){var n,i,r,o;this.parser=e,this.materialType=null!=(n=t.materialType)?n:lp,this.renderOrderOffset=null!=(i=t.renderOrderOffset)?i:0,this.v0CompatShade=null!=(r=t.v0CompatShade)&&r,this.debugMode=null!=(o=t.debugMode)?o:"none",this._mToonMaterialSet=new Set}beforeRoot(){return ep(this,null,function*(){this._removeUnlitExtensionIfMToonExists()})}afterRoot(e){return ep(this,null,function*(){e.userData.vrmMToonMaterials=Array.from(this._mToonMaterialSet)})}getMaterialType(e){return this._getMToonExtension(e)?this.materialType:null}extendMaterialParams(e,t){const n=this._getMToonExtension(e);return n?this._extendMaterialParams(n,t):null}loadMesh(e){return ep(this,null,function*(){var t;const n=this.parser,i=null==(t=n.json.meshes)?void 0:t[e];if(null==i)throw new Error(`MToonMaterialLoaderPlugin: Attempt to use meshes[${e}] of glTF but the mesh doesn't exist`);const r=i.primitives,o=yield n.loadMesh(e);if(1===r.length){const e=o,t=r[0].material;null!=t&&this._setupPrimitive(e,t)}else{const e=o;for(let t=0;t<r.length;t++){const n=e.children[t],i=r[t].material;null!=i&&this._setupPrimitive(n,i)}}return o})}_removeUnlitExtensionIfMToonExists(){const e=this.parser.json.materials;null==e||e.map((e,t)=>{var n;this._getMToonExtension(t)&&(null==(n=e.extensions)?void 0:n.KHR_materials_unlit)&&delete e.extensions.KHR_materials_unlit})}_getMToonExtension(t){var n,i;const r=null==(n=this.parser.json.materials)?void 0:n[t];if(null==r)return void console.warn(`MToonMaterialLoaderPlugin: Attempt to use materials[${t}] of glTF but the material doesn't exist`);const o=null==(i=r.extensions)?void 0:i[e.EXTENSION_NAME];if(null==o)return;const s=o.specVersion;if(up.has(s))return o;console.warn(`MToonMaterialLoaderPlugin: Unknown ${e.EXTENSION_NAME} specVersion "${s}"`)}_extendMaterialParams(e,t){return ep(this,null,function*(){var n;delete t.metalness,delete t.roughness;const i=new np(this.parser,t);i.assignPrimitive("transparentWithZWrite",e.transparentWithZWrite),i.assignColor("shadeColorFactor",e.shadeColorFactor),i.assignTexture("shadeMultiplyTexture",e.shadeMultiplyTexture,!0),i.assignPrimitive("shadingShiftFactor",e.shadingShiftFactor),i.assignTexture("shadingShiftTexture",e.shadingShiftTexture,!0),i.assignPrimitive("shadingShiftTextureScale",null==(n=e.shadingShiftTexture)?void 0:n.scale),i.assignPrimitive("shadingToonyFactor",e.shadingToonyFactor),i.assignPrimitive("giEqualizationFactor",e.giEqualizationFactor),i.assignColor("matcapFactor",e.matcapFactor),i.assignTexture("matcapTexture",e.matcapTexture,!0),i.assignColor("parametricRimColorFactor",e.parametricRimColorFactor),i.assignTexture("rimMultiplyTexture",e.rimMultiplyTexture,!0),i.assignPrimitive("rimLightingMixFactor",e.rimLightingMixFactor),i.assignPrimitive("parametricRimFresnelPowerFactor",e.parametricRimFresnelPowerFactor),i.assignPrimitive("parametricRimLiftFactor",e.parametricRimLiftFactor),i.assignPrimitive("outlineWidthMode",e.outlineWidthMode),i.assignPrimitive("outlineWidthFactor",e.outlineWidthFactor),i.assignTexture("outlineWidthMultiplyTexture",e.outlineWidthMultiplyTexture,!1),i.assignColor("outlineColorFactor",e.outlineColorFactor),i.assignPrimitive("outlineLightingMixFactor",e.outlineLightingMixFactor),i.assignTexture("uvAnimationMaskTexture",e.uvAnimationMaskTexture,!1),i.assignPrimitive("uvAnimationScrollXSpeedFactor",e.uvAnimationScrollXSpeedFactor),i.assignPrimitive("uvAnimationScrollYSpeedFactor",e.uvAnimationScrollYSpeedFactor),i.assignPrimitive("uvAnimationRotationSpeedFactor",e.uvAnimationRotationSpeedFactor),i.assignPrimitive("v0CompatShade",this.v0CompatShade),i.assignPrimitive("debugMode",this.debugMode),yield i.pending})}_setupPrimitive(e,t){const n=this._getMToonExtension(t);if(n){const t=this._parseRenderOrder(n);return e.renderOrder=t+this.renderOrderOffset,this._generateOutline(e),void this._addToMaterialSet(e)}}_shouldGenerateOutline(e){return"string"==typeof e.outlineWidthMode&&"none"!==e.outlineWidthMode&&"number"==typeof e.outlineWidthFactor&&e.outlineWidthFactor>0}_generateOutline(e){const t=e.material;if(!(t instanceof lr))return;if(!this._shouldGenerateOutline(t))return;e.material=[t];const n=t.clone();n.name+=" (Outline)",n.isOutline=!0,n.side=1,e.material.push(n);const i=e.geometry,r=i.index?i.index.count:i.attributes.position.count/3;i.addGroup(0,r,0),i.addGroup(0,r,1)}_addToMaterialSet(e){const t=e.material,n=new Set;Array.isArray(t)?t.forEach(e=>n.add(e)):n.add(t);for(const i of n)this._mToonMaterialSet.add(i)}_parseRenderOrder(e){var t;return(e.transparentWithZWrite?0:19)+(null!=(t=e.renderQueueOffsetNumber)?t:0)}};cp.EXTENSION_NAME="VRMC_materials_mtoon";var dp=cp,hp=class e{get name(){return e.EXTENSION_NAME}constructor(e){this.parser=e}extendMaterialParams(e,t){return n=this,i=null,r=function*(){const n=this._getHDREmissiveMultiplierExtension(e);if(null==n)return;console.warn("VRMMaterialsHDREmissiveMultiplierLoaderPlugin: `VRMC_materials_hdr_emissiveMultiplier` is archived. Use `KHR_materials_emissive_strength` instead.");const i=n.emissiveMultiplier;t.emissiveIntensity=i},new Promise((e,t)=>{var o=e=>{try{a(r.next(e))}catch(n){t(n)}},s=e=>{try{a(r.throw(e))}catch(n){t(n)}},a=t=>t.done?e(t.value):Promise.resolve(t.value).then(o,s);a((r=r.apply(n,i)).next())});var n,i,r}_getHDREmissiveMultiplierExtension(t){var n,i;const r=null==(n=this.parser.json.materials)?void 0:n[t];if(null==r)return void console.warn(`VRMMaterialsHDREmissiveMultiplierLoaderPlugin: Attempt to use materials[${t}] of glTF but the material doesn't exist`);const o=null==(i=r.extensions)?void 0:i[e.EXTENSION_NAME];return null!=o?o:void 0}};hp.EXTENSION_NAME="VRMC_materials_hdr_emissiveMultiplier";var pp=hp,fp=Object.defineProperty,mp=Object.defineProperties,gp=Object.getOwnPropertyDescriptors,vp=Object.getOwnPropertySymbols,_p=Object.prototype.hasOwnProperty,yp=Object.prototype.propertyIsEnumerable,xp=(e,t,n)=>t in e?fp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Sp=(e,t)=>{for(var n in t||(t={}))_p.call(t,n)&&xp(e,n,t[n]);if(vp)for(var n of vp(t))yp.call(t,n)&&xp(e,n,t[n]);return e},Ep=(e,t)=>mp(e,gp(t));function bp(e){return Math.pow(e,2.2)}var Tp=class{get name(){return"VRMMaterialsV0CompatPlugin"}constructor(e){var t;this.parser=e,this._renderQueueMapTransparent=new Map,this._renderQueueMapTransparentZWrite=new Map;const n=this.parser.json;n.extensionsUsed=null!=(t=n.extensionsUsed)?t:[],-1===n.extensionsUsed.indexOf("KHR_texture_transform")&&n.extensionsUsed.push("KHR_texture_transform")}beforeRoot(){return e=this,t=null,n=function*(){var e;const t=this.parser.json,n=null==(e=t.extensions)?void 0:e.VRM,i=null==n?void 0:n.materialProperties;i&&(this._populateRenderQueueMap(i),i.forEach((e,n)=>{var i,r;const o=null==(i=t.materials)?void 0:i[n];if(null!=o)if("VRM/MToon"===e.shader){const i=this._parseV0MToonProperties(e,o);t.materials[n]=i}else if(null==(r=e.shader)?void 0:r.startsWith("VRM/Unlit")){const i=this._parseV0UnlitProperties(e,o);t.materials[n]=i}else"VRM_USE_GLTFSHADER"===e.shader||console.warn(`VRMMaterialsV0CompatPlugin: Unknown shader: ${e.shader}`);else console.warn(`VRMMaterialsV0CompatPlugin: Attempt to use materials[${n}] of glTF but the material doesn't exist`)}))},new Promise((i,r)=>{var o=e=>{try{a(n.next(e))}catch(t){r(t)}},s=e=>{try{a(n.throw(e))}catch(t){r(t)}},a=e=>e.done?i(e.value):Promise.resolve(e.value).then(o,s);a((n=n.apply(e,t)).next())});var e,t,n}_parseV0MToonProperties(e,t){var n,i,r,o,s,a,l,u,c,d,h,p,f,m,g,v,_,y,x,S,E,b,T,w,M,A,R,C,I,P,O,N,L,D,U,k,F,B,H,V,z,G,W,j,q,X,Y,K,J,$,Z,Q,ee,te,ne;const ie=null!=(i=null==(n=e.keywordMap)?void 0:n._ALPHABLEND_ON)&&i,re=1===(null==(r=e.floatProperties)?void 0:r._ZWrite)&&ie,oe=this._v0ParseRenderQueue(e),se=null!=(s=null==(o=e.keywordMap)?void 0:o._ALPHATEST_ON)&&s,ae=ie?"BLEND":se?"MASK":"OPAQUE",le=se?null!=(l=null==(a=e.floatProperties)?void 0:a._Cutoff)?l:.5:void 0,ue=0===(null!=(c=null==(u=e.floatProperties)?void 0:u._CullMode)?c:2),ce=this._portTextureTransform(e),de=(null!=(h=null==(d=e.vectorProperties)?void 0:d._Color)?h:[1,1,1,1]).map((e,t)=>3===t?e:bp(e)),he=null==(p=e.textureProperties)?void 0:p._MainTex,pe=null!=he?{index:he,extensions:Sp({},ce)}:void 0,fe=null!=(m=null==(f=e.floatProperties)?void 0:f._BumpScale)?m:1,me=null==(g=e.textureProperties)?void 0:g._BumpMap,ge=null!=me?{index:me,scale:fe,extensions:Sp({},ce)}:void 0,ve=(null!=(_=null==(v=e.vectorProperties)?void 0:v._EmissionColor)?_:[0,0,0,1]).map(bp),_e=null==(y=e.textureProperties)?void 0:y._EmissionMap,ye=null!=_e?{index:_e,extensions:Sp({},ce)}:void 0,xe=(null!=(S=null==(x=e.vectorProperties)?void 0:x._ShadeColor)?S:[.97,.81,.86,1]).map(bp),Se=null==(E=e.textureProperties)?void 0:E._ShadeTexture,Ee=null!=Se?{index:Se,extensions:Sp({},ce)}:void 0;let be=null!=(T=null==(b=e.floatProperties)?void 0:b._ShadeShift)?T:0,Te=null!=(M=null==(w=e.floatProperties)?void 0:w._ShadeToony)?M:.9;Te=dn.lerp(Te,1,.5+.5*be),be=-be-(1-Te);const we=null!=(R=null==(A=e.floatProperties)?void 0:A._IndirectLightIntensity)?R:.1,Me=we?1-we:void 0,Ae=null==(C=e.textureProperties)?void 0:C._SphereAdd,Re=null!=Ae?[1,1,1]:void 0,Ce=null!=Ae?{index:Ae}:void 0,Ie=null!=(P=null==(I=e.floatProperties)?void 0:I._RimLightingMix)?P:0,Pe=null==(O=e.textureProperties)?void 0:O._RimTexture,Oe=null!=Pe?{index:Pe,extensions:Sp({},ce)}:void 0,Ne=(null!=(L=null==(N=e.vectorProperties)?void 0:N._RimColor)?L:[0,0,0,1]).map(bp),Le=null!=(U=null==(D=e.floatProperties)?void 0:D._RimFresnelPower)?U:1,De=null!=(F=null==(k=e.floatProperties)?void 0:k._RimLift)?F:0,Ue=["none","worldCoordinates","screenCoordinates"][null!=(H=null==(B=e.floatProperties)?void 0:B._OutlineWidthMode)?H:0];let ke=null!=(z=null==(V=e.floatProperties)?void 0:V._OutlineWidth)?z:0;ke*=.01;const Fe=null==(G=e.textureProperties)?void 0:G._OutlineWidthTexture,Be=null!=Fe?{index:Fe,extensions:Sp({},ce)}:void 0,He=(null!=(j=null==(W=e.vectorProperties)?void 0:W._OutlineColor)?j:[0,0,0]).map(bp),Ve=1===(null!=(X=null==(q=e.floatProperties)?void 0:q._OutlineColorMode)?X:0)?null!=(K=null==(Y=e.floatProperties)?void 0:Y._OutlineLightingMix)?K:1:0,ze=null==(J=e.textureProperties)?void 0:J._UvAnimMaskTexture,Ge=null!=ze?{index:ze,extensions:Sp({},ce)}:void 0,We=null!=(Z=null==($=e.floatProperties)?void 0:$._UvAnimScrollX)?Z:0;let je=null!=(ee=null==(Q=e.floatProperties)?void 0:Q._UvAnimScrollY)?ee:0;null!=je&&(je=-je);const qe={specVersion:"1.0",transparentWithZWrite:re,renderQueueOffsetNumber:oe,shadeColorFactor:xe,shadeMultiplyTexture:Ee,shadingShiftFactor:be,shadingToonyFactor:Te,giEqualizationFactor:Me,matcapFactor:Re,matcapTexture:Ce,rimLightingMixFactor:Ie,rimMultiplyTexture:Oe,parametricRimColorFactor:Ne,parametricRimFresnelPowerFactor:Le,parametricRimLiftFactor:De,outlineWidthMode:Ue,outlineWidthFactor:ke,outlineWidthMultiplyTexture:Be,outlineColorFactor:He,outlineLightingMixFactor:Ve,uvAnimationMaskTexture:Ge,uvAnimationScrollXSpeedFactor:We,uvAnimationScrollYSpeedFactor:je,uvAnimationRotationSpeedFactor:null!=(ne=null==(te=e.floatProperties)?void 0:te._UvAnimRotation)?ne:0};return Ep(Sp({},t),{pbrMetallicRoughness:{baseColorFactor:de,baseColorTexture:pe},normalTexture:ge,emissiveTexture:ye,emissiveFactor:ve,alphaMode:ae,alphaCutoff:le,doubleSided:ue,extensions:{VRMC_materials_mtoon:qe}})}_parseV0UnlitProperties(e,t){var n,i,r,o,s;const a="VRM/UnlitTransparentZWrite"===e.shader,l="VRM/UnlitTransparent"===e.shader||a,u=this._v0ParseRenderQueue(e),c="VRM/UnlitCutout"===e.shader,d=l?"BLEND":c?"MASK":"OPAQUE",h=c?null!=(i=null==(n=e.floatProperties)?void 0:n._Cutoff)?i:.5:void 0,p=this._portTextureTransform(e),f=(null!=(o=null==(r=e.vectorProperties)?void 0:r._Color)?o:[1,1,1,1]).map(bp),m=null==(s=e.textureProperties)?void 0:s._MainTex,g=null!=m?{index:m,extensions:Sp({},p)}:void 0,v={specVersion:"1.0",transparentWithZWrite:a,renderQueueOffsetNumber:u,shadeColorFactor:f,shadeMultiplyTexture:g};return Ep(Sp({},t),{pbrMetallicRoughness:{baseColorFactor:f,baseColorTexture:g},alphaMode:d,alphaCutoff:h,extensions:{VRMC_materials_mtoon:v}})}_portTextureTransform(e){var t,n,i,r,o;const s=null==(t=e.vectorProperties)?void 0:t._MainTex;if(null==s)return{};const a=[null!=(n=null==s?void 0:s[0])?n:0,null!=(i=null==s?void 0:s[1])?i:0],l=[null!=(r=null==s?void 0:s[2])?r:1,null!=(o=null==s?void 0:s[3])?o:1];return a[1]=1-l[1]-a[1],{KHR_texture_transform:{offset:a,scale:l}}}_v0ParseRenderQueue(e){var t,n;const i="VRM/UnlitTransparentZWrite"===e.shader,r=null!=(null==(t=e.keywordMap)?void 0:t._ALPHABLEND_ON)||"VRM/UnlitTransparent"===e.shader||i,o=1===(null==(n=e.floatProperties)?void 0:n._ZWrite)||i;let s=0;if(r){const t=e.renderQueue;null!=t&&(s=o?this._renderQueueMapTransparentZWrite.get(t):this._renderQueueMapTransparent.get(t))}return s}_populateRenderQueueMap(e){const t=new Set,n=new Set;e.forEach(e=>{var i,r;const o="VRM/UnlitTransparentZWrite"===e.shader,s=null!=(null==(i=e.keywordMap)?void 0:i._ALPHABLEND_ON)||"VRM/UnlitTransparent"===e.shader||o,a=1===(null==(r=e.floatProperties)?void 0:r._ZWrite)||o;if(s){const i=e.renderQueue;null!=i&&(a?n.add(i):t.add(i))}}),t.size>10&&console.warn(`VRMMaterialsV0CompatPlugin: This VRM uses ${t.size} render queues for Transparent materials while VRM 1.0 only supports up to 10 render queues. The model might not be rendered correctly.`),n.size>10&&console.warn(`VRMMaterialsV0CompatPlugin: This VRM uses ${n.size} render queues for TransparentZWrite materials while VRM 1.0 only supports up to 10 render queues. The model might not be rendered correctly.`),Array.from(t).sort().forEach((e,n)=>{const i=Math.min(Math.max(n-t.size+1,-9),0);this._renderQueueMapTransparent.set(e,i)}),Array.from(n).sort().forEach((e,t)=>{const n=Math.min(Math.max(t,0),9);this._renderQueueMapTransparentZWrite.set(e,n)})}},wp=(e,t,n)=>new Promise((i,r)=>{var o=e=>{try{a(n.next(e))}catch(t){r(t)}},s=e=>{try{a(n.throw(e))}catch(t){r(t)}},a=e=>e.done?i(e.value):Promise.resolve(e.value).then(o,s);a((n=n.apply(e,t)).next())}),Mp=new Hn,Ap=class extends qa{constructor(e){super(),this._attrPosition=new hr(new Float32Array([0,0,0,0,0,0]),3),this._attrPosition.setUsage(35048);const t=new br;t.setAttribute("position",this._attrPosition);const n=new Il({color:16711935,depthTest:!1,depthWrite:!1});this._line=new Fl(t,n),this.add(this._line),this.constraint=e}updateMatrixWorld(e){Mp.setFromMatrixPosition(this.constraint.destination.matrixWorld),this._attrPosition.setXYZ(0,Mp.x,Mp.y,Mp.z),this.constraint.source&&Mp.setFromMatrixPosition(this.constraint.source.matrixWorld),this._attrPosition.setXYZ(1,Mp.x,Mp.y,Mp.z),this._attrPosition.needsUpdate=!0,super.updateMatrixWorld(e)}};function Rp(e,t){return t.set(e.elements[12],e.elements[13],e.elements[14])}var Cp=new Hn,Ip=new Hn;function Pp(e){return e.invert?e.invert():e.inverse(),e}var Op=class{constructor(e,t){this.destination=e,this.source=t,this.weight=1}},Np=new Hn,Lp=new Hn,Dp=new Hn,Up=new Bn,kp=new Bn,Fp=new Bn,Bp=class extends Op{get aimAxis(){return this._aimAxis}set aimAxis(e){this._aimAxis=e,this._v3AimAxis.set("PositiveX"===e?1:"NegativeX"===e?-1:0,"PositiveY"===e?1:"NegativeY"===e?-1:0,"PositiveZ"===e?1:"NegativeZ"===e?-1:0)}get dependencies(){const e=new Set([this.source]);return this.destination.parent&&e.add(this.destination.parent),e}constructor(e,t){super(e,t),this._aimAxis="PositiveX",this._v3AimAxis=new Hn(1,0,0),this._dstRestQuat=new Bn}setInitState(){this._dstRestQuat.copy(this.destination.quaternion)}update(){this.destination.updateWorldMatrix(!0,!1),this.source.updateWorldMatrix(!0,!1);const e=Up.identity(),t=kp.identity();var n,i;this.destination.parent&&(n=this.destination.parent.matrixWorld,i=e,n.decompose(Cp,i,Ip),Pp(t.copy(e)));const r=Np.copy(this._v3AimAxis).applyQuaternion(this._dstRestQuat).applyQuaternion(e),o=Rp(this.source.matrixWorld,Lp).sub(Rp(this.destination.matrixWorld,Dp)).normalize(),s=Fp.setFromUnitVectors(r,o).premultiply(t).multiply(e).multiply(this._dstRestQuat);this.destination.quaternion.copy(this._dstRestQuat).slerp(s,this.weight)}};function Hp(e,t){const n=[e];let i=e.parent;for(;null!==i;)n.unshift(i),i=i.parent;n.forEach(e=>{t(e)})}var Vp=class{constructor(){this._constraints=new Set,this._objectConstraintsMap=new Map}get constraints(){return this._constraints}addConstraint(e){this._constraints.add(e);let t=this._objectConstraintsMap.get(e.destination);null==t&&(t=new Set,this._objectConstraintsMap.set(e.destination,t)),t.add(e)}deleteConstraint(e){this._constraints.delete(e);this._objectConstraintsMap.get(e.destination).delete(e)}setInitState(){const e=new Set,t=new Set;for(const n of this._constraints)this._processConstraint(n,e,t,e=>e.setInitState())}update(){const e=new Set,t=new Set;for(const n of this._constraints)this._processConstraint(n,e,t,e=>e.update())}_processConstraint(e,t,n,i){if(n.has(e))return;if(t.has(e))throw new Error("VRMNodeConstraintManager: Circular dependency detected while updating constraints");t.add(e);const r=e.dependencies;for(const o of r)Hp(o,e=>{const r=this._objectConstraintsMap.get(e);if(r)for(const o of r)this._processConstraint(o,t,n,i)});i(e),n.add(e)}},zp=new Bn,Gp=new Bn,Wp=class extends Op{get dependencies(){return new Set([this.source])}constructor(e,t){super(e,t),this._dstRestQuat=new Bn,this._invSrcRestQuat=new Bn}setInitState(){this._dstRestQuat.copy(this.destination.quaternion),Pp(this._invSrcRestQuat.copy(this.source.quaternion))}update(){const e=zp.copy(this._invSrcRestQuat).multiply(this.source.quaternion),t=Gp.copy(this._dstRestQuat).multiply(e);this.destination.quaternion.copy(this._dstRestQuat).slerp(t,this.weight)}},jp=new Hn,qp=new Bn,Xp=new Bn,Yp=class extends Op{get rollAxis(){return this._rollAxis}set rollAxis(e){this._rollAxis=e,this._v3RollAxis.set("X"===e?1:0,"Y"===e?1:0,"Z"===e?1:0)}get dependencies(){return new Set([this.source])}constructor(e,t){super(e,t),this._rollAxis="X",this._v3RollAxis=new Hn(1,0,0),this._dstRestQuat=new Bn,this._invDstRestQuat=new Bn,this._invSrcRestQuatMulDstRestQuat=new Bn}setInitState(){this._dstRestQuat.copy(this.destination.quaternion),Pp(this._invDstRestQuat.copy(this._dstRestQuat)),Pp(this._invSrcRestQuatMulDstRestQuat.copy(this.source.quaternion)).multiply(this._dstRestQuat)}update(){const e=qp.copy(this._invDstRestQuat).multiply(this.source.quaternion).multiply(this._invSrcRestQuatMulDstRestQuat),t=jp.copy(this._v3RollAxis).applyQuaternion(e),n=Xp.setFromUnitVectors(t,this._v3RollAxis).premultiply(this._dstRestQuat).multiply(e);this.destination.quaternion.copy(this._dstRestQuat).slerp(n,this.weight)}},Kp=new Set(["1.0","1.0-beta"]),Jp=class e{get name(){return e.EXTENSION_NAME}constructor(e,t){this.parser=e,this.helperRoot=null==t?void 0:t.helperRoot}afterRoot(e){return wp(this,null,function*(){e.userData.vrmNodeConstraintManager=yield this._import(e)})}_import(t){return wp(this,null,function*(){var n;const i=this.parser.json;if(!(-1!==(null==(n=i.extensionsUsed)?void 0:n.indexOf(e.EXTENSION_NAME))))return null;const r=new Vp,o=yield this.parser.getDependencies("node");return o.forEach((t,n)=>{var s;const a=i.nodes[n],l=null==(s=null==a?void 0:a.extensions)?void 0:s[e.EXTENSION_NAME];if(null==l)return;const u=l.specVersion;if(!Kp.has(u))return void console.warn(`VRMNodeConstraintLoaderPlugin: Unknown ${e.EXTENSION_NAME} specVersion "${u}"`);const c=l.constraint;if(null!=c.roll){const e=this._importRollConstraint(t,o,c.roll);r.addConstraint(e)}else if(null!=c.aim){const e=this._importAimConstraint(t,o,c.aim);r.addConstraint(e)}else if(null!=c.rotation){const e=this._importRotationConstraint(t,o,c.rotation);r.addConstraint(e)}}),t.scene.updateMatrixWorld(),r.setInitState(),r})}_importRollConstraint(e,t,n){const{source:i,rollAxis:r,weight:o}=n,s=t[i],a=new Yp(e,s);if(null!=r&&(a.rollAxis=r),null!=o&&(a.weight=o),this.helperRoot){const e=new Ap(a);this.helperRoot.add(e)}return a}_importAimConstraint(e,t,n){const{source:i,aimAxis:r,weight:o}=n,s=t[i],a=new Bp(e,s);if(null!=r&&(a.aimAxis=r),null!=o&&(a.weight=o),this.helperRoot){const e=new Ap(a);this.helperRoot.add(e)}return a}_importRotationConstraint(e,t,n){const{source:i,weight:r}=n,o=t[i],s=new Wp(e,o);if(null!=r&&(s.weight=r),this.helperRoot){const e=new Ap(s);this.helperRoot.add(e)}return s}};Jp.EXTENSION_NAME="VRMC_node_constraint";var $p=Jp,Zp=(e,t,n)=>new Promise((i,r)=>{var o=e=>{try{a(n.next(e))}catch(t){r(t)}},s=e=>{try{a(n.throw(e))}catch(t){r(t)}},a=e=>e.done?i(e.value):Promise.resolve(e.value).then(o,s);a((n=n.apply(e,t)).next())}),Qp=class{},ef=new Hn,tf=new Hn,nf=class extends Qp{get type(){return"capsule"}constructor(e){var t,n,i,r;super(),this.offset=null!=(t=null==e?void 0:e.offset)?t:new Hn(0,0,0),this.tail=null!=(n=null==e?void 0:e.tail)?n:new Hn(0,0,0),this.radius=null!=(i=null==e?void 0:e.radius)?i:0,this.inside=null!=(r=null==e?void 0:e.inside)&&r}calculateCollision(e,t,n,i){ef.setFromMatrixPosition(e),tf.subVectors(this.tail,this.offset).applyMatrix4(e),tf.sub(ef);const r=tf.lengthSq();i.copy(t).sub(ef);const o=tf.dot(i);o<=0||(r<=o||tf.multiplyScalar(o/r),i.sub(tf));const s=i.length(),a=this.inside?this.radius-n-s:s-n-this.radius;return a<0&&(i.multiplyScalar(1/s),this.inside&&i.negate()),a}},rf=new Hn,of=new pn,sf=class extends Qp{get type(){return"plane"}constructor(e){var t,n;super(),this.offset=null!=(t=null==e?void 0:e.offset)?t:new Hn(0,0,0),this.normal=null!=(n=null==e?void 0:e.normal)?n:new Hn(0,0,1)}calculateCollision(e,t,n,i){i.setFromMatrixPosition(e),i.negate().add(t),of.getNormalMatrix(e),rf.copy(this.normal).applyNormalMatrix(of).normalize();const r=i.dot(rf)-n;return i.copy(rf),r}},af=new Hn,lf=class extends Qp{get type(){return"sphere"}constructor(e){var t,n,i;super(),this.offset=null!=(t=null==e?void 0:e.offset)?t:new Hn(0,0,0),this.radius=null!=(n=null==e?void 0:e.radius)?n:0,this.inside=null!=(i=null==e?void 0:e.inside)&&i}calculateCollision(e,t,n,i){i.subVectors(t,af.setFromMatrixPosition(e));const r=i.length(),o=this.inside?this.radius-n-r:r-n-this.radius;return o<0&&(i.multiplyScalar(1/r),this.inside&&i.negate()),o}},uf=new Hn,cf=class extends br{constructor(e){super(),this.worldScale=1,this._currentRadius=0,this._currentOffset=new Hn,this._currentTail=new Hn,this._shape=e,this._attrPos=new hr(new Float32Array(396),3),this.setAttribute("position",this._attrPos),this._attrIndex=new hr(new Uint16Array(264),1),this.setIndex(this._attrIndex),this._buildIndex(),this.update()}update(){let e=!1;const t=this._shape.radius/this.worldScale;this._currentRadius!==t&&(this._currentRadius=t,e=!0),this._currentOffset.equals(this._shape.offset)||(this._currentOffset.copy(this._shape.offset),e=!0);const n=uf.copy(this._shape.tail).divideScalar(this.worldScale);this._currentTail.distanceToSquared(n)>1e-10&&(this._currentTail.copy(n),e=!0),e&&this._buildPosition()}_buildPosition(){uf.copy(this._currentTail).sub(this._currentOffset);const e=uf.length()/this._currentRadius;for(let i=0;i<=16;i++){const t=i/16*Math.PI;this._attrPos.setXYZ(i,-Math.sin(t),-Math.cos(t),0),this._attrPos.setXYZ(17+i,e+Math.sin(t),Math.cos(t),0),this._attrPos.setXYZ(34+i,-Math.sin(t),0,-Math.cos(t)),this._attrPos.setXYZ(51+i,e+Math.sin(t),0,Math.cos(t))}for(let i=0;i<32;i++){const t=i/16*Math.PI;this._attrPos.setXYZ(68+i,0,Math.sin(t),Math.cos(t)),this._attrPos.setXYZ(100+i,e,Math.sin(t),Math.cos(t))}const t=Math.atan2(uf.y,Math.sqrt(uf.x*uf.x+uf.z*uf.z)),n=-Math.atan2(uf.z,uf.x);this.rotateZ(t),this.rotateY(n),this.scale(this._currentRadius,this._currentRadius,this._currentRadius),this.translate(this._currentOffset.x,this._currentOffset.y,this._currentOffset.z),this._attrPos.needsUpdate=!0}_buildIndex(){for(let e=0;e<34;e++){const t=(e+1)%34;this._attrIndex.setXY(2*e,e,t),this._attrIndex.setXY(68+2*e,34+e,34+t)}for(let e=0;e<32;e++){const t=(e+1)%32;this._attrIndex.setXY(136+2*e,68+e,68+t),this._attrIndex.setXY(200+2*e,100+e,100+t)}this._attrIndex.needsUpdate=!0}},df=class extends br{constructor(e){super(),this.worldScale=1,this._currentOffset=new Hn,this._currentNormal=new Hn,this._shape=e,this._attrPos=new hr(new Float32Array(18),3),this.setAttribute("position",this._attrPos),this._attrIndex=new hr(new Uint16Array(10),1),this.setIndex(this._attrIndex),this._buildIndex(),this.update()}update(){let e=!1;this._currentOffset.equals(this._shape.offset)||(this._currentOffset.copy(this._shape.offset),e=!0),this._currentNormal.equals(this._shape.normal)||(this._currentNormal.copy(this._shape.normal),e=!0),e&&this._buildPosition()}_buildPosition(){this._attrPos.setXYZ(0,-.5,-.5,0),this._attrPos.setXYZ(1,.5,-.5,0),this._attrPos.setXYZ(2,.5,.5,0),this._attrPos.setXYZ(3,-.5,.5,0),this._attrPos.setXYZ(4,0,0,0),this._attrPos.setXYZ(5,0,0,.25),this.translate(this._currentOffset.x,this._currentOffset.y,this._currentOffset.z),this.lookAt(this._currentNormal),this._attrPos.needsUpdate=!0}_buildIndex(){this._attrIndex.setXY(0,0,1),this._attrIndex.setXY(2,1,2),this._attrIndex.setXY(4,2,3),this._attrIndex.setXY(6,3,0),this._attrIndex.setXY(8,4,5),this._attrIndex.needsUpdate=!0}},hf=class extends br{constructor(e){super(),this.worldScale=1,this._currentRadius=0,this._currentOffset=new Hn,this._shape=e,this._attrPos=new hr(new Float32Array(288),3),this.setAttribute("position",this._attrPos),this._attrIndex=new hr(new Uint16Array(192),1),this.setIndex(this._attrIndex),this._buildIndex(),this.update()}update(){let e=!1;const t=this._shape.radius/this.worldScale;this._currentRadius!==t&&(this._currentRadius=t,e=!0),this._currentOffset.equals(this._shape.offset)||(this._currentOffset.copy(this._shape.offset),e=!0),e&&this._buildPosition()}_buildPosition(){for(let e=0;e<32;e++){const t=e/16*Math.PI;this._attrPos.setXYZ(e,Math.cos(t),Math.sin(t),0),this._attrPos.setXYZ(32+e,0,Math.cos(t),Math.sin(t)),this._attrPos.setXYZ(64+e,Math.sin(t),0,Math.cos(t))}this.scale(this._currentRadius,this._currentRadius,this._currentRadius),this.translate(this._currentOffset.x,this._currentOffset.y,this._currentOffset.z),this._attrPos.needsUpdate=!0}_buildIndex(){for(let e=0;e<32;e++){const t=(e+1)%32;this._attrIndex.setXY(2*e,e,t),this._attrIndex.setXY(64+2*e,32+e,32+t),this._attrIndex.setXY(128+2*e,64+e,64+t)}this._attrIndex.needsUpdate=!0}},pf=new Hn,ff=class extends qa{constructor(e){if(super(),this.matrixAutoUpdate=!1,this.collider=e,this.collider.shape instanceof lf)this._geometry=new hf(this.collider.shape);else if(this.collider.shape instanceof nf)this._geometry=new cf(this.collider.shape);else{if(!(this.collider.shape instanceof sf))throw new Error("VRMSpringBoneColliderHelper: Unknown collider shape type detected");this._geometry=new df(this.collider.shape)}const t=new Il({color:16711935,depthTest:!1,depthWrite:!1});this._line=new zl(this._geometry,t),this.add(this._line)}dispose(){this._geometry.dispose()}updateMatrixWorld(e){this.collider.updateWorldMatrix(!0,!1),this.matrix.copy(this.collider.matrixWorld);const t=this.matrix.elements;this._geometry.worldScale=pf.set(t[0],t[1],t[2]).length(),this._geometry.update(),super.updateMatrixWorld(e)}},mf=class extends br{constructor(e){super(),this.worldScale=1,this._currentRadius=0,this._currentTail=new Hn,this._springBone=e,this._attrPos=new hr(new Float32Array(294),3),this.setAttribute("position",this._attrPos),this._attrIndex=new hr(new Uint16Array(194),1),this.setIndex(this._attrIndex),this._buildIndex(),this.update()}update(){let e=!1;const t=this._springBone.settings.hitRadius/this.worldScale;this._currentRadius!==t&&(this._currentRadius=t,e=!0),this._currentTail.equals(this._springBone.initialLocalChildPosition)||(this._currentTail.copy(this._springBone.initialLocalChildPosition),e=!0),e&&this._buildPosition()}_buildPosition(){for(let e=0;e<32;e++){const t=e/16*Math.PI;this._attrPos.setXYZ(e,Math.cos(t),Math.sin(t),0),this._attrPos.setXYZ(32+e,0,Math.cos(t),Math.sin(t)),this._attrPos.setXYZ(64+e,Math.sin(t),0,Math.cos(t))}this.scale(this._currentRadius,this._currentRadius,this._currentRadius),this.translate(this._currentTail.x,this._currentTail.y,this._currentTail.z),this._attrPos.setXYZ(96,0,0,0),this._attrPos.setXYZ(97,this._currentTail.x,this._currentTail.y,this._currentTail.z),this._attrPos.needsUpdate=!0}_buildIndex(){for(let e=0;e<32;e++){const t=(e+1)%32;this._attrIndex.setXY(2*e,e,t),this._attrIndex.setXY(64+2*e,32+e,32+t),this._attrIndex.setXY(128+2*e,64+e,64+t)}this._attrIndex.setXY(192,96,97),this._attrIndex.needsUpdate=!0}},gf=new Hn,vf=class extends qa{constructor(e){super(),this.matrixAutoUpdate=!1,this.springBone=e,this._geometry=new mf(this.springBone);const t=new Il({color:16776960,depthTest:!1,depthWrite:!1});this._line=new zl(this._geometry,t),this.add(this._line)}dispose(){this._geometry.dispose()}updateMatrixWorld(e){this.springBone.bone.updateWorldMatrix(!0,!1),this.matrix.copy(this.springBone.bone.matrixWorld);const t=this.matrix.elements;this._geometry.worldScale=gf.set(t[0],t[1],t[2]).length(),this._geometry.update(),super.updateMatrixWorld(e)}},_f=class extends Gi{constructor(e){super(),this.colliderMatrix=new gi,this.shape=e}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),function(e,t,n){const i=t.elements;e.copy(t),n&&(e.elements[12]=i[0]*n.x+i[4]*n.y+i[8]*n.z+i[12],e.elements[13]=i[1]*n.x+i[5]*n.y+i[9]*n.z+i[13],e.elements[14]=i[2]*n.x+i[6]*n.y+i[10]*n.z+i[14])}(this.colliderMatrix,this.matrixWorld,this.shape.offset)}};var yf=new gi;var xf=class{constructor(e){this._inverseCache=new gi,this._shouldUpdateInverse=!0,this.matrix=e;const t={set:(e,t,n)=>(this._shouldUpdateInverse=!0,e[t]=n,!0)};this._originalElements=e.elements,e.elements=new Proxy(e.elements,t)}get inverse(){var e;return this._shouldUpdateInverse&&((e=this._inverseCache.copy(this.matrix)).invert?e.invert():e.getInverse(yf.copy(e)),this._shouldUpdateInverse=!1),this._inverseCache}revert(){this.matrix.elements=this._originalElements}},Sf=new gi,Ef=new Hn,bf=new Hn,Tf=new Hn,wf=new Hn,Mf=new gi,Af=class{constructor(e,t,n={},i=[]){var r,o,s,a,l,u;this._currentTail=new Hn,this._prevTail=new Hn,this._boneAxis=new Hn,this._worldSpaceBoneLength=0,this._center=null,this._initialLocalMatrix=new gi,this._initialLocalRotation=new Bn,this._initialLocalChildPosition=new Hn,this.bone=e,this.bone.matrixAutoUpdate=!1,this.child=t,this.settings={hitRadius:null!=(r=n.hitRadius)?r:0,stiffness:null!=(o=n.stiffness)?o:1,gravityPower:null!=(s=n.gravityPower)?s:0,gravityDir:null!=(l=null==(a=n.gravityDir)?void 0:a.clone())?l:new Hn(0,-1,0),dragForce:null!=(u=n.dragForce)?u:.4},this.colliderGroups=i}get dependencies(){const e=new Set,t=this.bone.parent;t&&e.add(t);for(let n=0;n<this.colliderGroups.length;n++)for(let t=0;t<this.colliderGroups[n].colliders.length;t++)e.add(this.colliderGroups[n].colliders[t]);return e}get center(){return this._center}set center(e){var t;(null==(t=this._center)?void 0:t.userData.inverseCacheProxy)&&(this._center.userData.inverseCacheProxy.revert(),delete this._center.userData.inverseCacheProxy),this._center=e,this._center&&(this._center.userData.inverseCacheProxy||(this._center.userData.inverseCacheProxy=new xf(this._center.matrixWorld)))}get initialLocalChildPosition(){return this._initialLocalChildPosition}get _parentMatrixWorld(){return this.bone.parent?this.bone.parent.matrixWorld:Sf}setInitState(){this._initialLocalMatrix.copy(this.bone.matrix),this._initialLocalRotation.copy(this.bone.quaternion),this.child?this._initialLocalChildPosition.copy(this.child.position):this._initialLocalChildPosition.copy(this.bone.position).normalize().multiplyScalar(.07);const e=this._getMatrixWorldToCenter();this.bone.localToWorld(this._currentTail.copy(this._initialLocalChildPosition)).applyMatrix4(e),this._prevTail.copy(this._currentTail),this._boneAxis.copy(this._initialLocalChildPosition).normalize()}reset(){this.bone.quaternion.copy(this._initialLocalRotation),this.bone.updateMatrix(),this.bone.matrixWorld.multiplyMatrices(this._parentMatrixWorld,this.bone.matrix);const e=this._getMatrixWorldToCenter();this.bone.localToWorld(this._currentTail.copy(this._initialLocalChildPosition)).applyMatrix4(e),this._prevTail.copy(this._currentTail)}update(e){if(e<=0)return;this._calcWorldSpaceBoneLength();const t=bf.copy(this._boneAxis).transformDirection(this._initialLocalMatrix).transformDirection(this._parentMatrixWorld);wf.copy(this._currentTail).add(Ef.subVectors(this._currentTail,this._prevTail).multiplyScalar(1-this.settings.dragForce)).applyMatrix4(this._getMatrixCenterToWorld()).addScaledVector(t,this.settings.stiffness*e).addScaledVector(this.settings.gravityDir,this.settings.gravityPower*e),Tf.setFromMatrixPosition(this.bone.matrixWorld),wf.sub(Tf).normalize().multiplyScalar(this._worldSpaceBoneLength).add(Tf),this._collision(wf),this._prevTail.copy(this._currentTail),this._currentTail.copy(wf).applyMatrix4(this._getMatrixWorldToCenter());const n=Mf.multiplyMatrices(this._parentMatrixWorld,this._initialLocalMatrix).invert();this.bone.quaternion.setFromUnitVectors(this._boneAxis,Ef.copy(wf).applyMatrix4(n).normalize()).premultiply(this._initialLocalRotation),this.bone.updateMatrix(),this.bone.matrixWorld.multiplyMatrices(this._parentMatrixWorld,this.bone.matrix)}_collision(e){for(let t=0;t<this.colliderGroups.length;t++)for(let n=0;n<this.colliderGroups[t].colliders.length;n++){const i=this.colliderGroups[t].colliders[n],r=i.shape.calculateCollision(i.colliderMatrix,e,this.settings.hitRadius,Ef);if(r<0){e.addScaledVector(Ef,-r),e.sub(Tf);const t=e.length();e.multiplyScalar(this._worldSpaceBoneLength/t).add(Tf)}}}_calcWorldSpaceBoneLength(){Ef.setFromMatrixPosition(this.bone.matrixWorld),this.child?bf.setFromMatrixPosition(this.child.matrixWorld):(bf.copy(this._initialLocalChildPosition),bf.applyMatrix4(this.bone.matrixWorld)),this._worldSpaceBoneLength=Ef.sub(bf).length()}_getMatrixCenterToWorld(){return this._center?this._center.matrixWorld:Sf}_getMatrixWorldToCenter(){return this._center?this._center.userData.inverseCacheProxy.inverse:Sf}};function Rf(e,t){const n=[];let i=e;for(;null!==i;)n.unshift(i),i=i.parent;n.forEach(e=>{t(e)})}function Cf(e,t){e.children.forEach(e=>{t(e)||Cf(e,t)})}var If=class{constructor(){this._joints=new Set,this._sortedJoints=[],this._hasWarnedCircularDependency=!1,this._ancestors=[],this._objectSpringBonesMap=new Map,this._isSortedJointsDirty=!1,this._relevantChildrenUpdated=this._relevantChildrenUpdated.bind(this)}get joints(){return this._joints}get springBones(){return console.warn("VRMSpringBoneManager: springBones is deprecated. use joints instead."),this._joints}get colliderGroups(){const e=new Set;return this._joints.forEach(t=>{t.colliderGroups.forEach(t=>{e.add(t)})}),Array.from(e)}get colliders(){const e=new Set;return this.colliderGroups.forEach(t=>{t.colliders.forEach(t=>{e.add(t)})}),Array.from(e)}addJoint(e){this._joints.add(e);let t=this._objectSpringBonesMap.get(e.bone);null==t&&(t=new Set,this._objectSpringBonesMap.set(e.bone,t)),t.add(e),this._isSortedJointsDirty=!0}addSpringBone(e){console.warn("VRMSpringBoneManager: addSpringBone() is deprecated. use addJoint() instead."),this.addJoint(e)}deleteJoint(e){this._joints.delete(e);this._objectSpringBonesMap.get(e.bone).delete(e),this._isSortedJointsDirty=!0}deleteSpringBone(e){console.warn("VRMSpringBoneManager: deleteSpringBone() is deprecated. use deleteJoint() instead."),this.deleteJoint(e)}setInitState(){this._sortJoints();for(let e=0;e<this._sortedJoints.length;e++){const t=this._sortedJoints[e];t.bone.updateMatrix(),t.bone.updateWorldMatrix(!1,!1),t.setInitState()}}reset(){this._sortJoints();for(let e=0;e<this._sortedJoints.length;e++){const t=this._sortedJoints[e];t.bone.updateMatrix(),t.bone.updateWorldMatrix(!1,!1),t.reset()}}update(e){this._sortJoints();for(let t=0;t<this._ancestors.length;t++)this._ancestors[t].updateWorldMatrix(0===t,!1);for(let t=0;t<this._sortedJoints.length;t++){const n=this._sortedJoints[t];n.bone.updateMatrix(),n.bone.updateWorldMatrix(!1,!1),n.update(e),Cf(n.bone,this._relevantChildrenUpdated)}}_sortJoints(){if(!this._isSortedJointsDirty)return;const e=[],t=new Set,n=new Set,i=new Set;for(const o of this._joints)this._insertJointSort(o,t,n,e,i);this._sortedJoints=e;const r=function(e){var t;const n=new Map;for(const i of e){let r=i;do{const i=(null!=(t=n.get(r))?t:0)+1;if(i===e.size)return r;n.set(r,i),r=r.parent}while(null!==r)}return null}(i);this._ancestors=[],r&&(this._ancestors.push(r),Cf(r,e=>{var t,n;return(null!=(n=null==(t=this._objectSpringBonesMap.get(e))?void 0:t.size)?n:0)>0||(this._ancestors.push(e),!1)})),this._isSortedJointsDirty=!1}_insertJointSort(e,t,n,i,r){if(n.has(e))return;if(t.has(e))return void(this._hasWarnedCircularDependency||(console.warn("VRMSpringBoneManager: Circular dependency detected"),this._hasWarnedCircularDependency=!0));t.add(e);const o=e.dependencies;for(const s of o){let e=!1,o=null;Rf(s,s=>{const a=this._objectSpringBonesMap.get(s);if(a)for(const o of a)e=!0,this._insertJointSort(o,t,n,i,r);else e||(o=s)}),o&&r.add(o)}i.push(e),n.add(e)}_relevantChildrenUpdated(e){var t,n;return(null!=(n=null==(t=this._objectSpringBonesMap.get(e))?void 0:t.size)?n:0)>0||(e.updateWorldMatrix(!1,!1),!1)}},Pf="VRMC_springBone_extended_collider",Of=new Set(["1.0","1.0-beta"]),Nf=new Set(["1.0"]),Lf=class e{get name(){return e.EXTENSION_NAME}constructor(e,t){var n;this.parser=e,this.jointHelperRoot=null==t?void 0:t.jointHelperRoot,this.colliderHelperRoot=null==t?void 0:t.colliderHelperRoot,this.useExtendedColliders=null==(n=null==t?void 0:t.useExtendedColliders)||n}afterRoot(e){return Zp(this,null,function*(){e.userData.vrmSpringBoneManager=yield this._import(e)})}_import(e){return Zp(this,null,function*(){const t=yield this._v1Import(e);if(null!=t)return t;const n=yield this._v0Import(e);return null!=n?n:null})}_v1Import(t){return Zp(this,null,function*(){var n,i,r,o,s;const a=t.parser.json;if(!(-1!==(null==(n=a.extensionsUsed)?void 0:n.indexOf(e.EXTENSION_NAME))))return null;const l=new If,u=yield t.parser.getDependencies("node"),c=null==(i=a.extensions)?void 0:i[e.EXTENSION_NAME];if(!c)return null;const d=c.specVersion;if(!Of.has(d))return console.warn(`VRMSpringBoneLoaderPlugin: Unknown ${e.EXTENSION_NAME} specVersion "${d}"`),null;const h=null==(r=c.colliders)?void 0:r.map((t,n)=>{var i,r,o,s,a,l,c,d,h,p,f,m,g,v,_;const y=u[t.node];if(null==y)return console.warn(`VRMSpringBoneLoaderPlugin: The collider #${n} attempted to use the node #${t.node} but not found`),null;const x=t.shape,S=null==(i=t.extensions)?void 0:i[Pf];if(this.useExtendedColliders&&null!=S){const t=S.specVersion;if(Nf.has(t)){const e=S.shape;if(e.sphere)return this._importSphereCollider(y,{offset:(new Hn).fromArray(null!=(r=e.sphere.offset)?r:[0,0,0]),radius:null!=(o=e.sphere.radius)?o:0,inside:null!=(s=e.sphere.inside)&&s});if(e.capsule)return this._importCapsuleCollider(y,{offset:(new Hn).fromArray(null!=(a=e.capsule.offset)?a:[0,0,0]),radius:null!=(l=e.capsule.radius)?l:0,tail:(new Hn).fromArray(null!=(c=e.capsule.tail)?c:[0,0,0]),inside:null!=(d=e.capsule.inside)&&d});if(e.plane)return this._importPlaneCollider(y,{offset:(new Hn).fromArray(null!=(h=e.plane.offset)?h:[0,0,0]),normal:(new Hn).fromArray(null!=(p=e.plane.normal)?p:[0,0,1])})}else console.warn(`VRMSpringBoneLoaderPlugin: Unknown ${Pf} specVersion "${t}". Fallbacking to the ${e.EXTENSION_NAME} definition`)}if(x.sphere)return this._importSphereCollider(y,{offset:(new Hn).fromArray(null!=(f=x.sphere.offset)?f:[0,0,0]),radius:null!=(m=x.sphere.radius)?m:0,inside:!1});if(x.capsule)return this._importCapsuleCollider(y,{offset:(new Hn).fromArray(null!=(g=x.capsule.offset)?g:[0,0,0]),radius:null!=(v=x.capsule.radius)?v:0,tail:(new Hn).fromArray(null!=(_=x.capsule.tail)?_:[0,0,0]),inside:!1});throw new Error(`VRMSpringBoneLoaderPlugin: The collider #${n} has no valid shape`)}),p=null==(o=c.colliderGroups)?void 0:o.map((e,t)=>{var n;return{colliders:(null!=(n=e.colliders)?n:[]).flatMap(e=>{const n=null==h?void 0:h[e];return null==n?(console.warn(`VRMSpringBoneLoaderPlugin: The colliderGroup #${t} attempted to use a collider #${e} but not found`),[]):n}),name:e.name}});return null==(s=c.springs)||s.forEach((e,t)=>{var n;const i=e.joints,r=null==(n=e.colliderGroups)?void 0:n.map(e=>{const n=null==p?void 0:p[e];if(null==n)throw new Error(`VRMSpringBoneLoaderPlugin: The spring #${t} attempted to use a colliderGroup ${e} but not found`);return n}),o=null!=e.center?u[e.center]:void 0;let s;i.forEach(e=>{if(s){const t=s.node,n=u[t],i=e.node,a=u[i],c={hitRadius:s.hitRadius,dragForce:s.dragForce,gravityPower:s.gravityPower,stiffness:s.stiffness,gravityDir:null!=s.gravityDir?(new Hn).fromArray(s.gravityDir):void 0},d=this._importJoint(n,a,c,r);o&&(d.center=o),l.addJoint(d)}s=e})}),l.setInitState(),l})}_v0Import(e){return Zp(this,null,function*(){var t,n,i;const r=e.parser.json;if(!(-1!==(null==(t=r.extensionsUsed)?void 0:t.indexOf("VRM"))))return null;const o=null==(n=r.extensions)?void 0:n.VRM,s=null==o?void 0:o.secondaryAnimation;if(!s)return null;const a=null==s?void 0:s.boneGroups;if(!a)return null;const l=new If,u=yield e.parser.getDependencies("node"),c=null==(i=s.colliderGroups)?void 0:i.map(e=>{var t;const n=u[e.node];return{colliders:(null!=(t=e.colliders)?t:[]).map((e,t)=>{var i,r,o;const s=new Hn(0,0,0);return e.offset&&s.set(null!=(i=e.offset.x)?i:0,null!=(r=e.offset.y)?r:0,e.offset.z?-e.offset.z:0),this._importSphereCollider(n,{offset:s,radius:null!=(o=e.radius)?o:0,inside:!1})})}});return null==a||a.forEach((e,t)=>{const n=e.bones;n&&n.forEach(n=>{var i,r,o,s;const a=u[n],d=new Hn;e.gravityDir?d.set(null!=(i=e.gravityDir.x)?i:0,null!=(r=e.gravityDir.y)?r:0,null!=(o=e.gravityDir.z)?o:0):d.set(0,-1,0);const h=null!=e.center?u[e.center]:void 0,p={hitRadius:e.hitRadius,dragForce:e.dragForce,gravityPower:e.gravityPower,stiffness:e.stiffiness,gravityDir:d},f=null==(s=e.colliderGroups)?void 0:s.map(e=>{const n=null==c?void 0:c[e];if(null==n)throw new Error(`VRMSpringBoneLoaderPlugin: The spring #${t} attempted to use a colliderGroup ${e} but not found`);return n});a.traverse(e=>{var t;const n=null!=(t=e.children[0])?t:null,i=this._importJoint(e,n,p,f);h&&(i.center=h),l.addJoint(i)})})}),e.scene.updateMatrixWorld(),l.setInitState(),l})}_importJoint(e,t,n,i){const r=new Af(e,t,n,i);if(this.jointHelperRoot){const e=new vf(r);this.jointHelperRoot.add(e),e.renderOrder=this.jointHelperRoot.renderOrder}return r}_importSphereCollider(e,t){const n=new lf(t),i=new _f(n);if(e.add(i),this.colliderHelperRoot){const e=new ff(i);this.colliderHelperRoot.add(e),e.renderOrder=this.colliderHelperRoot.renderOrder}return i}_importCapsuleCollider(e,t){const n=new nf(t),i=new _f(n);if(e.add(i),this.colliderHelperRoot){const e=new ff(i);this.colliderHelperRoot.add(e),e.renderOrder=this.colliderHelperRoot.renderOrder}return i}_importPlaneCollider(e,t){const n=new sf(t),i=new _f(n);if(e.add(i),this.colliderHelperRoot){const e=new ff(i);this.colliderHelperRoot.add(e),e.renderOrder=this.colliderHelperRoot.renderOrder}return i}};Lf.EXTENSION_NAME="VRMC_springBone";var Df=Lf,Uf=class{get name(){return"VRMLoaderPlugin"}constructor(e,t){var n,i,r,o,s,a,l,u,c,d;this.parser=e;const h=null==t?void 0:t.helperRoot,p=null==t?void 0:t.autoUpdateHumanBones;this.expressionPlugin=null!=(n=null==t?void 0:t.expressionPlugin)?n:new Fd(e),this.firstPersonPlugin=null!=(i=null==t?void 0:t.firstPersonPlugin)?i:new zd(e),this.humanoidPlugin=null!=(r=null==t?void 0:t.humanoidPlugin)?r:new ah(e,{helperRoot:h,autoUpdateHumanBones:p}),this.lookAtPlugin=null!=(o=null==t?void 0:t.lookAtPlugin)?o:new Gh(e,{helperRoot:h}),this.metaPlugin=null!=(s=null==t?void 0:t.metaPlugin)?s:new jh(e),this.mtoonMaterialPlugin=null!=(a=null==t?void 0:t.mtoonMaterialPlugin)?a:new dp(e),this.materialsHDREmissiveMultiplierPlugin=null!=(l=null==t?void 0:t.materialsHDREmissiveMultiplierPlugin)?l:new pp(e),this.materialsV0CompatPlugin=null!=(u=null==t?void 0:t.materialsV0CompatPlugin)?u:new Tp(e),this.springBonePlugin=null!=(c=null==t?void 0:t.springBonePlugin)?c:new Df(e,{colliderHelperRoot:h,jointHelperRoot:h}),this.nodeConstraintPlugin=null!=(d=null==t?void 0:t.nodeConstraintPlugin)?d:new $p(e,{helperRoot:h})}beforeRoot(){return yd(this,null,function*(){yield this.materialsV0CompatPlugin.beforeRoot(),yield this.mtoonMaterialPlugin.beforeRoot()})}loadMesh(e){return yd(this,null,function*(){return yield this.mtoonMaterialPlugin.loadMesh(e)})}getMaterialType(e){const t=this.mtoonMaterialPlugin.getMaterialType(e);return null!=t?t:null}extendMaterialParams(e,t){return yd(this,null,function*(){yield this.materialsHDREmissiveMultiplierPlugin.extendMaterialParams(e,t),yield this.mtoonMaterialPlugin.extendMaterialParams(e,t)})}afterRoot(e){return yd(this,null,function*(){yield this.metaPlugin.afterRoot(e),yield this.humanoidPlugin.afterRoot(e),yield this.expressionPlugin.afterRoot(e),yield this.lookAtPlugin.afterRoot(e),yield this.firstPersonPlugin.afterRoot(e),yield this.springBonePlugin.afterRoot(e),yield this.nodeConstraintPlugin.afterRoot(e),yield this.mtoonMaterialPlugin.afterRoot(e);const t=e.userData.vrmMeta,n=e.userData.vrmHumanoid;if(t&&n){const i=new Xh({scene:e.scene,expressionManager:e.userData.vrmExpressionManager,firstPerson:e.userData.vrmFirstPerson,humanoid:n,lookAt:e.userData.vrmLookAt,meta:t,materials:e.userData.vrmMToonMaterials,springBoneManager:e.userData.vrmSpringBoneManager,nodeConstraintManager:e.userData.vrmNodeConstraintManager});e.userData.vrm=i}})}};function kf(e,t,n){if(1===t.size){const n=t.values().next().value;if(1===n.weight)return e[n.index]}const i=new Float32Array(3*e[0].count);let r=0;if(n)r=1;else for(const o of t)r+=o.weight;for(const o of t){const t=e[o.index],n=o.weight/r;for(let e=0;e<t.count;e++)i[3*e+0]+=t.getX(e)*n,i[3*e+1]+=t.getY(e)*n,i[3*e+2]+=t.getZ(e)*n}return new hr(i,3)}function Ff(e,t,n){if(e.getComponent)return e.getComponent(t,n);{let i=e.array[t*e.itemSize+n];return e.normalized&&(i=dn.denormalize(i,e.array)),i}}function Bf(e,t,n,i){e.setComponent?e.setComponent(t,n,i):(e.normalized&&(i=dn.normalize(i,e.array)),e.array[t*e.itemSize+n]=i)}function Hf(e,t){const n=new Set;for(let i=0;i<e.count;i++)for(let r=0;r<e.itemSize;r++){const o=Ff(e,i,r);0!==Ff(t,i,r)&&n.add(o)}return n}function Vf(e,t){const n=new Map,i=e.skeleton,r=e.geometry,o=r.getAttribute("skinIndex"),s=r.getAttribute("skinWeight"),a=t.get(o),l=null==a?void 0:a.get(s);if(!l)throw new Error("Unreachable. attributeUsedIndexSetMap does not know the skin index attribute or the skin weight attribute.");for(const u of l)n.set(i.bones[u],i.boneInverses[u]);return n}function zf(e,t){for(const[n,i]of e.entries()){const e=t.get(n);if(null!=e&&!Wf(i,e))return!1}return!0}function Gf(e,t,n){const i=new Map;for(const o of t)i.set(o,i.size);const r=new Map;for(const[o,s]of n.entries()){const e=i.get(s);r.set(e,o)}for(let o=0;o<e.count;o++)for(let t=0;t<e.itemSize;t++){const n=Ff(e,o,t);Bf(e,o,t,r.get(n))}e.needsUpdate=!0}function Wf(e,t,n){if(n=n||1e-4,e.elements.length!=t.elements.length)return!1;for(let i=0,r=e.elements.length;i<r;i++){if(Math.abs(e.elements[i]-t.elements[i])>n)return!1}return!0}var jf=class{constructor(){this._objectIndexMap=new Map,this._index=0}get(e){return this._objectIndexMap.get(e)}getOrCreate(e){let t=this._objectIndexMap.get(e);return null==t&&(t=this._index,this._objectIndexMap.set(e,t),this._index++),t}};function qf(e){var t,n,i,r;const o=new br;o.name=e.name,o.setIndex(e.index);for(const[s,a]of Object.entries(e.attributes))o.setAttribute(s,a);for(const[s,a]of Object.entries(e.morphAttributes)){const e=s;o.morphAttributes[e]=a.concat()}o.morphTargetsRelative=e.morphTargetsRelative,o.groups=[];for(const s of e.groups)o.addGroup(s.start,s.count,s.materialIndex);return o.boundingSphere=null!=(n=null==(t=e.boundingSphere)?void 0:t.clone())?n:null,o.boundingBox=null!=(r=null==(i=e.boundingBox)?void 0:i.clone())?r:null,o.drawRange.start=e.drawRange.start,o.drawRange.count=e.drawRange.count,o.userData=e.userData,o}function Xf(e){if(Object.values(e).forEach(e=>{if(null==e?void 0:e.isTexture){e.dispose()}}),e.isShaderMaterial){const t=e.uniforms;t&&Object.values(t).forEach(e=>{const t=e.value;if(null==t?void 0:t.isTexture){t.dispose()}})}e.dispose()}function Yf(e){const t=e.geometry;t&&t.dispose();const n=e.skeleton;n&&n.dispose();const i=e.material;i&&(Array.isArray(i)?i.forEach(e=>Xf(e)):i&&Xf(i))}var Kf=class{constructor(){}};function Jf(e,t){if(0===t)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(2===t||1===t){let n=e.getIndex();if(null===n){const t=[],i=e.getAttribute("position");if(void 0===i)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<i.count;e++)t.push(e);e.setIndex(t),n=e.getIndex()}const i=n.count-2,r=[];if(2===t)for(let e=1;e<=i;e++)r.push(n.getX(0)),r.push(n.getX(e)),r.push(n.getX(e+1));else for(let e=0;e<i;e++)e%2==0?(r.push(n.getX(e)),r.push(n.getX(e+1)),r.push(n.getX(e+2))):(r.push(n.getX(e+2)),r.push(n.getX(e+1)),r.push(n.getX(e)));r.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=e.clone();return o.setIndex(r),o.clearGroups(),o}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}Kf.combineMorphs=function(e){var t;const n=function(e){const t=new Set;return e.traverse(e=>{if(!e.isMesh)return;const n=e;t.add(n)}),t}(e.scene),i=new Map,r=null==(t=e.expressionManager)?void 0:t.expressionMap;if(null!=r)for(const[o,s]of Object.entries(r)){const e=new Set;for(const t of s.binds)if(t instanceof Od){if(0!==t.weight)for(const e of t.primitives){let n=i.get(e);null==n&&(n=new Map,i.set(e,n));let r=n.get(o);null==r&&(r=new Set,n.set(o,r)),r.add(t)}e.add(t)}for(const t of e)s.deleteBind(t)}for(const o of n){const e=i.get(o);if(null==e)continue;const t=o.geometry.morphAttributes;o.geometry.morphAttributes={};const n=o.geometry.clone();o.geometry=n;const s=n.morphTargetsRelative,a=null!=t.position,l=null!=t.normal,u={},c={},d=[];if(a||l){a&&(u.position=[]),l&&(u.normal=[]);let n=0;for(const[i,h]of e)a&&(u.position[n]=kf(t.position,h,s)),l&&(u.normal[n]=kf(t.normal,h,s)),null==r||r[i].addBind(new Od({index:n,weight:1,primitives:[o]})),c[i]=n,d.push(0),n++}n.morphAttributes=u,o.morphTargetDictionary=c,o.morphTargetInfluences=d}},Kf.combineSkeletons=function(e){var t;const n=function(e){const t=new Set;return e.traverse(e=>{if(!e.isSkinnedMesh)return;const n=e;t.add(n)}),t}(e),i=new Set;for(const d of n)i.has(d.geometry)&&(d.geometry=qf(d.geometry)),i.add(d.geometry);const r=new Map;for(const d of i){const e=d.getAttribute("skinIndex"),n=null!=(t=r.get(e))?t:new Map;r.set(e,n);const i=d.getAttribute("skinWeight"),o=Hf(e,i);n.set(i,o)}const o=new Map;for(const d of n){const e=Vf(d,r);o.set(d,e)}const s=[];for(const[d,h]of o){let e=!1;for(const t of s){if(zf(h,t.boneInverseMap)){e=!0,t.meshes.add(d);for(const[e,n]of h)t.boneInverseMap.set(e,n);break}}e||s.push({boneInverseMap:h,meshes:new Set([d])})}const a=new Map,l=new jf,u=new jf,c=new jf;for(const d of s){const{boneInverseMap:e,meshes:t}=d,n=Array.from(e.keys()),i=Array.from(e.values()),r=new xl(n,i),o=u.getOrCreate(r);for(const s of t){const e=s.geometry.getAttribute("skinIndex"),t=l.getOrCreate(e),i=s.skeleton.bones,r=`${t};${o};${i.map(e=>c.getOrCreate(e)).join(",")}`;let u=a.get(r);null==u&&(u=e.clone(),Gf(u,i,n),a.set(r,u)),s.geometry.setAttribute("skinIndex",u)}for(const s of t)s.bind(r,new gi)}},Kf.deepDispose=function(e){e.traverse(Yf)},Kf.removeUnnecessaryJoints=function(e,t){var n,i;console.warn("VRMUtils.removeUnnecessaryJoints: removeUnnecessaryJoints is deprecated. Use combineSkeletons instead. combineSkeletons contributes more to the performance improvement. This function will be removed in the next major version.");const r=null!=(n=null==t?void 0:t.experimentalSameBoneCounts)&&n,o=[];e.traverse(e=>{"SkinnedMesh"===e.type&&o.push(e)});const s=new Map;let a=0;for(const l of o){const e=l.geometry.getAttribute("skinIndex");if(s.has(e))continue;const t=new Map,n=new Map;for(let i=0;i<e.count;i++)for(let r=0;r<e.itemSize;r++){const o=Ff(e,i,r);let s=t.get(o);null==s&&(s=t.size,t.set(o,s),n.set(s,o)),Bf(e,i,r,s)}e.needsUpdate=!0,s.set(e,n),a=Math.max(a,t.size)}for(const l of o){const e=l.geometry.getAttribute("skinIndex"),t=s.get(e),n=[],o=[],u=r?a:t.size;for(let r=0;r<u;r++){const e=null!=(i=t.get(r))?i:0;n.push(l.skeleton.bones[e]),o.push(l.skeleton.boneInverses[e])}const c=new xl(n,o);l.bind(c,new gi)}},Kf.removeUnnecessaryVertices=function(e){const t=new Map;e.traverse(e=>{var n,i,r,o;if(!e.isMesh)return;const s=e,a=s.geometry,l=a.index;if(null==l)return;const u=t.get(a);if(null!=u)return void(s.geometry=u);const c=Object.values(a.attributes)[0].count,d=new Array(c);let h=0;const p=l.array;for(let t=0;t<p.length;t++){const e=p[t];d[e]||(d[e]=!0,h++)}if(h===c)return;const f=[],m=[];let g=0;for(let t=0;t<d.length;t++)if(d[t]){const e=g++;f[t]=e,m[e]=t}const v=new br;v.name=a.name,v.morphTargetsRelative=a.morphTargetsRelative,a.groups.forEach(e=>{v.addGroup(e.start,e.count,e.materialIndex)}),v.boundingBox=null!=(i=null==(n=a.boundingBox)?void 0:n.clone())?i:null,v.boundingSphere=null!=(o=null==(r=a.boundingSphere)?void 0:r.clone())?o:null,v.setDrawRange(a.drawRange.start,a.drawRange.count),v.userData=a.userData,t.set(a,v);{const e=l.array,t=new e.constructor(e.length);for(let n=0;n<e.length;n++){const i=f[e[n]];t[n]=i}v.setIndex(new hr(t,1,!1))}Object.keys(a.attributes).forEach(e=>{const t=a.attributes[e];if(t.isInterleavedBufferAttribute)throw new Error("removeUnnecessaryVertices: InterleavedBufferAttribute is not supported");const n=t.array,{itemSize:i,normalized:r}=t,o=new n.constructor(m.length*i);m.forEach((e,t)=>{for(let r=0;r<i;r++)o[t*i+r]=n[e*i+r]}),v.setAttribute(e,new hr(o,i,r))});let _=!0;for(const[t,y]of Object.entries(a.morphAttributes)){const e=t;v.morphAttributes[e]=[];for(let t=0;t<y.length;t++){const n=y[t];if(n.isInterleavedBufferAttribute)throw new Error("removeUnnecessaryVertices: InterleavedBufferAttribute is not supported");const i=n.array,{itemSize:r,normalized:o}=n,s=new i.constructor(m.length*r);m.forEach((e,t)=>{for(let n=0;n<r;n++)s[t*r+n]=i[e*r+n]}),_=_&&s.every(e=>0===e),v.morphAttributes[e][t]=new hr(s,r,o)}}_&&(v.morphAttributes={}),s.geometry=v}),Array.from(t.keys()).forEach(e=>{e.dispose()})},Kf.rotateVRM0=function(e){var t;"0"===(null==(t=e.meta)?void 0:t.metaVersion)&&(e.scene.rotation.y=Math.PI)};class $f extends gc{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new im(e)}),this.register(function(e){return new rm(e)}),this.register(function(e){return new pm(e)}),this.register(function(e){return new fm(e)}),this.register(function(e){return new mm(e)}),this.register(function(e){return new sm(e)}),this.register(function(e){return new am(e)}),this.register(function(e){return new lm(e)}),this.register(function(e){return new um(e)}),this.register(function(e){return new nm(e)}),this.register(function(e){return new cm(e)}),this.register(function(e){return new om(e)}),this.register(function(e){return new hm(e)}),this.register(function(e){return new dm(e)}),this.register(function(e){return new em(e)}),this.register(function(e){return new gm(e)}),this.register(function(e){return new vm(e)})}load(e,t,n,i){const r=this;let o;if(""!==this.resourcePath)o=this.resourcePath;else if(""!==this.path){const t=kc.extractUrlBase(e);o=kc.resolveURL(t,this.path)}else o=kc.extractUrlBase(e);this.manager.itemStart(e);const s=function(t){i?i(t):console.error(t),r.manager.itemError(e),r.manager.itemEnd(e)},a=new yc(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(n){try{r.parse(n,o,function(n){t(n),r.manager.itemEnd(e)},s)}catch(i){s(i)}},n,s)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,i){let r;const o={},s={},a=new TextDecoder;if("string"==typeof e)r=JSON.parse(e);else if(e instanceof ArrayBuffer){if(a.decode(new Uint8Array(e,0,4))===_m){try{o[Qf.KHR_BINARY_GLTF]=new Sm(e)}catch(u){return void(i&&i(u))}r=JSON.parse(o[Qf.KHR_BINARY_GLTF].content)}else r=JSON.parse(a.decode(e))}else r=e;if(void 0===r.asset||r.asset.version[0]<2)return void(i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const l=new Xm(r,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let c=0;c<this.pluginCallbacks.length;c++){const e=this.pluginCallbacks[c](l);e.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),s[e.name]=e,o[e.name]=!0}if(r.extensionsUsed)for(let c=0;c<r.extensionsUsed.length;++c){const e=r.extensionsUsed[c],t=r.extensionsRequired||[];switch(e){case Qf.KHR_MATERIALS_UNLIT:o[e]=new tm;break;case Qf.KHR_DRACO_MESH_COMPRESSION:o[e]=new Em(r,this.dracoLoader);break;case Qf.KHR_TEXTURE_TRANSFORM:o[e]=new bm;break;case Qf.KHR_MESH_QUANTIZATION:o[e]=new Tm;break;default:t.indexOf(e)>=0&&void 0===s[e]&&console.warn('THREE.GLTFLoader: Unknown extension "'+e+'".')}}l.setExtensions(o),l.setPlugins(s),l.parse(n,i)}parseAsync(e,t){const n=this;return new Promise(function(i,r){n.parse(e,t,i,r)})}}function Zf(){let e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const Qf={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class em{constructor(e){this.parser=e,this.name=Qf.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,i=t.length;n<i;n++){const i=t[n];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let i=t.cache.get(n);if(i)return i;const r=t.json,o=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e];let s;const a=new or(16777215);void 0!==o.color&&a.setRGB(o.color[0],o.color[1],o.color[2],Nt);const l=void 0!==o.range?o.range:0;switch(o.type){case"directional":s=new Dc(a),s.target.position.set(0,0,-1),s.add(s.target);break;case"point":s=new Nc(a),s.distance=l;break;case"spot":s=new Rc(a),s.distance=l,o.spot=o.spot||{},o.spot.innerConeAngle=void 0!==o.spot.innerConeAngle?o.spot.innerConeAngle:0,o.spot.outerConeAngle=void 0!==o.spot.outerConeAngle?o.spot.outerConeAngle:Math.PI/4,s.angle=o.spot.outerConeAngle,s.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,s.target.position.set(0,0,-1),s.add(s.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return s.position.set(0,0,0),s.decay=2,Vm(s,o),void 0!==o.intensity&&(s.intensity=o.intensity),s.name=t.createUniqueName(o.name||"light_"+e),i=Promise.resolve(s),t.cache.add(n,i),i}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,i=n.json.nodes[e],r=(i.extensions&&i.extensions[this.name]||{}).light;return void 0===r?null:this._loadLight(r).then(function(e){return n._getNodeRef(t.cache,r,e)})}}class tm{constructor(){this.name=Qf.KHR_MATERIALS_UNLIT}getMaterialType(){return ur}extendParams(e,t,n){const i=[];e.color=new or(1,1,1),e.opacity=1;const r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const t=r.baseColorFactor;e.color.setRGB(t[0],t[1],t[2],Nt),e.opacity=t[3]}void 0!==r.baseColorTexture&&i.push(n.assignTexture(e,"map",r.baseColorTexture,Ot))}return Promise.all(i)}}class nm{constructor(e){this.parser=e,this.name=Qf.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name].emissiveStrength;return void 0!==i&&(t.emissiveIntensity=i),Promise.resolve()}}class im{constructor(e){this.parser=e,this.name=Qf.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?qu:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];if(void 0!==o.clearcoatFactor&&(t.clearcoat=o.clearcoatFactor),void 0!==o.clearcoatTexture&&r.push(n.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),void 0!==o.clearcoatRoughnessFactor&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),void 0!==o.clearcoatRoughnessTexture&&r.push(n.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),void 0!==o.clearcoatNormalTexture&&(r.push(n.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),void 0!==o.clearcoatNormalTexture.scale)){const e=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new hn(e,e)}return Promise.all(r)}}class rm{constructor(e){this.parser=e,this.name=Qf.KHR_MATERIALS_DISPERSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?qu:null}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.dispersion=void 0!==i.dispersion?i.dispersion:0,Promise.resolve()}}class om{constructor(e){this.parser=e,this.name=Qf.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?qu:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];return void 0!==o.iridescenceFactor&&(t.iridescence=o.iridescenceFactor),void 0!==o.iridescenceTexture&&r.push(n.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),void 0!==o.iridescenceIor&&(t.iridescenceIOR=o.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==o.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),void 0!==o.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),void 0!==o.iridescenceThicknessTexture&&r.push(n.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(r)}}class sm{constructor(e){this.parser=e,this.name=Qf.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?qu:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[];t.sheenColor=new or(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=i.extensions[this.name];if(void 0!==o.sheenColorFactor){const e=o.sheenColorFactor;t.sheenColor.setRGB(e[0],e[1],e[2],Nt)}return void 0!==o.sheenRoughnessFactor&&(t.sheenRoughness=o.sheenRoughnessFactor),void 0!==o.sheenColorTexture&&r.push(n.assignTexture(t,"sheenColorMap",o.sheenColorTexture,Ot)),void 0!==o.sheenRoughnessTexture&&r.push(n.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(r)}}class am{constructor(e){this.parser=e,this.name=Qf.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?qu:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];return void 0!==o.transmissionFactor&&(t.transmission=o.transmissionFactor),void 0!==o.transmissionTexture&&r.push(n.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(r)}}class lm{constructor(e){this.parser=e,this.name=Qf.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?qu:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];t.thickness=void 0!==o.thicknessFactor?o.thicknessFactor:0,void 0!==o.thicknessTexture&&r.push(n.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const s=o.attenuationColor||[1,1,1];return t.attenuationColor=(new or).setRGB(s[0],s[1],s[2],Nt),Promise.all(r)}}class um{constructor(e){this.parser=e,this.name=Qf.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?qu:null}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.ior=void 0!==i.ior?i.ior:1.5,Promise.resolve()}}class cm{constructor(e){this.parser=e,this.name=Qf.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?qu:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];t.specularIntensity=void 0!==o.specularFactor?o.specularFactor:1,void 0!==o.specularTexture&&r.push(n.assignTexture(t,"specularIntensityMap",o.specularTexture));const s=o.specularColorFactor||[1,1,1];return t.specularColor=(new or).setRGB(s[0],s[1],s[2],Nt),void 0!==o.specularColorTexture&&r.push(n.assignTexture(t,"specularColorMap",o.specularColorTexture,Ot)),Promise.all(r)}}class dm{constructor(e){this.parser=e,this.name=Qf.EXT_MATERIALS_BUMP}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?qu:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];return t.bumpScale=void 0!==o.bumpFactor?o.bumpFactor:1,void 0!==o.bumpTexture&&r.push(n.assignTexture(t,"bumpMap",o.bumpTexture)),Promise.all(r)}}class hm{constructor(e){this.parser=e,this.name=Qf.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?qu:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];return void 0!==o.anisotropyStrength&&(t.anisotropy=o.anisotropyStrength),void 0!==o.anisotropyRotation&&(t.anisotropyRotation=o.anisotropyRotation),void 0!==o.anisotropyTexture&&r.push(n.assignTexture(t,"anisotropyMap",o.anisotropyTexture)),Promise.all(r)}}class pm{constructor(e){this.parser=e,this.name=Qf.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,i=n.textures[e];if(!i.extensions||!i.extensions[this.name])return null;const r=i.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,o)}}class fm{constructor(e){this.parser=e,this.name=Qf.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,i=n.json,r=i.textures[e];if(!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],s=i.images[o.source];let a=n.textureLoader;if(s.uri){const e=n.options.manager.getHandler(s.uri);null!==e&&(a=e)}return this.detectSupport().then(function(r){if(r)return n.loadTextureImage(e,o.source,a);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class mm{constructor(e){this.parser=e,this.name=Qf.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,i=n.json,r=i.textures[e];if(!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],s=i.images[o.source];let a=n.textureLoader;if(s.uri){const e=n.options.manager.getHandler(s.uri);null!==e&&(a=e)}return this.detectSupport().then(function(r){if(r)return n.loadTextureImage(e,o.source,a);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class gm{constructor(e){this.name=Qf.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const e=n.extensions[this.name],i=this.parser.getDependency("buffer",e.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then(function(t){const n=e.byteOffset||0,i=e.byteLength||0,o=e.count,s=e.byteStride,a=new Uint8Array(t,n,i);return r.decodeGltfBufferAsync?r.decodeGltfBufferAsync(o,s,a,e.mode,e.filter).then(function(e){return e.buffer}):r.ready.then(function(){const t=new ArrayBuffer(o*s);return r.decodeGltfBuffer(new Uint8Array(t),o,s,a,e.mode,e.filter),t})})}return null}}class vm{constructor(e){this.name=Qf.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||void 0===n.mesh)return null;const i=t.meshes[n.mesh];for(const a of i.primitives)if(a.mode!==Rm.TRIANGLES&&a.mode!==Rm.TRIANGLE_STRIP&&a.mode!==Rm.TRIANGLE_FAN&&void 0!==a.mode)return null;const r=n.extensions[this.name].attributes,o=[],s={};for(const a in r)o.push(this.parser.getDependency("accessor",r[a]).then(e=>(s[a]=e,s[a])));return o.length<1?null:(o.push(this.parser.createNodeMesh(e)),Promise.all(o).then(e=>{const t=e.pop(),n=t.isGroup?t.children:[t],i=e[0].count,r=[];for(const o of n){const e=new gi,t=new Hn,n=new Bn,a=new Hn(1,1,1),l=new Cl(o.geometry,o.material,i);for(let r=0;r<i;r++)s.TRANSLATION&&t.fromBufferAttribute(s.TRANSLATION,r),s.ROTATION&&n.fromBufferAttribute(s.ROTATION,r),s.SCALE&&a.fromBufferAttribute(s.SCALE,r),l.setMatrixAt(r,e.compose(t,n,a));for(const i in s)if("_COLOR_0"===i){const e=s[i];l.instanceColor=new Sl(e.array,e.itemSize,e.normalized)}else"TRANSLATION"!==i&&"ROTATION"!==i&&"SCALE"!==i&&o.geometry.setAttribute(i,s[i]);Gi.prototype.copy.call(l,o),this.parser.assignFinalMaterial(l),r.push(l)}return t.isGroup?(t.clear(),t.add(...r),t):r[0]}))}}const _m="glTF",ym=1313821514,xm=5130562;class Sm{constructor(e){this.name=Qf.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12),n=new TextDecoder;if(this.header={magic:n.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==_m)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-12,r=new DataView(e,12);let o=0;for(;o<i;){const t=r.getUint32(o,!0);o+=4;const i=r.getUint32(o,!0);if(o+=4,i===ym){const i=new Uint8Array(e,12+o,t);this.content=n.decode(i)}else if(i===xm){const n=12+o;this.body=e.slice(n,n+t)}o+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Em{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Qf.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,i=this.dracoLoader,r=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,s={},a={},l={};for(const u in o){const e=Nm[u]||u.toLowerCase();s[e]=o[u]}for(const u in e.attributes){const t=Nm[u]||u.toLowerCase();if(void 0!==o[u]){const i=n.accessors[e.attributes[u]],r=Cm[i.componentType];l[t]=r.name,a[t]=!0===i.normalized}}return t.getDependency("bufferView",r).then(function(e){return new Promise(function(t,n){i.decodeDracoFile(e,function(e){for(const t in e.attributes){const n=e.attributes[t],i=a[t];void 0!==i&&(n.normalized=i)}t(e)},s,l,Nt,n)})})}}class bm{constructor(){this.name=Qf.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&t.texCoord!==e.channel||void 0!==t.offset||void 0!==t.rotation||void 0!==t.scale?(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0,e):e}}class Tm{constructor(){this.name=Qf.KHR_MESH_QUANTIZATION}}class wm extends Qu{constructor(e,t,n,i){super(e,t,n,i)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i*3+i;for(let o=0;o!==i;o++)t[o]=n[r+o];return t}interpolate_(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=2*s,l=3*s,u=i-t,c=(n-t)/u,d=c*c,h=d*c,p=e*l,f=p-l,m=-2*h+3*d,g=h-d,v=1-m,_=g-d+c;for(let y=0;y!==s;y++){const e=o[f+y+s],t=o[f+y+a]*u,n=o[p+y+s],i=o[p+y]*u;r[y]=v*e+_*t+m*n+g*i}return r}}const Mm=new Bn;class Am extends wm{interpolate_(e,t,n,i){const r=super.interpolate_(e,t,n,i);return Mm.fromArray(r).normalize().toArray(r),r}}const Rm={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Cm={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Im={9728:Ee,9729:we,9984:1004,9985:Me,9986:Te,9987:Ae},Pm={33071:xe,33648:Se,10497:ye},Om={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Nm={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Lm={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Dm={CUBICSPLINE:void 0,LINEAR:wt,STEP:Tt},Um="OPAQUE",km="MASK",Fm="BLEND";function Bm(e){return void 0===e.DefaultMaterial&&(e.DefaultMaterial=new ju({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:0})),e.DefaultMaterial}function Hm(e,t,n){for(const i in n.extensions)void 0===e[i]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=n.extensions[i])}function Vm(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function zm(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let n=0,i=t.weights.length;n<i;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){const n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(let t=0,i=n.length;t<i;t++)e.morphTargetDictionary[n[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Gm(e){let t;const n=e.extensions&&e.extensions[Qf.KHR_DRACO_MESH_COMPRESSION];if(t=n?"draco:"+n.bufferView+":"+n.indices+":"+Wm(n.attributes):e.indices+":"+Wm(e.attributes)+":"+e.mode,void 0!==e.targets)for(let i=0,r=e.targets.length;i<r;i++)t+=":"+Wm(e.targets[i]);return t}function Wm(e){let t="";const n=Object.keys(e).sort();for(let i=0,r=n.length;i<r;i++)t+=n[i]+":"+e[n[i]]+";";return t}function jm(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const qm=new gi;class Xm{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Zf,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,i=-1,r=!1,o=-1;if("undefined"!=typeof navigator){const e=navigator.userAgent;n=!0===/^((?!chrome|android).)*safari/i.test(e);const t=e.match(/Version\/(\d+)/);i=n&&t?parseInt(t[1],10):-1,r=e.indexOf("Firefox")>-1,o=r?e.match(/Firefox\/([0-9]+)\./)[1]:-1}"undefined"==typeof createImageBitmap||n&&i<17||r&&o<98?this.textureLoader=new Sc(this.options.manager):this.textureLoader=new Fc(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new yc(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,i=this.json,r=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(e){return e._markDefs&&e._markDefs()}),Promise.all(this._invokeAll(function(e){return e.beforeRoot&&e.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(t){const o={scene:t[0][i.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:i.asset,parser:n,userData:{}};return Hm(r,o,i),Vm(o,i),Promise.all(n._invokeAll(function(e){return e.afterRoot&&e.afterRoot(o)})).then(function(){for(const e of o.scenes)e.updateMatrixWorld();e(o)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let i=0,r=t.length;i<r;i++){const n=t[i].joints;for(let t=0,i=n.length;t<i;t++)e[n[t]].isBone=!0}for(let i=0,r=e.length;i<r;i++){const t=e[i];void 0!==t.mesh&&(this._addNodeRef(this.meshCache,t.mesh),void 0!==t.skin&&(n[t.mesh].isSkinnedMesh=!0)),void 0!==t.camera&&this._addNodeRef(this.cameraCache,t.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const i=n.clone(),r=(e,t)=>{const n=this.associations.get(e);null!=n&&this.associations.set(t,n);for(const[i,o]of e.children.entries())r(o,t.children[i])};return r(n,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const i=e(t[n]);if(i)return i}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let i=0;i<t.length;i++){const r=e(t[i]);r&&n.push(r)}return n}getDependency(e,t){const n=e+":"+t;let i=this.cache.get(n);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this._invokeOne(function(e){return e.loadNode&&e.loadNode(t)});break;case"mesh":i=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(t)});break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(t)});break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(t)});break;case"texture":i=this._invokeOne(function(e){return e.loadTexture&&e.loadTexture(t)});break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne(function(e){return e.loadAnimation&&e.loadAnimation(t)});break;case"camera":i=this.loadCamera(t);break;default:if(i=this._invokeOne(function(n){return n!=this&&n.getDependency&&n.getDependency(e,t)}),!i)throw new Error("Unknown type: "+e)}this.cache.add(n,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,i=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(i.map(function(t,i){return n.getDependency(e,i)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[Qf.KHR_BINARY_GLTF].body);const i=this.options;return new Promise(function(e,r){n.load(kc.resolveURL(t.uri,i.path),e,void 0,function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){const n=t.byteLength||0,i=t.byteOffset||0;return e.slice(i,i+n)})}loadAccessor(e){const t=this,n=this.json,i=this.json.accessors[e];if(void 0===i.bufferView&&void 0===i.sparse){const e=Om[i.type],t=Cm[i.componentType],n=!0===i.normalized,r=new t(i.count*e);return Promise.resolve(new hr(r,e,n))}const r=[];return void 0!==i.bufferView?r.push(this.getDependency("bufferView",i.bufferView)):r.push(null),void 0!==i.sparse&&(r.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(r).then(function(e){const r=e[0],o=Om[i.type],s=Cm[i.componentType],a=s.BYTES_PER_ELEMENT,l=a*o,u=i.byteOffset||0,c=void 0!==i.bufferView?n.bufferViews[i.bufferView].byteStride:void 0,d=!0===i.normalized;let h,p;if(c&&c!==l){const e=Math.floor(u/c),n="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+e+":"+i.count;let l=t.cache.get(n);l||(h=new s(r,e*c,i.count*c/a),l=new il(h,c/a),t.cache.add(n,l)),p=new ol(l,o,u%c/a,d)}else h=null===r?new s(i.count*o):new s(r,u,i.count*o),p=new hr(h,o,d);if(void 0!==i.sparse){const t=Om.SCALAR,n=Cm[i.sparse.indices.componentType],a=i.sparse.indices.byteOffset||0,l=i.sparse.values.byteOffset||0,u=new n(e[1],a,i.sparse.count*t),c=new s(e[2],l,i.sparse.count*o);null!==r&&(p=new hr(p.array.slice(),p.itemSize,p.normalized));for(let e=0,i=u.length;e<i;e++){const t=u[e];if(p.setX(t,c[e*o]),o>=2&&p.setY(t,c[e*o+1]),o>=3&&p.setZ(t,c[e*o+2]),o>=4&&p.setW(t,c[e*o+3]),o>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return p})}loadTexture(e){const t=this.json,n=this.options,i=t.textures[e].source,r=t.images[i];let o=this.textureLoader;if(r.uri){const e=n.manager.getHandler(r.uri);null!==e&&(o=e)}return this.loadTextureImage(e,i,o)}loadTextureImage(e,t,n){const i=this,r=this.json,o=r.textures[e],s=r.images[t],a=(s.uri||s.bufferView)+":"+o.sampler;if(this.textureCache[a])return this.textureCache[a];const l=this.loadImageSource(t,n).then(function(t){t.flipY=!1,t.name=o.name||s.name||"",""===t.name&&"string"==typeof s.uri&&!1===s.uri.startsWith("data:image/")&&(t.name=s.uri);const n=(r.samplers||{})[o.sampler]||{};return t.magFilter=Im[n.magFilter]||we,t.minFilter=Im[n.minFilter]||Ae,t.wrapS=Pm[n.wrapS]||ye,t.wrapT=Pm[n.wrapT]||ye,i.associations.set(t,{textures:e}),t}).catch(function(){return null});return this.textureCache[a]=l,l}loadImageSource(e,t){const n=this,i=this.json,r=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then(e=>e.clone());const o=i.images[e],s=self.URL||self.webkitURL;let a=o.uri||"",l=!1;if(void 0!==o.bufferView)a=n.getDependency("bufferView",o.bufferView).then(function(e){l=!0;const t=new Blob([e],{type:o.mimeType});return a=s.createObjectURL(t),a});else if(void 0===o.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const u=Promise.resolve(a).then(function(e){return new Promise(function(n,i){let o=n;!0===t.isImageBitmapLoader&&(o=function(e){const t=new Nn(e);t.needsUpdate=!0,n(t)}),t.load(kc.resolveURL(e,r.path),o,void 0,i)})}).then(function(e){var t;return!0===l&&s.revokeObjectURL(a),Vm(e,o),e.userData.mimeType=o.mimeType||((t=o.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":"image/png"),e}).catch(function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",a),e});return this.sourceCache[e]=u,u}assignTexture(e,t,n,i){const r=this;return this.getDependency("texture",n.index).then(function(o){if(!o)return null;if(void 0!==n.texCoord&&n.texCoord>0&&((o=o.clone()).channel=n.texCoord),r.extensions[Qf.KHR_TEXTURE_TRANSFORM]){const e=void 0!==n.extensions?n.extensions[Qf.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=r.associations.get(o);o=r.extensions[Qf.KHR_TEXTURE_TRANSFORM].extendTexture(o,e),r.associations.set(o,t)}}return void 0!==i&&(o.colorSpace=i),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const i=void 0===t.attributes.tangent,r=void 0!==t.attributes.color,o=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new Wl,lr.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,t.sizeAttenuation=!1,this.cache.add(e,t)),n=t}else if(e.isLine){const e="LineBasicMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new Il,lr.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,this.cache.add(e,t)),n=t}if(i||r||o){let e="ClonedMaterial:"+n.uuid+":";i&&(e+="derivative-tangents:"),r&&(e+="vertex-colors:"),o&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=n.clone(),r&&(t.vertexColors=!0),o&&(t.flatShading=!0),i&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(n))),n=t}e.material=n}getMaterialType(){return ju}loadMaterial(e){const t=this,n=this.json,i=this.extensions,r=n.materials[e];let o;const s={},a=[];if((r.extensions||{})[Qf.KHR_MATERIALS_UNLIT]){const e=i[Qf.KHR_MATERIALS_UNLIT];o=e.getMaterialType(),a.push(e.extendParams(s,r,t))}else{const n=r.pbrMetallicRoughness||{};if(s.color=new or(1,1,1),s.opacity=1,Array.isArray(n.baseColorFactor)){const e=n.baseColorFactor;s.color.setRGB(e[0],e[1],e[2],Nt),s.opacity=e[3]}void 0!==n.baseColorTexture&&a.push(t.assignTexture(s,"map",n.baseColorTexture,Ot)),s.metalness=void 0!==n.metallicFactor?n.metallicFactor:1,s.roughness=void 0!==n.roughnessFactor?n.roughnessFactor:1,void 0!==n.metallicRoughnessTexture&&(a.push(t.assignTexture(s,"metalnessMap",n.metallicRoughnessTexture)),a.push(t.assignTexture(s,"roughnessMap",n.metallicRoughnessTexture))),o=this._invokeOne(function(t){return t.getMaterialType&&t.getMaterialType(e)}),a.push(Promise.all(this._invokeAll(function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,s)})))}!0===r.doubleSided&&(s.side=2);const l=r.alphaMode||Um;if(l===Fm?(s.transparent=!0,s.depthWrite=!1):(s.transparent=!1,l===km&&(s.alphaTest=void 0!==r.alphaCutoff?r.alphaCutoff:.5)),void 0!==r.normalTexture&&o!==ur&&(a.push(t.assignTexture(s,"normalMap",r.normalTexture)),s.normalScale=new hn(1,1),void 0!==r.normalTexture.scale)){const e=r.normalTexture.scale;s.normalScale.set(e,e)}if(void 0!==r.occlusionTexture&&o!==ur&&(a.push(t.assignTexture(s,"aoMap",r.occlusionTexture)),void 0!==r.occlusionTexture.strength&&(s.aoMapIntensity=r.occlusionTexture.strength)),void 0!==r.emissiveFactor&&o!==ur){const e=r.emissiveFactor;s.emissive=(new or).setRGB(e[0],e[1],e[2],Nt)}return void 0!==r.emissiveTexture&&o!==ur&&a.push(t.assignTexture(s,"emissiveMap",r.emissiveTexture,Ot)),Promise.all(a).then(function(){const n=new o(s);return r.name&&(n.name=r.name),Vm(n,r),t.associations.set(n,{materials:e}),r.extensions&&Hm(i,n,r),n})}createUniqueName(e){const t=id.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,n=this.extensions,i=this.primitiveCache;function r(e){return n[Qf.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then(function(n){return Ym(n,e,t)})}const o=[];for(let s=0,a=e.length;s<a;s++){const n=e[s],a=Gm(n),l=i[a];if(l)o.push(l.promise);else{let e;e=n.extensions&&n.extensions[Qf.KHR_DRACO_MESH_COMPRESSION]?r(n):Ym(new br,n,t),i[a]={primitive:n,promise:e},o.push(e)}}return Promise.all(o)}loadMesh(e){const t=this,n=this.json,i=this.extensions,r=n.meshes[e],o=r.primitives,s=[];for(let a=0,l=o.length;a<l;a++){const e=void 0===o[a].material?Bm(this.cache):this.getDependency("material",o[a].material);s.push(e)}return s.push(t.loadGeometries(o)),Promise.all(s).then(function(n){const s=n.slice(0,n.length-1),a=n[n.length-1],l=[];for(let c=0,d=a.length;c<d;c++){const n=a[c],u=o[c];let d;const h=s[c];if(u.mode===Rm.TRIANGLES||u.mode===Rm.TRIANGLE_STRIP||u.mode===Rm.TRIANGLE_FAN||void 0===u.mode)d=!0===r.isSkinnedMesh?new ml(n,h):new Vr(n,h),!0===d.isSkinnedMesh&&d.normalizeSkinWeights(),u.mode===Rm.TRIANGLE_STRIP?d.geometry=Jf(d.geometry,1):u.mode===Rm.TRIANGLE_FAN&&(d.geometry=Jf(d.geometry,2));else if(u.mode===Rm.LINES)d=new zl(n,h);else if(u.mode===Rm.LINE_STRIP)d=new Fl(n,h);else if(u.mode===Rm.LINE_LOOP)d=new Gl(n,h);else{if(u.mode!==Rm.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+u.mode);d=new Kl(n,h)}Object.keys(d.geometry.morphAttributes).length>0&&zm(d,r),d.name=t.createUniqueName(r.name||"mesh_"+e),Vm(d,r),u.extensions&&Hm(i,d,u),t.assignFinalMaterial(d),l.push(d)}for(let i=0,r=l.length;i<r;i++)t.associations.set(l[i],{meshes:e,primitives:i});if(1===l.length)return r.extensions&&Hm(i,l[0],r),l[0];const u=new qa;r.extensions&&Hm(i,u,r),t.associations.set(u,{meshes:e});for(let e=0,t=l.length;e<t;e++)u.add(l[e]);return u})}loadCamera(e){let t;const n=this.json.cameras[e],i=n[n.type];if(i)return"perspective"===n.type?t=new Qr(dn.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===n.type&&(t=new Ao(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),Vm(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],n=[];for(let i=0,r=t.joints.length;i<r;i++)n.push(this._loadNodeShallow(t.joints[i]));return void 0!==t.inverseBindMatrices?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(e){const n=e.pop(),i=e,r=[],o=[];for(let s=0,a=i.length;s<a;s++){const e=i[s];if(e){r.push(e);const t=new gi;null!==n&&t.fromArray(n.array,16*s),o.push(t)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[s])}return new xl(r,o)})}loadAnimation(e){const t=this.json,n=this,i=t.animations[e],r=i.name?i.name:"animation_"+e,o=[],s=[],a=[],l=[],u=[];for(let c=0,d=i.channels.length;c<d;c++){const e=i.channels[c],t=i.samplers[e.sampler],n=e.target,r=n.node,d=void 0!==i.parameters?i.parameters[t.input]:t.input,h=void 0!==i.parameters?i.parameters[t.output]:t.output;void 0!==n.node&&(o.push(this.getDependency("node",r)),s.push(this.getDependency("accessor",d)),a.push(this.getDependency("accessor",h)),l.push(t),u.push(n))}return Promise.all([Promise.all(o),Promise.all(s),Promise.all(a),Promise.all(l),Promise.all(u)]).then(function(e){const t=e[0],i=e[1],o=e[2],s=e[3],a=e[4],l=[];for(let r=0,u=t.length;r<u;r++){const e=t[r],u=i[r],c=o[r],d=s[r],h=a[r];if(void 0===e)continue;e.updateMatrix&&e.updateMatrix();const p=n._createAnimationTracks(e,u,c,d,h);if(p)for(let t=0;t<p.length;t++)l.push(p[t])}return new dc(r,void 0,l)})}createNodeMesh(e){const t=this.json,n=this,i=t.nodes[e];return void 0===i.mesh?null:n.getDependency("mesh",i.mesh).then(function(e){const t=n._getNodeRef(n.meshCache,i.mesh,e);return void 0!==i.weights&&t.traverse(function(e){if(e.isMesh)for(let t=0,n=i.weights.length;t<n;t++)e.morphTargetInfluences[t]=i.weights[t]}),t})}loadNode(e){const t=this,n=this.json.nodes[e],i=t._loadNodeShallow(e),r=[],o=n.children||[];for(let a=0,l=o.length;a<l;a++)r.push(t.getDependency("node",o[a]));const s=void 0===n.skin?Promise.resolve(null):t.getDependency("skin",n.skin);return Promise.all([i,Promise.all(r),s]).then(function(e){const t=e[0],n=e[1],i=e[2];null!==i&&t.traverse(function(e){e.isSkinnedMesh&&e.bind(i,qm)});for(let r=0,o=n.length;r<o;r++)t.add(n[r]);return t})}_loadNodeShallow(e){const t=this.json,n=this.extensions,i=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];const r=t.nodes[e],o=r.name?i.createUniqueName(r.name):"",s=[],a=i._invokeOne(function(t){return t.createNodeMesh&&t.createNodeMesh(e)});return a&&s.push(a),void 0!==r.camera&&s.push(i.getDependency("camera",r.camera).then(function(e){return i._getNodeRef(i.cameraCache,r.camera,e)})),i._invokeAll(function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)}).forEach(function(e){s.push(e)}),this.nodeCache[e]=Promise.all(s).then(function(t){let s;if(s=!0===r.isBone?new gl:t.length>1?new qa:1===t.length?t[0]:new Gi,s!==t[0])for(let e=0,n=t.length;e<n;e++)s.add(t[e]);if(r.name&&(s.userData.name=r.name,s.name=o),Vm(s,r),r.extensions&&Hm(n,s,r),void 0!==r.matrix){const e=new gi;e.fromArray(r.matrix),s.applyMatrix4(e)}else void 0!==r.translation&&s.position.fromArray(r.translation),void 0!==r.rotation&&s.quaternion.fromArray(r.rotation),void 0!==r.scale&&s.scale.fromArray(r.scale);return i.associations.has(s)||i.associations.set(s,{}),i.associations.get(s).nodes=e,s}),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],i=this,r=new qa;n.name&&(r.name=i.createUniqueName(n.name)),Vm(r,n),n.extensions&&Hm(t,r,n);const o=n.nodes||[],s=[];for(let a=0,l=o.length;a<l;a++)s.push(i.getDependency("node",o[a]));return Promise.all(s).then(function(e){for(let t=0,n=e.length;t<n;t++)r.add(e[t]);return i.associations=(e=>{const t=new Map;for(const[n,r]of i.associations)(n instanceof lr||n instanceof Nn)&&t.set(n,r);return e.traverse(e=>{const n=i.associations.get(e);null!=n&&t.set(e,n)}),t})(r),r})}_createAnimationTracks(e,t,n,i,r){const o=[],s=e.name?e.name:e.uuid,a=[];let l;switch(Lm[r.path]===Lm.weights?e.traverse(function(e){e.morphTargetInfluences&&a.push(e.name?e.name:e.uuid)}):a.push(s),Lm[r.path]){case Lm.weights:l=sc;break;case Lm.rotation:l=lc;break;case Lm.position:case Lm.scale:l=cc;break;default:if(1===n.itemSize)l=sc;else l=cc}const u=void 0!==i.interpolation?Dm[i.interpolation]:wt,c=this._getArrayFromAccessor(n);for(let d=0,h=a.length;d<h;d++){const e=new l(a[d]+"."+Lm[r.path],t.array,c,u);"CUBICSPLINE"===i.interpolation&&this._createCubicSplineTrackInterpolant(e),o.push(e)}return o}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const e=jm(t.constructor),n=new Float32Array(t.length);for(let i=0,r=t.length;i<r;i++)n[i]=t[i]*e;t=n}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(e){return new(this instanceof lc?Am:wm)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Ym(e,t,n){const i=t.attributes,r=[];function o(t,i){return n.getDependency("accessor",t).then(function(t){e.setAttribute(i,t)})}for(const s in i){const t=Nm[s]||s.toLowerCase();t in e.attributes||r.push(o(i[s],t))}if(void 0!==t.indices&&!e.index){const i=n.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});r.push(i)}return Tn.workingColorSpace!==Nt&&"COLOR_0"in i&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${Tn.workingColorSpace}" not supported.`),Vm(e,t),function(e,t,n){const i=t.attributes,r=new Gn;if(void 0===i.POSITION)return;{const e=n.json.accessors[i.POSITION],t=e.min,o=e.max;if(void 0===t||void 0===o)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(r.set(new Hn(t[0],t[1],t[2]),new Hn(o[0],o[1],o[2])),e.normalized){const t=jm(Cm[e.componentType]);r.min.multiplyScalar(t),r.max.multiplyScalar(t)}}const o=t.targets;if(void 0!==o){const e=new Hn,t=new Hn;for(let i=0,r=o.length;i<r;i++){const r=o[i];if(void 0!==r.POSITION){const i=n.json.accessors[r.POSITION],o=i.min,s=i.max;if(void 0!==o&&void 0!==s){if(t.setX(Math.max(Math.abs(o[0]),Math.abs(s[0]))),t.setY(Math.max(Math.abs(o[1]),Math.abs(s[1]))),t.setZ(Math.max(Math.abs(o[2]),Math.abs(s[2]))),i.normalized){const e=jm(Cm[i.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(e)}e.boundingBox=r;const s=new ai;r.getCenter(s.center),s.radius=r.min.distanceTo(r.max)/2,e.boundingSphere=s}(e,t,n),Promise.all(r).then(function(){return void 0!==t.targets?function(e,t,n){let i=!1,r=!1,o=!1;for(let u=0,c=t.length;u<c;u++){const e=t[u];if(void 0!==e.POSITION&&(i=!0),void 0!==e.NORMAL&&(r=!0),void 0!==e.COLOR_0&&(o=!0),i&&r&&o)break}if(!i&&!r&&!o)return Promise.resolve(e);const s=[],a=[],l=[];for(let u=0,c=t.length;u<c;u++){const c=t[u];if(i){const t=void 0!==c.POSITION?n.getDependency("accessor",c.POSITION):e.attributes.position;s.push(t)}if(r){const t=void 0!==c.NORMAL?n.getDependency("accessor",c.NORMAL):e.attributes.normal;a.push(t)}if(o){const t=void 0!==c.COLOR_0?n.getDependency("accessor",c.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(s),Promise.all(a),Promise.all(l)]).then(function(t){const n=t[0],s=t[1],a=t[2];return i&&(e.morphAttributes.position=n),r&&(e.morphAttributes.normal=s),o&&(e.morphAttributes.color=a),e.morphTargetsRelative=!0,e})}(e,t.targets,n):e})}var Km=Uint8Array,Jm=Uint16Array,$m=Int32Array,Zm=new Km([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Qm=new Km([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),eg=new Km([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),tg=function(e,t){for(var n=new Jm(31),i=0;i<31;++i)n[i]=t+=1<<e[i-1];var r=new $m(n[30]);for(i=1;i<30;++i)for(var o=n[i];o<n[i+1];++o)r[o]=o-n[i]<<5|i;return{b:n,r:r}},ng=tg(Zm,2),ig=ng.b,rg=ng.r;ig[28]=258,rg[258]=28;for(var og=tg(Qm,0).b,sg=new Jm(32768),ag=0;ag<32768;++ag){var lg=(43690&ag)>>1|(21845&ag)<<1;lg=(61680&(lg=(52428&lg)>>2|(13107&lg)<<2))>>4|(3855&lg)<<4,sg[ag]=((65280&lg)>>8|(255&lg)<<8)>>1}var ug=function(e,t,n){for(var i=e.length,r=0,o=new Jm(t);r<i;++r)e[r]&&++o[e[r]-1];var s,a=new Jm(t);for(r=1;r<t;++r)a[r]=a[r-1]+o[r-1]<<1;if(n){s=new Jm(1<<t);var l=15-t;for(r=0;r<i;++r)if(e[r])for(var u=r<<4|e[r],c=t-e[r],d=a[e[r]-1]++<<c,h=d|(1<<c)-1;d<=h;++d)s[sg[d]>>l]=u}else for(s=new Jm(i),r=0;r<i;++r)e[r]&&(s[r]=sg[a[e[r]-1]++]>>15-e[r]);return s},cg=new Km(288);for(ag=0;ag<144;++ag)cg[ag]=8;for(ag=144;ag<256;++ag)cg[ag]=9;for(ag=256;ag<280;++ag)cg[ag]=7;for(ag=280;ag<288;++ag)cg[ag]=8;var dg=new Km(32);for(ag=0;ag<32;++ag)dg[ag]=5;var hg=ug(cg,9,1),pg=ug(dg,5,1),fg=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},mg=function(e,t,n){var i=t/8|0;return(e[i]|e[i+1]<<8)>>(7&t)&n},gg=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},vg=function(e){return(e+7)/8|0},_g=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],yg=function(e,t,n){var i=new Error(t||_g[e]);if(i.code=e,Error.captureStackTrace&&Error.captureStackTrace(i,yg),!n)throw i;return i},xg=function(e,t,n,i){var r=e.length;if(!r||t.f&&!t.l)return n||new Km(0);var o=!n,s=o||2!=t.i,a=t.i;o&&(n=new Km(3*r));var l=function(e){var t=n.length;if(e>t){var i=new Km(Math.max(2*t,e));i.set(n),n=i}},u=t.f||0,c=t.p||0,d=t.b||0,h=t.l,p=t.d,f=t.m,m=t.n,g=8*r;do{if(!h){u=mg(e,c,1);var v=mg(e,c+1,3);if(c+=3,!v){var _=e[(C=vg(c)+4)-4]|e[C-3]<<8,y=C+_;if(y>r){a&&yg(0);break}s&&l(d+_),n.set(e.subarray(C,y),d),t.b=d+=_,t.p=c=8*y,t.f=u;continue}if(1==v)h=hg,p=pg,f=9,m=5;else if(2==v){var x=mg(e,c,31)+257,S=mg(e,c+10,15)+4,E=x+mg(e,c+5,31)+1;c+=14;for(var b=new Km(E),T=new Km(19),w=0;w<S;++w)T[eg[w]]=mg(e,c+3*w,7);c+=3*S;var M=fg(T),A=(1<<M)-1,R=ug(T,M,1);for(w=0;w<E;){var C,I=R[mg(e,c,A)];if(c+=15&I,(C=I>>4)<16)b[w++]=C;else{var P=0,O=0;for(16==C?(O=3+mg(e,c,3),c+=2,P=b[w-1]):17==C?(O=3+mg(e,c,7),c+=3):18==C&&(O=11+mg(e,c,127),c+=7);O--;)b[w++]=P}}var N=b.subarray(0,x),L=b.subarray(x);f=fg(N),m=fg(L),h=ug(N,f,1),p=ug(L,m,1)}else yg(1);if(c>g){a&&yg(0);break}}s&&l(d+131072);for(var D=(1<<f)-1,U=(1<<m)-1,k=c;;k=c){var F=(P=h[gg(e,c)&D])>>4;if((c+=15&P)>g){a&&yg(0);break}if(P||yg(2),F<256)n[d++]=F;else{if(256==F){k=c,h=null;break}var B=F-254;if(F>264){var H=Zm[w=F-257];B=mg(e,c,(1<<H)-1)+ig[w],c+=H}var V=p[gg(e,c)&U],z=V>>4;V||yg(3),c+=15&V;L=og[z];if(z>3){H=Qm[z];L+=gg(e,c)&(1<<H)-1,c+=H}if(c>g){a&&yg(0);break}s&&l(d+131072);var G=d+B;if(d<L){var W=0-L,j=Math.min(L,G);for(W+d<0&&yg(3);d<j;++d)n[d]=i[W+d]}for(;d<G;++d)n[d]=n[d-L]}}t.l=h,t.p=k,t.b=d,t.f=u,h&&(u=1,t.m=f,t.d=p,t.n=m)}while(!u);return d!=n.length&&o?function(e,t,n){return(null==n||n>e.length)&&(n=e.length),new Km(e.subarray(t,n))}(n,0,d):n.subarray(0,d)},Sg=new Km(0);function Eg(e,t){return xg(e.subarray(((8!=(15&(n=e)[0])||n[0]>>4>7||(n[0]<<8|n[1])%31)&&yg(6,"invalid zlib data"),1==(n[1]>>5&1)&&yg(6,"invalid zlib data: "+(32&n[1]?"need":"unexpected")+" dictionary"),2+(n[1]>>3&4)),-4),{i:2},t,t);var n}var bg="undefined"!=typeof TextDecoder&&new TextDecoder;try{bg.decode(Sg,{stream:!0})}catch(BM){}function Tg(e,t,n){const i=n.length-e-1;if(t>=n[i])return i-1;if(t<=n[e])return e;let r=e,o=i,s=Math.floor((r+o)/2);for(;t<n[s]||t>=n[s+1];)t<n[s]?o=s:r=s,s=Math.floor((r+o)/2);return s}function wg(e,t){let n=1;for(let r=2;r<=e;++r)n*=r;let i=1;for(let r=2;r<=t;++r)i*=r;for(let r=2;r<=e-t;++r)i*=r;return n/i}function Mg(e,t,n,i,r){const o=function(e,t,n,i,r){const o=r<e?r:e,s=[],a=Tg(e,i,t),l=function(e,t,n,i,r){const o=[];for(let d=0;d<=n;++d)o[d]=0;const s=[];for(let d=0;d<=i;++d)s[d]=o.slice(0);const a=[];for(let d=0;d<=n;++d)a[d]=o.slice(0);a[0][0]=1;const l=o.slice(0),u=o.slice(0);for(let d=1;d<=n;++d){l[d]=t-r[e+1-d],u[d]=r[e+d]-t;let n=0;for(let e=0;e<d;++e){const t=u[e+1],i=l[d-e];a[d][e]=t+i;const r=a[e][d-1]/a[d][e];a[e][d]=n+t*r,n=i*r}a[d][d]=n}for(let d=0;d<=n;++d)s[0][d]=a[d][n];for(let d=0;d<=n;++d){let e=0,t=1;const r=[];for(let i=0;i<=n;++i)r[i]=o.slice(0);r[0][0]=1;for(let o=1;o<=i;++o){let i=0;const l=d-o,u=n-o;d>=o&&(r[t][0]=r[e][0]/a[u+1][l],i=r[t][0]*a[l][u]);const c=d-1<=u?o-1:n-d;for(let n=l>=-1?1:-l;n<=c;++n)r[t][n]=(r[e][n]-r[e][n-1])/a[u+1][l+n],i+=r[t][n]*a[l+n][u];d<=u&&(r[t][o]=-r[e][o-1]/a[u+1][d],i+=r[t][o]*a[d][u]),s[o][d]=i;const h=e;e=t,t=h}}let c=n;for(let d=1;d<=i;++d){for(let e=0;e<=n;++e)s[d][e]*=c;c*=n-d}return s}(a,i,e,o,t),u=[];for(let c=0;c<n.length;++c){const e=n[c].clone(),t=e.w;e.x*=t,e.y*=t,e.z*=t,u[c]=e}for(let c=0;c<=o;++c){const t=u[a-e].clone().multiplyScalar(l[c][0]);for(let n=1;n<=e;++n)t.add(u[a-e+n].clone().multiplyScalar(l[c][n]));s[c]=t}for(let c=o+1;c<=r+1;++c)s[c]=new Ln(0,0,0);return s}(e,t,n,i,r);return function(e){const t=e.length,n=[],i=[];for(let o=0;o<t;++o){const t=e[o];n[o]=new Hn(t.x,t.y,t.z),i[o]=t.w}const r=[];for(let o=0;o<t;++o){const e=n[o].clone();for(let t=1;t<=o;++t)e.sub(r[o-t].clone().multiplyScalar(wg(o,t)*i[t]));r[o]=e.divideScalar(i[0])}return r}(o)}class Ag extends $l{constructor(e,t,n,i,r){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=i||0,this.endKnot=r||this.knots.length-1;for(let o=0;o<n.length;++o){const e=n[o];this.controlPoints[o]=new Ln(e.x,e.y,e.z,e.w)}}getPoint(e,t=new Hn){const n=t,i=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),r=function(e,t,n,i){const r=Tg(e,i,t),o=function(e,t,n,i){const r=[],o=[],s=[];r[0]=1;for(let a=1;a<=n;++a){o[a]=t-i[e+1-a],s[a]=i[e+a]-t;let n=0;for(let e=0;e<a;++e){const t=s[e+1],i=o[a-e],l=r[e]/(t+i);r[e]=n+t*l,n=i*l}r[a]=n}return r}(r,i,e,t),s=new Ln(0,0,0,0);for(let a=0;a<=e;++a){const t=n[r-e+a],i=o[a],l=t.w*i;s.x+=t.x*l,s.y+=t.y*l,s.z+=t.z*l,s.w+=t.w*i}return s}(this.degree,this.knots,this.controlPoints,i);return 1!==r.w&&r.divideScalar(r.w),n.set(r.x,r.y,r.z)}getTangent(e,t=new Hn){const n=t,i=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),r=Mg(this.degree,this.knots,this.controlPoints,i,1);return n.copy(r[1]).normalize(),n}}let Rg,Cg,Ig;class Pg extends gc{constructor(e){super(e)}load(e,t,n,i){const r=this,o=""===r.path?kc.extractUrlBase(e):r.path,s=new yc(this.manager);s.setPath(r.path),s.setResponseType("arraybuffer"),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(e,function(n){try{t(r.parse(n,o))}catch(BM){i?i(BM):console.error(BM),r.manager.itemError(e)}},n,i)}parse(e,t){if(function(e){const t="Kaydara FBX Binary  \0";return e.byteLength>=t.length&&t===Yg(e,0,t.length)}(e))Rg=(new Ug).parse(e);else{const t=Yg(e);if(!function(e){const t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let n=0;function i(t){const i=e[t-1];return e=e.slice(n+t),n++,i}for(let r=0;r<t.length;++r){if(i(1)===t[r])return!1}return!0}(t))throw new Error("THREE.FBXLoader: Unknown format.");if(Bg(t)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+Bg(t));Rg=(new Dg).parse(t)}const n=new Sc(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new Og(n,this.manager).parse(Rg)}}class Og{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){Cg=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),i=this.parseDeformers(),r=(new Ng).parse(i);return this.parseScene(i,r,n),Ig}parseConnections(){const e=new Map;if("Connections"in Rg){Rg.Connections.connections.forEach(function(t){const n=t[0],i=t[1],r=t[2];e.has(n)||e.set(n,{parents:[],children:[]});const o={ID:i,relationship:r};e.get(n).parents.push(o),e.has(i)||e.set(i,{parents:[],children:[]});const s={ID:n,relationship:r};e.get(i).children.push(s)})}return e}parseImages(){const e={},t={};if("Video"in Rg.Objects){const n=Rg.Objects.Video;for(const i in n){const r=n[i];if(e[parseInt(i)]=r.RelativeFilename||r.Filename,"Content"in r){const e=r.Content instanceof ArrayBuffer&&r.Content.byteLength>0,o="string"==typeof r.Content&&""!==r.Content;if(e||o){const e=this.parseImage(n[i]);t[r.RelativeFilename||r.Filename]=e}}}}for(const n in e){const i=e[n];void 0!==t[i]?e[n]=t[i]:e[n]=e[n].split("\\").pop()}return e}parseImage(e){const t=e.Content,n=e.RelativeFilename||e.Filename,i=n.slice(n.lastIndexOf(".")+1).toLowerCase();let r;switch(i){case"bmp":r="image/bmp";break;case"jpg":case"jpeg":r="image/jpeg";break;case"png":r="image/png";break;case"tif":r="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",n),r="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+i+'" is not supported.')}if("string"==typeof t)return"data:"+r+";base64,"+t;{const e=new Uint8Array(t);return window.URL.createObjectURL(new Blob([e],{type:r}))}}parseTextures(e){const t=new Map;if("Texture"in Rg.Objects){const n=Rg.Objects.Texture;for(const i in n){const r=this.parseTexture(n[i],e);t.set(parseInt(i),r)}}return t}parseTexture(e,t){const n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;const i=e.WrapModeU,r=e.WrapModeV,o=void 0!==i?i.value:0,s=void 0!==r?r.value:0;if(n.wrapS=0===o?ye:xe,n.wrapT=0===s?ye:xe,"Scaling"in e){const t=e.Scaling.value;n.repeat.x=t[0],n.repeat.y=t[1]}if("Translation"in e){const t=e.Translation.value;n.offset.x=t[0],n.offset.y=t[1]}return n}loadTexture(e,t){const n=new Set(["tga","tif","tiff","exr","dds","hdr","ktx2"]),i=e.FileName.split(".").pop().toLowerCase(),r=n.has(i)?this.manager.getHandler(`.${i}`):this.textureLoader;if(!r)return console.warn(`FBXLoader: ${i.toUpperCase()} loader not found, creating placeholder texture for`,e.RelativeFilename),new Nn;const o=r.path;o||r.setPath(this.textureLoader.path);const s=Cg.get(e.id).children;let a;void 0!==s&&s.length>0&&void 0!==t[s[0].ID]&&(a=t[s[0].ID],0!==a.indexOf("blob:")&&0!==a.indexOf("data:")||r.setPath(void 0));const l=r.load(a);return r.setPath(o),l}parseMaterials(e){const t=new Map;if("Material"in Rg.Objects){const n=Rg.Objects.Material;for(const i in n){const r=this.parseMaterial(n[i],e);null!==r&&t.set(parseInt(i),r)}}return t}parseMaterial(e,t){const n=e.id,i=e.attrName;let r=e.ShadingModel;if("object"==typeof r&&(r=r.value),!Cg.has(n))return null;const o=this.parseParameters(e,t,n);let s;switch(r.toLowerCase()){case"phong":s=new Xu;break;case"lambert":s=new Yu;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',r),s=new Xu}return s.setValues(o),s.name=i,s}parseParameters(e,t,n){const i={};e.BumpFactor&&(i.bumpScale=e.BumpFactor.value),e.Diffuse?i.color=(new or).fromArray(e.Diffuse.value).convertSRGBToLinear():!e.DiffuseColor||"Color"!==e.DiffuseColor.type&&"ColorRGB"!==e.DiffuseColor.type||(i.color=(new or).fromArray(e.DiffuseColor.value).convertSRGBToLinear()),e.DisplacementFactor&&(i.displacementScale=e.DisplacementFactor.value),e.Emissive?i.emissive=(new or).fromArray(e.Emissive.value).convertSRGBToLinear():!e.EmissiveColor||"Color"!==e.EmissiveColor.type&&"ColorRGB"!==e.EmissiveColor.type||(i.emissive=(new or).fromArray(e.EmissiveColor.value).convertSRGBToLinear()),e.EmissiveFactor&&(i.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(i.opacity=parseFloat(e.Opacity.value)),i.opacity<1&&(i.transparent=!0),e.ReflectionFactor&&(i.reflectivity=e.ReflectionFactor.value),e.Shininess&&(i.shininess=e.Shininess.value),e.Specular?i.specular=(new or).fromArray(e.Specular.value).convertSRGBToLinear():e.SpecularColor&&"Color"===e.SpecularColor.type&&(i.specular=(new or).fromArray(e.SpecularColor.value).convertSRGBToLinear());const r=this;return Cg.get(n).children.forEach(function(e){const n=e.relationship;switch(n){case"Bump":i.bumpMap=r.getTexture(t,e.ID);break;case"Maya|TEX_ao_map":i.aoMap=r.getTexture(t,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":i.map=r.getTexture(t,e.ID),void 0!==i.map&&(i.map.colorSpace=Ot);break;case"DisplacementColor":i.displacementMap=r.getTexture(t,e.ID);break;case"EmissiveColor":i.emissiveMap=r.getTexture(t,e.ID),void 0!==i.emissiveMap&&(i.emissiveMap.colorSpace=Ot);break;case"NormalMap":case"Maya|TEX_normal_map":i.normalMap=r.getTexture(t,e.ID);break;case"ReflectionColor":i.envMap=r.getTexture(t,e.ID),void 0!==i.envMap&&(i.envMap.mapping=ve,i.envMap.colorSpace=Ot);break;case"SpecularColor":i.specularMap=r.getTexture(t,e.ID),void 0!==i.specularMap&&(i.specularMap.colorSpace=Ot);break;case"TransparentColor":case"TransparencyFactor":i.alphaMap=r.getTexture(t,e.ID),i.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",n)}}),i}getTexture(e,t){return"LayeredTexture"in Rg.Objects&&t in Rg.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=Cg.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in Rg.Objects){const n=Rg.Objects.Deformer;for(const i in n){const r=n[i],o=Cg.get(parseInt(i));if("Skin"===r.attrType){const t=this.parseSkeleton(o,n);t.ID=i,o.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),t.geometryID=o.parents[0].ID,e[i]=t}else if("BlendShape"===r.attrType){const e={id:i};e.rawTargets=this.parseMorphTargets(o,n),e.id=i,o.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[i]=e}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const n=[];return e.children.forEach(function(e){const i=t[e.ID];if("Cluster"!==i.attrType)return;const r={ID:e.ID,indices:[],weights:[],transformLink:(new gi).fromArray(i.TransformLink.a)};"Indexes"in i&&(r.indices=i.Indexes.a,r.weights=i.Weights.a),n.push(r)}),{rawBones:n,bones:[]}}parseMorphTargets(e,t){const n=[];for(let i=0;i<e.children.length;i++){const r=e.children[i],o=t[r.ID],s={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if("BlendShapeChannel"!==o.attrType)return;s.geoID=Cg.get(parseInt(r.ID)).children.filter(function(e){return void 0===e.relationship})[0].ID,n.push(s)}return n}parseScene(e,t,n){Ig=new qa;const i=this.parseModels(e.skeletons,t,n),r=Rg.Objects.Model,o=this;i.forEach(function(e){const t=r[e.ID];o.setLookAtProperties(e,t);Cg.get(e.ID).parents.forEach(function(t){const n=i.get(t.ID);void 0!==n&&n.add(e)}),null===e.parent&&Ig.add(e)}),this.bindSkeleton(e.skeletons,t,i),this.addGlobalSceneSettings(),Ig.traverse(function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrix=e.parent.matrix,e.userData.transformData.parentMatrixWorld=e.parent.matrixWorld);const t=jg(e.userData.transformData);e.applyMatrix4(t),e.updateWorldMatrix()}});const s=(new Lg).parse();1===Ig.children.length&&Ig.children[0].isGroup&&(Ig.children[0].animations=s,Ig=Ig.children[0]),Ig.animations=s}parseModels(e,t,n){const i=new Map,r=Rg.Objects.Model;for(const o in r){const s=parseInt(o),a=r[o],l=Cg.get(s);let u=this.buildSkeleton(l,e,s,a.attrName);if(!u){switch(a.attrType){case"Camera":u=this.createCamera(l);break;case"Light":u=this.createLight(l);break;case"Mesh":u=this.createMesh(l,t,n);break;case"NurbsCurve":u=this.createCurve(l,t);break;case"LimbNode":case"Root":u=new gl;break;default:u=new qa}u.name=a.attrName?id.sanitizeNodeName(a.attrName):"",u.userData.originalName=a.attrName,u.ID=s}this.getTransformData(u,a),i.set(s,u)}return i}buildSkeleton(e,t,n,i){let r=null;return e.parents.forEach(function(e){for(const o in t){const s=t[o];s.rawBones.forEach(function(t,o){if(t.ID===e.ID){const e=r;r=new gl,r.matrixWorld.copy(t.transformLink),r.name=i?id.sanitizeNodeName(i):"",r.userData.originalName=i,r.ID=n,s.bones[o]=r,null!==e&&r.add(e)}})}}),r}createCamera(e){let t,n;if(e.children.forEach(function(e){const t=Rg.Objects.NodeAttribute[e.ID];void 0!==t&&(n=t)}),void 0===n)t=new Gi;else{let e=0;void 0!==n.CameraProjectionType&&1===n.CameraProjectionType.value&&(e=1);let i=1;void 0!==n.NearPlane&&(i=n.NearPlane.value/1e3);let r=1e3;void 0!==n.FarPlane&&(r=n.FarPlane.value/1e3);let o=window.innerWidth,s=window.innerHeight;void 0!==n.AspectWidth&&void 0!==n.AspectHeight&&(o=n.AspectWidth.value,s=n.AspectHeight.value);const a=o/s;let l=45;void 0!==n.FieldOfView&&(l=n.FieldOfView.value);const u=n.FocalLength?n.FocalLength.value:null;switch(e){case 0:t=new Qr(l,a,i,r),null!==u&&t.setFocalLength(u);break;case 1:t=new Ao(-o/2,o/2,s/2,-s/2,i,r);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+e+"."),t=new Gi}}return t}createLight(e){let t,n;if(e.children.forEach(function(e){const t=Rg.Objects.NodeAttribute[e.ID];void 0!==t&&(n=t)}),void 0===n)t=new Gi;else{let e;e=void 0===n.LightType?0:n.LightType.value;let i=16777215;void 0!==n.Color&&(i=(new or).fromArray(n.Color.value).convertSRGBToLinear());let r=void 0===n.Intensity?1:n.Intensity.value/100;void 0!==n.CastLightOnObject&&0===n.CastLightOnObject.value&&(r=0);let o=0;void 0!==n.FarAttenuationEnd&&(o=void 0!==n.EnableFarAttenuation&&0===n.EnableFarAttenuation.value?0:n.FarAttenuationEnd.value);const s=1;switch(e){case 0:t=new Nc(i,r,o,s);break;case 1:t=new Dc(i,r);break;case 2:let e=Math.PI/3;void 0!==n.InnerAngle&&(e=dn.degToRad(n.InnerAngle.value));let a=0;void 0!==n.OuterAngle&&(a=dn.degToRad(n.OuterAngle.value),a=Math.max(a,1)),t=new Rc(i,r,o,e,a,s);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),t=new Nc(i,r)}void 0!==n.CastShadows&&1===n.CastShadows.value&&(t.castShadow=!0)}return t}createMesh(e,t,n){let i,r=null,o=null;const s=[];return e.children.forEach(function(e){t.has(e.ID)&&(r=t.get(e.ID)),n.has(e.ID)&&s.push(n.get(e.ID))}),s.length>1?o=s:s.length>0?o=s[0]:(o=new Xu({name:gc.DEFAULT_MATERIAL_NAME,color:13421772}),s.push(o)),"color"in r.attributes&&s.forEach(function(e){e.vertexColors=!0}),r.FBX_Deformer?(i=new ml(r,o),i.normalizeSkinWeights()):i=new Vr(r,o),i}createCurve(e,t){const n=e.children.reduce(function(e,n){return t.has(n.ID)&&(e=t.get(n.ID)),e},null),i=new Il({name:gc.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new Fl(n,i)}getTransformData(e,t){const n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),n.eulerOrder="RotationOrder"in t?qg(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,t){if("LookAtProperty"in t){Cg.get(e.ID).children.forEach(function(t){if("LookAtProperty"===t.relationship){const n=Rg.Objects.Model[t.ID];if("Lcl_Translation"in n){const t=n.Lcl_Translation.value;void 0!==e.target?(e.target.position.fromArray(t),Ig.add(e.target)):e.lookAt((new Hn).fromArray(t))}}})}}bindSkeleton(e,t,n){const i=this.parsePoseNodes();for(const r in e){const o=e[r];Cg.get(parseInt(o.ID)).parents.forEach(function(e){if(t.has(e.ID)){const t=e.ID;Cg.get(t).parents.forEach(function(e){if(n.has(e.ID)){n.get(e.ID).bind(new xl(o.bones),i[e.ID])}})}})}}parsePoseNodes(){const e={};if("Pose"in Rg.Objects){const t=Rg.Objects.Pose;for(const n in t)if("BindPose"===t[n].attrType&&t[n].NbPoseNodes>0){const i=t[n].PoseNode;Array.isArray(i)?i.forEach(function(t){e[t.Node]=(new gi).fromArray(t.Matrix.a)}):e[i.Node]=(new gi).fromArray(i.Matrix.a)}}return e}addGlobalSceneSettings(){if("GlobalSettings"in Rg){if("AmbientColor"in Rg.GlobalSettings){const e=Rg.GlobalSettings.AmbientColor.value,t=e[0],n=e[1],i=e[2];if(0!==t||0!==n||0!==i){const e=new or(t,n,i).convertSRGBToLinear();Ig.add(new Uc(e,1))}}"UnitScaleFactor"in Rg.GlobalSettings&&(Ig.userData.unitScaleFactor=Rg.GlobalSettings.UnitScaleFactor.value)}}}class Ng{constructor(){this.negativeMaterialIndices=!1}parse(e){const t=new Map;if("Geometry"in Rg.Objects){const n=Rg.Objects.Geometry;for(const i in n){const r=Cg.get(parseInt(i)),o=this.parseGeometry(r,n[i],e);t.set(parseInt(i),o)}}return!0===this.negativeMaterialIndices&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),t}parseGeometry(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,n){const i=n.skeletons,r=[],o=e.parents.map(function(e){return Rg.Objects.Model[e.ID]});if(0===o.length)return;const s=e.children.reduce(function(e,t){return void 0!==i[t.ID]&&(e=i[t.ID]),e},null);e.children.forEach(function(e){void 0!==n.morphTargets[e.ID]&&r.push(n.morphTargets[e.ID])});const a=o[0],l={};"RotationOrder"in a&&(l.eulerOrder=qg(a.RotationOrder.value)),"InheritType"in a&&(l.inheritType=parseInt(a.InheritType.value)),"GeometricTranslation"in a&&(l.translation=a.GeometricTranslation.value),"GeometricRotation"in a&&(l.rotation=a.GeometricRotation.value),"GeometricScaling"in a&&(l.scale=a.GeometricScaling.value);const u=jg(l);return this.genGeometry(t,s,r,u)}genGeometry(e,t,n,i){const r=new br;e.attrName&&(r.name=e.attrName);const o=this.parseGeoNode(e,t),s=this.genBuffers(o),a=new mr(s.vertex,3);if(a.applyMatrix4(i),r.setAttribute("position",a),s.colors.length>0&&r.setAttribute("color",new mr(s.colors,3)),t&&(r.setAttribute("skinIndex",new pr(s.weightsIndices,4)),r.setAttribute("skinWeight",new mr(s.vertexWeights,4)),r.FBX_Deformer=t),s.normal.length>0){const e=(new pn).getNormalMatrix(i),t=new mr(s.normal,3);t.applyNormalMatrix(e),r.setAttribute("normal",t)}if(s.uvs.forEach(function(e,t){const n=0===t?"uv":`uv${t}`;r.setAttribute(n,new mr(s.uvs[t],2))}),o.material&&"AllSame"!==o.material.mappingType){let e=s.materialIndex[0],t=0;if(s.materialIndex.forEach(function(n,i){n!==e&&(r.addGroup(t,i-t,e),e=n,t=i)}),r.groups.length>0){const t=r.groups[r.groups.length-1],n=t.start+t.count;n!==s.materialIndex.length&&r.addGroup(n,s.materialIndex.length-n,e)}0===r.groups.length&&r.addGroup(0,s.materialIndex.length,s.materialIndex[0])}return this.addMorphTargets(r,e,n,i),r}parseGeoNode(e,t){const n={};if(n.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],n.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let t=0;for(;e.LayerElementUV[t];)e.LayerElementUV[t].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[t])),t++}return n.weightTable={},null!==t&&(n.skeleton=t,t.rawBones.forEach(function(e,t){e.indices.forEach(function(i,r){void 0===n.weightTable[i]&&(n.weightTable[i]=[]),n.weightTable[i].push({id:t,weight:e.weights[r]})})})),n}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,i=0,r=!1,o=[],s=[],a=[],l=[],u=[],c=[];const d=this;return e.vertexIndices.forEach(function(h,p){let f,m=!1;h<0&&(h^=-1,m=!0);let g=[],v=[];if(o.push(3*h,3*h+1,3*h+2),e.color){const t=zg(p,n,h,e.color);a.push(t[0],t[1],t[2])}if(e.skeleton){if(void 0!==e.weightTable[h]&&e.weightTable[h].forEach(function(e){v.push(e.weight),g.push(e.id)}),v.length>4){r||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),r=!0);const e=[0,0,0,0],t=[0,0,0,0];v.forEach(function(n,i){let r=n,o=g[i];t.forEach(function(t,n,i){if(r>t){i[n]=r,r=t;const s=e[n];e[n]=o,o=s}})}),g=e,v=t}for(;v.length<4;)v.push(0),g.push(0);for(let e=0;e<4;++e)u.push(v[e]),c.push(g[e])}if(e.normal){const t=zg(p,n,h,e.normal);s.push(t[0],t[1],t[2])}e.material&&"AllSame"!==e.material.mappingType&&(f=zg(p,n,h,e.material)[0],f<0&&(d.negativeMaterialIndices=!0,f=0)),e.uv&&e.uv.forEach(function(e,t){const i=zg(p,n,h,e);void 0===l[t]&&(l[t]=[]),l[t].push(i[0]),l[t].push(i[1])}),i++,m&&(d.genFace(t,e,o,f,s,a,l,u,c,i),n++,i=0,o=[],s=[],a=[],l=[],u=[],c=[])}),t}getNormalNewell(e){const t=new Hn(0,0,0);for(let n=0;n<e.length;n++){const i=e[n],r=e[(n+1)%e.length];t.x+=(i.y-r.y)*(i.z+r.z),t.y+=(i.z-r.z)*(i.x+r.x),t.z+=(i.x-r.x)*(i.y+r.y)}return t.normalize(),t}getNormalTangentAndBitangent(e){const t=this.getNormalNewell(e),n=(Math.abs(t.z)>.5?new Hn(0,1,0):new Hn(0,0,1)).cross(t).normalize(),i=t.clone().cross(n).normalize();return{normal:t,tangent:n,bitangent:i}}flattenVertex(e,t,n){return new hn(e.dot(t),e.dot(n))}genFace(e,t,n,i,r,o,s,a,l,u){let c;if(u>3){const e=[],i=t.baseVertexPositions||t.vertexPositions;for(let t=0;t<n.length;t+=3)e.push(new Hn(i[n[t]],i[n[t+1]],i[n[t+2]]));const{tangent:r,bitangent:o}=this.getNormalTangentAndBitangent(e),s=[];for(const t of e)s.push(this.flattenVertex(t,r,o));c=Hu.triangulateShape(s,[])}else c=[[0,1,2]];for(const[d,h,p]of c)e.vertex.push(t.vertexPositions[n[3*d]]),e.vertex.push(t.vertexPositions[n[3*d+1]]),e.vertex.push(t.vertexPositions[n[3*d+2]]),e.vertex.push(t.vertexPositions[n[3*h]]),e.vertex.push(t.vertexPositions[n[3*h+1]]),e.vertex.push(t.vertexPositions[n[3*h+2]]),e.vertex.push(t.vertexPositions[n[3*p]]),e.vertex.push(t.vertexPositions[n[3*p+1]]),e.vertex.push(t.vertexPositions[n[3*p+2]]),t.skeleton&&(e.vertexWeights.push(a[4*d]),e.vertexWeights.push(a[4*d+1]),e.vertexWeights.push(a[4*d+2]),e.vertexWeights.push(a[4*d+3]),e.vertexWeights.push(a[4*h]),e.vertexWeights.push(a[4*h+1]),e.vertexWeights.push(a[4*h+2]),e.vertexWeights.push(a[4*h+3]),e.vertexWeights.push(a[4*p]),e.vertexWeights.push(a[4*p+1]),e.vertexWeights.push(a[4*p+2]),e.vertexWeights.push(a[4*p+3]),e.weightsIndices.push(l[4*d]),e.weightsIndices.push(l[4*d+1]),e.weightsIndices.push(l[4*d+2]),e.weightsIndices.push(l[4*d+3]),e.weightsIndices.push(l[4*h]),e.weightsIndices.push(l[4*h+1]),e.weightsIndices.push(l[4*h+2]),e.weightsIndices.push(l[4*h+3]),e.weightsIndices.push(l[4*p]),e.weightsIndices.push(l[4*p+1]),e.weightsIndices.push(l[4*p+2]),e.weightsIndices.push(l[4*p+3])),t.color&&(e.colors.push(o[3*d]),e.colors.push(o[3*d+1]),e.colors.push(o[3*d+2]),e.colors.push(o[3*h]),e.colors.push(o[3*h+1]),e.colors.push(o[3*h+2]),e.colors.push(o[3*p]),e.colors.push(o[3*p+1]),e.colors.push(o[3*p+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(i),e.materialIndex.push(i),e.materialIndex.push(i)),t.normal&&(e.normal.push(r[3*d]),e.normal.push(r[3*d+1]),e.normal.push(r[3*d+2]),e.normal.push(r[3*h]),e.normal.push(r[3*h+1]),e.normal.push(r[3*h+2]),e.normal.push(r[3*p]),e.normal.push(r[3*p+1]),e.normal.push(r[3*p+2])),t.uv&&t.uv.forEach(function(t,n){void 0===e.uvs[n]&&(e.uvs[n]=[]),e.uvs[n].push(s[n][2*d]),e.uvs[n].push(s[n][2*d+1]),e.uvs[n].push(s[n][2*h]),e.uvs[n].push(s[n][2*h+1]),e.uvs[n].push(s[n][2*p]),e.uvs[n].push(s[n][2*p+1])})}addMorphTargets(e,t,n,i){if(0===n.length)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const r=this;n.forEach(function(n){n.rawTargets.forEach(function(n){const o=Rg.Objects.Geometry[n.geoID];void 0!==o&&r.genMorphGeometry(e,t,o,i,n.name)})})}genMorphGeometry(e,t,n,i,r){const o=void 0!==t.Vertices?t.Vertices.a:[],s=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],a=void 0!==n.Vertices?n.Vertices.a:[],l=void 0!==n.Indexes?n.Indexes.a:[],u=3*e.attributes.position.count,c=new Float32Array(u);for(let f=0;f<l.length;f++){const e=3*l[f];c[e]=a[3*f],c[e+1]=a[3*f+1],c[e+2]=a[3*f+2]}const d={vertexIndices:s,vertexPositions:c,baseVertexPositions:o},h=this.genBuffers(d),p=new mr(h.vertex,3);p.name=r||n.attrName,p.applyMatrix4(i),e.morphAttributes.position.push(p)}parseNormals(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.Normals.a;let r=[];return"IndexToDirect"===n&&("NormalIndex"in e?r=e.NormalIndex.a:"NormalsIndex"in e&&(r=e.NormalsIndex.a)),{dataSize:3,buffer:i,indices:r,mappingType:t,referenceType:n}}parseUVs(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.UV.a;let r=[];return"IndexToDirect"===n&&(r=e.UVIndex.a),{dataSize:2,buffer:i,indices:r,mappingType:t,referenceType:n}}parseVertexColors(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.Colors.a;let r=[];"IndexToDirect"===n&&(r=e.ColorIndex.a);for(let o=0,s=new or;o<i.length;o+=4)s.fromArray(i,o).convertSRGBToLinear().toArray(i,o);return{dataSize:4,buffer:i,indices:r,mappingType:t,referenceType:n}}parseMaterialIndices(e){const t=e.MappingInformationType,n=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const i=e.Materials.a,r=[];for(let o=0;o<i.length;++o)r.push(o);return{dataSize:1,buffer:i,indices:r,mappingType:t,referenceType:n}}parseNurbsGeometry(e){const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new br;const n=t-1,i=e.KnotVector.a,r=[],o=e.Points.a;for(let u=0,c=o.length;u<c;u+=4)r.push((new Ln).fromArray(o,u));let s,a;if("Closed"===e.Form)r.push(r[0]);else if("Periodic"===e.Form){s=n,a=i.length-1-s;for(let e=0;e<n;++e)r.push(r[e])}const l=new Ag(n,i,r,s,a).getPoints(12*r.length);return(new br).setFromPoints(l)}}class Lg{parse(){const e=[],t=this.parseClips();if(void 0!==t)for(const n in t){const i=t[n],r=this.addClip(i);e.push(r)}return e}parseClips(){if(void 0===Rg.Objects.AnimationCurve)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=Rg.Objects.AnimationCurveNode,t=new Map;for(const n in e){const i=e[n];if(null!==i.attrName.match(/S|R|T|DeformPercent/)){const e={id:i.id,attr:i.attrName,curves:{}};t.set(e.id,e)}}return t}parseAnimationCurves(e){const t=Rg.Objects.AnimationCurve;for(const n in t){const i={id:t[n].id,times:t[n].KeyTime.a.map(Hg),values:t[n].KeyValueFloat.a},r=Cg.get(i.id);if(void 0!==r){const t=r.parents[0].ID,n=r.parents[0].relationship;n.match(/X/)?e.get(t).curves.x=i:n.match(/Y/)?e.get(t).curves.y=i:n.match(/Z/)?e.get(t).curves.z=i:n.match(/DeformPercent/)&&e.has(t)&&(e.get(t).curves.morph=i)}}}parseAnimationLayers(e){const t=Rg.Objects.AnimationLayer,n=new Map;for(const i in t){const t=[],r=Cg.get(parseInt(i));if(void 0!==r){r.children.forEach(function(n,i){if(e.has(n.ID)){const r=e.get(n.ID);if(void 0!==r.curves.x||void 0!==r.curves.y||void 0!==r.curves.z){if(void 0===t[i]){const e=Cg.get(n.ID).parents.filter(function(e){return void 0!==e.relationship})[0].ID;if(void 0!==e){const r=Rg.Objects.Model[e.toString()];if(void 0===r)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",n);const o={modelName:r.attrName?id.sanitizeNodeName(r.attrName):"",ID:r.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Ig.traverse(function(e){e.ID===r.id&&(o.transform=e.matrix,e.userData.transformData&&(o.eulerOrder=e.userData.transformData.eulerOrder))}),o.transform||(o.transform=new gi),"PreRotation"in r&&(o.preRotation=r.PreRotation.value),"PostRotation"in r&&(o.postRotation=r.PostRotation.value),t[i]=o}}t[i]&&(t[i][r.attr]=r)}else if(void 0!==r.curves.morph){if(void 0===t[i]){const e=Cg.get(n.ID).parents.filter(function(e){return void 0!==e.relationship})[0].ID,r=Cg.get(e).parents[0].ID,o=Cg.get(r).parents[0].ID,s=Cg.get(o).parents[0].ID,a=Rg.Objects.Model[s],l={modelName:a.attrName?id.sanitizeNodeName(a.attrName):"",morphName:Rg.Objects.Deformer[e].attrName};t[i]=l}t[i][r.attr]=r}}}),n.set(parseInt(i),t)}}return n}parseAnimStacks(e){const t=Rg.Objects.AnimationStack,n={};for(const i in t){const r=Cg.get(parseInt(i)).children;r.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const o=e.get(r[0].ID);n[i]={name:t[i].attrName,layer:o}}return n}addClip(e){let t=[];const n=this;return e.layer.forEach(function(e){t=t.concat(n.generateTracks(e))}),new dc(e.name,-1,t)}generateTracks(e){const t=[];let n=new Hn,i=new Hn;if(e.transform&&e.transform.decompose(n,new Bn,i),n=n.toArray(),i=i.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){const i=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");void 0!==i&&t.push(i)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){const n=this.generateRotationTrack(e.modelName,e.R.curves,e.preRotation,e.postRotation,e.eulerOrder);void 0!==n&&t.push(n)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){const n=this.generateVectorTrack(e.modelName,e.S.curves,i,"scale");void 0!==n&&t.push(n)}if(void 0!==e.DeformPercent){const n=this.generateMorphTrack(e);void 0!==n&&t.push(n)}return t}generateVectorTrack(e,t,n,i){const r=this.getTimesForAllAxes(t),o=this.getKeyframeTrackValues(r,t,n);return new cc(e+"."+i,r,o)}generateRotationTrack(e,t,n,i,r){let o,s;if(void 0!==t.x&&void 0!==t.y&&void 0!==t.z){const e=this.interpolateRotations(t.x,t.y,t.z,r);o=e[0],s=e[1]}void 0!==n&&((n=n.map(dn.degToRad)).push(r),n=(new Mi).fromArray(n),n=(new Bn).setFromEuler(n)),void 0!==i&&((i=i.map(dn.degToRad)).push(r),i=(new Mi).fromArray(i),i=(new Bn).setFromEuler(i).invert());const a=new Bn,l=new Mi,u=[];if(!s||!o)return new lc(e+".quaternion",[0],[0]);for(let c=0;c<s.length;c+=3){if(l.set(s[c],s[c+1],s[c+2],r),a.setFromEuler(l),void 0!==n&&a.premultiply(n),void 0!==i&&a.multiply(i),c>2){(new Bn).fromArray(u,(c-3)/3*4).dot(a)<0&&a.set(-a.x,-a.y,-a.z,-a.w)}a.toArray(u,c/3*4)}return new lc(e+".quaternion",o,u)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,n=t.values.map(function(e){return e/100}),i=Ig.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new sc(e.modelName+".morphTargetInfluences["+i+"]",t.times,n)}getTimesForAllAxes(e){let t=[];if(void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort(function(e,t){return e-t}),t.length>1){let e=1,n=t[0];for(let i=1;i<t.length;i++){const r=t[i];r!==n&&(t[e]=r,n=r,e++)}t=t.slice(0,e)}return t}getKeyframeTrackValues(e,t,n){const i=n,r=[];let o=-1,s=-1,a=-1;return e.forEach(function(e){if(t.x&&(o=t.x.times.indexOf(e)),t.y&&(s=t.y.times.indexOf(e)),t.z&&(a=t.z.times.indexOf(e)),-1!==o){const e=t.x.values[o];r.push(e),i[0]=e}else r.push(i[0]);if(-1!==s){const e=t.y.values[s];r.push(e),i[1]=e}else r.push(i[1]);if(-1!==a){const e=t.z.values[a];r.push(e),i[2]=e}else r.push(i[2])}),r}interpolateRotations(e,t,n,i){const r=[],o=[];r.push(e.times[0]),o.push(dn.degToRad(e.values[0])),o.push(dn.degToRad(t.values[0])),o.push(dn.degToRad(n.values[0]));for(let s=1;s<e.values.length;s++){const a=[e.values[s-1],t.values[s-1],n.values[s-1]];if(isNaN(a[0])||isNaN(a[1])||isNaN(a[2]))continue;const l=a.map(dn.degToRad),u=[e.values[s],t.values[s],n.values[s]];if(isNaN(u[0])||isNaN(u[1])||isNaN(u[2]))continue;const c=u.map(dn.degToRad),d=[u[0]-a[0],u[1]-a[1],u[2]-a[2]],h=[Math.abs(d[0]),Math.abs(d[1]),Math.abs(d[2])];if(h[0]>=180||h[1]>=180||h[2]>=180){const t=Math.max(...h)/180,n=new Mi(...l,i),a=new Mi(...c,i),u=(new Bn).setFromEuler(n),d=(new Bn).setFromEuler(a);u.dot(d)&&d.set(-d.x,-d.y,-d.z,-d.w);const p=e.times[s-1],f=e.times[s]-p,m=new Bn,g=new Mi;for(let e=0;e<1;e+=1/t)m.copy(u.clone().slerp(d.clone(),e)),r.push(p+e*f),g.setFromQuaternion(m,i),o.push(g.x),o.push(g.y),o.push(g.z)}else r.push(e.times[s]),o.push(dn.degToRad(e.values[s])),o.push(dn.degToRad(t.values[s])),o.push(dn.degToRad(n.values[s]))}return[r,o]}}class Dg{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new Fg,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,n=e.split(/[\r\n]+/);return n.forEach(function(e,i){const r=e.match(/^[\s\t]*;/),o=e.match(/^[\s\t]*$/);if(r||o)return;const s=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),a=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=e.match("^\\t{"+(t.currentIndent-1)+"}}");s?t.parseNodeBegin(e,s):a?t.parseNodeProperty(e,a,n[++i]):l?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)}),this.allNodes}parseNodeBegin(e,t){const n=t[1].trim().replace(/^"/,"").replace(/"$/,""),i=t[2].split(",").map(function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")}),r={name:n},o=this.parseNodeAttr(i),s=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(n,r):n in s?("PoseNode"===n?s.PoseNode.push(r):void 0!==s[n].id&&(s[n]={},s[n][s[n].id]=s[n]),""!==o.id&&(s[n][o.id]=r)):"number"==typeof o.id?(s[n]={},s[n][o.id]=r):"Properties70"!==n&&(s[n]="PoseNode"===n?[r]:r),"number"==typeof o.id&&(r.id=o.id),""!==o.name&&(r.attrName=o.name),""!==o.type&&(r.attrType=o.type),this.pushStack(r)}parseNodeAttr(e){let t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let n="",i="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),i=e[2]),{id:t,name:n,type:i}}parseNodeProperty(e,t,n){let i=t[1].replace(/^"/,"").replace(/"$/,"").trim(),r=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===i&&","===r&&(r=n.replace(/"/g,"").replace(/,$/,"").trim());const o=this.getCurrentNode();if("Properties70"!==o.name){if("C"===i){const e=r.split(",").slice(1),t=parseInt(e[0]),n=parseInt(e[1]);let s=r.split(",").slice(3);s=s.map(function(e){return e.trim().replace(/^"/,"")}),i="connections",r=[t,n],function(e,t){for(let n=0,i=e.length,r=t.length;n<r;n++,i++)e[i]=t[n]}(r,s),void 0===o[i]&&(o[i]=[])}"Node"===i&&(o.id=r),i in o&&Array.isArray(o[i])?o[i].push(r):"a"!==i?o[i]=r:o.a=r,this.setCurrentProp(o,i),"a"===i&&","!==r.slice(-1)&&(o.a=Xg(r))}else this.parseNodeSpecialProperty(e,i,r)}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=Xg(t.a))}parseNodeSpecialProperty(e,t,n){const i=n.split('",').map(function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")}),r=i[0],o=i[1],s=i[2],a=i[3];let l=i[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=Xg(l)}this.getPrevNode()[r]={type:o,type2:s,flag:a,value:l},this.setCurrentProp(this.getPrevNode(),r)}}class Ug{parse(e){const t=new kg(e);t.skip(23);const n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const i=new Fg;for(;!this.endOfContent(t);){const e=this.parseNode(t,n);null!==e&&i.add(e.name,e)}return i}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const n={},i=t>=7500?e.getUint64():e.getUint32(),r=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const o=e.getUint8(),s=e.getString(o);if(0===i)return null;const a=[];for(let d=0;d<r;d++)a.push(this.parseProperty(e));const l=a.length>0?a[0]:"",u=a.length>1?a[1]:"",c=a.length>2?a[2]:"";for(n.singleProperty=1===r&&e.getOffset()===i;i>e.getOffset();){const i=this.parseNode(e,t);null!==i&&this.parseSubNode(s,n,i)}return n.propertyList=a,"number"==typeof l&&(n.id=l),""!==u&&(n.attrName=u),""!==c&&(n.attrType=c),""!==s&&(n.name=s),n}parseSubNode(e,t,n){if(!0===n.singleProperty){const e=n.propertyList[0];Array.isArray(e)?(t[n.name]=n,n.a=e):t[n.name]=e}else if("Connections"===e&&"C"===n.name){const e=[];n.propertyList.forEach(function(t,n){0!==n&&e.push(t)}),void 0===t.connections&&(t.connections=[]),t.connections.push(e)}else if("Properties70"===n.name){Object.keys(n).forEach(function(e){t[e]=n[e]})}else if("Properties70"===e&&"P"===n.name){let e=n.propertyList[0],i=n.propertyList[1];const r=n.propertyList[2],o=n.propertyList[3];let s;0===e.indexOf("Lcl ")&&(e=e.replace("Lcl ","Lcl_")),0===i.indexOf("Lcl ")&&(i=i.replace("Lcl ","Lcl_")),s="Color"===i||"ColorRGB"===i||"Vector"===i||"Vector3D"===i||0===i.indexOf("Lcl_")?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],t[e]={type:i,type2:r,flag:o,value:s}}else void 0===t[n.name]?"number"==typeof n.id?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:"PoseNode"===n.name?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):void 0===t[n.name][n.id]&&(t[n.name][n.id]=n)}parseProperty(e){const t=e.getString(1);let n;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const i=e.getUint32(),r=e.getUint32(),o=e.getUint32();if(0===r)switch(t){case"b":case"c":return e.getBooleanArray(i);case"d":return e.getFloat64Array(i);case"f":return e.getFloat32Array(i);case"i":return e.getInt32Array(i);case"l":return e.getInt64Array(i)}const s=Eg(new Uint8Array(e.getArrayBuffer(o))),a=new kg(s.buffer);switch(t){case"b":case"c":return a.getBooleanArray(i);case"d":return a.getFloat64Array(i);case"f":return a.getFloat32Array(i);case"i":return a.getInt32Array(i);case"l":return a.getInt64Array(i)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class kg{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return!(1&~this.getUint8())}getBooleanArray(e){const t=[];for(let n=0;n<e;n++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,e=4294967295&~e,4294967295===e&&(t=t+1&4294967295),e=e+1&4294967295,-(4294967296*t+e)):4294967296*t+e}getInt64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){const t=this.offset;let n=new Uint8Array(this.dv.buffer,t,e);this.skip(e);const i=n.indexOf(0);return i>=0&&(n=new Uint8Array(this.dv.buffer,t,i)),this._textDecoder.decode(n)}}class Fg{add(e,t){this[e]=t}}function Bg(e){const t=e.match(/FBXVersion: (\d+)/);if(t){return parseInt(t[1])}throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function Hg(e){return e/46186158e3}const Vg=[];function zg(e,t,n,i){let r;switch(i.mappingType){case"ByPolygonVertex":r=e;break;case"ByPolygon":r=t;break;case"ByVertice":r=n;break;case"AllSame":r=i.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+i.mappingType)}"IndexToDirect"===i.referenceType&&(r=i.indices[r]);const o=r*i.dataSize,s=o+i.dataSize;return function(e,t,n,i){for(let r=n,o=0;r<i;r++,o++)e[o]=t[r];return e}(Vg,i.buffer,o,s)}const Gg=new Mi,Wg=new Hn;function jg(e){const t=new gi,n=new gi,i=new gi,r=new gi,o=new gi,s=new gi,a=new gi,l=new gi,u=new gi,c=new gi,d=new gi,h=new gi,p=e.inheritType?e.inheritType:0;if(e.translation&&t.setPosition(Wg.fromArray(e.translation)),e.preRotation){const t=e.preRotation.map(dn.degToRad);t.push(e.eulerOrder||Mi.DEFAULT_ORDER),n.makeRotationFromEuler(Gg.fromArray(t))}if(e.rotation){const t=e.rotation.map(dn.degToRad);t.push(e.eulerOrder||Mi.DEFAULT_ORDER),i.makeRotationFromEuler(Gg.fromArray(t))}if(e.postRotation){const t=e.postRotation.map(dn.degToRad);t.push(e.eulerOrder||Mi.DEFAULT_ORDER),r.makeRotationFromEuler(Gg.fromArray(t)),r.invert()}e.scale&&o.scale(Wg.fromArray(e.scale)),e.scalingOffset&&a.setPosition(Wg.fromArray(e.scalingOffset)),e.scalingPivot&&s.setPosition(Wg.fromArray(e.scalingPivot)),e.rotationOffset&&l.setPosition(Wg.fromArray(e.rotationOffset)),e.rotationPivot&&u.setPosition(Wg.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(d.copy(e.parentMatrix),c.copy(e.parentMatrixWorld));const f=n.clone().multiply(i).multiply(r),m=new gi;m.extractRotation(c);const g=new gi;g.copyPosition(c);const v=g.clone().invert().multiply(c),_=m.clone().invert().multiply(v),y=o,x=new gi;if(0===p)x.copy(m).multiply(f).multiply(_).multiply(y);else if(1===p)x.copy(m).multiply(_).multiply(f).multiply(y);else{const e=(new gi).scale((new Hn).setFromMatrixScale(d)).clone().invert(),t=_.clone().multiply(e);x.copy(m).multiply(f).multiply(t).multiply(y)}const S=u.clone().invert(),E=s.clone().invert();let b=t.clone().multiply(l).multiply(u).multiply(n).multiply(i).multiply(r).multiply(S).multiply(a).multiply(s).multiply(o).multiply(E);const T=(new gi).copyPosition(b),w=c.clone().multiply(T);return h.copyPosition(w),b=h.clone().multiply(x),b.premultiply(c.invert()),b}function qg(e){const t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function Xg(e){return e.split(",").map(function(e){return parseFloat(e)})}function Yg(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=e.byteLength),(new TextDecoder).decode(new Uint8Array(e,t,n))}class Kg extends gc{constructor(e){super(e)}load(e,t,n,i){const r=this,o=new yc(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(e){const n=r.parse(JSON.parse(e));t&&t(n)},n,i)}parse(e){return new Jg(e)}}class Jg{constructor(e){this.isFont=!0,this.type="Font",this.data=e}generateShapes(e,t=100){const n=[],i=function(e,t,n){const i=Array.from(e),r=t/n.resolution,o=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*r,s=[];let a=0,l=0;for(let u=0;u<i.length;u++){const e=i[u];if("\n"===e)a=0,l-=o;else{const t=$g(e,r,a,l,n);a+=t.offsetX,s.push(t.path)}}return s}(e,t,this.data);for(let r=0,o=i.length;r<o;r++)n.push(...i[r].toShapes());return n}}function $g(e,t,n,i,r){const o=r.glyphs[e]||r.glyphs["?"];if(!o)return void console.error('THREE.Font: character "'+e+'" does not exists in font family '+r.familyName+".");const s=new dd;let a,l,u,c,d,h,p,f;if(o.o){const e=o._cachedOutline||(o._cachedOutline=o.o.split(" "));for(let r=0,o=e.length;r<o;){switch(e[r++]){case"m":a=e[r++]*t+n,l=e[r++]*t+i,s.moveTo(a,l);break;case"l":a=e[r++]*t+n,l=e[r++]*t+i,s.lineTo(a,l);break;case"q":u=e[r++]*t+n,c=e[r++]*t+i,d=e[r++]*t+n,h=e[r++]*t+i,s.quadraticCurveTo(d,h,u,c);break;case"b":u=e[r++]*t+n,c=e[r++]*t+i,d=e[r++]*t+n,h=e[r++]*t+i,p=e[r++]*t+n,f=e[r++]*t+i,s.bezierCurveTo(d,h,p,f,u,c)}}}return{offsetX:o.ha*t,path:s}}class Zg extends Gu{constructor(e,t={}){const n=t.font;if(void 0===n)super();else{const i=n.generateShapes(e,t.size);void 0===t.depth&&void 0!==t.height&&console.warn("THREE.TextGeometry: .height is now depreciated. Please use .depth instead"),t.depth=void 0!==t.depth?t.depth:void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),super(i,t)}this.type="TextGeometry"}}var Qg,ev={exports:{}};var tv,nv=(Qg||(Qg=1,tv=ev,function(){var e={}.hasOwnProperty;function t(){for(var e="",t=0;t<arguments.length;t++){var r=arguments[t];r&&(e=i(e,n(r)))}return e}function n(n){if("string"==typeof n||"number"==typeof n)return n;if("object"!=typeof n)return"";if(Array.isArray(n))return t.apply(null,n);if(n.toString!==Object.prototype.toString&&!n.toString.toString().includes("[native code]"))return n.toString();var r="";for(var o in n)e.call(n,o)&&n[o]&&(r=i(r,o));return r}function i(e,t){return t?e?e+" "+t:e+t:e}tv.exports?(t.default=t,tv.exports=t):window.classNames=t}()),ev.exports);const iv=e(nv);var rv,ov;var sv,av,lv,uv,cv=function(){if(ov)return rv;ov=1;var e={linear:function(e,t,n,i){return(n-t)*e/i+t},easeInQuad:function(e,t,n,i){return(n-t)*(e/=i)*e+t},easeOutQuad:function(e,t,n,i){return-(n-t)*(e/=i)*(e-2)+t},easeInOutQuad:function(e,t,n,i){var r=n-t;return(e/=i/2)<1?r/2*e*e+t:-r/2*(--e*(e-2)-1)+t},easeInCubic:function(e,t,n,i){return(n-t)*(e/=i)*e*e+t},easeOutCubic:function(e,t,n,i){return(n-t)*((e=e/i-1)*e*e+1)+t},easeInOutCubic:function(e,t,n,i){var r=n-t;return(e/=i/2)<1?r/2*e*e*e+t:r/2*((e-=2)*e*e+2)+t},easeInQuart:function(e,t,n,i){return(n-t)*(e/=i)*e*e*e+t},easeOutQuart:function(e,t,n,i){return-(n-t)*((e=e/i-1)*e*e*e-1)+t},easeInOutQuart:function(e,t,n,i){var r=n-t;return(e/=i/2)<1?r/2*e*e*e*e+t:-r/2*((e-=2)*e*e*e-2)+t},easeInQuint:function(e,t,n,i){return(n-t)*(e/=i)*e*e*e*e+t},easeOutQuint:function(e,t,n,i){return(n-t)*((e=e/i-1)*e*e*e*e+1)+t},easeInOutQuint:function(e,t,n,i){var r=n-t;return(e/=i/2)<1?r/2*e*e*e*e*e+t:r/2*((e-=2)*e*e*e*e+2)+t},easeInSine:function(e,t,n,i){var r=n-t;return-r*Math.cos(e/i*(Math.PI/2))+r+t},easeOutSine:function(e,t,n,i){return(n-t)*Math.sin(e/i*(Math.PI/2))+t},easeInOutSine:function(e,t,n,i){return-(n-t)/2*(Math.cos(Math.PI*e/i)-1)+t},easeInExpo:function(e,t,n,i){return 0==e?t:(n-t)*Math.pow(2,10*(e/i-1))+t},easeOutExpo:function(e,t,n,i){var r=n-t;return e==i?t+r:r*(1-Math.pow(2,-10*e/i))+t},easeInOutExpo:function(e,t,n,i){var r=n-t;return 0===e?t:e===i?t+r:(e/=i/2)<1?r/2*Math.pow(2,10*(e-1))+t:r/2*(2-Math.pow(2,-10*--e))+t},easeInCirc:function(e,t,n,i){return-(n-t)*(Math.sqrt(1-(e/=i)*e)-1)+t},easeOutCirc:function(e,t,n,i){return(n-t)*Math.sqrt(1-(e=e/i-1)*e)+t},easeInOutCirc:function(e,t,n,i){var r=n-t;return(e/=i/2)<1?-r/2*(Math.sqrt(1-e*e)-1)+t:r/2*(Math.sqrt(1-(e-=2)*e)+1)+t},easeInElastic:function(e,t,n,i){var r,o,s,a=n-t;return s=1.70158,0===e?t:1===(e/=i)?t+a:((o=0)||(o=.3*i),(r=a)<Math.abs(a)?(r=a,s=o/4):s=o/(2*Math.PI)*Math.asin(a/r),-r*Math.pow(2,10*(e-=1))*Math.sin((e*i-s)*(2*Math.PI)/o)+t)},easeOutElastic:function(e,t,n,i){var r,o,s,a=n-t;return s=1.70158,0===e?t:1===(e/=i)?t+a:((o=0)||(o=.3*i),(r=a)<Math.abs(a)?(r=a,s=o/4):s=o/(2*Math.PI)*Math.asin(a/r),r*Math.pow(2,-10*e)*Math.sin((e*i-s)*(2*Math.PI)/o)+a+t)},easeInOutElastic:function(e,t,n,i){var r,o,s,a=n-t;return s=1.70158,0===e?t:2==(e/=i/2)?t+a:((o=0)||(o=i*(.3*1.5)),(r=a)<Math.abs(a)?(r=a,s=o/4):s=o/(2*Math.PI)*Math.asin(a/r),e<1?r*Math.pow(2,10*(e-=1))*Math.sin((e*i-s)*(2*Math.PI)/o)*-.5+t:r*Math.pow(2,-10*(e-=1))*Math.sin((e*i-s)*(2*Math.PI)/o)*.5+a+t)},easeInBack:function(e,t,n,i,r){return void 0===r&&(r=1.70158),(n-t)*(e/=i)*e*((r+1)*e-r)+t},easeOutBack:function(e,t,n,i,r){return void 0===r&&(r=1.70158),(n-t)*((e=e/i-1)*e*((r+1)*e+r)+1)+t},easeInOutBack:function(e,t,n,i,r){var o=n-t;return void 0===r&&(r=1.70158),(e/=i/2)<1?o/2*(e*e*((1+(r*=1.525))*e-r))+t:o/2*((e-=2)*e*((1+(r*=1.525))*e+r)+2)+t},easeInBounce:function(t,n,i,r){var o=i-n;return o-e.easeOutBounce(r-t,0,o,r)+n},easeOutBounce:function(e,t,n,i){var r=n-t;return(e/=i)<1/2.75?r*(7.5625*e*e)+t:e<2/2.75?r*(7.5625*(e-=1.5/2.75)*e+.75)+t:e<2.5/2.75?r*(7.5625*(e-=2.25/2.75)*e+.9375)+t:r*(7.5625*(e-=2.625/2.75)*e+.984375)+t},easeInOutBounce:function(t,n,i,r){var o=i-n;return t<r/2?.5*e.easeInBounce(2*t,0,o,r)+n:.5*e.easeOutBounce(2*t-r,0,o,r)+.5*o+n}};return rv=e}();function dv(e,t){return e+Math.random()*(t-e)}(av=sv||(sv={}))[av.Circle=0]="Circle",av[av.Square=1]="Square",av[av.Strip=2]="Strip",(uv=lv||(lv={}))[uv.Positive=1]="Positive",uv[uv.Negative=-1]="Negative";const hv=1e3/60;class pv{constructor(e,t,n,i){this.getOptions=t;const{colors:r,initialVelocityX:o,initialVelocityY:s}=this.getOptions();var a,l;this.context=e,this.x=n,this.y=i,this.w=dv(5,20),this.h=dv(5,20),this.radius=dv(5,10),this.vx="number"==typeof o?dv(-o,o):dv(o.min,o.max),this.vy="number"==typeof s?dv(-s,0):dv(s.min,s.max),this.shape=(a=0,l=2,Math.floor(a+Math.random()*(l-a+1))),this.angle=dv(0,360)*Math.PI/180,this.angularSpin=dv(-.2,.2),this.color=r[Math.floor(Math.random()*r.length)],this.rotateY=dv(0,1),this.rotationDirection=dv(0,1)?lv.Positive:lv.Negative}update(e){const{gravity:t,wind:n,friction:i,opacity:r,drawShape:o}=this.getOptions(),s=e/hv;this.x+=this.vx*s,this.y+=this.vy*s,this.vy+=t*s,this.vx+=n*s,this.vx*=i**s,this.vy*=i**s,this.rotateY>=1&&this.rotationDirection===lv.Positive?this.rotationDirection=lv.Negative:this.rotateY<=-1&&this.rotationDirection===lv.Negative&&(this.rotationDirection=lv.Positive);const a=.1*this.rotationDirection*s;if(this.rotateY+=a,this.angle+=this.angularSpin,this.context.save(),this.context.translate(this.x,this.y),this.context.rotate(this.angle),this.context.scale(1,this.rotateY),this.context.rotate(this.angle),this.context.beginPath(),this.context.fillStyle=this.color,this.context.strokeStyle=this.color,this.context.globalAlpha=r,this.context.lineCap="round",this.context.lineWidth=2,o&&"function"==typeof o)o.call(this,this.context);else switch(this.shape){case sv.Circle:this.context.beginPath(),this.context.arc(0,0,this.radius,0,2*Math.PI),this.context.fill();break;case sv.Square:this.context.fillRect(-this.w/2,-this.h/2,this.w,this.h);break;case sv.Strip:this.context.fillRect(-this.w/6,-this.h/2,this.w/3,this.h)}this.context.closePath(),this.context.restore()}}class fv{constructor(e,t){this.x=0,this.y=0,this.w=0,this.h=0,this.lastNumberOfPieces=0,this.tweenProgress=0,this.tweenFrom=0,this.particles=[],this.particlesGenerated=0,this.removeParticleAt=e=>{this.particles.splice(e,1)},this.getParticle=()=>{const e=dv(this.x,this.w+this.x),t=dv(this.y,this.h+this.y);return new pv(this.context,this.getOptions,e,t)},this.animate=e=>{const{canvas:t,context:n,particlesGenerated:i,lastNumberOfPieces:r}=this,{run:o,recycle:s,numberOfPieces:a,debug:l,tweenFunction:u,tweenDuration:c}=this.getOptions();if(!o)return!1;const d=this.particles.length,h=s?d:i;if(h<a){r!==a&&(this.tweenProgress=0,this.tweenFrom=h,this.lastNumberOfPieces=a),this.tweenProgress=Math.min(c,Math.max(0,this.tweenProgress+e));const t=u(this.tweenProgress,this.tweenFrom,a,c),n=Math.round(t-h);for(let e=0;e<n;e++)this.particles.push(this.getParticle());this.particlesGenerated+=n}l&&(n.font="12px sans-serif",n.fillStyle="#333",n.textAlign="right",n.fillText(`Particles: ${d}`,t.width-10,t.height-20));for(let p=this.particles.length-1;p>=0;p--){const n=this.particles[p];n.update(e),(n.y>t.height||n.y<-100||n.x>t.width+100||n.x<-100)&&(s&&h<=a?this.particles[p]=this.getParticle():this.removeParticleAt(p))}return d>0||h<a},this.canvas=e;const n=this.canvas.getContext("2d");if(!n)throw new Error("Could not get canvas context");this.context=n,this.getOptions=t}}const mv={width:"undefined"!=typeof window?window.innerWidth:300,height:"undefined"!=typeof window?window.innerHeight:200,numberOfPieces:200,friction:.99,wind:0,gravity:.1,initialVelocityX:4,initialVelocityY:10,colors:["#f44336","#e91e63","#9c27b0","#673ab7","#3f51b5","#2196f3","#03a9f4","#00bcd4","#009688","#4CAF50","#8BC34A","#CDDC39","#FFEB3B","#FFC107","#FF9800","#FF5722","#795548"],opacity:1,debug:!1,tweenFunction:cv.easeInOutQuad,tweenDuration:5e3,recycle:!0,run:!0};class gv{constructor(e,t){this.lastFrameTime=0,this.setOptionsWithDefaults=e=>{const t={confettiSource:{x:0,y:0,w:this.canvas.width,h:0}};this._options={...t,...mv,...e},Object.assign(this,e.confettiSource)},this.update=(e=0)=>{const{options:{run:t,onConfettiComplete:n,frameRate:i},canvas:r,context:o}=this,s=Math.min(e-this.lastFrameTime,50);i&&s<1e3/i?this.rafId=requestAnimationFrame(this.update):(this.lastFrameTime=e-(i?s%i:0),t&&(o.fillStyle="white",o.clearRect(0,0,r.width,r.height)),this.generator.animate(s)?this.rafId=requestAnimationFrame(this.update):(n&&"function"==typeof n&&this.generator.particlesGenerated>0&&n.call(this,this),this._options.run=!1))},this.reset=()=>{this.generator&&this.generator.particlesGenerated>0&&(this.generator.particlesGenerated=0,this.generator.particles=[],this.generator.lastNumberOfPieces=0)},this.stop=()=>{this.options={run:!1},this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=void 0)},this.canvas=e;const n=this.canvas.getContext("2d");if(!n)throw new Error("Could not get canvas context");this.context=n,this.generator=new fv(this.canvas,()=>this.options),this.options=t,this.update()}get options(){return this._options}set options(e){var t,n;const i=null==(t=this._options)?void 0:t.run,r=null==(n=this._options)?void 0:n.recycle;this.setOptionsWithDefaults(e),this.generator&&(Object.assign(this.generator,this.options.confettiSource),"boolean"==typeof e.recycle&&e.recycle&&!1===r&&(this.generator.lastNumberOfPieces=this.generator.particles.length)),"boolean"==typeof e.run&&e.run&&!1===i&&this.update()}}const vv=A.createRef();class _v extends A.Component{constructor(e){super(e),this.canvas=A.createRef(),this.canvas=e.canvasRef||vv}componentDidMount(){if(this.canvas.current){const e=yv(this.props)[0];this.confetti=new gv(this.canvas.current,e)}}componentDidUpdate(){const e=yv(this.props)[0];this.confetti&&(this.confetti.options=e)}componentWillUnmount(){this.confetti&&this.confetti.stop(),this.confetti=void 0}render(){const[e,t]=yv(this.props),n={zIndex:2,position:"absolute",pointerEvents:"none",top:0,left:0,bottom:0,right:0,...t.style};return v.jsx("canvas",{width:e.width,height:e.height,ref:this.canvas,...t,style:n})}}function yv(e){const t={},n={},i=[...Object.keys(mv),"confettiSource","drawShape","onConfettiComplete","frameRate"],r=["canvasRef"];for(const o in e){const s=e[o];i.includes(o)?t[o]=s:r.includes(o)?r[o]=s:n[o]=s}return[t,n,{}]}_v.defaultProps={...mv},_v.displayName="ReactConfetti";const xv=A.forwardRef((e,t)=>v.jsx(_v,{canvasRef:t,...e}));var Sv={},Ev=function(e,t){return(Ev=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function bv(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}Ev(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var Tv=function(){return Tv=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},Tv.apply(this,arguments)};function wv(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}function Mv(e,t,n,i){var r,o=arguments.length,s=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,n,s):r(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}function Av(e,t){return function(n,i){t(n,i,e)}}function Rv(e,t,n,i,r,o){function s(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var a,l=i.kind,u="getter"===l?"get":"setter"===l?"set":"value",c=!t&&e?i.static?e:e.prototype:null,d=t||(c?Object.getOwnPropertyDescriptor(c,i.name):{}),h=!1,p=n.length-1;p>=0;p--){var f={};for(var m in i)f[m]="access"===m?{}:i[m];for(var m in i.access)f.access[m]=i.access[m];f.addInitializer=function(e){if(h)throw new TypeError("Cannot add initializers after decoration has completed");o.push(s(e||null))};var g=(0,n[p])("accessor"===l?{get:d.get,set:d.set}:d[u],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(a=s(g.get))&&(d.get=a),(a=s(g.set))&&(d.set=a),(a=s(g.init))&&r.unshift(a)}else(a=s(g))&&("field"===l?r.unshift(a):d[u]=a)}c&&Object.defineProperty(c,i.name,d),h=!0}function Cv(e,t,n){for(var i=arguments.length>2,r=0;r<t.length;r++)n=i?t[r].call(e,n):t[r].call(e);return i?n:void 0}function Iv(e){return"symbol"==typeof e?e:"".concat(e)}function Pv(e,t,n){return"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:n?"".concat(n," ",t):t})}function Ov(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function Nv(e,t,n,i){return new(n||(n=Promise))(function(r,o){function s(e){try{l(i.next(e))}catch(BM){o(BM)}}function a(e){try{l(i.throw(e))}catch(BM){o(BM)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}l((i=i.apply(e,t||[])).next())})}function Lv(e,t){var n,i,r,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(BM){a=[6,BM],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}}var Dv=Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]};function Uv(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||Dv(t,e,n)}function kv(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Fv(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)s.push(i.value)}catch(a){r={error:a}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return s}function Bv(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Fv(arguments[t]));return e}function Hv(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),r=0;for(t=0;t<n;t++)for(var o=arguments[t],s=0,a=o.length;s<a;s++,r++)i[r]=o[s];return i}function Vv(e,t,n){if(n||2===arguments.length)for(var i,r=0,o=t.length;r<o;r++)!i&&r in t||(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||Array.prototype.slice.call(t))}function zv(e){return this instanceof zv?(this.v=e,this):new zv(e)}function Gv(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,r=n.apply(e,t||[]),o=[];return i=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),s("next"),s("throw"),s("return",function(e){return function(t){return Promise.resolve(t).then(e,u)}}),i[Symbol.asyncIterator]=function(){return this},i;function s(e,t){r[e]&&(i[e]=function(t){return new Promise(function(n,i){o.push([e,t,n,i])>1||a(e,t)})},t&&(i[e]=t(i[e])))}function a(e,t){try{(n=r[e](t)).value instanceof zv?Promise.resolve(n.value.v).then(l,u):c(o[0][2],n)}catch(BM){c(o[0][3],BM)}var n}function l(e){a("next",e)}function u(e){a("throw",e)}function c(e,t){e(t),o.shift(),o.length&&a(o[0][0],o[0][1])}}function Wv(e){var t,n;return t={},i("next"),i("throw",function(e){throw e}),i("return"),t[Symbol.iterator]=function(){return this},t;function i(i,r){t[i]=e[i]?function(t){return(n=!n)?{value:zv(e[i](t)),done:!1}:r?r(t):t}:r}}function jv(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=kv(e),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=e[n]&&function(t){return new Promise(function(i,r){(function(e,t,n,i){Promise.resolve(i).then(function(t){e({value:t,done:n})},t)})(i,r,(t=e[n](t)).done,t.value)})}}}function qv(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var Xv=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},Yv=function(e){return(Yv=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t})(e)};function Kv(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=Yv(e),i=0;i<n.length;i++)"default"!==n[i]&&Dv(t,e,n[i]);return Xv(t,e),t}function Jv(e){return e&&e.__esModule?e:{default:e}}function $v(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)}function Zv(e,t,n,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(e,n):r?r.value=n:t.set(e,n),n}function Qv(e,t){if(null===t||"object"!=typeof t&&"function"!=typeof t)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof e?t===e:e.has(t)}function e_(e,t,n){if(null!=t){if("object"!=typeof t&&"function"!=typeof t)throw new TypeError("Object expected.");var i,r;if(n){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");i=t[Symbol.asyncDispose]}if(void 0===i){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");i=t[Symbol.dispose],n&&(r=i)}if("function"!=typeof i)throw new TypeError("Object not disposable.");r&&(i=function(){try{r.call(this)}catch(BM){return Promise.reject(BM)}}),e.stack.push({value:t,dispose:i,async:n})}else n&&e.stack.push({async:!0});return t}var t_="function"==typeof SuppressedError?SuppressedError:function(e,t,n){var i=new Error(n);return i.name="SuppressedError",i.error=e,i.suppressed=t,i};function n_(e){function t(t){e.error=e.hasError?new t_(t,e.error,"An error was suppressed during disposal."):t,e.hasError=!0}var n,i=0;return function r(){for(;n=e.stack.pop();)try{if(!n.async&&1===i)return i=0,e.stack.push(n),Promise.resolve().then(r);if(n.dispose){var o=n.dispose.call(n.value);if(n.async)return i|=2,Promise.resolve(o).then(r,function(e){return t(e),r()})}else i|=1}catch(BM){t(BM)}if(1===i)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}()}function i_(e,t){return"string"==typeof e&&/^\.\.?\//.test(e)?e.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(e,n,i,r,o){return n?t?".jsx":".js":!i||r&&o?i+r+"."+o.toLowerCase()+"js":e}):e}const r_={__extends:bv,__assign:Tv,__rest:wv,__decorate:Mv,__param:Av,__esDecorate:Rv,__runInitializers:Cv,__propKey:Iv,__setFunctionName:Pv,__metadata:Ov,__awaiter:Nv,__generator:Lv,__createBinding:Dv,__exportStar:Uv,__values:kv,__read:Fv,__spread:Bv,__spreadArrays:Hv,__spreadArray:Vv,__await:zv,__asyncGenerator:Gv,__asyncDelegator:Wv,__asyncValues:jv,__makeTemplateObject:qv,__importStar:Kv,__importDefault:Jv,__classPrivateFieldGet:$v,__classPrivateFieldSet:Zv,__classPrivateFieldIn:Qv,__addDisposableResource:e_,__disposeResources:n_,__rewriteRelativeImportExtension:i_},o_=t(Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:e_,get __assign(){return Tv},__asyncDelegator:Wv,__asyncGenerator:Gv,__asyncValues:jv,__await:zv,__awaiter:Nv,__classPrivateFieldGet:$v,__classPrivateFieldIn:Qv,__classPrivateFieldSet:Zv,__createBinding:Dv,__decorate:Mv,__disposeResources:n_,__esDecorate:Rv,__exportStar:Uv,__extends:bv,__generator:Lv,__importDefault:Jv,__importStar:Kv,__makeTemplateObject:qv,__metadata:Ov,__param:Av,__propKey:Iv,__read:Fv,__rest:wv,__rewriteRelativeImportExtension:i_,__runInitializers:Cv,__setFunctionName:Pv,__spread:Bv,__spreadArray:Vv,__spreadArrays:Hv,__values:kv,default:r_},Symbol.toStringTag,{value:"Module"})));var s_,a_,l_,u_={},c_={},d_={};function h_(){if(s_)return d_;s_=1,Object.defineProperty(d_,"__esModule",{value:!0});var e=d();return d_.default=function(t){e.useEffect(t,[])},d_}function p_(){if(a_)return c_;a_=1,Object.defineProperty(c_,"__esModule",{value:!0});var e=o_,t=d(),n=e.__importDefault(h_());return c_.default=function(e){var i=t.useRef(e);i.current=e,n.default(function(){return function(){return i.current()}})},c_}function f_(){if(l_)return u_;l_=1,Object.defineProperty(u_,"__esModule",{value:!0});var e=o_,t=d(),n=e.__importDefault(p_());return u_.default=function(e){var i=t.useRef(0),r=t.useState(e),o=r[0],s=r[1],a=t.useCallback(function(e){cancelAnimationFrame(i.current),i.current=requestAnimationFrame(function(){s(e)})},[]);return n.default(function(){cancelAnimationFrame(i.current)}),[o,a]},u_}var m_,g_,v_={};function __(){if(m_)return v_;m_=1,Object.defineProperty(v_,"__esModule",{value:!0}),v_.isNavigator=v_.isBrowser=v_.off=v_.on=v_.noop=void 0;return v_.noop=function(){},v_.on=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];e&&e.addEventListener&&e.addEventListener.apply(e,t)},v_.off=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];e&&e.removeEventListener&&e.removeEventListener.apply(e,t)},v_.isBrowser="undefined"!=typeof window,v_.isNavigator="undefined"!=typeof navigator,v_}function y_(){if(g_)return Sv;g_=1,Object.defineProperty(Sv,"__esModule",{value:!0});var e=o_,t=d(),n=e.__importDefault(f_()),i=__();return Sv.default=function(e){var r=void 0===e?{}:e,o=r.initialWidth,s=void 0===o?1/0:o,a=r.initialHeight,l=void 0===a?1/0:a,u=r.onChange,c=n.default({width:i.isBrowser?window.innerWidth:s,height:i.isBrowser?window.innerHeight:l}),d=c[0],h=c[1];return t.useEffect(function(){if(i.isBrowser){var e=function(){var e=window.innerWidth,t=window.innerHeight;h({width:e,height:t}),u&&u(e,t)};return i.on(window,"resize",e),function(){i.off(window,"resize",e)}}},[]),d},Sv}const x_=e(y_());var S_,E_={};var b_=function(){if(S_)return E_;function e(e){var t=Object.create(null);return e&&Object.keys(e).forEach(function(n){if("default"!==n){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}}),t.default=e,Object.freeze(t)}S_=1,Object.defineProperty(E_,"__esModule",{value:!0});var t=e(d()),n=function(){return n=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},n.apply(this,arguments)};return"function"==typeof SuppressedError&&SuppressedError,E_.default=function(e){var i,r=e.bgColor,o=void 0===r?"#6a1b9a":r,s=e.height,a=void 0===s?"20px":s,l=e.width,u=void 0===l?"100%":l,c=e.borderRadius,d=void 0===c?"50px":c,h=e.labelAlignment,p=void 0===h?"right":h,f=e.baseBgColor,m=void 0===f?"#e0e0de":f,g=e.labelColor,v=void 0===g?"#fff":g,_=e.labelSize,y=void 0===_?"15px":_,x=e.isLabelVisible,S=void 0===x||x,E=e.dir,b=void 0===E?"ltr":E,T=e.ariaValuemin,w=void 0===T?0:T,M=e.ariaValuemax,A=void 0===M?100:M,R=e.ariaValuetext,C=void 0===R?null:R,I=e.maxCompleted,P=void 0===I?100:I,O=e.animateOnRender,N=void 0!==O&&O,L=e.initCompletedOnAnimation,D=void 0===L?0:L,U=e.isIndeterminate,k=void 0!==U&&U,F=e.completed,B=e.margin,H=e.padding,V=e.customLabelStyles,z=e.transitionDuration,G=e.transitionTimingFunction,W=e.className,j=e.customLabel,q=e.barContainerClassName,X=e.completedClassName,Y=e.labelClassName,K="left"===(i=p)?"flex-start":"center"===i?"center":"right"===i?"flex-end":null,J="number"==typeof D?"".concat(D,"%"):D,$=function(e,t){if(e){var n=Number(t)/e;return n>1?"100%":"".concat(100*n,"%")}return J}(P,F),Z=t.useState(J),Q=Z[0],ee=Z[1],te={height:a,background:m,borderRadius:d,padding:H,width:u,margin:B,overflow:"hidden"},ne={height:a,width:k?"100%":N?Q:$,background:o,transition:k?"none":"width ".concat(z||"1s"," ").concat(G||"ease-in-out"),borderRadius:"inherit",display:"flex",alignItems:"center",justifyContent:"outside"!==p&&K?K:"normal",animation:k?"indeterminate 1.5s infinite linear":"none"},ie=n({padding:"outside"===p?"0 0 0 5px":"5px",color:v,fontWeight:"bold",fontSize:y,display:S?"initial":"none"},V),re={display:"outside"===p?"flex":"initial",alignItems:"outside"===p?"center":"initial"},oe="number"==typeof F?"".concat(F,"%"):"".concat(F),se=j||oe;return t.useEffect(function(){N&&!k&&requestAnimationFrame(function(){return ee($)})},[$,N,k]),t.createElement("div",{style:W?void 0:re,className:W,dir:b,role:"progressbar","aria-valuenow":k?void 0:parseFloat(se),"aria-valuemin":w,"aria-valuemax":A,"aria-valuetext":"".concat(null===C?se:C)},t.createElement("div",{style:q?void 0:te,className:q},t.createElement("div",{style:X?void 0:ne,className:X},"outside"!==p&&t.createElement("span",{style:Y?void 0:ie,className:Y},se))),"outside"===p&&t.createElement("span",{style:Y?void 0:ie,className:Y},se),t.createElement("style",null,"\n          @keyframes indeterminate {\n            0% {\n              width: 30%;\n              transform: translateX(-50%);\n            }\n            50% {\n              width: 30%;\n              transform: translateX(250%);\n            }\n            100% {\n              width: 30%;\n              transform: translateX(-50%);\n            }\n          }\n        "))},E_}();const T_=e(b_),{entries:w_,setPrototypeOf:M_,isFrozen:A_,getPrototypeOf:R_,getOwnPropertyDescriptor:C_}=Object;let{freeze:I_,seal:P_,create:O_}=Object,{apply:N_,construct:L_}="undefined"!=typeof Reflect&&Reflect;I_||(I_=function(e){return e}),P_||(P_=function(e){return e}),N_||(N_=function(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return e.apply(t,i)}),L_||(L_=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return new e(...n)});const D_=J_(Array.prototype.forEach),U_=J_(Array.prototype.lastIndexOf),k_=J_(Array.prototype.pop),F_=J_(Array.prototype.push),B_=J_(Array.prototype.splice),H_=J_(String.prototype.toLowerCase),V_=J_(String.prototype.toString),z_=J_(String.prototype.match),G_=J_(String.prototype.replace),W_=J_(String.prototype.indexOf),j_=J_(String.prototype.trim),q_=J_(Object.prototype.hasOwnProperty),X_=J_(RegExp.prototype.test),Y_=(K_=TypeError,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return L_(K_,t)});var K_;function J_(e){return function(t){t instanceof RegExp&&(t.lastIndex=0);for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return N_(e,t,i)}}function $_(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:H_;M_&&M_(e,null);let i=t.length;for(;i--;){let r=t[i];if("string"==typeof r){const e=n(r);e!==r&&(A_(t)||(t[i]=e),r=e)}e[r]=!0}return e}function Z_(e){for(let t=0;t<e.length;t++){q_(e,t)||(e[t]=null)}return e}function Q_(e){const t=O_(null);for(const[n,i]of w_(e)){q_(e,n)&&(Array.isArray(i)?t[n]=Z_(i):i&&"object"==typeof i&&i.constructor===Object?t[n]=Q_(i):t[n]=i)}return t}function ey(e,t){for(;null!==e;){const n=C_(e,t);if(n){if(n.get)return J_(n.get);if("function"==typeof n.value)return J_(n.value)}e=R_(e)}return function(){return null}}const ty=I_(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),ny=I_(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),iy=I_(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),ry=I_(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),oy=I_(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),sy=I_(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),ay=I_(["#text"]),ly=I_(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),uy=I_(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),cy=I_(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),dy=I_(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),hy=P_(/\{\{[\w\W]*|[\w\W]*\}\}/gm),py=P_(/<%[\w\W]*|[\w\W]*%>/gm),fy=P_(/\$\{[\w\W]*/gm),my=P_(/^data-[\-\w.\u00B7-\uFFFF]+$/),gy=P_(/^aria-[\-\w]+$/),vy=P_(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),_y=P_(/^(?:\w+script|data):/i),yy=P_(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),xy=P_(/^html$/i),Sy=P_(/^[a-z][.\w]*(-[.\w]+)+$/i);var Ey=Object.freeze({__proto__:null,ARIA_ATTR:gy,ATTR_WHITESPACE:yy,CUSTOM_ELEMENT:Sy,DATA_ATTR:my,DOCTYPE_NAME:xy,ERB_EXPR:py,IS_ALLOWED_URI:vy,IS_SCRIPT_OR_DATA:_y,MUSTACHE_EXPR:hy,TMPLIT_EXPR:fy});const by=1,Ty=3,wy=7,My=8,Ay=9;var Ry=function e(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"undefined"==typeof window?null:window;const n=t=>e(t);if(n.version="3.3.1",n.removed=[],!t||!t.document||t.document.nodeType!==Ay||!t.Element)return n.isSupported=!1,n;let{document:i}=t;const r=i,o=r.currentScript,{DocumentFragment:s,HTMLTemplateElement:a,Node:l,Element:u,NodeFilter:c,NamedNodeMap:d=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:h,DOMParser:p,trustedTypes:f}=t,m=u.prototype,g=ey(m,"cloneNode"),v=ey(m,"remove"),_=ey(m,"nextSibling"),y=ey(m,"childNodes"),x=ey(m,"parentNode");if("function"==typeof a){const e=i.createElement("template");e.content&&e.content.ownerDocument&&(i=e.content.ownerDocument)}let S,E="";const{implementation:b,createNodeIterator:T,createDocumentFragment:w,getElementsByTagName:M}=i,{importNode:A}=r;let R={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]};n.isSupported="function"==typeof w_&&"function"==typeof x&&b&&void 0!==b.createHTMLDocument;const{MUSTACHE_EXPR:C,ERB_EXPR:I,TMPLIT_EXPR:P,DATA_ATTR:O,ARIA_ATTR:N,IS_SCRIPT_OR_DATA:L,ATTR_WHITESPACE:D,CUSTOM_ELEMENT:U}=Ey;let{IS_ALLOWED_URI:k}=Ey,F=null;const B=$_({},[...ty,...ny,...iy,...oy,...ay]);let H=null;const V=$_({},[...ly,...uy,...cy,...dy]);let z=Object.seal(O_(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),G=null,W=null;const j=Object.seal(O_(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let q=!0,X=!0,Y=!1,K=!0,J=!1,$=!0,Z=!1,Q=!1,ee=!1,te=!1,ne=!1,ie=!1,re=!0,oe=!1,se=!0,ae=!1,le={},ue=null;const ce=$_({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let de=null;const he=$_({},["audio","video","img","source","image","track"]);let pe=null;const fe=$_({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),me="http://www.w3.org/1998/Math/MathML",ge="http://www.w3.org/2000/svg",ve="http://www.w3.org/1999/xhtml";let _e=ve,ye=!1,xe=null;const Se=$_({},[me,ge,ve],V_);let Ee=$_({},["mi","mo","mn","ms","mtext"]),be=$_({},["annotation-xml"]);const Te=$_({},["title","style","font","a","script"]);let we=null;const Me=["application/xhtml+xml","text/html"];let Ae=null,Re=null;const Ce=i.createElement("form"),Ie=function(e){return e instanceof RegExp||e instanceof Function},Pe=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!Re||Re!==e){if(e&&"object"==typeof e||(e={}),e=Q_(e),we=-1===Me.indexOf(e.PARSER_MEDIA_TYPE)?"text/html":e.PARSER_MEDIA_TYPE,Ae="application/xhtml+xml"===we?V_:H_,F=q_(e,"ALLOWED_TAGS")?$_({},e.ALLOWED_TAGS,Ae):B,H=q_(e,"ALLOWED_ATTR")?$_({},e.ALLOWED_ATTR,Ae):V,xe=q_(e,"ALLOWED_NAMESPACES")?$_({},e.ALLOWED_NAMESPACES,V_):Se,pe=q_(e,"ADD_URI_SAFE_ATTR")?$_(Q_(fe),e.ADD_URI_SAFE_ATTR,Ae):fe,de=q_(e,"ADD_DATA_URI_TAGS")?$_(Q_(he),e.ADD_DATA_URI_TAGS,Ae):he,ue=q_(e,"FORBID_CONTENTS")?$_({},e.FORBID_CONTENTS,Ae):ce,G=q_(e,"FORBID_TAGS")?$_({},e.FORBID_TAGS,Ae):Q_({}),W=q_(e,"FORBID_ATTR")?$_({},e.FORBID_ATTR,Ae):Q_({}),le=!!q_(e,"USE_PROFILES")&&e.USE_PROFILES,q=!1!==e.ALLOW_ARIA_ATTR,X=!1!==e.ALLOW_DATA_ATTR,Y=e.ALLOW_UNKNOWN_PROTOCOLS||!1,K=!1!==e.ALLOW_SELF_CLOSE_IN_ATTR,J=e.SAFE_FOR_TEMPLATES||!1,$=!1!==e.SAFE_FOR_XML,Z=e.WHOLE_DOCUMENT||!1,te=e.RETURN_DOM||!1,ne=e.RETURN_DOM_FRAGMENT||!1,ie=e.RETURN_TRUSTED_TYPE||!1,ee=e.FORCE_BODY||!1,re=!1!==e.SANITIZE_DOM,oe=e.SANITIZE_NAMED_PROPS||!1,se=!1!==e.KEEP_CONTENT,ae=e.IN_PLACE||!1,k=e.ALLOWED_URI_REGEXP||vy,_e=e.NAMESPACE||ve,Ee=e.MATHML_TEXT_INTEGRATION_POINTS||Ee,be=e.HTML_INTEGRATION_POINTS||be,z=e.CUSTOM_ELEMENT_HANDLING||{},e.CUSTOM_ELEMENT_HANDLING&&Ie(e.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(z.tagNameCheck=e.CUSTOM_ELEMENT_HANDLING.tagNameCheck),e.CUSTOM_ELEMENT_HANDLING&&Ie(e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(z.attributeNameCheck=e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),e.CUSTOM_ELEMENT_HANDLING&&"boolean"==typeof e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(z.allowCustomizedBuiltInElements=e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),J&&(X=!1),ne&&(te=!0),le&&(F=$_({},ay),H=[],!0===le.html&&($_(F,ty),$_(H,ly)),!0===le.svg&&($_(F,ny),$_(H,uy),$_(H,dy)),!0===le.svgFilters&&($_(F,iy),$_(H,uy),$_(H,dy)),!0===le.mathMl&&($_(F,oy),$_(H,cy),$_(H,dy))),e.ADD_TAGS&&("function"==typeof e.ADD_TAGS?j.tagCheck=e.ADD_TAGS:(F===B&&(F=Q_(F)),$_(F,e.ADD_TAGS,Ae))),e.ADD_ATTR&&("function"==typeof e.ADD_ATTR?j.attributeCheck=e.ADD_ATTR:(H===V&&(H=Q_(H)),$_(H,e.ADD_ATTR,Ae))),e.ADD_URI_SAFE_ATTR&&$_(pe,e.ADD_URI_SAFE_ATTR,Ae),e.FORBID_CONTENTS&&(ue===ce&&(ue=Q_(ue)),$_(ue,e.FORBID_CONTENTS,Ae)),e.ADD_FORBID_CONTENTS&&(ue===ce&&(ue=Q_(ue)),$_(ue,e.ADD_FORBID_CONTENTS,Ae)),se&&(F["#text"]=!0),Z&&$_(F,["html","head","body"]),F.table&&($_(F,["tbody"]),delete G.tbody),e.TRUSTED_TYPES_POLICY){if("function"!=typeof e.TRUSTED_TYPES_POLICY.createHTML)throw Y_('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if("function"!=typeof e.TRUSTED_TYPES_POLICY.createScriptURL)throw Y_('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');S=e.TRUSTED_TYPES_POLICY,E=S.createHTML("")}else void 0===S&&(S=function(e,t){if("object"!=typeof e||"function"!=typeof e.createPolicy)return null;let n=null;const i="data-tt-policy-suffix";t&&t.hasAttribute(i)&&(n=t.getAttribute(i));const r="dompurify"+(n?"#"+n:"");try{return e.createPolicy(r,{createHTML:e=>e,createScriptURL:e=>e})}catch(o){return console.warn("TrustedTypes policy "+r+" could not be created."),null}}(f,o)),null!==S&&"string"==typeof E&&(E=S.createHTML(""));I_&&I_(e),Re=e}},Oe=$_({},[...ny,...iy,...ry]),Ne=$_({},[...oy,...sy]),Le=function(e){F_(n.removed,{element:e});try{x(e).removeChild(e)}catch(t){v(e)}},De=function(e,t){try{F_(n.removed,{attribute:t.getAttributeNode(e),from:t})}catch(i){F_(n.removed,{attribute:null,from:t})}if(t.removeAttribute(e),"is"===e)if(te||ne)try{Le(t)}catch(i){}else try{t.setAttribute(e,"")}catch(i){}},Ue=function(e){let t=null,n=null;if(ee)e="<remove></remove>"+e;else{const t=z_(e,/^[\r\n\t ]+/);n=t&&t[0]}"application/xhtml+xml"===we&&_e===ve&&(e='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+e+"</body></html>");const r=S?S.createHTML(e):e;if(_e===ve)try{t=(new p).parseFromString(r,we)}catch(s){}if(!t||!t.documentElement){t=b.createDocument(_e,"template",null);try{t.documentElement.innerHTML=ye?E:r}catch(s){}}const o=t.body||t.documentElement;return e&&n&&o.insertBefore(i.createTextNode(n),o.childNodes[0]||null),_e===ve?M.call(t,Z?"html":"body")[0]:Z?t.documentElement:o},ke=function(e){return T.call(e.ownerDocument||e,e,c.SHOW_ELEMENT|c.SHOW_COMMENT|c.SHOW_TEXT|c.SHOW_PROCESSING_INSTRUCTION|c.SHOW_CDATA_SECTION,null)},Fe=function(e){return e instanceof h&&("string"!=typeof e.nodeName||"string"!=typeof e.textContent||"function"!=typeof e.removeChild||!(e.attributes instanceof d)||"function"!=typeof e.removeAttribute||"function"!=typeof e.setAttribute||"string"!=typeof e.namespaceURI||"function"!=typeof e.insertBefore||"function"!=typeof e.hasChildNodes)},Be=function(e){return"function"==typeof l&&e instanceof l};function He(e,t,i){D_(e,e=>{e.call(n,t,i,Re)})}const Ve=function(e){let t=null;if(He(R.beforeSanitizeElements,e,null),Fe(e))return Le(e),!0;const i=Ae(e.nodeName);if(He(R.uponSanitizeElement,e,{tagName:i,allowedTags:F}),$&&e.hasChildNodes()&&!Be(e.firstElementChild)&&X_(/<[/\w!]/g,e.innerHTML)&&X_(/<[/\w!]/g,e.textContent))return Le(e),!0;if(e.nodeType===wy)return Le(e),!0;if($&&e.nodeType===My&&X_(/<[/\w]/g,e.data))return Le(e),!0;if(!(j.tagCheck instanceof Function&&j.tagCheck(i))&&(!F[i]||G[i])){if(!G[i]&&Ge(i)){if(z.tagNameCheck instanceof RegExp&&X_(z.tagNameCheck,i))return!1;if(z.tagNameCheck instanceof Function&&z.tagNameCheck(i))return!1}if(se&&!ue[i]){const t=x(e)||e.parentNode,n=y(e)||e.childNodes;if(n&&t){for(let i=n.length-1;i>=0;--i){const r=g(n[i],!0);r.__removalCount=(e.__removalCount||0)+1,t.insertBefore(r,_(e))}}}return Le(e),!0}return e instanceof u&&!function(e){let t=x(e);t&&t.tagName||(t={namespaceURI:_e,tagName:"template"});const n=H_(e.tagName),i=H_(t.tagName);return!!xe[e.namespaceURI]&&(e.namespaceURI===ge?t.namespaceURI===ve?"svg"===n:t.namespaceURI===me?"svg"===n&&("annotation-xml"===i||Ee[i]):Boolean(Oe[n]):e.namespaceURI===me?t.namespaceURI===ve?"math"===n:t.namespaceURI===ge?"math"===n&&be[i]:Boolean(Ne[n]):e.namespaceURI===ve?!(t.namespaceURI===ge&&!be[i])&&!(t.namespaceURI===me&&!Ee[i])&&!Ne[n]&&(Te[n]||!Oe[n]):!("application/xhtml+xml"!==we||!xe[e.namespaceURI]))}(e)?(Le(e),!0):"noscript"!==i&&"noembed"!==i&&"noframes"!==i||!X_(/<\/no(script|embed|frames)/i,e.innerHTML)?(J&&e.nodeType===Ty&&(t=e.textContent,D_([C,I,P],e=>{t=G_(t,e," ")}),e.textContent!==t&&(F_(n.removed,{element:e.cloneNode()}),e.textContent=t)),He(R.afterSanitizeElements,e,null),!1):(Le(e),!0)},ze=function(e,t,n){if(re&&("id"===t||"name"===t)&&(n in i||n in Ce))return!1;if(X&&!W[t]&&X_(O,t));else if(q&&X_(N,t));else if(j.attributeCheck instanceof Function&&j.attributeCheck(t,e));else if(!H[t]||W[t]){if(!(Ge(e)&&(z.tagNameCheck instanceof RegExp&&X_(z.tagNameCheck,e)||z.tagNameCheck instanceof Function&&z.tagNameCheck(e))&&(z.attributeNameCheck instanceof RegExp&&X_(z.attributeNameCheck,t)||z.attributeNameCheck instanceof Function&&z.attributeNameCheck(t,e))||"is"===t&&z.allowCustomizedBuiltInElements&&(z.tagNameCheck instanceof RegExp&&X_(z.tagNameCheck,n)||z.tagNameCheck instanceof Function&&z.tagNameCheck(n))))return!1}else if(pe[t]);else if(X_(k,G_(n,D,"")));else if("src"!==t&&"xlink:href"!==t&&"href"!==t||"script"===e||0!==W_(n,"data:")||!de[e]){if(Y&&!X_(L,G_(n,D,"")));else if(n)return!1}else;return!0},Ge=function(e){return"annotation-xml"!==e&&z_(e,U)},We=function(e){He(R.beforeSanitizeAttributes,e,null);const{attributes:t}=e;if(!t||Fe(e))return;const i={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:H,forceKeepAttr:void 0};let r=t.length;for(;r--;){const s=t[r],{name:a,namespaceURI:l,value:u}=s,c=Ae(a),d=u;let h="value"===a?d:j_(d);if(i.attrName=c,i.attrValue=h,i.keepAttr=!0,i.forceKeepAttr=void 0,He(R.uponSanitizeAttribute,e,i),h=i.attrValue,!oe||"id"!==c&&"name"!==c||(De(a,e),h="user-content-"+h),$&&X_(/((--!?|])>)|<\/(style|title|textarea)/i,h)){De(a,e);continue}if("attributename"===c&&z_(h,"href")){De(a,e);continue}if(i.forceKeepAttr)continue;if(!i.keepAttr){De(a,e);continue}if(!K&&X_(/\/>/i,h)){De(a,e);continue}J&&D_([C,I,P],e=>{h=G_(h,e," ")});const p=Ae(e.nodeName);if(ze(p,c,h)){if(S&&"object"==typeof f&&"function"==typeof f.getAttributeType)if(l);else switch(f.getAttributeType(p,c)){case"TrustedHTML":h=S.createHTML(h);break;case"TrustedScriptURL":h=S.createScriptURL(h)}if(h!==d)try{l?e.setAttributeNS(l,a,h):e.setAttribute(a,h),Fe(e)?Le(e):k_(n.removed)}catch(o){De(a,e)}}else De(a,e)}He(R.afterSanitizeAttributes,e,null)},je=function e(t){let n=null;const i=ke(t);for(He(R.beforeSanitizeShadowDOM,t,null);n=i.nextNode();)He(R.uponSanitizeShadowNode,n,null),Ve(n),We(n),n.content instanceof s&&e(n.content);He(R.afterSanitizeShadowDOM,t,null)};return n.sanitize=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=null,o=null,a=null,u=null;if(ye=!e,ye&&(e="\x3c!--\x3e"),"string"!=typeof e&&!Be(e)){if("function"!=typeof e.toString)throw Y_("toString is not a function");if("string"!=typeof(e=e.toString()))throw Y_("dirty is not a string, aborting")}if(!n.isSupported)return e;if(Q||Pe(t),n.removed=[],"string"==typeof e&&(ae=!1),ae){if(e.nodeName){const t=Ae(e.nodeName);if(!F[t]||G[t])throw Y_("root node is forbidden and cannot be sanitized in-place")}}else if(e instanceof l)i=Ue("\x3c!----\x3e"),o=i.ownerDocument.importNode(e,!0),o.nodeType===by&&"BODY"===o.nodeName||"HTML"===o.nodeName?i=o:i.appendChild(o);else{if(!te&&!J&&!Z&&-1===e.indexOf("<"))return S&&ie?S.createHTML(e):e;if(i=Ue(e),!i)return te?null:ie?E:""}i&&ee&&Le(i.firstChild);const c=ke(ae?e:i);for(;a=c.nextNode();)Ve(a),We(a),a.content instanceof s&&je(a.content);if(ae)return e;if(te){if(ne)for(u=w.call(i.ownerDocument);i.firstChild;)u.appendChild(i.firstChild);else u=i;return(H.shadowroot||H.shadowrootmode)&&(u=A.call(r,u,!0)),u}let d=Z?i.outerHTML:i.innerHTML;return Z&&F["!doctype"]&&i.ownerDocument&&i.ownerDocument.doctype&&i.ownerDocument.doctype.name&&X_(xy,i.ownerDocument.doctype.name)&&(d="<!DOCTYPE "+i.ownerDocument.doctype.name+">\n"+d),J&&D_([C,I,P],e=>{d=G_(d,e," ")}),S&&ie?S.createHTML(d):d},n.setConfig=function(){Pe(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),Q=!0},n.clearConfig=function(){Re=null,Q=!1},n.isValidAttribute=function(e,t,n){Re||Pe({});const i=Ae(e),r=Ae(t);return ze(i,r,n)},n.addHook=function(e,t){"function"==typeof t&&F_(R[e],t)},n.removeHook=function(e,t){if(void 0!==t){const n=U_(R[e],t);return-1===n?void 0:B_(R[e],n,1)[0]}return k_(R[e])},n.removeHooks=function(e){R[e]=[]},n.removeAllHooks=function(){R={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}},n}(),Cy={};let Iy,Py;function Oy(e,t,n,i){var r,o;if(!(null==e?void 0:e.baseUrl)){const e={geminiUrl:Iy,vertexUrl:Py};return t?null!==(r=e.vertexUrl)&&void 0!==r?r:n:null!==(o=e.geminiUrl)&&void 0!==o?o:i}return e.baseUrl}class Ny{}function Ly(e,t){return e.replace(/\{([^}]+)\}/g,(e,n)=>{if(Object.prototype.hasOwnProperty.call(t,n)){const e=t[n];return null!=e?String(e):""}throw new Error(`Key '${n}' not found in valueMap.`)})}function Dy(e,t,n){for(let o=0;o<t.length-1;o++){const i=t[o];if(i.endsWith("[]")){const r=i.slice(0,-2);if(!(r in e)){if(!Array.isArray(n))throw new Error(`Value must be a list given an array path ${i}`);e[r]=Array.from({length:n.length},()=>({}))}if(Array.isArray(e[r])){const i=e[r];if(Array.isArray(n))for(let e=0;e<i.length;e++){Dy(i[e],t.slice(o+1),n[e])}else for(const e of i)Dy(e,t.slice(o+1),n)}return}if(i.endsWith("[0]")){const r=i.slice(0,-3);r in e||(e[r]=[{}]);return void Dy(e[r][0],t.slice(o+1),n)}e[i]&&"object"==typeof e[i]||(e[i]={}),e=e[i]}const i=t[t.length-1],r=e[i];if(void 0!==r){if(!n||"object"==typeof n&&0===Object.keys(n).length)return;if(n===r)return;if("object"!=typeof r||"object"!=typeof n||null===r||null===n)throw new Error(`Cannot set value for an existing key. Key: ${i}`);Object.assign(r,n)}else if("_self"!==i||"object"!=typeof n||null===n||Array.isArray(n))e[i]=n;else{const t=n;Object.assign(e,t)}}function Uy(e,t,n=void 0){try{if(1===t.length&&"_self"===t[0])return e;for(let i=0;i<t.length;i++){if("object"!=typeof e||null===e)return n;const r=t[i];if(r.endsWith("[]")){const o=r.slice(0,-2);if(o in e){const r=e[o];return Array.isArray(r)?r.map(e=>Uy(e,t.slice(i+1),n)):n}return n}e=e[r]}return e}catch(i){if(i instanceof TypeError)return n;throw i}}function ky(e,t,n,i,r){if(i>=t.length)return;if("object"!=typeof e||null===e)return;const o=t[i];if(o.endsWith("[]")){const s=o.slice(0,-2),a=e;if(s in a&&Array.isArray(a[s]))for(const e of a[s])ky(e,t,n,i+1,r)}else if("*"===o){if("object"==typeof e&&null!==e&&!Array.isArray(e)){const t=e,o=Object.keys(t).filter(e=>!e.startsWith("_")&&!r.has(e)),s={};for(const e of o)s[e]=t[e];for(const[e,r]of Object.entries(s)){const o=[];for(const t of n.slice(i))"*"===t?o.push(e):o.push(t);Dy(t,o,r)}for(const e of o)delete t[e]}}else{o in e&&ky(e[o],t,n,i+1,r)}}function Fy(e){if("string"!=typeof e)throw new Error("fromImageBytes must be a string");return e}function By(e){const t={},n=Uy(e,["name"]);null!=n&&Dy(t,["name"],n);const i=Uy(e,["metadata"]);null!=i&&Dy(t,["metadata"],i);const r=Uy(e,["done"]);null!=r&&Dy(t,["done"],r);const o=Uy(e,["error"]);null!=o&&Dy(t,["error"],o);const s=Uy(e,["response","generateVideoResponse"]);return null!=s&&Dy(t,["response"],function(e){const t={},n=Uy(e,["generatedSamples"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=Uy(e,["video"]);null!=n&&Dy(t,["video"],function(e){const t={},n=Uy(e,["uri"]);null!=n&&Dy(t,["uri"],n);const i=Uy(e,["encodedVideo"]);null!=i&&Dy(t,["videoBytes"],Fy(i));const r=Uy(e,["encoding"]);null!=r&&Dy(t,["mimeType"],r);return t}(n));return t}(e))),Dy(t,["generatedVideos"],e)}const i=Uy(e,["raiMediaFilteredCount"]);null!=i&&Dy(t,["raiMediaFilteredCount"],i);const r=Uy(e,["raiMediaFilteredReasons"]);null!=r&&Dy(t,["raiMediaFilteredReasons"],r);return t}(s)),t}function Hy(e){const t={},n=Uy(e,["name"]);null!=n&&Dy(t,["name"],n);const i=Uy(e,["metadata"]);null!=i&&Dy(t,["metadata"],i);const r=Uy(e,["done"]);null!=r&&Dy(t,["done"],r);const o=Uy(e,["error"]);null!=o&&Dy(t,["error"],o);const s=Uy(e,["response"]);return null!=s&&Dy(t,["response"],function(e){const t={},n=Uy(e,["videos"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=Uy(e,["_self"]);null!=n&&Dy(t,["video"],function(e){const t={},n=Uy(e,["gcsUri"]);null!=n&&Dy(t,["uri"],n);const i=Uy(e,["bytesBase64Encoded"]);null!=i&&Dy(t,["videoBytes"],Fy(i));const r=Uy(e,["mimeType"]);null!=r&&Dy(t,["mimeType"],r);return t}(n));return t}(e))),Dy(t,["generatedVideos"],e)}const i=Uy(e,["raiMediaFilteredCount"]);null!=i&&Dy(t,["raiMediaFilteredCount"],i);const r=Uy(e,["raiMediaFilteredReasons"]);null!=r&&Dy(t,["raiMediaFilteredReasons"],r);return t}(s)),t}function Vy(e){const t={},n=Uy(e,["name"]);null!=n&&Dy(t,["name"],n);const i=Uy(e,["metadata"]);null!=i&&Dy(t,["metadata"],i);const r=Uy(e,["done"]);null!=r&&Dy(t,["done"],r);const o=Uy(e,["error"]);null!=o&&Dy(t,["error"],o);const s=Uy(e,["response"]);return null!=s&&Dy(t,["response"],function(e){const t={},n=Uy(e,["sdkHttpResponse"]);null!=n&&Dy(t,["sdkHttpResponse"],n);const i=Uy(e,["parent"]);null!=i&&Dy(t,["parent"],i);const r=Uy(e,["documentName"]);null!=r&&Dy(t,["documentName"],r);return t}(s)),t}function zy(e){const t={},n=Uy(e,["name"]);null!=n&&Dy(t,["name"],n);const i=Uy(e,["metadata"]);null!=i&&Dy(t,["metadata"],i);const r=Uy(e,["done"]);null!=r&&Dy(t,["done"],r);const o=Uy(e,["error"]);null!=o&&Dy(t,["error"],o);const s=Uy(e,["response"]);return null!=s&&Dy(t,["response"],function(e){const t={},n=Uy(e,["sdkHttpResponse"]);null!=n&&Dy(t,["sdkHttpResponse"],n);const i=Uy(e,["parent"]);null!=i&&Dy(t,["parent"],i);const r=Uy(e,["documentName"]);null!=r&&Dy(t,["documentName"],r);return t}(s)),t}var Gy,Wy,jy,qy,Xy,Yy,Ky,Jy,$y,Zy,Qy,ex,tx,nx,ix,rx,ox,sx,ax,lx,ux,cx,dx,hx,px,fx,mx,gx,vx,_x,yx,xx,Sx,Ex,bx,Tx,wx,Mx,Ax,Rx,Cx,Ix,Px,Ox,Nx,Lx,Dx,Ux,kx,Fx,Bx,Hx,Vx,zx,Gx,Wx,jx,qx,Xx,Yx,Kx,Jx,$x,Zx,Qx,eS,tS,nS,iS,rS,oS,sS,aS,lS,uS,cS,dS,hS,pS,fS,mS,gS,vS,_S,yS,xS,SS,ES,bS,TS,wS,MS,AS,RS,CS,IS,PS,OS,NS,LS,DS,US,kS,FS,BS,HS,VS,zS,GS,WS,jS,qS,XS,YS,KS;(Wy=Gy||(Gy={})).OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",Wy.OUTCOME_OK="OUTCOME_OK",Wy.OUTCOME_FAILED="OUTCOME_FAILED",Wy.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED",(qy=jy||(jy={})).LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",qy.PYTHON="PYTHON",(Yy=Xy||(Xy={})).SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",Yy.SILENT="SILENT",Yy.WHEN_IDLE="WHEN_IDLE",Yy.INTERRUPT="INTERRUPT",(Jy=Ky||(Ky={})).TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",Jy.STRING="STRING",Jy.NUMBER="NUMBER",Jy.INTEGER="INTEGER",Jy.BOOLEAN="BOOLEAN",Jy.ARRAY="ARRAY",Jy.OBJECT="OBJECT",Jy.NULL="NULL",(Zy=$y||($y={})).API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",Zy.SIMPLE_SEARCH="SIMPLE_SEARCH",Zy.ELASTIC_SEARCH="ELASTIC_SEARCH",(ex=Qy||(Qy={})).AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",ex.NO_AUTH="NO_AUTH",ex.API_KEY_AUTH="API_KEY_AUTH",ex.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",ex.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",ex.OAUTH="OAUTH",ex.OIDC_AUTH="OIDC_AUTH",(nx=tx||(tx={})).HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",nx.HTTP_IN_QUERY="HTTP_IN_QUERY",nx.HTTP_IN_HEADER="HTTP_IN_HEADER",nx.HTTP_IN_PATH="HTTP_IN_PATH",nx.HTTP_IN_BODY="HTTP_IN_BODY",nx.HTTP_IN_COOKIE="HTTP_IN_COOKIE",(rx=ix||(ix={})).PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",rx.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",rx.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",rx.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",rx.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",rx.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",rx.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH",(sx=ox||(ox={})).UNSPECIFIED="UNSPECIFIED",sx.BLOCKING="BLOCKING",sx.NON_BLOCKING="NON_BLOCKING",(lx=ax||(ax={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",lx.MODE_DYNAMIC="MODE_DYNAMIC",(cx=ux||(ux={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",cx.AUTO="AUTO",cx.ANY="ANY",cx.NONE="NONE",cx.VALIDATED="VALIDATED",(hx=dx||(dx={})).THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",hx.LOW="LOW",hx.MEDIUM="MEDIUM",hx.HIGH="HIGH",hx.MINIMAL="MINIMAL",(fx=px||(px={})).HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",fx.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",fx.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",fx.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",fx.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",fx.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",fx.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",fx.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",fx.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",fx.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",fx.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK",(gx=mx||(mx={})).HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",gx.SEVERITY="SEVERITY",gx.PROBABILITY="PROBABILITY",(_x=vx||(vx={})).HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",_x.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",_x.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",_x.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",_x.BLOCK_NONE="BLOCK_NONE",_x.OFF="OFF",(xx=yx||(yx={})).FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",xx.STOP="STOP",xx.MAX_TOKENS="MAX_TOKENS",xx.SAFETY="SAFETY",xx.RECITATION="RECITATION",xx.LANGUAGE="LANGUAGE",xx.OTHER="OTHER",xx.BLOCKLIST="BLOCKLIST",xx.PROHIBITED_CONTENT="PROHIBITED_CONTENT",xx.SPII="SPII",xx.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",xx.IMAGE_SAFETY="IMAGE_SAFETY",xx.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",xx.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",xx.NO_IMAGE="NO_IMAGE",xx.IMAGE_RECITATION="IMAGE_RECITATION",xx.IMAGE_OTHER="IMAGE_OTHER",(Ex=Sx||(Sx={})).HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",Ex.NEGLIGIBLE="NEGLIGIBLE",Ex.LOW="LOW",Ex.MEDIUM="MEDIUM",Ex.HIGH="HIGH",(Tx=bx||(bx={})).HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",Tx.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",Tx.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",Tx.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",Tx.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH",(Mx=wx||(wx={})).URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",Mx.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",Mx.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",Mx.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",Mx.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE",(Rx=Ax||(Ax={})).BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",Rx.SAFETY="SAFETY",Rx.OTHER="OTHER",Rx.BLOCKLIST="BLOCKLIST",Rx.PROHIBITED_CONTENT="PROHIBITED_CONTENT",Rx.IMAGE_SAFETY="IMAGE_SAFETY",Rx.MODEL_ARMOR="MODEL_ARMOR",Rx.JAILBREAK="JAILBREAK",(Ix=Cx||(Cx={})).TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",Ix.ON_DEMAND="ON_DEMAND",Ix.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT",(Ox=Px||(Px={})).MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",Ox.TEXT="TEXT",Ox.IMAGE="IMAGE",Ox.AUDIO="AUDIO",(Lx=Nx||(Nx={})).MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",Lx.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",Lx.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",Lx.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",(Ux=Dx||(Dx={})).TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",Ux.TUNING_MODE_FULL="TUNING_MODE_FULL",Ux.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER",(Fx=kx||(kx={})).ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",Fx.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",Fx.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",Fx.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",Fx.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",Fx.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",Fx.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO",(Hx=Bx||(Bx={})).JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",Hx.JOB_STATE_QUEUED="JOB_STATE_QUEUED",Hx.JOB_STATE_PENDING="JOB_STATE_PENDING",Hx.JOB_STATE_RUNNING="JOB_STATE_RUNNING",Hx.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",Hx.JOB_STATE_FAILED="JOB_STATE_FAILED",Hx.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",Hx.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",Hx.JOB_STATE_PAUSED="JOB_STATE_PAUSED",Hx.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",Hx.JOB_STATE_UPDATING="JOB_STATE_UPDATING",Hx.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED",(zx=Vx||(Vx={})).TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",zx.TUNING_TASK_I2V="TUNING_TASK_I2V",zx.TUNING_TASK_T2V="TUNING_TASK_T2V",zx.TUNING_TASK_R2V="TUNING_TASK_R2V",(Wx=Gx||(Gx={})).MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",Wx.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",Wx.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",Wx.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",Wx.MEDIA_RESOLUTION_ULTRA_HIGH="MEDIA_RESOLUTION_ULTRA_HIGH",(jx||(jx={})).COLLECTION="COLLECTION",(Xx=qx||(qx={})).FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",Xx.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",Xx.BALANCED="BALANCED",Xx.PRIORITIZE_COST="PRIORITIZE_COST",(Kx=Yx||(Yx={})).ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",Kx.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER",($x=Jx||(Jx={})).BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",$x.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",$x.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",$x.BLOCK_NONE="BLOCK_NONE",(Qx=Zx||(Zx={})).DONT_ALLOW="DONT_ALLOW",Qx.ALLOW_ADULT="ALLOW_ADULT",Qx.ALLOW_ALL="ALLOW_ALL",(tS=eS||(eS={})).auto="auto",tS.en="en",tS.ja="ja",tS.ko="ko",tS.hi="hi",tS.zh="zh",tS.pt="pt",tS.es="es",(iS=nS||(nS={})).MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",iS.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",iS.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",iS.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",iS.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC",(oS=rS||(rS={})).CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",oS.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",oS.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",oS.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH",(aS=sS||(sS={})).SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",aS.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",aS.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",aS.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT",(uS=lS||(lS={})).EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",uS.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",uS.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",uS.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",uS.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",uS.EDIT_MODE_STYLE="EDIT_MODE_STYLE",uS.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",uS.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE",(dS=cS||(cS={})).FOREGROUND="FOREGROUND",dS.BACKGROUND="BACKGROUND",dS.PROMPT="PROMPT",dS.SEMANTIC="SEMANTIC",dS.INTERACTIVE="INTERACTIVE",(pS=hS||(hS={})).ASSET="ASSET",pS.STYLE="STYLE",(mS=fS||(fS={})).INSERT="INSERT",mS.REMOVE="REMOVE",mS.REMOVE_STATIC="REMOVE_STATIC",mS.OUTPAINT="OUTPAINT",(vS=gS||(gS={})).OPTIMIZED="OPTIMIZED",vS.LOSSLESS="LOSSLESS",(yS=_S||(_S={})).SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",yS.PREFERENCE_TUNING="PREFERENCE_TUNING",yS.DISTILLATION="DISTILLATION",(SS=xS||(xS={})).STATE_UNSPECIFIED="STATE_UNSPECIFIED",SS.STATE_PENDING="STATE_PENDING",SS.STATE_ACTIVE="STATE_ACTIVE",SS.STATE_FAILED="STATE_FAILED",(bS=ES||(ES={})).STATE_UNSPECIFIED="STATE_UNSPECIFIED",bS.PROCESSING="PROCESSING",bS.ACTIVE="ACTIVE",bS.FAILED="FAILED",(wS=TS||(TS={})).SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",wS.UPLOADED="UPLOADED",wS.GENERATED="GENERATED",wS.REGISTERED="REGISTERED",(AS=MS||(MS={})).TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",AS.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",AS.RESPONSE_REJECTED="RESPONSE_REJECTED",AS.NEED_MORE_INPUT="NEED_MORE_INPUT",(CS=RS||(RS={})).MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",CS.TEXT="TEXT",CS.IMAGE="IMAGE",CS.VIDEO="VIDEO",CS.AUDIO="AUDIO",CS.DOCUMENT="DOCUMENT",(PS=IS||(IS={})).VAD_SIGNAL_TYPE_UNSPECIFIED="VAD_SIGNAL_TYPE_UNSPECIFIED",PS.VAD_SIGNAL_TYPE_SOS="VAD_SIGNAL_TYPE_SOS",PS.VAD_SIGNAL_TYPE_EOS="VAD_SIGNAL_TYPE_EOS",(NS=OS||(OS={})).TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",NS.ACTIVITY_START="ACTIVITY_START",NS.ACTIVITY_END="ACTIVITY_END",(DS=LS||(LS={})).START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",DS.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",DS.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW",(kS=US||(US={})).END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",kS.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",kS.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW",(BS=FS||(FS={})).ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",BS.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",BS.NO_INTERRUPTION="NO_INTERRUPTION",(VS=HS||(HS={})).TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",VS.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",VS.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT",(GS=zS||(zS={})).SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",GS.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",GS.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",GS.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",GS.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",GS.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",GS.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",GS.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",GS.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",GS.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",GS.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",GS.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",GS.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR",(jS=WS||(WS={})).MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",jS.QUALITY="QUALITY",jS.DIVERSITY="DIVERSITY",jS.VOCALIZATION="VOCALIZATION",(XS=qS||(qS={})).PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",XS.PLAY="PLAY",XS.PAUSE="PAUSE",XS.STOP="STOP",XS.RESET_CONTEXT="RESET_CONTEXT";class JS{constructor(e){const t={};for(const n of e.headers.entries())t[n[0]]=n[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}}class $S{get text(){var e,t,n,i,r,o,s,a;if(0===(null===(i=null===(n=null===(t=null===(e=this.candidates)||void 0===e?void 0:e[0])||void 0===t?void 0:t.content)||void 0===n?void 0:n.parts)||void 0===i?void 0:i.length))return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let l="",u=!1;const c=[];for(const d of null!==(a=null===(s=null===(o=null===(r=this.candidates)||void 0===r?void 0:r[0])||void 0===o?void 0:o.content)||void 0===s?void 0:s.parts)&&void 0!==a?a:[]){for(const[e,t]of Object.entries(d))"text"===e||"thought"===e||"thoughtSignature"===e||null===t&&void 0===t||c.push(e);if("string"==typeof d.text){if("boolean"==typeof d.thought&&d.thought)continue;u=!0,l+=d.text}}return c.length>0&&console.warn(`there are non-text parts ${c} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),u?l:void 0}get data(){var e,t,n,i,r,o,s,a;if(0===(null===(i=null===(n=null===(t=null===(e=this.candidates)||void 0===e?void 0:e[0])||void 0===t?void 0:t.content)||void 0===n?void 0:n.parts)||void 0===i?void 0:i.length))return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let l="";const u=[];for(const c of null!==(a=null===(s=null===(o=null===(r=this.candidates)||void 0===r?void 0:r[0])||void 0===o?void 0:o.content)||void 0===s?void 0:s.parts)&&void 0!==a?a:[]){for(const[e,t]of Object.entries(c))"inlineData"===e||null===t&&void 0===t||u.push(e);c.inlineData&&"string"==typeof c.inlineData.data&&(l+=atob(c.inlineData.data))}return u.length>0&&console.warn(`there are non-data parts ${u} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),l.length>0?btoa(l):void 0}get functionCalls(){var e,t,n,i,r,o,s,a;if(0===(null===(i=null===(n=null===(t=null===(e=this.candidates)||void 0===e?void 0:e[0])||void 0===t?void 0:t.content)||void 0===n?void 0:n.parts)||void 0===i?void 0:i.length))return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const l=null===(a=null===(s=null===(o=null===(r=this.candidates)||void 0===r?void 0:r[0])||void 0===o?void 0:o.content)||void 0===s?void 0:s.parts)||void 0===a?void 0:a.filter(e=>e.functionCall).map(e=>e.functionCall).filter(e=>void 0!==e);return 0!==(null==l?void 0:l.length)?l:void 0}get executableCode(){var e,t,n,i,r,o,s,a,l;if(0===(null===(i=null===(n=null===(t=null===(e=this.candidates)||void 0===e?void 0:e[0])||void 0===t?void 0:t.content)||void 0===n?void 0:n.parts)||void 0===i?void 0:i.length))return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const u=null===(a=null===(s=null===(o=null===(r=this.candidates)||void 0===r?void 0:r[0])||void 0===o?void 0:o.content)||void 0===s?void 0:s.parts)||void 0===a?void 0:a.filter(e=>e.executableCode).map(e=>e.executableCode).filter(e=>void 0!==e);return 0!==(null==u?void 0:u.length)?null===(l=null==u?void 0:u[0])||void 0===l?void 0:l.code:void 0}get codeExecutionResult(){var e,t,n,i,r,o,s,a,l;if(0===(null===(i=null===(n=null===(t=null===(e=this.candidates)||void 0===e?void 0:e[0])||void 0===t?void 0:t.content)||void 0===n?void 0:n.parts)||void 0===i?void 0:i.length))return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const u=null===(a=null===(s=null===(o=null===(r=this.candidates)||void 0===r?void 0:r[0])||void 0===o?void 0:o.content)||void 0===s?void 0:s.parts)||void 0===a?void 0:a.filter(e=>e.codeExecutionResult).map(e=>e.codeExecutionResult).filter(e=>void 0!==e);return 0!==(null==u?void 0:u.length)?null===(l=null==u?void 0:u[0])||void 0===l?void 0:l.output:void 0}}class ZS{}class QS{}class eE{}class tE{}class nE{}class iE{}class rE{}class oE{}class sE{}class aE{}class lE{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){const n=new lE;let i;const r=e;return i=t?Hy(r):By(r),Object.assign(n,i),n}}class uE{}class cE{}class dE{}class hE{}class pE{}class fE{}class mE{}class gE{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){const n=new gE,i=Vy(e);return Object.assign(n,i),n}}class vE{}class _E{}class yE{}class xE{}class SE{}class EE{get text(){var e,t,n;let i="",r=!1;const o=[];for(const s of null!==(n=null===(t=null===(e=this.serverContent)||void 0===e?void 0:e.modelTurn)||void 0===t?void 0:t.parts)&&void 0!==n?n:[]){for(const[e,t]of Object.entries(s))"text"!==e&&"thought"!==e&&null!==t&&o.push(e);if("string"==typeof s.text){if("boolean"==typeof s.thought&&s.thought)continue;r=!0,i+=s.text}}return o.length>0&&console.warn(`there are non-text parts ${o} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),r?i:void 0}get data(){var e,t,n;let i="";const r=[];for(const o of null!==(n=null===(t=null===(e=this.serverContent)||void 0===e?void 0:e.modelTurn)||void 0===t?void 0:t.parts)&&void 0!==n?n:[]){for(const[e,t]of Object.entries(o))"inlineData"!==e&&null!==t&&r.push(e);o.inlineData&&"string"==typeof o.inlineData.data&&(i+=atob(o.inlineData.data))}return r.length>0&&console.warn(`there are non-data parts ${r} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),i.length>0?btoa(i):void 0}}class bE{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class TE{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){const n=new TE,i=zy(e);return Object.assign(n,i),n}}function wE(e,t){if(!t||"string"!=typeof t)throw new Error("model is required and must be a string");if(t.includes("..")||t.includes("?")||t.includes("&"))throw new Error("invalid model parameter");if(e.isVertexAI()){if(t.startsWith("publishers/")||t.startsWith("projects/")||t.startsWith("models/"))return t;if(t.indexOf("/")>=0){const e=t.split("/",2);return`publishers/${e[0]}/models/${e[1]}`}return`publishers/google/models/${t}`}return t.startsWith("models/")||t.startsWith("tunedModels/")?t:`models/${t}`}function ME(e,t){const n=wE(e,t);return n?n.startsWith("publishers/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/${n}`:n.startsWith("models/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/publishers/google/${n}`:n:""}function AE(e){return Array.isArray(e)?e.map(e=>RE(e)):[RE(e)]}function RE(e){if("object"==typeof e&&null!==e)return e;throw new Error("Could not parse input as Blob. Unsupported blob type: "+typeof e)}function CE(e){const t=RE(e);if(t.mimeType&&t.mimeType.startsWith("image/"))return t;throw new Error(`Unsupported mime type: ${t.mimeType}`)}function IE(e){const t=RE(e);if(t.mimeType&&t.mimeType.startsWith("audio/"))return t;throw new Error(`Unsupported mime type: ${t.mimeType}`)}function PE(e){if(null==e)throw new Error("PartUnion is required");if("object"==typeof e)return e;if("string"==typeof e)return{text:e};throw new Error("Unsupported part type: "+typeof e)}function OE(e){if(null==e||Array.isArray(e)&&0===e.length)throw new Error("PartListUnion is required");return Array.isArray(e)?e.map(e=>PE(e)):[PE(e)]}function NE(e){return null!=e&&"object"==typeof e&&"parts"in e&&Array.isArray(e.parts)}function LE(e){return null!=e&&"object"==typeof e&&"functionCall"in e}function DE(e){return null!=e&&"object"==typeof e&&"functionResponse"in e}function UE(e){if(null==e)throw new Error("ContentUnion is required");return NE(e)?e:{role:"user",parts:OE(e)}}function kE(e,t){if(!t)return[];if(e.isVertexAI()&&Array.isArray(t))return t.flatMap(e=>{const t=UE(e);return t.parts&&t.parts.length>0&&void 0!==t.parts[0].text?[t.parts[0].text]:[]});if(e.isVertexAI()){const e=UE(t);return e.parts&&e.parts.length>0&&void 0!==e.parts[0].text?[e.parts[0].text]:[]}return Array.isArray(t)?t.map(e=>UE(e)):[UE(t)]}function FE(e){if(null==e||Array.isArray(e)&&0===e.length)throw new Error("contents are required");if(!Array.isArray(e)){if(LE(e)||DE(e))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[UE(e)]}const t=[],n=[],i=NE(e[0]);for(const r of e){const e=NE(r);if(e!=i)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(e)t.push(r);else{if(LE(r)||DE(r))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");n.push(r)}}return i||t.push({role:"user",parts:OE(n)}),t}function BE(e){const t={},n=["items"],i=["anyOf"],r=["properties"];if(e.type&&e.anyOf)throw new Error("type and anyOf cannot be both populated.");const o=e.anyOf;null!=o&&2==o.length&&("null"===o[0].type?(t.nullable=!0,e=o[1]):"null"===o[1].type&&(t.nullable=!0,e=o[0])),e.type instanceof Array&&function(e,t){e.includes("null")&&(t.nullable=!0);const n=e.filter(e=>"null"!==e);if(1===n.length)t.type=Object.values(Ky).includes(n[0].toUpperCase())?n[0].toUpperCase():Ky.TYPE_UNSPECIFIED;else{t.anyOf=[];for(const e of n)t.anyOf.push({type:Object.values(Ky).includes(e.toUpperCase())?e.toUpperCase():Ky.TYPE_UNSPECIFIED})}}(e.type,t);for(const[s,a]of Object.entries(e))if(null!=a)if("type"==s){if("null"===a)throw new Error("type: null can not be the only possible type for the field.");if(a instanceof Array)continue;t.type=Object.values(Ky).includes(a.toUpperCase())?a.toUpperCase():Ky.TYPE_UNSPECIFIED}else if(n.includes(s))t[s]=BE(a);else if(i.includes(s)){const e=[];for(const n of a)"null"!=n.type?e.push(BE(n)):t.nullable=!0;t[s]=e}else if(r.includes(s)){const e={};for(const[t,n]of Object.entries(a))e[t]=BE(n);t[s]=e}else{if("additionalProperties"===s)continue;t[s]=a}return t}function HE(e){return BE(e)}function VE(e){if("object"==typeof e)return e;if("string"==typeof e)return{voiceConfig:{prebuiltVoiceConfig:{voiceName:e}}};throw new Error("Unsupported speechConfig type: "+typeof e)}function zE(e){if("multiSpeakerVoiceConfig"in e)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return e}function GE(e){if(e.functionDeclarations)for(const t of e.functionDeclarations)t.parameters&&(Object.keys(t.parameters).includes("$schema")?t.parametersJsonSchema||(t.parametersJsonSchema=t.parameters,delete t.parameters):t.parameters=BE(t.parameters)),t.response&&(Object.keys(t.response).includes("$schema")?t.responseJsonSchema||(t.responseJsonSchema=t.response,delete t.response):t.response=BE(t.response));return e}function WE(e){if(null==e)throw new Error("tools is required");if(!Array.isArray(e))throw new Error("tools is required and must be an array of Tools");const t=[];for(const n of e)t.push(n);return t}function jE(e,t){if("string"!=typeof t)throw new Error("name must be a string");return function(e,t,n,i=1){const r=!t.startsWith(`${n}/`)&&t.split("/").length===i;return e.isVertexAI()?t.startsWith("projects/")?t:t.startsWith("locations/")?`projects/${e.getProject()}/${t}`:t.startsWith(`${n}/`)?`projects/${e.getProject()}/locations/${e.getLocation()}/${t}`:r?`projects/${e.getProject()}/locations/${e.getLocation()}/${n}/${t}`:t:r?`${n}/${t}`:t}(e,t,"cachedContents")}function qE(e){switch(e){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return e}}function XE(e){return Fy(e)}function YE(e){var t;let n;var i;if(null!=(i=e)&&"object"==typeof i&&"name"in i&&(n=e.name),!(function(e){return null!=e&&"object"==typeof e&&"uri"in e}(e)&&(n=e.uri,void 0===n)||function(e){return null!=e&&"object"==typeof e&&"video"in e}(e)&&(n=null===(t=e.video)||void 0===t?void 0:t.uri,void 0===n))){if("string"==typeof e&&(n=e),void 0===n)throw new Error("Could not extract file name from the provided input.");if(n.startsWith("https://")){const e=n.split("files/")[1].match(/[a-z0-9]+/);if(null===e)throw new Error(`Could not extract file name from URI ${n}`);n=e[0]}else n.startsWith("files/")&&(n=n.split("files/")[1]);return n}}function KE(e,t){let n;return n=e.isVertexAI()?t?"publishers/google/models":"models":t?"models":"tunedModels",n}function JE(e){for(const t of["models","tunedModels","publisherModels"])if($E(e,t))return e[t];return[]}function $E(e,t){return null!==e&&"object"==typeof e&&t in e}function ZE(e,t={}){const n=e,i={name:n.name,description:n.description,parametersJsonSchema:n.inputSchema};n.outputSchema&&(i.responseJsonSchema=n.outputSchema),t.behavior&&(i.behavior=t.behavior);return{functionDeclarations:[i]}}function QE(e,t){let n;if("string"==typeof t)if(e.isVertexAI())if(t.startsWith("gs://"))n={format:"jsonl",gcsUri:[t]};else{if(!t.startsWith("bq://"))throw new Error(`Unsupported string source for Vertex AI: ${t}`);n={format:"bigquery",bigqueryUri:t}}else{if(!t.startsWith("files/"))throw new Error(`Unsupported string source for Gemini API: ${t}`);n={fileName:t}}else if(Array.isArray(t)){if(e.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");n={inlinedRequests:t}}else n=t;const i=[n.gcsUri,n.bigqueryUri].filter(Boolean).length,r=[n.inlinedRequests,n.fileName].filter(Boolean).length;if(e.isVertexAI()){if(r>0||1!==i)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(i>0||1!==r)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return n}function eb(e){if("object"!=typeof e||null===e)return{};const t=e,n=t.inlinedResponses;if("object"!=typeof n||null===n)return e;const i=n.inlinedResponses;if(!Array.isArray(i)||0===i.length)return e;let r=!1;for(const o of i){if("object"!=typeof o||null===o)continue;const e=o.response;if("object"!=typeof e||null===e)continue;if(void 0!==e.embedding){r=!0;break}}return r&&(t.inlinedEmbedContentResponses=t.inlinedResponses,delete t.inlinedResponses),e}function tb(e,t){const n=t;if(!e.isVertexAI()){if(/batches\/[^/]+$/.test(n))return n.split("/").pop();throw new Error(`Invalid batch job name: ${n}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(n))return n.split("/").pop();if(/^\d+$/.test(n))return n;throw new Error(`Invalid batch job name: ${n}.`)}function nb(e){return"BATCH_STATE_UNSPECIFIED"===e?"JOB_STATE_UNSPECIFIED":"BATCH_STATE_PENDING"===e?"JOB_STATE_PENDING":"BATCH_STATE_RUNNING"===e?"JOB_STATE_RUNNING":"BATCH_STATE_SUCCEEDED"===e?"JOB_STATE_SUCCEEDED":"BATCH_STATE_FAILED"===e?"JOB_STATE_FAILED":"BATCH_STATE_CANCELLED"===e?"JOB_STATE_CANCELLED":"BATCH_STATE_EXPIRED"===e?"JOB_STATE_EXPIRED":e}function ib(e){const t={},n=Uy(e,["responsesFile"]);null!=n&&Dy(t,["fileName"],n);const i=Uy(e,["inlinedResponses","inlinedResponses"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=Uy(e,["response"]);null!=n&&Dy(t,["response"],function(e){const t={},n=Uy(e,["sdkHttpResponse"]);null!=n&&Dy(t,["sdkHttpResponse"],n);const i=Uy(e,["candidates"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=Uy(e,["content"]);null!=n&&Dy(t,["content"],n);const i=Uy(e,["citationMetadata"]);null!=i&&Dy(t,["citationMetadata"],function(e){const t={},n=Uy(e,["citationSources"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),Dy(t,["citations"],e)}return t}(i));const r=Uy(e,["tokenCount"]);null!=r&&Dy(t,["tokenCount"],r);const o=Uy(e,["finishReason"]);null!=o&&Dy(t,["finishReason"],o);const s=Uy(e,["avgLogprobs"]);null!=s&&Dy(t,["avgLogprobs"],s);const a=Uy(e,["groundingMetadata"]);null!=a&&Dy(t,["groundingMetadata"],a);const l=Uy(e,["index"]);null!=l&&Dy(t,["index"],l);const u=Uy(e,["logprobsResult"]);null!=u&&Dy(t,["logprobsResult"],u);const c=Uy(e,["safetyRatings"]);if(null!=c){let e=c;Array.isArray(e)&&(e=e.map(e=>e)),Dy(t,["safetyRatings"],e)}const d=Uy(e,["urlContextMetadata"]);null!=d&&Dy(t,["urlContextMetadata"],d);return t}(e))),Dy(t,["candidates"],e)}const r=Uy(e,["modelVersion"]);null!=r&&Dy(t,["modelVersion"],r);const o=Uy(e,["promptFeedback"]);null!=o&&Dy(t,["promptFeedback"],o);const s=Uy(e,["responseId"]);null!=s&&Dy(t,["responseId"],s);const a=Uy(e,["usageMetadata"]);null!=a&&Dy(t,["usageMetadata"],a);return t}(n));const i=Uy(e,["metadata"]);null!=i&&Dy(t,["metadata"],i);const r=Uy(e,["error"]);null!=r&&Dy(t,["error"],r);return t}(e))),Dy(t,["inlinedResponses"],e)}const r=Uy(e,["inlinedEmbedContentResponses","inlinedResponses"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),Dy(t,["inlinedEmbedContentResponses"],e)}return t}function rb(e){const t={},n=Uy(e,["name"]);null!=n&&Dy(t,["name"],n);const i=Uy(e,["metadata","displayName"]);null!=i&&Dy(t,["displayName"],i);const r=Uy(e,["metadata","state"]);null!=r&&Dy(t,["state"],nb(r));const o=Uy(e,["metadata","createTime"]);null!=o&&Dy(t,["createTime"],o);const s=Uy(e,["metadata","endTime"]);null!=s&&Dy(t,["endTime"],s);const a=Uy(e,["metadata","updateTime"]);null!=a&&Dy(t,["updateTime"],a);const l=Uy(e,["metadata","model"]);null!=l&&Dy(t,["model"],l);const u=Uy(e,["metadata","output"]);return null!=u&&Dy(t,["dest"],ib(eb(u))),t}function ob(e){const t={},n=Uy(e,["name"]);null!=n&&Dy(t,["name"],n);const i=Uy(e,["displayName"]);null!=i&&Dy(t,["displayName"],i);const r=Uy(e,["state"]);null!=r&&Dy(t,["state"],nb(r));const o=Uy(e,["error"]);null!=o&&Dy(t,["error"],o);const s=Uy(e,["createTime"]);null!=s&&Dy(t,["createTime"],s);const a=Uy(e,["startTime"]);null!=a&&Dy(t,["startTime"],a);const l=Uy(e,["endTime"]);null!=l&&Dy(t,["endTime"],l);const u=Uy(e,["updateTime"]);null!=u&&Dy(t,["updateTime"],u);const c=Uy(e,["model"]);null!=c&&Dy(t,["model"],c);const d=Uy(e,["inputConfig"]);null!=d&&Dy(t,["src"],function(e){const t={},n=Uy(e,["instancesFormat"]);null!=n&&Dy(t,["format"],n);const i=Uy(e,["gcsSource","uris"]);null!=i&&Dy(t,["gcsUri"],i);const r=Uy(e,["bigquerySource","inputUri"]);null!=r&&Dy(t,["bigqueryUri"],r);return t}(d));const h=Uy(e,["outputConfig"]);null!=h&&Dy(t,["dest"],function(e){const t={},n=Uy(e,["predictionsFormat"]);null!=n&&Dy(t,["format"],n);const i=Uy(e,["gcsDestination","outputUriPrefix"]);null!=i&&Dy(t,["gcsUri"],i);const r=Uy(e,["bigqueryDestination","outputUri"]);return null!=r&&Dy(t,["bigqueryUri"],r),t}(eb(h)));const p=Uy(e,["completionStats"]);return null!=p&&Dy(t,["completionStats"],p),t}function sb(e,t){const n={};if(void 0!==Uy(t,["format"]))throw new Error("format parameter is not supported in Gemini API.");if(void 0!==Uy(t,["gcsUri"]))throw new Error("gcsUri parameter is not supported in Gemini API.");if(void 0!==Uy(t,["bigqueryUri"]))throw new Error("bigqueryUri parameter is not supported in Gemini API.");const i=Uy(t,["fileName"]);null!=i&&Dy(n,["fileName"],i);const r=Uy(t,["inlinedRequests"]);if(null!=r){let t=r;Array.isArray(t)&&(t=t.map(t=>function(e,t){const n={},i=Uy(t,["model"]);null!=i&&Dy(n,["request","model"],wE(e,i));const r=Uy(t,["contents"]);if(null!=r){let e=FE(r);Array.isArray(e)&&(e=e.map(e=>ab(e))),Dy(n,["request","contents"],e)}const o=Uy(t,["metadata"]);null!=o&&Dy(n,["metadata"],o);const s=Uy(t,["config"]);null!=s&&Dy(n,["request","generationConfig"],function(e,t,n){const i={},r=Uy(t,["systemInstruction"]);void 0!==n&&null!=r&&Dy(n,["systemInstruction"],ab(UE(r)));const o=Uy(t,["temperature"]);null!=o&&Dy(i,["temperature"],o);const s=Uy(t,["topP"]);null!=s&&Dy(i,["topP"],s);const a=Uy(t,["topK"]);null!=a&&Dy(i,["topK"],a);const l=Uy(t,["candidateCount"]);null!=l&&Dy(i,["candidateCount"],l);const u=Uy(t,["maxOutputTokens"]);null!=u&&Dy(i,["maxOutputTokens"],u);const c=Uy(t,["stopSequences"]);null!=c&&Dy(i,["stopSequences"],c);const d=Uy(t,["responseLogprobs"]);null!=d&&Dy(i,["responseLogprobs"],d);const h=Uy(t,["logprobs"]);null!=h&&Dy(i,["logprobs"],h);const p=Uy(t,["presencePenalty"]);null!=p&&Dy(i,["presencePenalty"],p);const f=Uy(t,["frequencyPenalty"]);null!=f&&Dy(i,["frequencyPenalty"],f);const m=Uy(t,["seed"]);null!=m&&Dy(i,["seed"],m);const g=Uy(t,["responseMimeType"]);null!=g&&Dy(i,["responseMimeType"],g);const v=Uy(t,["responseSchema"]);null!=v&&Dy(i,["responseSchema"],HE(v));const _=Uy(t,["responseJsonSchema"]);null!=_&&Dy(i,["responseJsonSchema"],_);if(void 0!==Uy(t,["routingConfig"]))throw new Error("routingConfig parameter is not supported in Gemini API.");if(void 0!==Uy(t,["modelSelectionConfig"]))throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const y=Uy(t,["safetySettings"]);if(void 0!==n&&null!=y){let e=y;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=Uy(e,["category"]);null!=n&&Dy(t,["category"],n);if(void 0!==Uy(e,["method"]))throw new Error("method parameter is not supported in Gemini API.");const i=Uy(e,["threshold"]);null!=i&&Dy(t,["threshold"],i);return t}(e))),Dy(n,["safetySettings"],e)}const x=Uy(t,["tools"]);if(void 0!==n&&null!=x){let e=WE(x);Array.isArray(e)&&(e=e.map(e=>function(e){const t={};if(void 0!==Uy(e,["retrieval"]))throw new Error("retrieval parameter is not supported in Gemini API.");const n=Uy(e,["computerUse"]);null!=n&&Dy(t,["computerUse"],n);const i=Uy(e,["fileSearch"]);null!=i&&Dy(t,["fileSearch"],i);const r=Uy(e,["codeExecution"]);null!=r&&Dy(t,["codeExecution"],r);if(void 0!==Uy(e,["enterpriseWebSearch"]))throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const o=Uy(e,["functionDeclarations"]);if(null!=o){let e=o;Array.isArray(e)&&(e=e.map(e=>e)),Dy(t,["functionDeclarations"],e)}const s=Uy(e,["googleMaps"]);null!=s&&Dy(t,["googleMaps"],function(e){const t={};if(void 0!==Uy(e,["authConfig"]))throw new Error("authConfig parameter is not supported in Gemini API.");const n=Uy(e,["enableWidget"]);null!=n&&Dy(t,["enableWidget"],n);return t}(s));const a=Uy(e,["googleSearch"]);null!=a&&Dy(t,["googleSearch"],function(e){const t={};if(void 0!==Uy(e,["excludeDomains"]))throw new Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==Uy(e,["blockingConfidence"]))throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=Uy(e,["timeRangeFilter"]);null!=n&&Dy(t,["timeRangeFilter"],n);return t}(a));const l=Uy(e,["googleSearchRetrieval"]);null!=l&&Dy(t,["googleSearchRetrieval"],l);const u=Uy(e,["urlContext"]);null!=u&&Dy(t,["urlContext"],u);return t}(GE(e)))),Dy(n,["tools"],e)}const S=Uy(t,["toolConfig"]);void 0!==n&&null!=S&&Dy(n,["toolConfig"],function(e){const t={},n=Uy(e,["retrievalConfig"]);null!=n&&Dy(t,["retrievalConfig"],n);const i=Uy(e,["functionCallingConfig"]);null!=i&&Dy(t,["functionCallingConfig"],function(e){const t={},n=Uy(e,["allowedFunctionNames"]);null!=n&&Dy(t,["allowedFunctionNames"],n);const i=Uy(e,["mode"]);null!=i&&Dy(t,["mode"],i);if(void 0!==Uy(e,["streamFunctionCallArguments"]))throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}(i));return t}(S));if(void 0!==Uy(t,["labels"]))throw new Error("labels parameter is not supported in Gemini API.");const E=Uy(t,["cachedContent"]);void 0!==n&&null!=E&&Dy(n,["cachedContent"],jE(e,E));const b=Uy(t,["responseModalities"]);null!=b&&Dy(i,["responseModalities"],b);const T=Uy(t,["mediaResolution"]);null!=T&&Dy(i,["mediaResolution"],T);const w=Uy(t,["speechConfig"]);null!=w&&Dy(i,["speechConfig"],VE(w));if(void 0!==Uy(t,["audioTimestamp"]))throw new Error("audioTimestamp parameter is not supported in Gemini API.");const M=Uy(t,["thinkingConfig"]);null!=M&&Dy(i,["thinkingConfig"],M);const A=Uy(t,["imageConfig"]);null!=A&&Dy(i,["imageConfig"],function(e){const t={},n=Uy(e,["aspectRatio"]);null!=n&&Dy(t,["aspectRatio"],n);const i=Uy(e,["imageSize"]);null!=i&&Dy(t,["imageSize"],i);if(void 0!==Uy(e,["personGeneration"]))throw new Error("personGeneration parameter is not supported in Gemini API.");if(void 0!==Uy(e,["outputMimeType"]))throw new Error("outputMimeType parameter is not supported in Gemini API.");if(void 0!==Uy(e,["outputCompressionQuality"]))throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return t}(A));const R=Uy(t,["enableEnhancedCivicAnswers"]);null!=R&&Dy(i,["enableEnhancedCivicAnswers"],R);if(void 0!==Uy(t,["modelArmorConfig"]))throw new Error("modelArmorConfig parameter is not supported in Gemini API.");return i}(e,s,Uy(n,["request"],{})));return n}(e,t))),Dy(n,["requests","requests"],t)}return n}function ab(e){const t={},n=Uy(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=Uy(e,["mediaResolution"]);null!=n&&Dy(t,["mediaResolution"],n);const i=Uy(e,["codeExecutionResult"]);null!=i&&Dy(t,["codeExecutionResult"],i);const r=Uy(e,["executableCode"]);null!=r&&Dy(t,["executableCode"],r);const o=Uy(e,["fileData"]);null!=o&&Dy(t,["fileData"],function(e){const t={};if(void 0!==Uy(e,["displayName"]))throw new Error("displayName parameter is not supported in Gemini API.");const n=Uy(e,["fileUri"]);null!=n&&Dy(t,["fileUri"],n);const i=Uy(e,["mimeType"]);null!=i&&Dy(t,["mimeType"],i);return t}(o));const s=Uy(e,["functionCall"]);null!=s&&Dy(t,["functionCall"],function(e){const t={},n=Uy(e,["id"]);null!=n&&Dy(t,["id"],n);const i=Uy(e,["args"]);null!=i&&Dy(t,["args"],i);const r=Uy(e,["name"]);null!=r&&Dy(t,["name"],r);if(void 0!==Uy(e,["partialArgs"]))throw new Error("partialArgs parameter is not supported in Gemini API.");if(void 0!==Uy(e,["willContinue"]))throw new Error("willContinue parameter is not supported in Gemini API.");return t}(s));const a=Uy(e,["functionResponse"]);null!=a&&Dy(t,["functionResponse"],a);const l=Uy(e,["inlineData"]);null!=l&&Dy(t,["inlineData"],function(e){const t={},n=Uy(e,["data"]);if(null!=n&&Dy(t,["data"],n),void 0!==Uy(e,["displayName"]))throw new Error("displayName parameter is not supported in Gemini API.");const i=Uy(e,["mimeType"]);return null!=i&&Dy(t,["mimeType"],i),t}(l));const u=Uy(e,["text"]);null!=u&&Dy(t,["text"],u);const c=Uy(e,["thought"]);null!=c&&Dy(t,["thought"],c);const d=Uy(e,["thoughtSignature"]);null!=d&&Dy(t,["thoughtSignature"],d);const h=Uy(e,["videoMetadata"]);null!=h&&Dy(t,["videoMetadata"],h);return t}(e))),Dy(t,["parts"],e)}const i=Uy(e,["role"]);return null!=i&&Dy(t,["role"],i),t}function lb(e,t){const n=Uy(e,["displayName"]);void 0!==t&&null!=n&&Dy(t,["displayName"],n);const i=Uy(e,["dest"]);return void 0!==t&&null!=i&&Dy(t,["outputConfig"],function(e){const t={},n=Uy(e,["format"]);null!=n&&Dy(t,["predictionsFormat"],n);const i=Uy(e,["gcsUri"]);null!=i&&Dy(t,["gcsDestination","outputUriPrefix"],i);const r=Uy(e,["bigqueryUri"]);if(null!=r&&Dy(t,["bigqueryDestination","outputUri"],r),void 0!==Uy(e,["fileName"]))throw new Error("fileName parameter is not supported in Vertex AI.");if(void 0!==Uy(e,["inlinedResponses"]))throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(void 0!==Uy(e,["inlinedEmbedContentResponses"]))throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return t}(function(e){if("string"!=typeof e)return e;const t=e;if(t.startsWith("gs://"))return{format:"jsonl",gcsUri:t};if(t.startsWith("bq://"))return{format:"bigquery",bigqueryUri:t};throw new Error(`Unsupported destination: ${t}`)}(i))),{}}function ub(e,t){const n={},i=Uy(t,["model"]);null!=i&&Dy(n,["_url","model"],wE(e,i));const r=Uy(t,["src"]);null!=r&&Dy(n,["batch","inputConfig"],sb(e,QE(e,r)));const o=Uy(t,["config"]);return null!=o&&function(e,t){const n=Uy(e,["displayName"]);if(void 0!==t&&null!=n&&Dy(t,["batch","displayName"],n),void 0!==Uy(e,["dest"]))throw new Error("dest parameter is not supported in Gemini API.")}(o,n),n}function cb(e,t){const n={},i=Uy(t,["model"]);null!=i&&Dy(n,["model"],wE(e,i));const r=Uy(t,["src"]);null!=r&&Dy(n,["inputConfig"],function(e){const t={},n=Uy(e,["format"]);null!=n&&Dy(t,["instancesFormat"],n);const i=Uy(e,["gcsUri"]);null!=i&&Dy(t,["gcsSource","uris"],i);const r=Uy(e,["bigqueryUri"]);if(null!=r&&Dy(t,["bigquerySource","inputUri"],r),void 0!==Uy(e,["fileName"]))throw new Error("fileName parameter is not supported in Vertex AI.");if(void 0!==Uy(e,["inlinedRequests"]))throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return t}(QE(e,r)));const o=Uy(t,["config"]);return null!=o&&lb(o,n),n}function db(e,t){const n={},i=Uy(t,["model"]);null!=i&&Dy(n,["_url","model"],wE(e,i));const r=Uy(t,["src"]);null!=r&&Dy(n,["batch","inputConfig"],function(e,t){const n={},i=Uy(t,["fileName"]);null!=i&&Dy(n,["file_name"],i);const r=Uy(t,["inlinedRequests"]);null!=r&&Dy(n,["requests"],function(e,t){const n={},i=Uy(t,["contents"]);if(null!=i){let t=kE(e,i);Array.isArray(t)&&(t=t.map(e=>e)),Dy(n,["requests[]","request","content"],t)}const r=Uy(t,["config"]);null!=r&&(Dy(n,["_self"],function(e,t){const n={},i=Uy(e,["taskType"]);void 0!==t&&null!=i&&Dy(t,["requests[]","taskType"],i);const r=Uy(e,["title"]);void 0!==t&&null!=r&&Dy(t,["requests[]","title"],r);const o=Uy(e,["outputDimensionality"]);void 0!==t&&null!=o&&Dy(t,["requests[]","outputDimensionality"],o);if(void 0!==Uy(e,["mimeType"]))throw new Error("mimeType parameter is not supported in Gemini API.");if(void 0!==Uy(e,["autoTruncate"]))throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}(r,n)),function(e,t){for(const[n,i]of Object.entries(t)){const t=n.split("."),r=i.split("."),o=new Set;let s=-1;for(let e=0;e<t.length;e++)if("*"===t[e]){s=e;break}if(-1!==s&&r.length>s)for(let e=s;e<r.length;e++){const t=r[e];"*"===t||t.endsWith("[]")||t.endsWith("[0]")||o.add(t)}ky(e,t,r,0,o)}}(n,{"requests[].*":"requests[].request.*"}));return n}(e,r));return n}(e,r));const o=Uy(t,["config"]);return null!=o&&function(e,t){const n=Uy(e,["displayName"]);void 0!==t&&null!=n&&Dy(t,["batch","displayName"],n)}(o,n),n}function hb(e){const t={},n=Uy(e,["config"]);return null!=n&&function(e,t){const n=Uy(e,["pageSize"]);void 0!==t&&null!=n&&Dy(t,["_query","pageSize"],n);const i=Uy(e,["pageToken"]);if(void 0!==t&&null!=i&&Dy(t,["_query","pageToken"],i),void 0!==Uy(e,["filter"]))throw new Error("filter parameter is not supported in Gemini API.")}(n,t),t}function pb(e){const t={},n=Uy(e,["config"]);return null!=n&&function(e,t){const n=Uy(e,["pageSize"]);void 0!==t&&null!=n&&Dy(t,["_query","pageSize"],n);const i=Uy(e,["pageToken"]);void 0!==t&&null!=i&&Dy(t,["_query","pageToken"],i);const r=Uy(e,["filter"]);void 0!==t&&null!=r&&Dy(t,["_query","filter"],r)}(n,t),t}(KS=YS||(YS={})).PAGED_ITEM_BATCH_JOBS="batchJobs",KS.PAGED_ITEM_MODELS="models",KS.PAGED_ITEM_TUNING_JOBS="tuningJobs",KS.PAGED_ITEM_FILES="files",KS.PAGED_ITEM_CACHED_CONTENTS="cachedContents",KS.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",KS.PAGED_ITEM_DOCUMENTS="documents";class fb{constructor(e,t,n,i){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,n,i)}init(e,t,n){var i,r;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.sdkHttpResponseInternal=null==t?void 0:t.sdkHttpResponse,this.idxInternal=0;let o={config:{}};o=n&&0!==Object.keys(n).length?"object"==typeof n?Object.assign({},n):n:{config:{}},o.config&&(o.config.pageToken=t.nextPageToken),this.paramsInternal=o,this.pageInternalSize=null!==(r=null===(i=o.config)||void 0===i?void 0:i.pageSize)&&void 0!==r?r:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength){if(!this.hasNextPage())return{value:void 0,done:!0};await this.nextPage()}const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return void 0!==(null===(e=this.params.config)||void 0===e?void 0:e.pageToken)}}class mb extends Ny{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new fb(YS.PAGED_ITEM_BATCH_JOBS,e=>this.listInternal(e),await this.listInternal(e),e),this.create=async e=>(this.apiClient.isVertexAI()&&(e.config=this.formatDestination(e.src,e.config)),this.createInternal(e)),this.createEmbeddings=async e=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(e)}}createInlinedGenerateContentRequest(e){const t=ub(this.apiClient,e),n=Ly("{model}:batchGenerateContent",t._url),i=t.batch.inputConfig.requests,r=i.requests,o=[];for(const s of r){const e=Object.assign({},s);if(e.systemInstruction){const t=e.systemInstruction;delete e.systemInstruction;const n=e.request;n.systemInstruction=t,e.request=n}o.push(e)}return i.requests=o,delete t.config,delete t._url,delete t._query,{path:n,body:t}}getGcsUri(e){return"string"==typeof e?e.startsWith("gs://")?e:void 0:!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0?e.gcsUri[0]:void 0}getBigqueryUri(e){return"string"==typeof e?e.startsWith("bq://")?e:void 0:Array.isArray(e)?void 0:e.bigqueryUri}formatDestination(e,t){const n=t?Object.assign({},t):{},i=Date.now().toString();if(n.displayName||(n.displayName=`genaiBatchJob_${i}`),void 0===n.dest){const t=this.getGcsUri(e),r=this.getBigqueryUri(e);if(t)t.endsWith(".jsonl")?n.dest=`${t.slice(0,-6)}/dest`:n.dest=`${t}_dest_${i}`;else{if(!r)throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.");n.dest=`${r}_dest_${i}`}}return n}async createInternal(e){var t,n,i,r;let o,s="",a={};if(this.apiClient.isVertexAI()){const i=cb(this.apiClient,e);return s=Ly("batchPredictionJobs",i._url),a=i._query,delete i._url,delete i._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(i),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),o.then(e=>ob(e))}{const t=ub(this.apiClient,e);return s=Ly("{model}:batchGenerateContent",t._url),a=t._query,delete t._url,delete t._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(i=e.config)||void 0===i?void 0:i.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()),o.then(e=>rb(e))}}async createEmbeddingsInternal(e){var t,n;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const s=db(this.apiClient,e);return r=Ly("{model}:asyncBatchEmbedContent",s._url),o=s._query,delete s._url,delete s._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),i.then(e=>rb(e))}}async get(e){var t,n,i,r;let o,s="",a={};if(this.apiClient.isVertexAI()){const i=function(e,t){const n={},i=Uy(t,["name"]);return null!=i&&Dy(n,["_url","name"],tb(e,i)),n}(this.apiClient,e);return s=Ly("batchPredictionJobs/{name}",i._url),a=i._query,delete i._url,delete i._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(i),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),o.then(e=>ob(e))}{const t=function(e,t){const n={},i=Uy(t,["name"]);return null!=i&&Dy(n,["_url","name"],tb(e,i)),n}(this.apiClient,e);return s=Ly("batches/{name}",t._url),a=t._query,delete t._url,delete t._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(i=e.config)||void 0===i?void 0:i.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()),o.then(e=>rb(e))}}async cancel(e){var t,n,i,r;let o="",s={};if(this.apiClient.isVertexAI()){const i=function(e,t){const n={},i=Uy(t,["name"]);return null!=i&&Dy(n,["_url","name"],tb(e,i)),n}(this.apiClient,e);o=Ly("batchPredictionJobs/{name}:cancel",i._url),s=i._query,delete i._url,delete i._query,await this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(i),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal})}else{const t=function(e,t){const n={},i=Uy(t,["name"]);return null!=i&&Dy(n,["_url","name"],tb(e,i)),n}(this.apiClient,e);o=Ly("batches/{name}:cancel",t._url),s=t._query,delete t._url,delete t._query,await this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(i=e.config)||void 0===i?void 0:i.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal})}}async listInternal(e){var t,n,i,r;let o,s="",a={};if(this.apiClient.isVertexAI()){const i=pb(e);return s=Ly("batchPredictionJobs",i._url),a=i._query,delete i._url,delete i._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(i),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),o.then(e=>{const t=function(e){const t={},n=Uy(e,["sdkHttpResponse"]);null!=n&&Dy(t,["sdkHttpResponse"],n);const i=Uy(e,["nextPageToken"]);null!=i&&Dy(t,["nextPageToken"],i);const r=Uy(e,["batchPredictionJobs"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>ob(e))),Dy(t,["batchJobs"],e)}return t}(e),n=new SE;return Object.assign(n,t),n})}{const t=hb(e);return s=Ly("batches",t._url),a=t._query,delete t._url,delete t._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(i=e.config)||void 0===i?void 0:i.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),o.then(e=>{const t=function(e){const t={},n=Uy(e,["sdkHttpResponse"]);null!=n&&Dy(t,["sdkHttpResponse"],n);const i=Uy(e,["nextPageToken"]);null!=i&&Dy(t,["nextPageToken"],i);const r=Uy(e,["operations"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>rb(e))),Dy(t,["batchJobs"],e)}return t}(e),n=new SE;return Object.assign(n,t),n})}}async delete(e){var t,n,i,r;let o,s="",a={};if(this.apiClient.isVertexAI()){const i=function(e,t){const n={},i=Uy(t,["name"]);return null!=i&&Dy(n,["_url","name"],tb(e,i)),n}(this.apiClient,e);return s=Ly("batchPredictionJobs/{name}",i._url),a=i._query,delete i._url,delete i._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(i),httpMethod:"DELETE",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),o.then(e=>function(e){const t={},n=Uy(e,["sdkHttpResponse"]);null!=n&&Dy(t,["sdkHttpResponse"],n);const i=Uy(e,["name"]);null!=i&&Dy(t,["name"],i);const r=Uy(e,["done"]);null!=r&&Dy(t,["done"],r);const o=Uy(e,["error"]);return null!=o&&Dy(t,["error"],o),t}(e))}{const t=function(e,t){const n={},i=Uy(t,["name"]);return null!=i&&Dy(n,["_url","name"],tb(e,i)),n}(this.apiClient,e);return s=Ly("batches/{name}",t._url),a=t._query,delete t._url,delete t._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(t),httpMethod:"DELETE",httpOptions:null===(i=e.config)||void 0===i?void 0:i.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),o.then(e=>function(e){const t={},n=Uy(e,["sdkHttpResponse"]);null!=n&&Dy(t,["sdkHttpResponse"],n);const i=Uy(e,["name"]);null!=i&&Dy(t,["name"],i);const r=Uy(e,["done"]);null!=r&&Dy(t,["done"],r);const o=Uy(e,["error"]);return null!=o&&Dy(t,["error"],o),t}(e))}}}function gb(e){const t={},n=Uy(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=Uy(e,["mediaResolution"]);null!=n&&Dy(t,["mediaResolution"],n);const i=Uy(e,["codeExecutionResult"]);null!=i&&Dy(t,["codeExecutionResult"],i);const r=Uy(e,["executableCode"]);null!=r&&Dy(t,["executableCode"],r);const o=Uy(e,["fileData"]);null!=o&&Dy(t,["fileData"],function(e){const t={};if(void 0!==Uy(e,["displayName"]))throw new Error("displayName parameter is not supported in Gemini API.");const n=Uy(e,["fileUri"]);null!=n&&Dy(t,["fileUri"],n);const i=Uy(e,["mimeType"]);null!=i&&Dy(t,["mimeType"],i);return t}(o));const s=Uy(e,["functionCall"]);null!=s&&Dy(t,["functionCall"],function(e){const t={},n=Uy(e,["id"]);null!=n&&Dy(t,["id"],n);const i=Uy(e,["args"]);null!=i&&Dy(t,["args"],i);const r=Uy(e,["name"]);null!=r&&Dy(t,["name"],r);if(void 0!==Uy(e,["partialArgs"]))throw new Error("partialArgs parameter is not supported in Gemini API.");if(void 0!==Uy(e,["willContinue"]))throw new Error("willContinue parameter is not supported in Gemini API.");return t}(s));const a=Uy(e,["functionResponse"]);null!=a&&Dy(t,["functionResponse"],a);const l=Uy(e,["inlineData"]);null!=l&&Dy(t,["inlineData"],function(e){const t={},n=Uy(e,["data"]);if(null!=n&&Dy(t,["data"],n),void 0!==Uy(e,["displayName"]))throw new Error("displayName parameter is not supported in Gemini API.");const i=Uy(e,["mimeType"]);return null!=i&&Dy(t,["mimeType"],i),t}(l));const u=Uy(e,["text"]);null!=u&&Dy(t,["text"],u);const c=Uy(e,["thought"]);null!=c&&Dy(t,["thought"],c);const d=Uy(e,["thoughtSignature"]);null!=d&&Dy(t,["thoughtSignature"],d);const h=Uy(e,["videoMetadata"]);null!=h&&Dy(t,["videoMetadata"],h);return t}(e))),Dy(t,["parts"],e)}const i=Uy(e,["role"]);return null!=i&&Dy(t,["role"],i),t}function vb(e,t){const n=Uy(e,["ttl"]);void 0!==t&&null!=n&&Dy(t,["ttl"],n);const i=Uy(e,["expireTime"]);void 0!==t&&null!=i&&Dy(t,["expireTime"],i);const r=Uy(e,["displayName"]);void 0!==t&&null!=r&&Dy(t,["displayName"],r);const o=Uy(e,["contents"]);if(void 0!==t&&null!=o){let e=FE(o);Array.isArray(e)&&(e=e.map(e=>gb(e))),Dy(t,["contents"],e)}const s=Uy(e,["systemInstruction"]);void 0!==t&&null!=s&&Dy(t,["systemInstruction"],gb(UE(s)));const a=Uy(e,["tools"]);if(void 0!==t&&null!=a){let e=a;Array.isArray(e)&&(e=e.map(e=>function(e){const t={};if(void 0!==Uy(e,["retrieval"]))throw new Error("retrieval parameter is not supported in Gemini API.");const n=Uy(e,["computerUse"]);null!=n&&Dy(t,["computerUse"],n);const i=Uy(e,["fileSearch"]);null!=i&&Dy(t,["fileSearch"],i);const r=Uy(e,["codeExecution"]);null!=r&&Dy(t,["codeExecution"],r);if(void 0!==Uy(e,["enterpriseWebSearch"]))throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const o=Uy(e,["functionDeclarations"]);if(null!=o){let e=o;Array.isArray(e)&&(e=e.map(e=>e)),Dy(t,["functionDeclarations"],e)}const s=Uy(e,["googleMaps"]);null!=s&&Dy(t,["googleMaps"],function(e){const t={};if(void 0!==Uy(e,["authConfig"]))throw new Error("authConfig parameter is not supported in Gemini API.");const n=Uy(e,["enableWidget"]);null!=n&&Dy(t,["enableWidget"],n);return t}(s));const a=Uy(e,["googleSearch"]);null!=a&&Dy(t,["googleSearch"],function(e){const t={};if(void 0!==Uy(e,["excludeDomains"]))throw new Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==Uy(e,["blockingConfidence"]))throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=Uy(e,["timeRangeFilter"]);null!=n&&Dy(t,["timeRangeFilter"],n);return t}(a));const l=Uy(e,["googleSearchRetrieval"]);null!=l&&Dy(t,["googleSearchRetrieval"],l);const u=Uy(e,["urlContext"]);null!=u&&Dy(t,["urlContext"],u);return t}(e))),Dy(t,["tools"],e)}const l=Uy(e,["toolConfig"]);if(void 0!==t&&null!=l&&Dy(t,["toolConfig"],function(e){const t={},n=Uy(e,["retrievalConfig"]);null!=n&&Dy(t,["retrievalConfig"],n);const i=Uy(e,["functionCallingConfig"]);null!=i&&Dy(t,["functionCallingConfig"],function(e){const t={},n=Uy(e,["allowedFunctionNames"]);null!=n&&Dy(t,["allowedFunctionNames"],n);const i=Uy(e,["mode"]);null!=i&&Dy(t,["mode"],i);if(void 0!==Uy(e,["streamFunctionCallArguments"]))throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}(i));return t}(l)),void 0!==Uy(e,["kmsKeyName"]))throw new Error("kmsKeyName parameter is not supported in Gemini API.");return{}}function _b(e,t){const n=Uy(e,["ttl"]);void 0!==t&&null!=n&&Dy(t,["ttl"],n);const i=Uy(e,["expireTime"]);void 0!==t&&null!=i&&Dy(t,["expireTime"],i);const r=Uy(e,["displayName"]);void 0!==t&&null!=r&&Dy(t,["displayName"],r);const o=Uy(e,["contents"]);if(void 0!==t&&null!=o){let e=FE(o);Array.isArray(e)&&(e=e.map(e=>e)),Dy(t,["contents"],e)}const s=Uy(e,["systemInstruction"]);void 0!==t&&null!=s&&Dy(t,["systemInstruction"],UE(s));const a=Uy(e,["tools"]);if(void 0!==t&&null!=a){let e=a;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=Uy(e,["retrieval"]);null!=n&&Dy(t,["retrieval"],n);const i=Uy(e,["computerUse"]);null!=i&&Dy(t,["computerUse"],i);if(void 0!==Uy(e,["fileSearch"]))throw new Error("fileSearch parameter is not supported in Vertex AI.");const r=Uy(e,["codeExecution"]);null!=r&&Dy(t,["codeExecution"],r);const o=Uy(e,["enterpriseWebSearch"]);null!=o&&Dy(t,["enterpriseWebSearch"],o);const s=Uy(e,["functionDeclarations"]);if(null!=s){let e=s;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=Uy(e,["description"]);null!=n&&Dy(t,["description"],n);const i=Uy(e,["name"]);null!=i&&Dy(t,["name"],i);const r=Uy(e,["parameters"]);null!=r&&Dy(t,["parameters"],r);const o=Uy(e,["parametersJsonSchema"]);null!=o&&Dy(t,["parametersJsonSchema"],o);const s=Uy(e,["response"]);null!=s&&Dy(t,["response"],s);const a=Uy(e,["responseJsonSchema"]);null!=a&&Dy(t,["responseJsonSchema"],a);if(void 0!==Uy(e,["behavior"]))throw new Error("behavior parameter is not supported in Vertex AI.");return t}(e))),Dy(t,["functionDeclarations"],e)}const a=Uy(e,["googleMaps"]);null!=a&&Dy(t,["googleMaps"],a);const l=Uy(e,["googleSearch"]);null!=l&&Dy(t,["googleSearch"],l);const u=Uy(e,["googleSearchRetrieval"]);null!=u&&Dy(t,["googleSearchRetrieval"],u);const c=Uy(e,["urlContext"]);null!=c&&Dy(t,["urlContext"],c);return t}(e))),Dy(t,["tools"],e)}const l=Uy(e,["toolConfig"]);void 0!==t&&null!=l&&Dy(t,["toolConfig"],l);const u=Uy(e,["kmsKeyName"]);return void 0!==t&&null!=u&&Dy(t,["encryption_spec","kmsKeyName"],u),{}}function yb(e){const t={},n=Uy(e,["config"]);return null!=n&&function(e,t){const n=Uy(e,["pageSize"]);void 0!==t&&null!=n&&Dy(t,["_query","pageSize"],n);const i=Uy(e,["pageToken"]);void 0!==t&&null!=i&&Dy(t,["_query","pageToken"],i)}(n,t),t}function xb(e){const t={},n=Uy(e,["config"]);return null!=n&&function(e,t){const n=Uy(e,["pageSize"]);void 0!==t&&null!=n&&Dy(t,["_query","pageSize"],n);const i=Uy(e,["pageToken"]);void 0!==t&&null!=i&&Dy(t,["_query","pageToken"],i)}(n,t),t}function Sb(e,t){const n={},i=Uy(t,["name"]);null!=i&&Dy(n,["_url","name"],jE(e,i));const r=Uy(t,["config"]);return null!=r&&function(e,t){const n=Uy(e,["ttl"]);void 0!==t&&null!=n&&Dy(t,["ttl"],n);const i=Uy(e,["expireTime"]);void 0!==t&&null!=i&&Dy(t,["expireTime"],i)}(r,n),n}function Eb(e,t){const n={},i=Uy(t,["name"]);null!=i&&Dy(n,["_url","name"],jE(e,i));const r=Uy(t,["config"]);return null!=r&&function(e,t){const n=Uy(e,["ttl"]);void 0!==t&&null!=n&&Dy(t,["ttl"],n);const i=Uy(e,["expireTime"]);void 0!==t&&null!=i&&Dy(t,["expireTime"],i)}(r,n),n}class bb extends Ny{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new fb(YS.PAGED_ITEM_CACHED_CONTENTS,e=>this.listInternal(e),await this.listInternal(e),e)}async create(e){var t,n,i,r;let o,s="",a={};if(this.apiClient.isVertexAI()){const i=function(e,t){const n={},i=Uy(t,["model"]);null!=i&&Dy(n,["model"],ME(e,i));const r=Uy(t,["config"]);return null!=r&&_b(r,n),n}(this.apiClient,e);return s=Ly("cachedContents",i._url),a=i._query,delete i._url,delete i._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(i),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),o.then(e=>e)}{const t=function(e,t){const n={},i=Uy(t,["model"]);null!=i&&Dy(n,["model"],ME(e,i));const r=Uy(t,["config"]);return null!=r&&vb(r,n),n}(this.apiClient,e);return s=Ly("cachedContents",t._url),a=t._query,delete t._url,delete t._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(i=e.config)||void 0===i?void 0:i.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()),o.then(e=>e)}}async get(e){var t,n,i,r;let o,s="",a={};if(this.apiClient.isVertexAI()){const i=function(e,t){const n={},i=Uy(t,["name"]);return null!=i&&Dy(n,["_url","name"],jE(e,i)),n}(this.apiClient,e);return s=Ly("{name}",i._url),a=i._query,delete i._url,delete i._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(i),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),o.then(e=>e)}{const t=function(e,t){const n={},i=Uy(t,["name"]);return null!=i&&Dy(n,["_url","name"],jE(e,i)),n}(this.apiClient,e);return s=Ly("{name}",t._url),a=t._query,delete t._url,delete t._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(i=e.config)||void 0===i?void 0:i.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()),o.then(e=>e)}}async delete(e){var t,n,i,r;let o,s="",a={};if(this.apiClient.isVertexAI()){const i=function(e,t){const n={},i=Uy(t,["name"]);return null!=i&&Dy(n,["_url","name"],jE(e,i)),n}(this.apiClient,e);return s=Ly("{name}",i._url),a=i._query,delete i._url,delete i._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(i),httpMethod:"DELETE",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),o.then(e=>{const t=function(e){const t={},n=Uy(e,["sdkHttpResponse"]);return null!=n&&Dy(t,["sdkHttpResponse"],n),t}(e),n=new dE;return Object.assign(n,t),n})}{const t=function(e,t){const n={},i=Uy(t,["name"]);return null!=i&&Dy(n,["_url","name"],jE(e,i)),n}(this.apiClient,e);return s=Ly("{name}",t._url),a=t._query,delete t._url,delete t._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(t),httpMethod:"DELETE",httpOptions:null===(i=e.config)||void 0===i?void 0:i.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),o.then(e=>{const t=function(e){const t={},n=Uy(e,["sdkHttpResponse"]);return null!=n&&Dy(t,["sdkHttpResponse"],n),t}(e),n=new dE;return Object.assign(n,t),n})}}async update(e){var t,n,i,r;let o,s="",a={};if(this.apiClient.isVertexAI()){const i=Eb(this.apiClient,e);return s=Ly("{name}",i._url),a=i._query,delete i._url,delete i._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(i),httpMethod:"PATCH",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),o.then(e=>e)}{const t=Sb(this.apiClient,e);return s=Ly("{name}",t._url),a=t._query,delete t._url,delete t._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(t),httpMethod:"PATCH",httpOptions:null===(i=e.config)||void 0===i?void 0:i.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()),o.then(e=>e)}}async listInternal(e){var t,n,i,r;let o,s="",a={};if(this.apiClient.isVertexAI()){const i=xb(e);return s=Ly("cachedContents",i._url),a=i._query,delete i._url,delete i._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(i),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),o.then(e=>{const t=function(e){const t={},n=Uy(e,["sdkHttpResponse"]);null!=n&&Dy(t,["sdkHttpResponse"],n);const i=Uy(e,["nextPageToken"]);null!=i&&Dy(t,["nextPageToken"],i);const r=Uy(e,["cachedContents"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),Dy(t,["cachedContents"],e)}return t}(e),n=new hE;return Object.assign(n,t),n})}{const t=yb(e);return s=Ly("cachedContents",t._url),a=t._query,delete t._url,delete t._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(i=e.config)||void 0===i?void 0:i.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),o.then(e=>{const t=function(e){const t={},n=Uy(e,["sdkHttpResponse"]);null!=n&&Dy(t,["sdkHttpResponse"],n);const i=Uy(e,["nextPageToken"]);null!=i&&Dy(t,["nextPageToken"],i);const r=Uy(e,["cachedContents"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),Dy(t,["cachedContents"],e)}return t}(e),n=new hE;return Object.assign(n,t),n})}}}function Tb(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}function wb(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Mb(e){return this instanceof Mb?(this.v=e,this):new Mb(e)}function Ab(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,r=n.apply(e,t||[]),o=[];return i=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),s("next"),s("throw"),s("return",function(e){return function(t){return Promise.resolve(t).then(e,u)}}),i[Symbol.asyncIterator]=function(){return this},i;function s(e,t){r[e]&&(i[e]=function(t){return new Promise(function(n,i){o.push([e,t,n,i])>1||a(e,t)})},t&&(i[e]=t(i[e])))}function a(e,t){try{(n=r[e](t)).value instanceof Mb?Promise.resolve(n.value.v).then(l,u):c(o[0][2],n)}catch(BM){c(o[0][3],BM)}var n}function l(e){a("next",e)}function u(e){a("throw",e)}function c(e,t){e(t),o.shift(),o.length&&a(o[0][0],o[0][1])}}function Rb(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=wb(e),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=e[n]&&function(t){return new Promise(function(i,r){(function(e,t,n,i){Promise.resolve(i).then(function(t){e({value:t,done:n})},t)})(i,r,(t=e[n](t)).done,t.value)})}}}function Cb(e){var t;if(null==e.candidates||0===e.candidates.length)return!1;const n=null===(t=e.candidates[0])||void 0===t?void 0:t.content;return void 0!==n&&Ib(n)}function Ib(e){if(void 0===e.parts||0===e.parts.length)return!1;for(const t of e.parts)if(void 0===t||0===Object.keys(t).length)return!1;return!0}function Pb(e){if(void 0===e||0===e.length)return[];const t=[],n=e.length;let i=0;for(;i<n;)if("user"===e[i].role)t.push(e[i]),i++;else{const r=[];let o=!0;for(;i<n&&"model"===e[i].role;)r.push(e[i]),o&&!Ib(e[i])&&(o=!1),i++;o?t.push(...r):t.pop()}return t}"function"==typeof SuppressedError&&SuppressedError;class Ob{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new Nb(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class Nb{constructor(e,t,n,i={},r=[]){this.apiClient=e,this.modelsModule=t,this.model=n,this.config=i,this.history=r,this.sendPromise=Promise.resolve(),function(e){if(0!==e.length)for(const t of e)if("user"!==t.role&&"model"!==t.role)throw new Error(`Role must be user or model, but got ${t.role}.`)}(r)}async sendMessage(e){var t;await this.sendPromise;const n=UE(e.message),i=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(n),config:null!==(t=e.config)&&void 0!==t?t:this.config});return this.sendPromise=(async()=>{var e,t,r;const o=await i,s=null===(t=null===(e=o.candidates)||void 0===e?void 0:e[0])||void 0===t?void 0:t.content,a=o.automaticFunctionCallingHistory,l=this.getHistory(!0).length;let u=[];null!=a&&(u=null!==(r=a.slice(l))&&void 0!==r?r:[]);const c=s?[s]:[];this.recordHistory(n,c,u)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),i}async sendMessageStream(e){var t;await this.sendPromise;const n=UE(e.message),i=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(n),config:null!==(t=e.config)&&void 0!==t?t:this.config});this.sendPromise=i.then(()=>{}).catch(()=>{});const r=await i;return this.processStreamResponse(r,n)}getHistory(e=!1){const t=e?Pb(this.history):this.history;return structuredClone(t)}processStreamResponse(e,t){return Ab(this,arguments,function*(){var n,i,r,o,s,a;const l=[];try{for(var u,c=!0,d=Rb(e);!(n=(u=yield Mb(d.next())).done);c=!0){o=u.value,c=!1;const e=o;if(Cb(e)){const t=null===(a=null===(s=e.candidates)||void 0===s?void 0:s[0])||void 0===a?void 0:a.content;void 0!==t&&l.push(t)}yield yield Mb(e)}}catch(h){i={error:h}}finally{try{c||n||!(r=d.return)||(yield Mb(r.call(d)))}finally{if(i)throw i.error}}this.recordHistory(t,l)})}recordHistory(e,t,n){let i=[];t.length>0&&t.every(e=>void 0!==e.role)?i=t:i.push({role:"model",parts:[]}),n&&n.length>0?this.history.push(...Pb(n)):this.history.push(e),this.history.push(...i)}}class Lb extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,Lb.prototype)}}function Db(e){const t={},n=Uy(e,["config"]);return null!=n&&function(e,t){const n=Uy(e,["pageSize"]);void 0!==t&&null!=n&&Dy(t,["_query","pageSize"],n);const i=Uy(e,["pageToken"]);void 0!==t&&null!=i&&Dy(t,["_query","pageToken"],i)}(n,t),t}class Ub extends Ny{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new fb(YS.PAGED_ITEM_FILES,e=>this.listInternal(e),await this.listInternal(e),e)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(e=>e)}async download(e){await this.apiClient.downloadFile(e)}async registerFiles(e){throw new Error("registerFiles is only supported in Node.js environments.")}async _registerFiles(e){return this.registerFilesInternal(e)}async listInternal(e){var t,n;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const s=Db(e);return r=Ly("files",s._url),o=s._query,delete s._url,delete s._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),i.then(e=>{const t=function(e){const t={},n=Uy(e,["sdkHttpResponse"]);null!=n&&Dy(t,["sdkHttpResponse"],n);const i=Uy(e,["nextPageToken"]);null!=i&&Dy(t,["nextPageToken"],i);const r=Uy(e,["files"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),Dy(t,["files"],e)}return t}(e),n=new vE;return Object.assign(n,t),n})}}async createInternal(e){var t,n;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const s=function(e){const t={},n=Uy(e,["file"]);return null!=n&&Dy(t,["file"],n),t}(e);return r=Ly("upload/v1beta/files",s._url),o=s._query,delete s._url,delete s._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),i.then(e=>{const t=function(e){const t={},n=Uy(e,["sdkHttpResponse"]);return null!=n&&Dy(t,["sdkHttpResponse"],n),t}(e),n=new _E;return Object.assign(n,t),n})}}async get(e){var t,n;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const s=function(e){const t={},n=Uy(e,["name"]);return null!=n&&Dy(t,["_url","file"],YE(n)),t}(e);return r=Ly("files/{file}",s._url),o=s._query,delete s._url,delete s._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),i.then(e=>e)}}async delete(e){var t,n;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const s=function(e){const t={},n=Uy(e,["name"]);return null!=n&&Dy(t,["_url","file"],YE(n)),t}(e);return r=Ly("files/{file}",s._url),o=s._query,delete s._url,delete s._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(s),httpMethod:"DELETE",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),i.then(e=>{const t=function(e){const t={},n=Uy(e,["sdkHttpResponse"]);return null!=n&&Dy(t,["sdkHttpResponse"],n),t}(e),n=new yE;return Object.assign(n,t),n})}}async registerFilesInternal(e){var t,n;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const s=function(e){const t={},n=Uy(e,["uris"]);return null!=n&&Dy(t,["uris"],n),t}(e);return r=Ly("files:register",s._url),o=s._query,delete s._url,delete s._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),i.then(e=>{const t=function(e){const t={},n=Uy(e,["sdkHttpResponse"]);null!=n&&Dy(t,["sdkHttpResponse"],n);const i=Uy(e,["files"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),Dy(t,["files"],e)}return t}(e),n=new xE;return Object.assign(n,t),n})}}}function kb(e){const t={},n=Uy(e,["data"]);if(null!=n&&Dy(t,["data"],n),void 0!==Uy(e,["displayName"]))throw new Error("displayName parameter is not supported in Gemini API.");const i=Uy(e,["mimeType"]);return null!=i&&Dy(t,["mimeType"],i),t}function Fb(e){const t={},n=Uy(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=Uy(e,["mediaResolution"]);null!=n&&Dy(t,["mediaResolution"],n);const i=Uy(e,["codeExecutionResult"]);null!=i&&Dy(t,["codeExecutionResult"],i);const r=Uy(e,["executableCode"]);null!=r&&Dy(t,["executableCode"],r);const o=Uy(e,["fileData"]);null!=o&&Dy(t,["fileData"],function(e){const t={};if(void 0!==Uy(e,["displayName"]))throw new Error("displayName parameter is not supported in Gemini API.");const n=Uy(e,["fileUri"]);null!=n&&Dy(t,["fileUri"],n);const i=Uy(e,["mimeType"]);null!=i&&Dy(t,["mimeType"],i);return t}(o));const s=Uy(e,["functionCall"]);null!=s&&Dy(t,["functionCall"],function(e){const t={},n=Uy(e,["id"]);null!=n&&Dy(t,["id"],n);const i=Uy(e,["args"]);null!=i&&Dy(t,["args"],i);const r=Uy(e,["name"]);null!=r&&Dy(t,["name"],r);if(void 0!==Uy(e,["partialArgs"]))throw new Error("partialArgs parameter is not supported in Gemini API.");if(void 0!==Uy(e,["willContinue"]))throw new Error("willContinue parameter is not supported in Gemini API.");return t}(s));const a=Uy(e,["functionResponse"]);null!=a&&Dy(t,["functionResponse"],a);const l=Uy(e,["inlineData"]);null!=l&&Dy(t,["inlineData"],kb(l));const u=Uy(e,["text"]);null!=u&&Dy(t,["text"],u);const c=Uy(e,["thought"]);null!=c&&Dy(t,["thought"],c);const d=Uy(e,["thoughtSignature"]);null!=d&&Dy(t,["thoughtSignature"],d);const h=Uy(e,["videoMetadata"]);null!=h&&Dy(t,["videoMetadata"],h);return t}(e))),Dy(t,["parts"],e)}const i=Uy(e,["role"]);return null!=i&&Dy(t,["role"],i),t}function Bb(e,t){const n=Uy(e,["generationConfig"]);void 0!==t&&null!=n&&Dy(t,["setup","generationConfig"],n);const i=Uy(e,["responseModalities"]);void 0!==t&&null!=i&&Dy(t,["setup","generationConfig","responseModalities"],i);const r=Uy(e,["temperature"]);void 0!==t&&null!=r&&Dy(t,["setup","generationConfig","temperature"],r);const o=Uy(e,["topP"]);void 0!==t&&null!=o&&Dy(t,["setup","generationConfig","topP"],o);const s=Uy(e,["topK"]);void 0!==t&&null!=s&&Dy(t,["setup","generationConfig","topK"],s);const a=Uy(e,["maxOutputTokens"]);void 0!==t&&null!=a&&Dy(t,["setup","generationConfig","maxOutputTokens"],a);const l=Uy(e,["mediaResolution"]);void 0!==t&&null!=l&&Dy(t,["setup","generationConfig","mediaResolution"],l);const u=Uy(e,["seed"]);void 0!==t&&null!=u&&Dy(t,["setup","generationConfig","seed"],u);const c=Uy(e,["speechConfig"]);void 0!==t&&null!=c&&Dy(t,["setup","generationConfig","speechConfig"],zE(c));const d=Uy(e,["thinkingConfig"]);void 0!==t&&null!=d&&Dy(t,["setup","generationConfig","thinkingConfig"],d);const h=Uy(e,["enableAffectiveDialog"]);void 0!==t&&null!=h&&Dy(t,["setup","generationConfig","enableAffectiveDialog"],h);const p=Uy(e,["systemInstruction"]);void 0!==t&&null!=p&&Dy(t,["setup","systemInstruction"],Fb(UE(p)));const f=Uy(e,["tools"]);if(void 0!==t&&null!=f){let e=WE(f);Array.isArray(e)&&(e=e.map(e=>function(e){const t={};if(void 0!==Uy(e,["retrieval"]))throw new Error("retrieval parameter is not supported in Gemini API.");const n=Uy(e,["computerUse"]);null!=n&&Dy(t,["computerUse"],n);const i=Uy(e,["fileSearch"]);null!=i&&Dy(t,["fileSearch"],i);const r=Uy(e,["codeExecution"]);null!=r&&Dy(t,["codeExecution"],r);if(void 0!==Uy(e,["enterpriseWebSearch"]))throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const o=Uy(e,["functionDeclarations"]);if(null!=o){let e=o;Array.isArray(e)&&(e=e.map(e=>e)),Dy(t,["functionDeclarations"],e)}const s=Uy(e,["googleMaps"]);null!=s&&Dy(t,["googleMaps"],function(e){const t={};if(void 0!==Uy(e,["authConfig"]))throw new Error("authConfig parameter is not supported in Gemini API.");const n=Uy(e,["enableWidget"]);return null!=n&&Dy(t,["enableWidget"],n),t}(s));const a=Uy(e,["googleSearch"]);null!=a&&Dy(t,["googleSearch"],function(e){const t={};if(void 0!==Uy(e,["excludeDomains"]))throw new Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==Uy(e,["blockingConfidence"]))throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=Uy(e,["timeRangeFilter"]);return null!=n&&Dy(t,["timeRangeFilter"],n),t}(a));const l=Uy(e,["googleSearchRetrieval"]);null!=l&&Dy(t,["googleSearchRetrieval"],l);const u=Uy(e,["urlContext"]);null!=u&&Dy(t,["urlContext"],u);return t}(GE(e)))),Dy(t,["setup","tools"],e)}const m=Uy(e,["sessionResumption"]);void 0!==t&&null!=m&&Dy(t,["setup","sessionResumption"],function(e){const t={},n=Uy(e,["handle"]);null!=n&&Dy(t,["handle"],n);if(void 0!==Uy(e,["transparent"]))throw new Error("transparent parameter is not supported in Gemini API.");return t}(m));const g=Uy(e,["inputAudioTranscription"]);void 0!==t&&null!=g&&Dy(t,["setup","inputAudioTranscription"],g);const v=Uy(e,["outputAudioTranscription"]);void 0!==t&&null!=v&&Dy(t,["setup","outputAudioTranscription"],v);const _=Uy(e,["realtimeInputConfig"]);void 0!==t&&null!=_&&Dy(t,["setup","realtimeInputConfig"],_);const y=Uy(e,["contextWindowCompression"]);void 0!==t&&null!=y&&Dy(t,["setup","contextWindowCompression"],y);const x=Uy(e,["proactivity"]);if(void 0!==t&&null!=x&&Dy(t,["setup","proactivity"],x),void 0!==Uy(e,["explicitVadSignal"]))throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return{}}function Hb(e,t){const n=Uy(e,["generationConfig"]);void 0!==t&&null!=n&&Dy(t,["setup","generationConfig"],function(e){const t={},n=Uy(e,["modelSelectionConfig"]);null!=n&&Dy(t,["modelConfig"],n);const i=Uy(e,["responseJsonSchema"]);null!=i&&Dy(t,["responseJsonSchema"],i);const r=Uy(e,["audioTimestamp"]);null!=r&&Dy(t,["audioTimestamp"],r);const o=Uy(e,["candidateCount"]);null!=o&&Dy(t,["candidateCount"],o);const s=Uy(e,["enableAffectiveDialog"]);null!=s&&Dy(t,["enableAffectiveDialog"],s);const a=Uy(e,["frequencyPenalty"]);null!=a&&Dy(t,["frequencyPenalty"],a);const l=Uy(e,["logprobs"]);null!=l&&Dy(t,["logprobs"],l);const u=Uy(e,["maxOutputTokens"]);null!=u&&Dy(t,["maxOutputTokens"],u);const c=Uy(e,["mediaResolution"]);null!=c&&Dy(t,["mediaResolution"],c);const d=Uy(e,["presencePenalty"]);null!=d&&Dy(t,["presencePenalty"],d);const h=Uy(e,["responseLogprobs"]);null!=h&&Dy(t,["responseLogprobs"],h);const p=Uy(e,["responseMimeType"]);null!=p&&Dy(t,["responseMimeType"],p);const f=Uy(e,["responseModalities"]);null!=f&&Dy(t,["responseModalities"],f);const m=Uy(e,["responseSchema"]);null!=m&&Dy(t,["responseSchema"],m);const g=Uy(e,["routingConfig"]);null!=g&&Dy(t,["routingConfig"],g);const v=Uy(e,["seed"]);null!=v&&Dy(t,["seed"],v);const _=Uy(e,["speechConfig"]);null!=_&&Dy(t,["speechConfig"],_);const y=Uy(e,["stopSequences"]);null!=y&&Dy(t,["stopSequences"],y);const x=Uy(e,["temperature"]);null!=x&&Dy(t,["temperature"],x);const S=Uy(e,["thinkingConfig"]);null!=S&&Dy(t,["thinkingConfig"],S);const E=Uy(e,["topK"]);null!=E&&Dy(t,["topK"],E);const b=Uy(e,["topP"]);if(null!=b&&Dy(t,["topP"],b),void 0!==Uy(e,["enableEnhancedCivicAnswers"]))throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}(n));const i=Uy(e,["responseModalities"]);void 0!==t&&null!=i&&Dy(t,["setup","generationConfig","responseModalities"],i);const r=Uy(e,["temperature"]);void 0!==t&&null!=r&&Dy(t,["setup","generationConfig","temperature"],r);const o=Uy(e,["topP"]);void 0!==t&&null!=o&&Dy(t,["setup","generationConfig","topP"],o);const s=Uy(e,["topK"]);void 0!==t&&null!=s&&Dy(t,["setup","generationConfig","topK"],s);const a=Uy(e,["maxOutputTokens"]);void 0!==t&&null!=a&&Dy(t,["setup","generationConfig","maxOutputTokens"],a);const l=Uy(e,["mediaResolution"]);void 0!==t&&null!=l&&Dy(t,["setup","generationConfig","mediaResolution"],l);const u=Uy(e,["seed"]);void 0!==t&&null!=u&&Dy(t,["setup","generationConfig","seed"],u);const c=Uy(e,["speechConfig"]);void 0!==t&&null!=c&&Dy(t,["setup","generationConfig","speechConfig"],zE(c));const d=Uy(e,["thinkingConfig"]);void 0!==t&&null!=d&&Dy(t,["setup","generationConfig","thinkingConfig"],d);const h=Uy(e,["enableAffectiveDialog"]);void 0!==t&&null!=h&&Dy(t,["setup","generationConfig","enableAffectiveDialog"],h);const p=Uy(e,["systemInstruction"]);void 0!==t&&null!=p&&Dy(t,["setup","systemInstruction"],UE(p));const f=Uy(e,["tools"]);if(void 0!==t&&null!=f){let e=WE(f);Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=Uy(e,["retrieval"]);null!=n&&Dy(t,["retrieval"],n);const i=Uy(e,["computerUse"]);null!=i&&Dy(t,["computerUse"],i);if(void 0!==Uy(e,["fileSearch"]))throw new Error("fileSearch parameter is not supported in Vertex AI.");const r=Uy(e,["codeExecution"]);null!=r&&Dy(t,["codeExecution"],r);const o=Uy(e,["enterpriseWebSearch"]);null!=o&&Dy(t,["enterpriseWebSearch"],o);const s=Uy(e,["functionDeclarations"]);if(null!=s){let e=s;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=Uy(e,["description"]);null!=n&&Dy(t,["description"],n);const i=Uy(e,["name"]);null!=i&&Dy(t,["name"],i);const r=Uy(e,["parameters"]);null!=r&&Dy(t,["parameters"],r);const o=Uy(e,["parametersJsonSchema"]);null!=o&&Dy(t,["parametersJsonSchema"],o);const s=Uy(e,["response"]);null!=s&&Dy(t,["response"],s);const a=Uy(e,["responseJsonSchema"]);if(null!=a&&Dy(t,["responseJsonSchema"],a),void 0!==Uy(e,["behavior"]))throw new Error("behavior parameter is not supported in Vertex AI.");return t}(e))),Dy(t,["functionDeclarations"],e)}const a=Uy(e,["googleMaps"]);null!=a&&Dy(t,["googleMaps"],a);const l=Uy(e,["googleSearch"]);null!=l&&Dy(t,["googleSearch"],l);const u=Uy(e,["googleSearchRetrieval"]);null!=u&&Dy(t,["googleSearchRetrieval"],u);const c=Uy(e,["urlContext"]);null!=c&&Dy(t,["urlContext"],c);return t}(GE(e)))),Dy(t,["setup","tools"],e)}const m=Uy(e,["sessionResumption"]);void 0!==t&&null!=m&&Dy(t,["setup","sessionResumption"],m);const g=Uy(e,["inputAudioTranscription"]);void 0!==t&&null!=g&&Dy(t,["setup","inputAudioTranscription"],g);const v=Uy(e,["outputAudioTranscription"]);void 0!==t&&null!=v&&Dy(t,["setup","outputAudioTranscription"],v);const _=Uy(e,["realtimeInputConfig"]);void 0!==t&&null!=_&&Dy(t,["setup","realtimeInputConfig"],_);const y=Uy(e,["contextWindowCompression"]);void 0!==t&&null!=y&&Dy(t,["setup","contextWindowCompression"],y);const x=Uy(e,["proactivity"]);void 0!==t&&null!=x&&Dy(t,["setup","proactivity"],x);const S=Uy(e,["explicitVadSignal"]);return void 0!==t&&null!=S&&Dy(t,["setup","explicitVadSignal"],S),{}}function Vb(e){const t={},n=Uy(e,["media"]);if(null!=n){let e=AE(n);Array.isArray(e)&&(e=e.map(e=>kb(e))),Dy(t,["mediaChunks"],e)}const i=Uy(e,["audio"]);null!=i&&Dy(t,["audio"],kb(IE(i)));const r=Uy(e,["audioStreamEnd"]);null!=r&&Dy(t,["audioStreamEnd"],r);const o=Uy(e,["video"]);null!=o&&Dy(t,["video"],kb(CE(o)));const s=Uy(e,["text"]);null!=s&&Dy(t,["text"],s);const a=Uy(e,["activityStart"]);null!=a&&Dy(t,["activityStart"],a);const l=Uy(e,["activityEnd"]);return null!=l&&Dy(t,["activityEnd"],l),t}function zb(e){const t={},n=Uy(e,["media"]);if(null!=n){let e=AE(n);Array.isArray(e)&&(e=e.map(e=>e)),Dy(t,["mediaChunks"],e)}const i=Uy(e,["audio"]);null!=i&&Dy(t,["audio"],IE(i));const r=Uy(e,["audioStreamEnd"]);null!=r&&Dy(t,["audioStreamEnd"],r);const o=Uy(e,["video"]);null!=o&&Dy(t,["video"],CE(o));const s=Uy(e,["text"]);null!=s&&Dy(t,["text"],s);const a=Uy(e,["activityStart"]);null!=a&&Dy(t,["activityStart"],a);const l=Uy(e,["activityEnd"]);return null!=l&&Dy(t,["activityEnd"],l),t}function Gb(e){const t={},n=Uy(e,["setupComplete"]);null!=n&&Dy(t,["setupComplete"],n);const i=Uy(e,["serverContent"]);null!=i&&Dy(t,["serverContent"],i);const r=Uy(e,["toolCall"]);null!=r&&Dy(t,["toolCall"],r);const o=Uy(e,["toolCallCancellation"]);null!=o&&Dy(t,["toolCallCancellation"],o);const s=Uy(e,["usageMetadata"]);null!=s&&Dy(t,["usageMetadata"],function(e){const t={},n=Uy(e,["promptTokenCount"]);null!=n&&Dy(t,["promptTokenCount"],n);const i=Uy(e,["cachedContentTokenCount"]);null!=i&&Dy(t,["cachedContentTokenCount"],i);const r=Uy(e,["candidatesTokenCount"]);null!=r&&Dy(t,["responseTokenCount"],r);const o=Uy(e,["toolUsePromptTokenCount"]);null!=o&&Dy(t,["toolUsePromptTokenCount"],o);const s=Uy(e,["thoughtsTokenCount"]);null!=s&&Dy(t,["thoughtsTokenCount"],s);const a=Uy(e,["totalTokenCount"]);null!=a&&Dy(t,["totalTokenCount"],a);const l=Uy(e,["promptTokensDetails"]);if(null!=l){let e=l;Array.isArray(e)&&(e=e.map(e=>e)),Dy(t,["promptTokensDetails"],e)}const u=Uy(e,["cacheTokensDetails"]);if(null!=u){let e=u;Array.isArray(e)&&(e=e.map(e=>e)),Dy(t,["cacheTokensDetails"],e)}const c=Uy(e,["candidatesTokensDetails"]);if(null!=c){let e=c;Array.isArray(e)&&(e=e.map(e=>e)),Dy(t,["responseTokensDetails"],e)}const d=Uy(e,["toolUsePromptTokensDetails"]);if(null!=d){let e=d;Array.isArray(e)&&(e=e.map(e=>e)),Dy(t,["toolUsePromptTokensDetails"],e)}const h=Uy(e,["trafficType"]);null!=h&&Dy(t,["trafficType"],h);return t}(s));const a=Uy(e,["goAway"]);null!=a&&Dy(t,["goAway"],a);const l=Uy(e,["sessionResumptionUpdate"]);null!=l&&Dy(t,["sessionResumptionUpdate"],l);const u=Uy(e,["voiceActivityDetectionSignal"]);null!=u&&Dy(t,["voiceActivityDetectionSignal"],u);const c=Uy(e,["voiceActivity"]);return null!=c&&Dy(t,["voiceActivity"],function(e){const t={},n=Uy(e,["type"]);null!=n&&Dy(t,["voiceActivityType"],n);return t}(c)),t}function Wb(e,t){const n={},i=Uy(e,["content"]);null!=i&&Dy(n,["content"],i);const r=Uy(e,["citationMetadata"]);null!=r&&Dy(n,["citationMetadata"],function(e){const t={},n=Uy(e,["citationSources"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),Dy(t,["citations"],e)}return t}(r));const o=Uy(e,["tokenCount"]);null!=o&&Dy(n,["tokenCount"],o);const s=Uy(e,["finishReason"]);null!=s&&Dy(n,["finishReason"],s);const a=Uy(e,["avgLogprobs"]);null!=a&&Dy(n,["avgLogprobs"],a);const l=Uy(e,["groundingMetadata"]);null!=l&&Dy(n,["groundingMetadata"],l);const u=Uy(e,["index"]);null!=u&&Dy(n,["index"],u);const c=Uy(e,["logprobsResult"]);null!=c&&Dy(n,["logprobsResult"],c);const d=Uy(e,["safetyRatings"]);if(null!=d){let e=d;Array.isArray(e)&&(e=e.map(e=>e)),Dy(n,["safetyRatings"],e)}const h=Uy(e,["urlContextMetadata"]);return null!=h&&Dy(n,["urlContextMetadata"],h),n}function jb(e,t){const n={},i=Uy(e,["values"]);null!=i&&Dy(n,["values"],i);const r=Uy(e,["statistics"]);return null!=r&&Dy(n,["statistics"],function(e){const t={},n=Uy(e,["truncated"]);null!=n&&Dy(t,["truncated"],n);const i=Uy(e,["token_count"]);null!=i&&Dy(t,["tokenCount"],i);return t}(r)),n}function qb(e,t){const n={},i=Uy(e,["parts"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=Uy(e,["mediaResolution"]);null!=n&&Dy(t,["mediaResolution"],n);const i=Uy(e,["codeExecutionResult"]);null!=i&&Dy(t,["codeExecutionResult"],i);const r=Uy(e,["executableCode"]);null!=r&&Dy(t,["executableCode"],r);const o=Uy(e,["fileData"]);null!=o&&Dy(t,["fileData"],function(e){const t={};if(void 0!==Uy(e,["displayName"]))throw new Error("displayName parameter is not supported in Gemini API.");const n=Uy(e,["fileUri"]);null!=n&&Dy(t,["fileUri"],n);const i=Uy(e,["mimeType"]);null!=i&&Dy(t,["mimeType"],i);return t}(o));const s=Uy(e,["functionCall"]);null!=s&&Dy(t,["functionCall"],function(e){const t={},n=Uy(e,["id"]);null!=n&&Dy(t,["id"],n);const i=Uy(e,["args"]);null!=i&&Dy(t,["args"],i);const r=Uy(e,["name"]);null!=r&&Dy(t,["name"],r);if(void 0!==Uy(e,["partialArgs"]))throw new Error("partialArgs parameter is not supported in Gemini API.");if(void 0!==Uy(e,["willContinue"]))throw new Error("willContinue parameter is not supported in Gemini API.");return t}(s));const a=Uy(e,["functionResponse"]);null!=a&&Dy(t,["functionResponse"],a);const l=Uy(e,["inlineData"]);null!=l&&Dy(t,["inlineData"],function(e){const t={},n=Uy(e,["data"]);if(null!=n&&Dy(t,["data"],n),void 0!==Uy(e,["displayName"]))throw new Error("displayName parameter is not supported in Gemini API.");const i=Uy(e,["mimeType"]);return null!=i&&Dy(t,["mimeType"],i),t}(l));const u=Uy(e,["text"]);null!=u&&Dy(t,["text"],u);const c=Uy(e,["thought"]);null!=c&&Dy(t,["thought"],c);const d=Uy(e,["thoughtSignature"]);null!=d&&Dy(t,["thoughtSignature"],d);const h=Uy(e,["videoMetadata"]);null!=h&&Dy(t,["videoMetadata"],h);return t}(e))),Dy(n,["parts"],e)}const r=Uy(e,["role"]);return null!=r&&Dy(n,["role"],r),n}function Xb(e,t,n){const i=Uy(e,["systemInstruction"]);void 0!==t&&null!=i&&Dy(t,["systemInstruction"],UE(i));const r=Uy(e,["tools"]);if(void 0!==t&&null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>MT(e))),Dy(t,["tools"],e)}const o=Uy(e,["generationConfig"]);return void 0!==t&&null!=o&&Dy(t,["generationConfig"],function(e){const t={},n=Uy(e,["modelSelectionConfig"]);null!=n&&Dy(t,["modelConfig"],n);const i=Uy(e,["responseJsonSchema"]);null!=i&&Dy(t,["responseJsonSchema"],i);const r=Uy(e,["audioTimestamp"]);null!=r&&Dy(t,["audioTimestamp"],r);const o=Uy(e,["candidateCount"]);null!=o&&Dy(t,["candidateCount"],o);const s=Uy(e,["enableAffectiveDialog"]);null!=s&&Dy(t,["enableAffectiveDialog"],s);const a=Uy(e,["frequencyPenalty"]);null!=a&&Dy(t,["frequencyPenalty"],a);const l=Uy(e,["logprobs"]);null!=l&&Dy(t,["logprobs"],l);const u=Uy(e,["maxOutputTokens"]);null!=u&&Dy(t,["maxOutputTokens"],u);const c=Uy(e,["mediaResolution"]);null!=c&&Dy(t,["mediaResolution"],c);const d=Uy(e,["presencePenalty"]);null!=d&&Dy(t,["presencePenalty"],d);const h=Uy(e,["responseLogprobs"]);null!=h&&Dy(t,["responseLogprobs"],h);const p=Uy(e,["responseMimeType"]);null!=p&&Dy(t,["responseMimeType"],p);const f=Uy(e,["responseModalities"]);null!=f&&Dy(t,["responseModalities"],f);const m=Uy(e,["responseSchema"]);null!=m&&Dy(t,["responseSchema"],m);const g=Uy(e,["routingConfig"]);null!=g&&Dy(t,["routingConfig"],g);const v=Uy(e,["seed"]);null!=v&&Dy(t,["seed"],v);const _=Uy(e,["speechConfig"]);null!=_&&Dy(t,["speechConfig"],_);const y=Uy(e,["stopSequences"]);null!=y&&Dy(t,["stopSequences"],y);const x=Uy(e,["temperature"]);null!=x&&Dy(t,["temperature"],x);const S=Uy(e,["thinkingConfig"]);null!=S&&Dy(t,["thinkingConfig"],S);const E=Uy(e,["topK"]);null!=E&&Dy(t,["topK"],E);const b=Uy(e,["topP"]);null!=b&&Dy(t,["topP"],b);if(void 0!==Uy(e,["enableEnhancedCivicAnswers"]))throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}(o)),{}}function Yb(e,t,n){const i={},r=Uy(t,["model"]);null!=r&&Dy(i,["_url","model"],wE(e,r));const o=Uy(t,["contents"]);if(null!=o){let e=FE(o);Array.isArray(e)&&(e=e.map(e=>qb(e))),Dy(i,["contents"],e)}const s=Uy(t,["config"]);return null!=s&&function(e){if(void 0!==Uy(e,["systemInstruction"]))throw new Error("systemInstruction parameter is not supported in Gemini API.");if(void 0!==Uy(e,["tools"]))throw new Error("tools parameter is not supported in Gemini API.");if(void 0!==Uy(e,["generationConfig"]))throw new Error("generationConfig parameter is not supported in Gemini API.")}(s),i}function Kb(e,t,n){const i={},r=Uy(t,["model"]);null!=r&&Dy(i,["_url","model"],wE(e,r));const o=Uy(t,["prompt"]);null!=o&&Dy(i,["instances[0]","prompt"],o);const s=Uy(t,["referenceImages"]);if(null!=s){let e=s;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=Uy(e,["referenceImage"]);null!=n&&Dy(t,["referenceImage"],gT(n));const i=Uy(e,["referenceId"]);null!=i&&Dy(t,["referenceId"],i);const r=Uy(e,["referenceType"]);null!=r&&Dy(t,["referenceType"],r);const o=Uy(e,["maskImageConfig"]);null!=o&&Dy(t,["maskImageConfig"],function(e){const t={},n=Uy(e,["maskMode"]);null!=n&&Dy(t,["maskMode"],n);const i=Uy(e,["segmentationClasses"]);null!=i&&Dy(t,["maskClasses"],i);const r=Uy(e,["maskDilation"]);null!=r&&Dy(t,["dilation"],r);return t}(o));const s=Uy(e,["controlImageConfig"]);null!=s&&Dy(t,["controlImageConfig"],function(e){const t={},n=Uy(e,["controlType"]);null!=n&&Dy(t,["controlType"],n);const i=Uy(e,["enableControlImageComputation"]);return null!=i&&Dy(t,["computeControl"],i),t}(s));const a=Uy(e,["styleImageConfig"]);null!=a&&Dy(t,["styleImageConfig"],a);const l=Uy(e,["subjectImageConfig"]);null!=l&&Dy(t,["subjectImageConfig"],l);return t}(e))),Dy(i,["instances[0]","referenceImages"],e)}const a=Uy(t,["config"]);return null!=a&&function(e,t){const n=Uy(e,["outputGcsUri"]);void 0!==t&&null!=n&&Dy(t,["parameters","storageUri"],n);const i=Uy(e,["negativePrompt"]);void 0!==t&&null!=i&&Dy(t,["parameters","negativePrompt"],i);const r=Uy(e,["numberOfImages"]);void 0!==t&&null!=r&&Dy(t,["parameters","sampleCount"],r);const o=Uy(e,["aspectRatio"]);void 0!==t&&null!=o&&Dy(t,["parameters","aspectRatio"],o);const s=Uy(e,["guidanceScale"]);void 0!==t&&null!=s&&Dy(t,["parameters","guidanceScale"],s);const a=Uy(e,["seed"]);void 0!==t&&null!=a&&Dy(t,["parameters","seed"],a);const l=Uy(e,["safetyFilterLevel"]);void 0!==t&&null!=l&&Dy(t,["parameters","safetySetting"],l);const u=Uy(e,["personGeneration"]);void 0!==t&&null!=u&&Dy(t,["parameters","personGeneration"],u);const c=Uy(e,["includeSafetyAttributes"]);void 0!==t&&null!=c&&Dy(t,["parameters","includeSafetyAttributes"],c);const d=Uy(e,["includeRaiReason"]);void 0!==t&&null!=d&&Dy(t,["parameters","includeRaiReason"],d);const h=Uy(e,["language"]);void 0!==t&&null!=h&&Dy(t,["parameters","language"],h);const p=Uy(e,["outputMimeType"]);void 0!==t&&null!=p&&Dy(t,["parameters","outputOptions","mimeType"],p);const f=Uy(e,["outputCompressionQuality"]);void 0!==t&&null!=f&&Dy(t,["parameters","outputOptions","compressionQuality"],f);const m=Uy(e,["addWatermark"]);void 0!==t&&null!=m&&Dy(t,["parameters","addWatermark"],m);const g=Uy(e,["labels"]);void 0!==t&&null!=g&&Dy(t,["labels"],g);const v=Uy(e,["editMode"]);void 0!==t&&null!=v&&Dy(t,["parameters","editMode"],v);const _=Uy(e,["baseSteps"]);void 0!==t&&null!=_&&Dy(t,["parameters","editConfig","baseSteps"],_)}(a,i),i}function Jb(e,t,n){const i={},r=Uy(t,["model"]);null!=r&&Dy(i,["_url","model"],wE(e,r));const o=Uy(t,["contents"]);if(null!=o){let t=kE(e,o);Array.isArray(t)&&(t=t.map(e=>e)),Dy(i,["requests[]","content"],t)}const s=Uy(t,["config"]);null!=s&&function(e,t){const n=Uy(e,["taskType"]);void 0!==t&&null!=n&&Dy(t,["requests[]","taskType"],n);const i=Uy(e,["title"]);void 0!==t&&null!=i&&Dy(t,["requests[]","title"],i);const r=Uy(e,["outputDimensionality"]);if(void 0!==t&&null!=r&&Dy(t,["requests[]","outputDimensionality"],r),void 0!==Uy(e,["mimeType"]))throw new Error("mimeType parameter is not supported in Gemini API.");if(void 0!==Uy(e,["autoTruncate"]))throw new Error("autoTruncate parameter is not supported in Gemini API.")}(s,i);const a=Uy(t,["model"]);return void 0!==a&&Dy(i,["requests[]","model"],wE(e,a)),i}function $b(e,t,n){const i={},r=Uy(t,["model"]);null!=r&&Dy(i,["_url","model"],wE(e,r));const o=Uy(t,["contents"]);if(null!=o){let t=kE(e,o);Array.isArray(t)&&(t=t.map(e=>e)),Dy(i,["instances[]","content"],t)}const s=Uy(t,["config"]);return null!=s&&function(e,t){const n=Uy(e,["taskType"]);void 0!==t&&null!=n&&Dy(t,["instances[]","task_type"],n);const i=Uy(e,["title"]);void 0!==t&&null!=i&&Dy(t,["instances[]","title"],i);const r=Uy(e,["outputDimensionality"]);void 0!==t&&null!=r&&Dy(t,["parameters","outputDimensionality"],r);const o=Uy(e,["mimeType"]);void 0!==t&&null!=o&&Dy(t,["instances[]","mimeType"],o);const s=Uy(e,["autoTruncate"]);void 0!==t&&null!=s&&Dy(t,["parameters","autoTruncate"],s)}(s,i),i}function Zb(e,t,n,i){const r={},o=Uy(t,["systemInstruction"]);void 0!==n&&null!=o&&Dy(n,["systemInstruction"],qb(UE(o)));const s=Uy(t,["temperature"]);null!=s&&Dy(r,["temperature"],s);const a=Uy(t,["topP"]);null!=a&&Dy(r,["topP"],a);const l=Uy(t,["topK"]);null!=l&&Dy(r,["topK"],l);const u=Uy(t,["candidateCount"]);null!=u&&Dy(r,["candidateCount"],u);const c=Uy(t,["maxOutputTokens"]);null!=c&&Dy(r,["maxOutputTokens"],c);const d=Uy(t,["stopSequences"]);null!=d&&Dy(r,["stopSequences"],d);const h=Uy(t,["responseLogprobs"]);null!=h&&Dy(r,["responseLogprobs"],h);const p=Uy(t,["logprobs"]);null!=p&&Dy(r,["logprobs"],p);const f=Uy(t,["presencePenalty"]);null!=f&&Dy(r,["presencePenalty"],f);const m=Uy(t,["frequencyPenalty"]);null!=m&&Dy(r,["frequencyPenalty"],m);const g=Uy(t,["seed"]);null!=g&&Dy(r,["seed"],g);const v=Uy(t,["responseMimeType"]);null!=v&&Dy(r,["responseMimeType"],v);const _=Uy(t,["responseSchema"]);null!=_&&Dy(r,["responseSchema"],HE(_));const y=Uy(t,["responseJsonSchema"]);if(null!=y&&Dy(r,["responseJsonSchema"],y),void 0!==Uy(t,["routingConfig"]))throw new Error("routingConfig parameter is not supported in Gemini API.");if(void 0!==Uy(t,["modelSelectionConfig"]))throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const x=Uy(t,["safetySettings"]);if(void 0!==n&&null!=x){let e=x;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=Uy(e,["category"]);null!=n&&Dy(t,["category"],n);if(void 0!==Uy(e,["method"]))throw new Error("method parameter is not supported in Gemini API.");const i=Uy(e,["threshold"]);null!=i&&Dy(t,["threshold"],i);return t}(e))),Dy(n,["safetySettings"],e)}const S=Uy(t,["tools"]);if(void 0!==n&&null!=S){let e=WE(S);Array.isArray(e)&&(e=e.map(e=>function(e){const t={};if(void 0!==Uy(e,["retrieval"]))throw new Error("retrieval parameter is not supported in Gemini API.");const n=Uy(e,["computerUse"]);null!=n&&Dy(t,["computerUse"],n);const i=Uy(e,["fileSearch"]);null!=i&&Dy(t,["fileSearch"],i);const r=Uy(e,["codeExecution"]);null!=r&&Dy(t,["codeExecution"],r);if(void 0!==Uy(e,["enterpriseWebSearch"]))throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const o=Uy(e,["functionDeclarations"]);if(null!=o){let e=o;Array.isArray(e)&&(e=e.map(e=>e)),Dy(t,["functionDeclarations"],e)}const s=Uy(e,["googleMaps"]);null!=s&&Dy(t,["googleMaps"],function(e){const t={};if(void 0!==Uy(e,["authConfig"]))throw new Error("authConfig parameter is not supported in Gemini API.");const n=Uy(e,["enableWidget"]);null!=n&&Dy(t,["enableWidget"],n);return t}(s));const a=Uy(e,["googleSearch"]);null!=a&&Dy(t,["googleSearch"],function(e){const t={};if(void 0!==Uy(e,["excludeDomains"]))throw new Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==Uy(e,["blockingConfidence"]))throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=Uy(e,["timeRangeFilter"]);null!=n&&Dy(t,["timeRangeFilter"],n);return t}(a));const l=Uy(e,["googleSearchRetrieval"]);null!=l&&Dy(t,["googleSearchRetrieval"],l);const u=Uy(e,["urlContext"]);null!=u&&Dy(t,["urlContext"],u);return t}(GE(e)))),Dy(n,["tools"],e)}const E=Uy(t,["toolConfig"]);if(void 0!==n&&null!=E&&Dy(n,["toolConfig"],function(e){const t={},n=Uy(e,["retrievalConfig"]);null!=n&&Dy(t,["retrievalConfig"],n);const i=Uy(e,["functionCallingConfig"]);null!=i&&Dy(t,["functionCallingConfig"],function(e){const t={},n=Uy(e,["allowedFunctionNames"]);null!=n&&Dy(t,["allowedFunctionNames"],n);const i=Uy(e,["mode"]);if(null!=i&&Dy(t,["mode"],i),void 0!==Uy(e,["streamFunctionCallArguments"]))throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}(i));return t}(E)),void 0!==Uy(t,["labels"]))throw new Error("labels parameter is not supported in Gemini API.");const b=Uy(t,["cachedContent"]);void 0!==n&&null!=b&&Dy(n,["cachedContent"],jE(e,b));const T=Uy(t,["responseModalities"]);null!=T&&Dy(r,["responseModalities"],T);const w=Uy(t,["mediaResolution"]);null!=w&&Dy(r,["mediaResolution"],w);const M=Uy(t,["speechConfig"]);if(null!=M&&Dy(r,["speechConfig"],VE(M)),void 0!==Uy(t,["audioTimestamp"]))throw new Error("audioTimestamp parameter is not supported in Gemini API.");const A=Uy(t,["thinkingConfig"]);null!=A&&Dy(r,["thinkingConfig"],A);const R=Uy(t,["imageConfig"]);null!=R&&Dy(r,["imageConfig"],function(e){const t={},n=Uy(e,["aspectRatio"]);null!=n&&Dy(t,["aspectRatio"],n);const i=Uy(e,["imageSize"]);null!=i&&Dy(t,["imageSize"],i);if(void 0!==Uy(e,["personGeneration"]))throw new Error("personGeneration parameter is not supported in Gemini API.");if(void 0!==Uy(e,["outputMimeType"]))throw new Error("outputMimeType parameter is not supported in Gemini API.");if(void 0!==Uy(e,["outputCompressionQuality"]))throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return t}(R));const C=Uy(t,["enableEnhancedCivicAnswers"]);if(null!=C&&Dy(r,["enableEnhancedCivicAnswers"],C),void 0!==Uy(t,["modelArmorConfig"]))throw new Error("modelArmorConfig parameter is not supported in Gemini API.");return r}function Qb(e,t,n,i){const r={},o=Uy(t,["systemInstruction"]);void 0!==n&&null!=o&&Dy(n,["systemInstruction"],UE(o));const s=Uy(t,["temperature"]);null!=s&&Dy(r,["temperature"],s);const a=Uy(t,["topP"]);null!=a&&Dy(r,["topP"],a);const l=Uy(t,["topK"]);null!=l&&Dy(r,["topK"],l);const u=Uy(t,["candidateCount"]);null!=u&&Dy(r,["candidateCount"],u);const c=Uy(t,["maxOutputTokens"]);null!=c&&Dy(r,["maxOutputTokens"],c);const d=Uy(t,["stopSequences"]);null!=d&&Dy(r,["stopSequences"],d);const h=Uy(t,["responseLogprobs"]);null!=h&&Dy(r,["responseLogprobs"],h);const p=Uy(t,["logprobs"]);null!=p&&Dy(r,["logprobs"],p);const f=Uy(t,["presencePenalty"]);null!=f&&Dy(r,["presencePenalty"],f);const m=Uy(t,["frequencyPenalty"]);null!=m&&Dy(r,["frequencyPenalty"],m);const g=Uy(t,["seed"]);null!=g&&Dy(r,["seed"],g);const v=Uy(t,["responseMimeType"]);null!=v&&Dy(r,["responseMimeType"],v);const _=Uy(t,["responseSchema"]);null!=_&&Dy(r,["responseSchema"],HE(_));const y=Uy(t,["responseJsonSchema"]);null!=y&&Dy(r,["responseJsonSchema"],y);const x=Uy(t,["routingConfig"]);null!=x&&Dy(r,["routingConfig"],x);const S=Uy(t,["modelSelectionConfig"]);null!=S&&Dy(r,["modelConfig"],S);const E=Uy(t,["safetySettings"]);if(void 0!==n&&null!=E){let e=E;Array.isArray(e)&&(e=e.map(e=>e)),Dy(n,["safetySettings"],e)}const b=Uy(t,["tools"]);if(void 0!==n&&null!=b){let e=WE(b);Array.isArray(e)&&(e=e.map(e=>MT(GE(e)))),Dy(n,["tools"],e)}const T=Uy(t,["toolConfig"]);void 0!==n&&null!=T&&Dy(n,["toolConfig"],T);const w=Uy(t,["labels"]);void 0!==n&&null!=w&&Dy(n,["labels"],w);const M=Uy(t,["cachedContent"]);void 0!==n&&null!=M&&Dy(n,["cachedContent"],jE(e,M));const A=Uy(t,["responseModalities"]);null!=A&&Dy(r,["responseModalities"],A);const R=Uy(t,["mediaResolution"]);null!=R&&Dy(r,["mediaResolution"],R);const C=Uy(t,["speechConfig"]);null!=C&&Dy(r,["speechConfig"],VE(C));const I=Uy(t,["audioTimestamp"]);null!=I&&Dy(r,["audioTimestamp"],I);const P=Uy(t,["thinkingConfig"]);null!=P&&Dy(r,["thinkingConfig"],P);const O=Uy(t,["imageConfig"]);if(null!=O&&Dy(r,["imageConfig"],function(e){const t={},n=Uy(e,["aspectRatio"]);null!=n&&Dy(t,["aspectRatio"],n);const i=Uy(e,["imageSize"]);null!=i&&Dy(t,["imageSize"],i);const r=Uy(e,["personGeneration"]);null!=r&&Dy(t,["personGeneration"],r);const o=Uy(e,["outputMimeType"]);null!=o&&Dy(t,["imageOutputOptions","mimeType"],o);const s=Uy(e,["outputCompressionQuality"]);null!=s&&Dy(t,["imageOutputOptions","compressionQuality"],s);return t}(O)),void 0!==Uy(t,["enableEnhancedCivicAnswers"]))throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");const N=Uy(t,["modelArmorConfig"]);return void 0!==n&&null!=N&&Dy(n,["modelArmorConfig"],N),r}function eT(e,t,n){const i={},r=Uy(t,["model"]);null!=r&&Dy(i,["_url","model"],wE(e,r));const o=Uy(t,["contents"]);if(null!=o){let e=FE(o);Array.isArray(e)&&(e=e.map(e=>qb(e))),Dy(i,["contents"],e)}const s=Uy(t,["config"]);return null!=s&&Dy(i,["generationConfig"],Zb(e,s,i)),i}function tT(e,t,n){const i={},r=Uy(t,["model"]);null!=r&&Dy(i,["_url","model"],wE(e,r));const o=Uy(t,["contents"]);if(null!=o){let e=FE(o);Array.isArray(e)&&(e=e.map(e=>e)),Dy(i,["contents"],e)}const s=Uy(t,["config"]);return null!=s&&Dy(i,["generationConfig"],Qb(e,s,i)),i}function nT(e,t){const n={},i=Uy(e,["sdkHttpResponse"]);null!=i&&Dy(n,["sdkHttpResponse"],i);const r=Uy(e,["candidates"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>Wb(e))),Dy(n,["candidates"],e)}const o=Uy(e,["modelVersion"]);null!=o&&Dy(n,["modelVersion"],o);const s=Uy(e,["promptFeedback"]);null!=s&&Dy(n,["promptFeedback"],s);const a=Uy(e,["responseId"]);null!=a&&Dy(n,["responseId"],a);const l=Uy(e,["usageMetadata"]);return null!=l&&Dy(n,["usageMetadata"],l),n}function iT(e,t){const n={},i=Uy(e,["sdkHttpResponse"]);null!=i&&Dy(n,["sdkHttpResponse"],i);const r=Uy(e,["candidates"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),Dy(n,["candidates"],e)}const o=Uy(e,["createTime"]);null!=o&&Dy(n,["createTime"],o);const s=Uy(e,["modelVersion"]);null!=s&&Dy(n,["modelVersion"],s);const a=Uy(e,["promptFeedback"]);null!=a&&Dy(n,["promptFeedback"],a);const l=Uy(e,["responseId"]);null!=l&&Dy(n,["responseId"],l);const u=Uy(e,["usageMetadata"]);return null!=u&&Dy(n,["usageMetadata"],u),n}function rT(e,t,n){const i={},r=Uy(t,["model"]);null!=r&&Dy(i,["_url","model"],wE(e,r));const o=Uy(t,["prompt"]);null!=o&&Dy(i,["instances[0]","prompt"],o);const s=Uy(t,["config"]);return null!=s&&function(e,t){if(void 0!==Uy(e,["outputGcsUri"]))throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(void 0!==Uy(e,["negativePrompt"]))throw new Error("negativePrompt parameter is not supported in Gemini API.");const n=Uy(e,["numberOfImages"]);void 0!==t&&null!=n&&Dy(t,["parameters","sampleCount"],n);const i=Uy(e,["aspectRatio"]);void 0!==t&&null!=i&&Dy(t,["parameters","aspectRatio"],i);const r=Uy(e,["guidanceScale"]);if(void 0!==t&&null!=r&&Dy(t,["parameters","guidanceScale"],r),void 0!==Uy(e,["seed"]))throw new Error("seed parameter is not supported in Gemini API.");const o=Uy(e,["safetyFilterLevel"]);void 0!==t&&null!=o&&Dy(t,["parameters","safetySetting"],o);const s=Uy(e,["personGeneration"]);void 0!==t&&null!=s&&Dy(t,["parameters","personGeneration"],s);const a=Uy(e,["includeSafetyAttributes"]);void 0!==t&&null!=a&&Dy(t,["parameters","includeSafetyAttributes"],a);const l=Uy(e,["includeRaiReason"]);void 0!==t&&null!=l&&Dy(t,["parameters","includeRaiReason"],l);const u=Uy(e,["language"]);void 0!==t&&null!=u&&Dy(t,["parameters","language"],u);const c=Uy(e,["outputMimeType"]);void 0!==t&&null!=c&&Dy(t,["parameters","outputOptions","mimeType"],c);const d=Uy(e,["outputCompressionQuality"]);if(void 0!==t&&null!=d&&Dy(t,["parameters","outputOptions","compressionQuality"],d),void 0!==Uy(e,["addWatermark"]))throw new Error("addWatermark parameter is not supported in Gemini API.");if(void 0!==Uy(e,["labels"]))throw new Error("labels parameter is not supported in Gemini API.");const h=Uy(e,["imageSize"]);if(void 0!==t&&null!=h&&Dy(t,["parameters","sampleImageSize"],h),void 0!==Uy(e,["enhancePrompt"]))throw new Error("enhancePrompt parameter is not supported in Gemini API.")}(s,i),i}function oT(e,t,n){const i={},r=Uy(t,["model"]);null!=r&&Dy(i,["_url","model"],wE(e,r));const o=Uy(t,["prompt"]);null!=o&&Dy(i,["instances[0]","prompt"],o);const s=Uy(t,["config"]);return null!=s&&function(e,t){const n=Uy(e,["outputGcsUri"]);void 0!==t&&null!=n&&Dy(t,["parameters","storageUri"],n);const i=Uy(e,["negativePrompt"]);void 0!==t&&null!=i&&Dy(t,["parameters","negativePrompt"],i);const r=Uy(e,["numberOfImages"]);void 0!==t&&null!=r&&Dy(t,["parameters","sampleCount"],r);const o=Uy(e,["aspectRatio"]);void 0!==t&&null!=o&&Dy(t,["parameters","aspectRatio"],o);const s=Uy(e,["guidanceScale"]);void 0!==t&&null!=s&&Dy(t,["parameters","guidanceScale"],s);const a=Uy(e,["seed"]);void 0!==t&&null!=a&&Dy(t,["parameters","seed"],a);const l=Uy(e,["safetyFilterLevel"]);void 0!==t&&null!=l&&Dy(t,["parameters","safetySetting"],l);const u=Uy(e,["personGeneration"]);void 0!==t&&null!=u&&Dy(t,["parameters","personGeneration"],u);const c=Uy(e,["includeSafetyAttributes"]);void 0!==t&&null!=c&&Dy(t,["parameters","includeSafetyAttributes"],c);const d=Uy(e,["includeRaiReason"]);void 0!==t&&null!=d&&Dy(t,["parameters","includeRaiReason"],d);const h=Uy(e,["language"]);void 0!==t&&null!=h&&Dy(t,["parameters","language"],h);const p=Uy(e,["outputMimeType"]);void 0!==t&&null!=p&&Dy(t,["parameters","outputOptions","mimeType"],p);const f=Uy(e,["outputCompressionQuality"]);void 0!==t&&null!=f&&Dy(t,["parameters","outputOptions","compressionQuality"],f);const m=Uy(e,["addWatermark"]);void 0!==t&&null!=m&&Dy(t,["parameters","addWatermark"],m);const g=Uy(e,["labels"]);void 0!==t&&null!=g&&Dy(t,["labels"],g);const v=Uy(e,["imageSize"]);void 0!==t&&null!=v&&Dy(t,["parameters","sampleImageSize"],v);const _=Uy(e,["enhancePrompt"]);void 0!==t&&null!=_&&Dy(t,["parameters","enhancePrompt"],_)}(s,i),i}function sT(e,t){const n={},i=Uy(e,["sdkHttpResponse"]);null!=i&&Dy(n,["sdkHttpResponse"],i);const r=Uy(e,["predictions"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=Uy(e,["_self"]);null!=n&&Dy(t,["image"],function(e){const t={},n=Uy(e,["bytesBase64Encoded"]);null!=n&&Dy(t,["imageBytes"],XE(n));const i=Uy(e,["mimeType"]);null!=i&&Dy(t,["mimeType"],i);return t}(n));const i=Uy(e,["raiFilteredReason"]);null!=i&&Dy(t,["raiFilteredReason"],i);const r=Uy(e,["_self"]);null!=r&&Dy(t,["safetyAttributes"],ET(r));return t}(e))),Dy(n,["generatedImages"],e)}const o=Uy(e,["positivePromptSafetyAttributes"]);return null!=o&&Dy(n,["positivePromptSafetyAttributes"],ET(o)),n}function aT(e,t,n){const i=Uy(e,["numberOfVideos"]);if(void 0!==t&&null!=i&&Dy(t,["parameters","sampleCount"],i),void 0!==Uy(e,["outputGcsUri"]))throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(void 0!==Uy(e,["fps"]))throw new Error("fps parameter is not supported in Gemini API.");const r=Uy(e,["durationSeconds"]);if(void 0!==t&&null!=r&&Dy(t,["parameters","durationSeconds"],r),void 0!==Uy(e,["seed"]))throw new Error("seed parameter is not supported in Gemini API.");const o=Uy(e,["aspectRatio"]);void 0!==t&&null!=o&&Dy(t,["parameters","aspectRatio"],o);const s=Uy(e,["resolution"]);void 0!==t&&null!=s&&Dy(t,["parameters","resolution"],s);const a=Uy(e,["personGeneration"]);if(void 0!==t&&null!=a&&Dy(t,["parameters","personGeneration"],a),void 0!==Uy(e,["pubsubTopic"]))throw new Error("pubsubTopic parameter is not supported in Gemini API.");const l=Uy(e,["negativePrompt"]);void 0!==t&&null!=l&&Dy(t,["parameters","negativePrompt"],l);const u=Uy(e,["enhancePrompt"]);if(void 0!==t&&null!=u&&Dy(t,["parameters","enhancePrompt"],u),void 0!==Uy(e,["generateAudio"]))throw new Error("generateAudio parameter is not supported in Gemini API.");const c=Uy(e,["lastFrame"]);void 0!==t&&null!=c&&Dy(t,["instances[0]","lastFrame"],mT(c));const d=Uy(e,["referenceImages"]);if(void 0!==t&&null!=d){let e=d;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=Uy(e,["image"]);null!=n&&Dy(t,["image"],mT(n));const i=Uy(e,["referenceType"]);null!=i&&Dy(t,["referenceType"],i);return t}(e))),Dy(t,["instances[0]","referenceImages"],e)}if(void 0!==Uy(e,["mask"]))throw new Error("mask parameter is not supported in Gemini API.");if(void 0!==Uy(e,["compressionQuality"]))throw new Error("compressionQuality parameter is not supported in Gemini API.");return{}}function lT(e,t,n){const i=Uy(e,["numberOfVideos"]);void 0!==t&&null!=i&&Dy(t,["parameters","sampleCount"],i);const r=Uy(e,["outputGcsUri"]);void 0!==t&&null!=r&&Dy(t,["parameters","storageUri"],r);const o=Uy(e,["fps"]);void 0!==t&&null!=o&&Dy(t,["parameters","fps"],o);const s=Uy(e,["durationSeconds"]);void 0!==t&&null!=s&&Dy(t,["parameters","durationSeconds"],s);const a=Uy(e,["seed"]);void 0!==t&&null!=a&&Dy(t,["parameters","seed"],a);const l=Uy(e,["aspectRatio"]);void 0!==t&&null!=l&&Dy(t,["parameters","aspectRatio"],l);const u=Uy(e,["resolution"]);void 0!==t&&null!=u&&Dy(t,["parameters","resolution"],u);const c=Uy(e,["personGeneration"]);void 0!==t&&null!=c&&Dy(t,["parameters","personGeneration"],c);const d=Uy(e,["pubsubTopic"]);void 0!==t&&null!=d&&Dy(t,["parameters","pubsubTopic"],d);const h=Uy(e,["negativePrompt"]);void 0!==t&&null!=h&&Dy(t,["parameters","negativePrompt"],h);const p=Uy(e,["enhancePrompt"]);void 0!==t&&null!=p&&Dy(t,["parameters","enhancePrompt"],p);const f=Uy(e,["generateAudio"]);void 0!==t&&null!=f&&Dy(t,["parameters","generateAudio"],f);const m=Uy(e,["lastFrame"]);void 0!==t&&null!=m&&Dy(t,["instances[0]","lastFrame"],gT(m));const g=Uy(e,["referenceImages"]);if(void 0!==t&&null!=g){let e=g;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=Uy(e,["image"]);null!=n&&Dy(t,["image"],gT(n));const i=Uy(e,["referenceType"]);null!=i&&Dy(t,["referenceType"],i);return t}(e))),Dy(t,["instances[0]","referenceImages"],e)}const v=Uy(e,["mask"]);void 0!==t&&null!=v&&Dy(t,["instances[0]","mask"],function(e){const t={},n=Uy(e,["image"]);null!=n&&Dy(t,["_self"],gT(n));const i=Uy(e,["maskMode"]);null!=i&&Dy(t,["maskMode"],i);return t}(v));const _=Uy(e,["compressionQuality"]);return void 0!==t&&null!=_&&Dy(t,["parameters","compressionQuality"],_),{}}function uT(e,t){const n={},i=Uy(e,["name"]);null!=i&&Dy(n,["name"],i);const r=Uy(e,["metadata"]);null!=r&&Dy(n,["metadata"],r);const o=Uy(e,["done"]);null!=o&&Dy(n,["done"],o);const s=Uy(e,["error"]);null!=s&&Dy(n,["error"],s);const a=Uy(e,["response","generateVideoResponse"]);return null!=a&&Dy(n,["response"],function(e){const t={},n=Uy(e,["generatedSamples"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=Uy(e,["video"]);null!=n&&Dy(t,["video"],function(e){const t={},n=Uy(e,["uri"]);null!=n&&Dy(t,["uri"],n);const i=Uy(e,["encodedVideo"]);null!=i&&Dy(t,["videoBytes"],XE(i));const r=Uy(e,["encoding"]);null!=r&&Dy(t,["mimeType"],r);return t}(n));return t}(e))),Dy(t,["generatedVideos"],e)}const i=Uy(e,["raiMediaFilteredCount"]);null!=i&&Dy(t,["raiMediaFilteredCount"],i);const r=Uy(e,["raiMediaFilteredReasons"]);null!=r&&Dy(t,["raiMediaFilteredReasons"],r);return t}(a)),n}function cT(e,t){const n={},i=Uy(e,["name"]);null!=i&&Dy(n,["name"],i);const r=Uy(e,["metadata"]);null!=r&&Dy(n,["metadata"],r);const o=Uy(e,["done"]);null!=o&&Dy(n,["done"],o);const s=Uy(e,["error"]);null!=s&&Dy(n,["error"],s);const a=Uy(e,["response"]);return null!=a&&Dy(n,["response"],function(e){const t={},n=Uy(e,["videos"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=Uy(e,["_self"]);null!=n&&Dy(t,["video"],function(e){const t={},n=Uy(e,["gcsUri"]);null!=n&&Dy(t,["uri"],n);const i=Uy(e,["bytesBase64Encoded"]);null!=i&&Dy(t,["videoBytes"],XE(i));const r=Uy(e,["mimeType"]);null!=r&&Dy(t,["mimeType"],r);return t}(n));return t}(e))),Dy(t,["generatedVideos"],e)}const i=Uy(e,["raiMediaFilteredCount"]);null!=i&&Dy(t,["raiMediaFilteredCount"],i);const r=Uy(e,["raiMediaFilteredReasons"]);null!=r&&Dy(t,["raiMediaFilteredReasons"],r);return t}(a)),n}function dT(e,t,n){const i={},r=Uy(t,["model"]);null!=r&&Dy(i,["_url","model"],wE(e,r));const o=Uy(t,["prompt"]);null!=o&&Dy(i,["instances[0]","prompt"],o);const s=Uy(t,["image"]);null!=s&&Dy(i,["instances[0]","image"],mT(s));const a=Uy(t,["video"]);null!=a&&Dy(i,["instances[0]","video"],IT(a));const l=Uy(t,["source"]);null!=l&&function(e,t){const n={},i=Uy(e,["prompt"]);void 0!==t&&null!=i&&Dy(t,["instances[0]","prompt"],i);const r=Uy(e,["image"]);void 0!==t&&null!=r&&Dy(t,["instances[0]","image"],mT(r));const o=Uy(e,["video"]);void 0!==t&&null!=o&&Dy(t,["instances[0]","video"],IT(o))}(l,i);const u=Uy(t,["config"]);return null!=u&&aT(u,i),i}function hT(e,t,n){const i={},r=Uy(t,["model"]);null!=r&&Dy(i,["_url","model"],wE(e,r));const o=Uy(t,["prompt"]);null!=o&&Dy(i,["instances[0]","prompt"],o);const s=Uy(t,["image"]);null!=s&&Dy(i,["instances[0]","image"],gT(s));const a=Uy(t,["video"]);null!=a&&Dy(i,["instances[0]","video"],PT(a));const l=Uy(t,["source"]);null!=l&&function(e,t){const n={},i=Uy(e,["prompt"]);void 0!==t&&null!=i&&Dy(t,["instances[0]","prompt"],i);const r=Uy(e,["image"]);void 0!==t&&null!=r&&Dy(t,["instances[0]","image"],gT(r));const o=Uy(e,["video"]);void 0!==t&&null!=o&&Dy(t,["instances[0]","video"],PT(o))}(l,i);const u=Uy(t,["config"]);return null!=u&&lT(u,i),i}function pT(e,t){const n={},i=Uy(e,["_self"]);null!=i&&Dy(n,["image"],fT(i));const r=Uy(e,["raiFilteredReason"]);null!=r&&Dy(n,["raiFilteredReason"],r);const o=Uy(e,["_self"]);null!=o&&Dy(n,["safetyAttributes"],bT(o));const s=Uy(e,["prompt"]);return null!=s&&Dy(n,["enhancedPrompt"],s),n}function fT(e,t){const n={},i=Uy(e,["gcsUri"]);null!=i&&Dy(n,["gcsUri"],i);const r=Uy(e,["bytesBase64Encoded"]);null!=r&&Dy(n,["imageBytes"],XE(r));const o=Uy(e,["mimeType"]);return null!=o&&Dy(n,["mimeType"],o),n}function mT(e,t){const n={};if(void 0!==Uy(e,["gcsUri"]))throw new Error("gcsUri parameter is not supported in Gemini API.");const i=Uy(e,["imageBytes"]);null!=i&&Dy(n,["bytesBase64Encoded"],XE(i));const r=Uy(e,["mimeType"]);return null!=r&&Dy(n,["mimeType"],r),n}function gT(e,t){const n={},i=Uy(e,["gcsUri"]);null!=i&&Dy(n,["gcsUri"],i);const r=Uy(e,["imageBytes"]);null!=r&&Dy(n,["bytesBase64Encoded"],XE(r));const o=Uy(e,["mimeType"]);return null!=o&&Dy(n,["mimeType"],o),n}function vT(e,t,n){const i={},r=Uy(t,["config"]);return null!=r&&function(e,t,n){const i=Uy(t,["pageSize"]);void 0!==n&&null!=i&&Dy(n,["_query","pageSize"],i);const r=Uy(t,["pageToken"]);void 0!==n&&null!=r&&Dy(n,["_query","pageToken"],r);const o=Uy(t,["filter"]);void 0!==n&&null!=o&&Dy(n,["_query","filter"],o);const s=Uy(t,["queryBase"]);void 0!==n&&null!=s&&Dy(n,["_url","models_url"],KE(e,s))}(e,r,i),i}function _T(e,t,n){const i={},r=Uy(t,["config"]);return null!=r&&function(e,t,n){const i=Uy(t,["pageSize"]);void 0!==n&&null!=i&&Dy(n,["_query","pageSize"],i);const r=Uy(t,["pageToken"]);void 0!==n&&null!=r&&Dy(n,["_query","pageToken"],r);const o=Uy(t,["filter"]);void 0!==n&&null!=o&&Dy(n,["_query","filter"],o);const s=Uy(t,["queryBase"]);void 0!==n&&null!=s&&Dy(n,["_url","models_url"],KE(e,s))}(e,r,i),i}function yT(e,t){const n={},i=Uy(e,["name"]);null!=i&&Dy(n,["name"],i);const r=Uy(e,["displayName"]);null!=r&&Dy(n,["displayName"],r);const o=Uy(e,["description"]);null!=o&&Dy(n,["description"],o);const s=Uy(e,["version"]);null!=s&&Dy(n,["version"],s);const a=Uy(e,["_self"]);null!=a&&Dy(n,["tunedModelInfo"],function(e){const t={},n=Uy(e,["baseModel"]);null!=n&&Dy(t,["baseModel"],n);const i=Uy(e,["createTime"]);null!=i&&Dy(t,["createTime"],i);const r=Uy(e,["updateTime"]);null!=r&&Dy(t,["updateTime"],r);return t}(a));const l=Uy(e,["inputTokenLimit"]);null!=l&&Dy(n,["inputTokenLimit"],l);const u=Uy(e,["outputTokenLimit"]);null!=u&&Dy(n,["outputTokenLimit"],u);const c=Uy(e,["supportedGenerationMethods"]);null!=c&&Dy(n,["supportedActions"],c);const d=Uy(e,["temperature"]);null!=d&&Dy(n,["temperature"],d);const h=Uy(e,["maxTemperature"]);null!=h&&Dy(n,["maxTemperature"],h);const p=Uy(e,["topP"]);null!=p&&Dy(n,["topP"],p);const f=Uy(e,["topK"]);null!=f&&Dy(n,["topK"],f);const m=Uy(e,["thinking"]);return null!=m&&Dy(n,["thinking"],m),n}function xT(e,t){const n={},i=Uy(e,["name"]);null!=i&&Dy(n,["name"],i);const r=Uy(e,["displayName"]);null!=r&&Dy(n,["displayName"],r);const o=Uy(e,["description"]);null!=o&&Dy(n,["description"],o);const s=Uy(e,["versionId"]);null!=s&&Dy(n,["version"],s);const a=Uy(e,["deployedModels"]);if(null!=a){let e=a;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=Uy(e,["endpoint"]);null!=n&&Dy(t,["name"],n);const i=Uy(e,["deployedModelId"]);return null!=i&&Dy(t,["deployedModelId"],i),t}(e))),Dy(n,["endpoints"],e)}const l=Uy(e,["labels"]);null!=l&&Dy(n,["labels"],l);const u=Uy(e,["_self"]);null!=u&&Dy(n,["tunedModelInfo"],function(e){const t={},n=Uy(e,["labels","google-vertex-llm-tuning-base-model-id"]);null!=n&&Dy(t,["baseModel"],n);const i=Uy(e,["createTime"]);null!=i&&Dy(t,["createTime"],i);const r=Uy(e,["updateTime"]);null!=r&&Dy(t,["updateTime"],r);return t}(u));const c=Uy(e,["defaultCheckpointId"]);null!=c&&Dy(n,["defaultCheckpointId"],c);const d=Uy(e,["checkpoints"]);if(null!=d){let e=d;Array.isArray(e)&&(e=e.map(e=>e)),Dy(n,["checkpoints"],e)}return n}function ST(e,t,n){const i={},r=Uy(t,["model"]);null!=r&&Dy(i,["_url","model"],wE(e,r));const o=Uy(t,["source"]);null!=o&&function(e,t){const n={},i=Uy(e,["prompt"]);void 0!==t&&null!=i&&Dy(t,["instances[0]","prompt"],i);const r=Uy(e,["personImage"]);void 0!==t&&null!=r&&Dy(t,["instances[0]","personImage","image"],gT(r));const o=Uy(e,["productImages"]);if(void 0!==t&&null!=o){let e=o;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=Uy(e,["productImage"]);return null!=n&&Dy(t,["image"],gT(n)),t}(e))),Dy(t,["instances[0]","productImages"],e)}}(o,i);const s=Uy(t,["config"]);return null!=s&&function(e,t){const n=Uy(e,["numberOfImages"]);void 0!==t&&null!=n&&Dy(t,["parameters","sampleCount"],n);const i=Uy(e,["baseSteps"]);void 0!==t&&null!=i&&Dy(t,["parameters","baseSteps"],i);const r=Uy(e,["outputGcsUri"]);void 0!==t&&null!=r&&Dy(t,["parameters","storageUri"],r);const o=Uy(e,["seed"]);void 0!==t&&null!=o&&Dy(t,["parameters","seed"],o);const s=Uy(e,["safetyFilterLevel"]);void 0!==t&&null!=s&&Dy(t,["parameters","safetySetting"],s);const a=Uy(e,["personGeneration"]);void 0!==t&&null!=a&&Dy(t,["parameters","personGeneration"],a);const l=Uy(e,["addWatermark"]);void 0!==t&&null!=l&&Dy(t,["parameters","addWatermark"],l);const u=Uy(e,["outputMimeType"]);void 0!==t&&null!=u&&Dy(t,["parameters","outputOptions","mimeType"],u);const c=Uy(e,["outputCompressionQuality"]);void 0!==t&&null!=c&&Dy(t,["parameters","outputOptions","compressionQuality"],c);const d=Uy(e,["enhancePrompt"]);void 0!==t&&null!=d&&Dy(t,["parameters","enhancePrompt"],d);const h=Uy(e,["labels"]);void 0!==t&&null!=h&&Dy(t,["labels"],h)}(s,i),i}function ET(e,t){const n={},i=Uy(e,["safetyAttributes","categories"]);null!=i&&Dy(n,["categories"],i);const r=Uy(e,["safetyAttributes","scores"]);null!=r&&Dy(n,["scores"],r);const o=Uy(e,["contentType"]);return null!=o&&Dy(n,["contentType"],o),n}function bT(e,t){const n={},i=Uy(e,["safetyAttributes","categories"]);null!=i&&Dy(n,["categories"],i);const r=Uy(e,["safetyAttributes","scores"]);null!=r&&Dy(n,["scores"],r);const o=Uy(e,["contentType"]);return null!=o&&Dy(n,["contentType"],o),n}function TT(e,t,n){const i={},r=Uy(t,["model"]);null!=r&&Dy(i,["_url","model"],wE(e,r));const o=Uy(t,["source"]);null!=o&&function(e,t){const n={},i=Uy(e,["prompt"]);void 0!==t&&null!=i&&Dy(t,["instances[0]","prompt"],i);const r=Uy(e,["image"]);void 0!==t&&null!=r&&Dy(t,["instances[0]","image"],gT(r));const o=Uy(e,["scribbleImage"]);void 0!==t&&null!=o&&Dy(t,["instances[0]","scribble"],function(e){const t={},n=Uy(e,["image"]);return null!=n&&Dy(t,["image"],gT(n)),t}(o))}(o,i);const s=Uy(t,["config"]);return null!=s&&function(e,t){const n=Uy(e,["mode"]);void 0!==t&&null!=n&&Dy(t,["parameters","mode"],n);const i=Uy(e,["maxPredictions"]);void 0!==t&&null!=i&&Dy(t,["parameters","maxPredictions"],i);const r=Uy(e,["confidenceThreshold"]);void 0!==t&&null!=r&&Dy(t,["parameters","confidenceThreshold"],r);const o=Uy(e,["maskDilation"]);void 0!==t&&null!=o&&Dy(t,["parameters","maskDilation"],o);const s=Uy(e,["binaryColorThreshold"]);void 0!==t&&null!=s&&Dy(t,["parameters","binaryColorThreshold"],s);const a=Uy(e,["labels"]);void 0!==t&&null!=a&&Dy(t,["labels"],a)}(s,i),i}function wT(e,t){const n={},i=Uy(e,["predictions"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=Uy(e,["_self"]);null!=n&&Dy(t,["mask"],fT(n));const i=Uy(e,["labels"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),Dy(t,["labels"],e)}return t}(e))),Dy(n,["generatedMasks"],e)}return n}function MT(e,t){const n={},i=Uy(e,["retrieval"]);null!=i&&Dy(n,["retrieval"],i);const r=Uy(e,["computerUse"]);if(null!=r&&Dy(n,["computerUse"],r),void 0!==Uy(e,["fileSearch"]))throw new Error("fileSearch parameter is not supported in Vertex AI.");const o=Uy(e,["codeExecution"]);null!=o&&Dy(n,["codeExecution"],o);const s=Uy(e,["enterpriseWebSearch"]);null!=s&&Dy(n,["enterpriseWebSearch"],s);const a=Uy(e,["functionDeclarations"]);if(null!=a){let e=a;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=Uy(e,["description"]);null!=n&&Dy(t,["description"],n);const i=Uy(e,["name"]);null!=i&&Dy(t,["name"],i);const r=Uy(e,["parameters"]);null!=r&&Dy(t,["parameters"],r);const o=Uy(e,["parametersJsonSchema"]);null!=o&&Dy(t,["parametersJsonSchema"],o);const s=Uy(e,["response"]);null!=s&&Dy(t,["response"],s);const a=Uy(e,["responseJsonSchema"]);if(null!=a&&Dy(t,["responseJsonSchema"],a),void 0!==Uy(e,["behavior"]))throw new Error("behavior parameter is not supported in Vertex AI.");return t}(e))),Dy(n,["functionDeclarations"],e)}const l=Uy(e,["googleMaps"]);null!=l&&Dy(n,["googleMaps"],l);const u=Uy(e,["googleSearch"]);null!=u&&Dy(n,["googleSearch"],u);const c=Uy(e,["googleSearchRetrieval"]);null!=c&&Dy(n,["googleSearchRetrieval"],c);const d=Uy(e,["urlContext"]);return null!=d&&Dy(n,["urlContext"],d),n}function AT(e,t,n){const i={},r=Uy(t,["model"]);null!=r&&Dy(i,["_url","name"],wE(e,r));const o=Uy(t,["config"]);return null!=o&&function(e,t){const n=Uy(e,["displayName"]);void 0!==t&&null!=n&&Dy(t,["displayName"],n);const i=Uy(e,["description"]);void 0!==t&&null!=i&&Dy(t,["description"],i);const r=Uy(e,["defaultCheckpointId"]);void 0!==t&&null!=r&&Dy(t,["defaultCheckpointId"],r)}(o,i),i}function RT(e,t,n){const i={},r=Uy(t,["model"]);null!=r&&Dy(i,["_url","model"],wE(e,r));const o=Uy(t,["config"]);return null!=o&&function(e,t){const n=Uy(e,["displayName"]);void 0!==t&&null!=n&&Dy(t,["displayName"],n);const i=Uy(e,["description"]);void 0!==t&&null!=i&&Dy(t,["description"],i);const r=Uy(e,["defaultCheckpointId"]);void 0!==t&&null!=r&&Dy(t,["defaultCheckpointId"],r)}(o,i),i}function CT(e,t,n){const i={},r=Uy(t,["model"]);null!=r&&Dy(i,["_url","model"],wE(e,r));const o=Uy(t,["image"]);null!=o&&Dy(i,["instances[0]","image"],gT(o));const s=Uy(t,["upscaleFactor"]);null!=s&&Dy(i,["parameters","upscaleConfig","upscaleFactor"],s);const a=Uy(t,["config"]);return null!=a&&function(e,t){const n=Uy(e,["outputGcsUri"]);void 0!==t&&null!=n&&Dy(t,["parameters","storageUri"],n);const i=Uy(e,["safetyFilterLevel"]);void 0!==t&&null!=i&&Dy(t,["parameters","safetySetting"],i);const r=Uy(e,["personGeneration"]);void 0!==t&&null!=r&&Dy(t,["parameters","personGeneration"],r);const o=Uy(e,["includeRaiReason"]);void 0!==t&&null!=o&&Dy(t,["parameters","includeRaiReason"],o);const s=Uy(e,["outputMimeType"]);void 0!==t&&null!=s&&Dy(t,["parameters","outputOptions","mimeType"],s);const a=Uy(e,["outputCompressionQuality"]);void 0!==t&&null!=a&&Dy(t,["parameters","outputOptions","compressionQuality"],a);const l=Uy(e,["enhanceInputImage"]);void 0!==t&&null!=l&&Dy(t,["parameters","upscaleConfig","enhanceInputImage"],l);const u=Uy(e,["imagePreservationFactor"]);void 0!==t&&null!=u&&Dy(t,["parameters","upscaleConfig","imagePreservationFactor"],u);const c=Uy(e,["labels"]);void 0!==t&&null!=c&&Dy(t,["labels"],c);const d=Uy(e,["numberOfImages"]);void 0!==t&&null!=d&&Dy(t,["parameters","sampleCount"],d);const h=Uy(e,["mode"]);void 0!==t&&null!=h&&Dy(t,["parameters","mode"],h)}(a,i),i}function IT(e,t){const n={},i=Uy(e,["uri"]);null!=i&&Dy(n,["uri"],i);const r=Uy(e,["videoBytes"]);null!=r&&Dy(n,["encodedVideo"],XE(r));const o=Uy(e,["mimeType"]);return null!=o&&Dy(n,["encoding"],o),n}function PT(e,t){const n={},i=Uy(e,["uri"]);null!=i&&Dy(n,["gcsUri"],i);const r=Uy(e,["videoBytes"]);null!=r&&Dy(n,["bytesBase64Encoded"],XE(r));const o=Uy(e,["mimeType"]);return null!=o&&Dy(n,["mimeType"],o),n}function OT(e){const t={},n=Uy(e,["config"]);return null!=n&&function(e,t){const n=Uy(e,["displayName"]);void 0!==t&&null!=n&&Dy(t,["displayName"],n)}(n,t),t}function NT(e){const t={},n=Uy(e,["name"]);null!=n&&Dy(t,["_url","name"],n);const i=Uy(e,["config"]);return null!=i&&function(e,t){const n=Uy(e,["force"]);void 0!==t&&null!=n&&Dy(t,["_query","force"],n)}(i,t),t}function LT(e){const t={},n=Uy(e,["name"]);null!=n&&Dy(t,["name"],n);const i=Uy(e,["metadata"]);null!=i&&Dy(t,["metadata"],i);const r=Uy(e,["done"]);null!=r&&Dy(t,["done"],r);const o=Uy(e,["error"]);null!=o&&Dy(t,["error"],o);const s=Uy(e,["response"]);return null!=s&&Dy(t,["response"],function(e){const t={},n=Uy(e,["sdkHttpResponse"]);null!=n&&Dy(t,["sdkHttpResponse"],n);const i=Uy(e,["parent"]);null!=i&&Dy(t,["parent"],i);const r=Uy(e,["documentName"]);null!=r&&Dy(t,["documentName"],r);return t}(s)),t}function DT(e){const t={},n=Uy(e,["fileSearchStoreName"]);null!=n&&Dy(t,["_url","file_search_store_name"],n);const i=Uy(e,["fileName"]);null!=i&&Dy(t,["fileName"],i);const r=Uy(e,["config"]);return null!=r&&function(e,t){const n=Uy(e,["customMetadata"]);if(void 0!==t&&null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),Dy(t,["customMetadata"],e)}const i=Uy(e,["chunkingConfig"]);void 0!==t&&null!=i&&Dy(t,["chunkingConfig"],i)}(r,t),t}function UT(e){const t={},n=Uy(e,["config"]);return null!=n&&function(e,t){const n=Uy(e,["pageSize"]);void 0!==t&&null!=n&&Dy(t,["_query","pageSize"],n);const i=Uy(e,["pageToken"]);void 0!==t&&null!=i&&Dy(t,["_query","pageToken"],i)}(n,t),t}function kT(e,t){const n=Uy(e,["mimeType"]);void 0!==t&&null!=n&&Dy(t,["mimeType"],n);const i=Uy(e,["displayName"]);void 0!==t&&null!=i&&Dy(t,["displayName"],i);const r=Uy(e,["customMetadata"]);if(void 0!==t&&null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),Dy(t,["customMetadata"],e)}const o=Uy(e,["chunkingConfig"]);return void 0!==t&&null!=o&&Dy(t,["chunkingConfig"],o),{}}const FT="x-goog-api-client";class BT{constructor(e){var t,n,i;this.clientOptions=Object.assign({},e),this.customBaseUrl=null===(t=e.httpOptions)||void 0===t?void 0:t.baseUrl,this.clientOptions.vertexai&&(this.clientOptions.project&&this.clientOptions.location?this.clientOptions.apiKey=void 0:this.clientOptions.apiKey&&(this.clientOptions.project=void 0,this.clientOptions.location=void 0));const r={};if(this.clientOptions.vertexai){this.clientOptions.location||this.clientOptions.apiKey||this.customBaseUrl||(this.clientOptions.location="global");if(!(this.clientOptions.project&&this.clientOptions.location||this.clientOptions.apiKey)&&!this.customBaseUrl)throw new Error("Authentication is not set up. Please provide either a project and location, or an API key, or a custom base URL.");const t=e.project&&e.location||!!e.apiKey;this.customBaseUrl&&!t?(r.baseUrl=this.customBaseUrl,this.clientOptions.project=void 0,this.clientOptions.location=void 0):this.clientOptions.apiKey||"global"===this.clientOptions.location?r.baseUrl="https://aiplatform.googleapis.com/":this.clientOptions.project&&this.clientOptions.location&&(r.baseUrl=`https://${this.clientOptions.location}-aiplatform.googleapis.com/`),r.apiVersion=null!==(n=this.clientOptions.apiVersion)&&void 0!==n?n:"v1beta1"}else{if(!this.clientOptions.apiKey)throw new Lb({message:"API key must be set when using the Gemini API.",status:403});r.apiVersion=null!==(i=this.clientOptions.apiVersion)&&void 0!==i?i:"v1beta",r.baseUrl="https://generativelanguage.googleapis.com/"}r.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=r,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(r,e.httpOptions))}isVertexAI(){var e;return null!==(e=this.clientOptions.vertexai)&&void 0!==e&&e}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getCustomBaseUrl(){return this.customBaseUrl}async getAuthHeaders(){const e=new Headers;return await this.clientOptions.auth.addAuthHeaders(e),e}getApiVersion(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.apiVersion)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.baseUrl)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.headers)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||void 0===e.baseUrl||void 0===e.apiVersion)throw new Error("HTTP options are not correctly set.");const t=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&""!==e.apiVersion&&t.push(e.apiVersion),t.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),t=new URL(e);return t.protocol="http:"==t.protocol?"ws":"wss",t.toString()}setBaseUrl(e){if(!this.clientOptions.httpOptions)throw new Error("HTTP options are not correctly set.");this.clientOptions.httpOptions.baseUrl=e}constructUrl(e,t,n){const i=[this.getRequestUrlInternal(t)];n&&i.push(this.getBaseResourcePath()),""!==e&&i.push(e);return new URL(`${i.join("/")}`)}shouldPrependVertexProjectPath(e,t){return(!t.baseUrl||t.baseUrlResourceScope!==jx.COLLECTION)&&(!this.clientOptions.apiKey&&(!!this.clientOptions.vertexai&&(!e.path.startsWith("projects/")&&("GET"!==e.httpMethod||!e.path.startsWith("publishers/google/models")))))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const n=this.shouldPrependVertexProjectPath(e,t),i=this.constructUrl(e.path,t,n);if(e.queryParams)for(const[o,s]of Object.entries(e.queryParams))i.searchParams.append(o,String(s));let r={};if("GET"===e.httpMethod){if(e.body&&"{}"!==e.body)throw new Error("Request body should be empty for GET request, but got non empty request body")}else r.body=e.body;return r=await this.includeExtraHttpOptionsToRequestInit(r,t,i.toString(),e.abortSignal),this.unaryApiCall(i,r,e.httpMethod)}patchHttpOptions(e,t){const n=JSON.parse(JSON.stringify(e));for(const[i,r]of Object.entries(t))"object"==typeof r?n[i]=Object.assign(Object.assign({},n[i]),r):void 0!==r&&(n[i]=r);return n}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const n=this.shouldPrependVertexProjectPath(e,t),i=this.constructUrl(e.path,t,n);i.searchParams.has("alt")&&"sse"===i.searchParams.get("alt")||i.searchParams.set("alt","sse");let r={};return r.body=e.body,r=await this.includeExtraHttpOptionsToRequestInit(r,t,i.toString(),e.abortSignal),this.streamApiCall(i,r,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,n,i){if(t&&t.timeout||i){const n=new AbortController,r=n.signal;if(t.timeout&&(null==t?void 0:t.timeout)>0){const e=setTimeout(()=>n.abort(),t.timeout);e&&"function"==typeof e.unref&&e.unref()}i&&i.addEventListener("abort",()=>{n.abort()}),e.signal=r}return t&&null!==t.extraBody&&function(e,t){if(!t||0===Object.keys(t).length)return;if(e.body instanceof Blob)return void console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");let n={};if("string"==typeof e.body&&e.body.length>0)try{const t=JSON.parse(e.body);if("object"!=typeof t||null===t||Array.isArray(t))return void console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");n=t}catch(BM){return void console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.")}function i(e,t){const n=Object.assign({},e);for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)){const e=t[r],o=n[r];e&&"object"==typeof e&&!Array.isArray(e)&&o&&"object"==typeof o&&!Array.isArray(o)?n[r]=i(o,e):(o&&e&&typeof o!=typeof e&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${r}". Original type: ${typeof o}, New type: ${typeof e}. Overwriting.`),n[r]=e)}return n}const r=i(n,t);e.body=JSON.stringify(r)}(e,t.extraBody),e.headers=await this.getHeadersInternal(t,n),e}async unaryApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async e=>(await HT(e),new JS(e))).catch(e=>{throw e instanceof Error?e:new Error(JSON.stringify(e))})}async streamApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async e=>(await HT(e),this.processStreamResponse(e))).catch(e=>{throw e instanceof Error?e:new Error(JSON.stringify(e))})}processStreamResponse(e){return Ab(this,arguments,function*(){var t;const n=null===(t=null==e?void 0:e.body)||void 0===t?void 0:t.getReader(),i=new TextDecoder("utf-8");if(!n)throw new Error("Response body is empty");try{let t="";const r="data:",o=["\n\n","\r\r","\r\n\r\n"];for(;;){const{done:s,value:a}=yield Mb(n.read());if(s){if(t.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const l=i.decode(a,{stream:!0});try{const e=JSON.parse(l);if("error"in e){const t=JSON.parse(JSON.stringify(e.error)),n=t.status,i=t.code,r=`got status: ${n}. ${JSON.stringify(e)}`;if(i>=400&&i<600){throw new Lb({message:r,status:i})}}}catch(BM){if("ApiError"===BM.name)throw BM}t+=l;let u=-1,c=0;for(;;){u=-1,c=0;for(const e of o){const n=t.indexOf(e);-1!==n&&(-1===u||n<u)&&(u=n,c=e.length)}if(-1===u)break;const n=t.substring(0,u);t=t.substring(u+c);const i=n.trim();if(i.startsWith(r)){const t=i.substring(r.length).trim();try{const n=new Response(t,{headers:null==e?void 0:e.headers,status:null==e?void 0:e.status,statusText:null==e?void 0:e.statusText});yield yield Mb(new JS(n))}catch(BM){throw new Error(`exception parsing stream chunk ${t}. ${BM}`)}}}}}finally{n.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(e=>{throw new Error(`exception ${e} sending request`)})}getDefaultHeaders(){const e={},t="google-genai-sdk/1.39.0 "+this.clientOptions.userAgentExtra;return e["User-Agent"]=t,e[FT]=t,e["Content-Type"]="application/json",e}async getHeadersInternal(e,t){const n=new Headers;if(e&&e.headers){for(const[t,i]of Object.entries(e.headers))n.append(t,i);e.timeout&&e.timeout>0&&n.append("X-Server-Timeout",String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(n,t),n}getFileName(e){var t;let n="";return"string"==typeof e&&(n=e.replace(/[/\\]+$/,""),n=null!==(t=n.split(/[/\\]/).pop())&&void 0!==t?t:""),n}async uploadFile(e,t){var n;const i={};null!=t&&(i.mimeType=t.mimeType,i.name=t.name,i.displayName=t.displayName),i.name&&!i.name.startsWith("files/")&&(i.name=`files/${i.name}`);const r=this.clientOptions.uploader,o=await r.stat(e);i.sizeBytes=String(o.size);const s=null!==(n=null==t?void 0:t.mimeType)&&void 0!==n?n:o.type;if(void 0===s||""===s)throw new Error("Can not determine mimeType. Please provide mimeType in the config.");i.mimeType=s;const a={file:i},l=this.getFileName(e),u=Ly("upload/v1beta/files",a._url),c=await this.fetchUploadUrl(u,i.sizeBytes,i.mimeType,l,a,null==t?void 0:t.httpOptions);return r.upload(e,c,this)}async uploadFileToFileSearchStore(e,t,n){var i;const r=this.clientOptions.uploader,o=await r.stat(t),s=String(o.size),a=null!==(i=null==n?void 0:n.mimeType)&&void 0!==i?i:o.type;if(void 0===a||""===a)throw new Error("Can not determine mimeType. Please provide mimeType in the config.");const l=`upload/v1beta/${e}:uploadToFileSearchStore`,u=this.getFileName(t),c={};null!=n&&kT(n,c);const d=await this.fetchUploadUrl(l,s,a,u,c,null==n?void 0:n.httpOptions);return r.uploadToFileSearchStore(t,d,this)}async downloadFile(e){const t=this.clientOptions.downloader;await t.download(e,this)}async fetchUploadUrl(e,t,n,i,r,o){var s;let a={};a=o||{apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t}`,"X-Goog-Upload-Header-Content-Type":`${n}`},i?{"X-Goog-Upload-File-Name":i}:{})};const l=await this.request({path:e,body:JSON.stringify(r),httpMethod:"POST",httpOptions:a});if(!l||!(null==l?void 0:l.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const u=null===(s=null==l?void 0:l.headers)||void 0===s?void 0:s["x-goog-upload-url"];if(void 0===u)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return u}}async function HT(e){var t;if(void 0===e)throw new Error("response is undefined");if(!e.ok){const n=e.status;let i;i=(null===(t=e.headers.get("content-type"))||void 0===t?void 0:t.includes("application/json"))?await e.json():{error:{message:await e.text(),code:e.status,status:e.statusText}};const r=JSON.stringify(i);if(n>=400&&n<600){throw new Lb({message:r,status:n})}throw new Error(r)}}function VT(e){for(const t of e){if(GT(t))return!0;if("object"==typeof t&&"inputSchema"in t)return!0}return false}function zT(e){var t;const n=null!==(t=e[FT])&&void 0!==t?t:"";e[FT]=(n+" mcp_used/unknown").trimStart()}function GT(e){return null!==e&&"object"==typeof e&&e instanceof jT}function WT(e){return Ab(this,arguments,function*(e,t=100){let n,i=0;for(;i<t;){const t=yield Mb(e.listTools({cursor:n}));for(const e of t.tools)yield yield Mb(e),i++;if(!t.nextCursor)break;n=t.nextCursor}})}class jT{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new jT(e,t)}async initialize(){var e,t,n,i;if(this.mcpTools.length>0)return;const r={},o=[];for(const c of this.mcpClients)try{for(var s,a=!0,l=(t=void 0,Rb(WT(c)));!(e=(s=await l.next()).done);a=!0){i=s.value,a=!1;const e=i;o.push(e);const t=e.name;if(r[t])throw new Error(`Duplicate function name ${t} found in MCP tools. Please ensure function names are unique.`);r[t]=c}}catch(u){t={error:u}}finally{try{a||e||!(n=l.return)||await n.call(l)}finally{if(t)throw t.error}}this.mcpTools=o,this.functionNameToMcpClient=r}async tool(){return await this.initialize(),function(e,t={}){const n=[],i=new Set;for(const r of e){const e=r.name;if(i.has(e))throw new Error(`Duplicate function name ${e} found in MCP tools. Please ensure function names are unique.`);i.add(e);const o=ZE(r,t);o.functionDeclarations&&n.push(...o.functionDeclarations)}return{functionDeclarations:n}}(this.mcpTools,this.config)}async callTool(e){await this.initialize();const t=[];for(const n of e)if(n.name in this.functionNameToMcpClient){const e=this.functionNameToMcpClient[n.name];let i;this.config.timeout&&(i={timeout:this.config.timeout});const r=await e.callTool({name:n.name,arguments:n.args},void 0,i);t.push({functionResponse:{name:n.name,response:r.isError?{error:r}:r}})}return t}}class qT{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n}async connect(e){var t,n;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const i=this.apiClient.getWebsocketBaseUrl(),r=this.apiClient.getApiVersion(),o=function(e){const t=new Headers;for(const[n,i]of Object.entries(e))t.append(n,i);return t}(this.apiClient.getDefaultHeaders()),s=`${i}/ws/google.ai.generativelanguage.${r}.GenerativeService.BidiGenerateMusic?key=${this.apiClient.getApiKey()}`;let a=()=>{};const l=new Promise(e=>{a=e}),u=e.callbacks,c=(this.apiClient,{onopen:function(){a({})},onmessage:e=>{!async function(e,t,n){const i=new bE;let r;r=n.data instanceof Blob?JSON.parse(await n.data.text()):JSON.parse(n.data),Object.assign(i,r),t(i)}(0,u.onmessage,e)},onerror:null!==(t=null==u?void 0:u.onerror)&&void 0!==t?t:function(e){},onclose:null!==(n=null==u?void 0:u.onclose)&&void 0!==n?n:function(e){}}),d=this.webSocketFactory.create(s,function(e){const t={};return e.forEach((e,n)=>{t[n]=e}),t}(o),c);d.connect(),await l;const h={setup:{model:wE(this.apiClient,e.model)}};return d.send(JSON.stringify(h)),new XT(d,this.apiClient)}}class XT{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||0===Object.keys(e.weightedPrompts).length)throw new Error("Weighted prompts must be set and contain at least one entry.");const t=function(e){const t={},n=Uy(e,["weightedPrompts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),Dy(t,["weightedPrompts"],e)}return t}(e);this.conn.send(JSON.stringify({clientContent:t}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const t=function(e){const t={},n=Uy(e,["musicGenerationConfig"]);return null!=n&&Dy(t,["musicGenerationConfig"],n),t}(e);this.conn.send(JSON.stringify(t))}sendPlaybackControl(e){const t={playbackControl:e};this.conn.send(JSON.stringify(t))}play(){this.sendPlaybackControl(qS.PLAY)}pause(){this.sendPlaybackControl(qS.PAUSE)}stop(){this.sendPlaybackControl(qS.STOP)}resetContext(){this.sendPlaybackControl(qS.RESET_CONTEXT)}close(){this.conn.close()}}class YT{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n,this.music=new qT(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,n,i,r,o,s;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const a=this.apiClient.getWebsocketBaseUrl(),l=this.apiClient.getApiVersion();let u;const c=this.apiClient.getHeaders();e.config&&e.config.tools&&VT(e.config.tools)&&zT(c);const d=function(e){const t=new Headers;for(const[n,i]of Object.entries(e))t.append(n,i);return t}(c);if(this.apiClient.isVertexAI()){const e=this.apiClient.getProject(),t=this.apiClient.getLocation(),n=this.apiClient.getApiKey(),i=!!e&&!!t||!!n;this.apiClient.getCustomBaseUrl()&&!i?u=a:(u=`${a}/ws/google.cloud.aiplatform.${l}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(d,u))}else{const e=this.apiClient.getApiKey();let t="BidiGenerateContent",n="key";(null==e?void 0:e.startsWith("auth_tokens/"))&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),"v1alpha"!==l&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),t="BidiGenerateContentConstrained",n="access_token"),u=`${a}/ws/google.ai.generativelanguage.${l}.GenerativeService.${t}?${n}=${e}`}let h=()=>{};const p=new Promise(e=>{h=e}),f=e.callbacks,m=this.apiClient,g={onopen:function(){var e;null===(e=null==f?void 0:f.onopen)||void 0===e||e.call(f),h({})},onmessage:e=>{!async function(e,t,n){const i=new EE;let r;r=n.data instanceof Blob?await n.data.text():n.data instanceof ArrayBuffer?(new TextDecoder).decode(n.data):n.data;const o=JSON.parse(r);if(e.isVertexAI()){const e=Gb(o);Object.assign(i,e)}else{const e=o;Object.assign(i,e)}t(i)}(m,f.onmessage,e)},onerror:null!==(t=null==f?void 0:f.onerror)&&void 0!==t?t:function(e){},onclose:null!==(n=null==f?void 0:f.onclose)&&void 0!==n?n:function(e){}},v=this.webSocketFactory.create(u,function(e){const t={};return e.forEach((e,n)=>{t[n]=e}),t}(d),g);v.connect(),await p;let _=wE(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&_.startsWith("publishers/")){const e=this.apiClient.getProject(),t=this.apiClient.getLocation();e&&t&&(_=`projects/${e}/locations/${t}/`+_)}let y={};this.apiClient.isVertexAI()&&void 0===(null===(i=e.config)||void 0===i?void 0:i.responseModalities)&&(void 0===e.config?e.config={responseModalities:[Px.AUDIO]}:e.config.responseModalities=[Px.AUDIO]),(null===(r=e.config)||void 0===r?void 0:r.generationConfig)&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const x=null!==(s=null===(o=e.config)||void 0===o?void 0:o.tools)&&void 0!==s?s:[],S=[];for(const b of x)if(this.isCallableTool(b)){const e=b;S.push(await e.tool())}else S.push(b);S.length>0&&(e.config.tools=S);const E={model:_,config:e.config,callbacks:e.callbacks};return y=this.apiClient.isVertexAI()?function(e,t){const n={},i=Uy(t,["model"]);null!=i&&Dy(n,["setup","model"],wE(e,i));const r=Uy(t,["config"]);return null!=r&&Dy(n,["config"],Hb(r,n)),n}(this.apiClient,E):function(e,t){const n={},i=Uy(t,["model"]);null!=i&&Dy(n,["setup","model"],wE(e,i));const r=Uy(t,["config"]);return null!=r&&Dy(n,["config"],Bb(r,n)),n}(this.apiClient,E),delete y.config,v.send(JSON.stringify(y)),new JT(v,this.apiClient)}isCallableTool(e){return"callTool"in e&&"function"==typeof e.callTool}}const KT={turnComplete:!0};class JT{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(null!==t.turns&&void 0!==t.turns){let i=[];try{i=FE(t.turns),e.isVertexAI()||(i=i.map(e=>qb(e)))}catch(n){throw new Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:i,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let n=[];if(null==t.functionResponses)throw new Error("functionResponses is required.");if(n=Array.isArray(t.functionResponses)?t.functionResponses:[t.functionResponses],0===n.length)throw new Error("functionResponses is required.");for(const i of n){if("object"!=typeof i||null===i||!("name"in i)||!("response"in i))throw new Error(`Could not parse function response, type '${typeof i}'.`);if(!e.isVertexAI()&&!("id"in i))throw new Error("FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.")}return{toolResponse:{functionResponses:n}}}sendClientContent(e){e=Object.assign(Object.assign({},KT),e);const t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};t=this.apiClient.isVertexAI()?{realtimeInput:zb(e)}:{realtimeInput:Vb(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(null==e.functionResponses)throw new Error("Tool response parameters are required.");const t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}}function $T(e){var t,n,i;if(null===(t=null==e?void 0:e.automaticFunctionCalling)||void 0===t?void 0:t.disable)return!0;let r=!1;for(const s of null!==(n=null==e?void 0:e.tools)&&void 0!==n?n:[])if(ZT(s)){r=!0;break}if(!r)return!0;const o=null===(i=null==e?void 0:e.automaticFunctionCalling)||void 0===i?void 0:i.maximumRemoteCalls;return!!(o&&(o<0||!Number.isInteger(o))||0==o)&&(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",o),!0)}function ZT(e){return"callTool"in e&&"function"==typeof e.callTool}function QT(e){var t;const n=[];return(null===(t=null==e?void 0:e.config)||void 0===t?void 0:t.tools)?(e.config.tools.forEach((e,t)=>{if(ZT(e))return;const i=e;i.functionDeclarations&&i.functionDeclarations.length>0&&n.push(t)}),n):n}function ew(e){var t;return!(null===(t=null==e?void 0:e.automaticFunctionCalling)||void 0===t?void 0:t.ignoreCallHistory)}class tw extends Ny{constructor(e){super(),this.apiClient=e,this.generateContent=async e=>{var t,n,i,r,o;const s=await this.processParamsMaybeAddMcpUsage(e);if(this.maybeMoveToResponseJsonSchem(e),!function(e){var t,n,i;return null!==(i=null===(n=null===(t=e.config)||void 0===t?void 0:t.tools)||void 0===n?void 0:n.some(e=>ZT(e)))&&void 0!==i&&i}(e)||$T(e.config))return await this.generateContentInternal(s);const a=QT(e);if(a.length>0){const e=a.map(e=>`tools[${e}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${e}.`)}let l,u;const c=FE(s.contents),d=null!==(i=null===(n=null===(t=s.config)||void 0===t?void 0:t.automaticFunctionCalling)||void 0===n?void 0:n.maximumRemoteCalls)&&void 0!==i?i:10;let h=0;for(;h<d&&(l=await this.generateContentInternal(s),l.functionCalls&&0!==l.functionCalls.length);){const t=l.candidates[0].content,n=[];for(const i of null!==(o=null===(r=e.config)||void 0===r?void 0:r.tools)&&void 0!==o?o:[])if(ZT(i)){const e=i,t=await e.callTool(l.functionCalls);n.push(...t)}h++,u={role:"user",parts:n},s.contents=FE(s.contents),s.contents.push(t),s.contents.push(u),ew(s.config)&&(c.push(t),c.push(u))}return ew(s.config)&&(l.automaticFunctionCallingHistory=c),l},this.generateContentStream=async e=>{var t,n,i,r,o;if(this.maybeMoveToResponseJsonSchem(e),$T(e.config)){const t=await this.processParamsMaybeAddMcpUsage(e);return await this.generateContentStreamInternal(t)}const s=QT(e);if(s.length>0){const e=s.map(e=>`tools[${e}]`).join(", ");throw new Error(`Incompatible tools found at ${e}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}const a=null===(i=null===(n=null===(t=null==e?void 0:e.config)||void 0===t?void 0:t.toolConfig)||void 0===n?void 0:n.functionCallingConfig)||void 0===i?void 0:i.streamFunctionCallArguments,l=null===(o=null===(r=null==e?void 0:e.config)||void 0===r?void 0:r.automaticFunctionCalling)||void 0===o?void 0:o.disable;if(a&&!l)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(e)},this.generateImages=async e=>await this.generateImagesInternal(e).then(e=>{var t;let n;const i=[];if(null==e?void 0:e.generatedImages)for(const o of e.generatedImages)o&&(null==o?void 0:o.safetyAttributes)&&"Positive Prompt"===(null===(t=null==o?void 0:o.safetyAttributes)||void 0===t?void 0:t.contentType)?n=null==o?void 0:o.safetyAttributes:i.push(o);let r;return r=n?{generatedImages:i,positivePromptSafetyAttributes:n,sdkHttpResponse:e.sdkHttpResponse}:{generatedImages:i,sdkHttpResponse:e.sdkHttpResponse},r}),this.list=async e=>{var t;const n={config:Object.assign(Object.assign({},{queryBase:!0}),null==e?void 0:e.config)};if(this.apiClient.isVertexAI()&&!n.config.queryBase){if(null===(t=n.config)||void 0===t?void 0:t.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");n.config.filter="labels.tune-type:*"}return new fb(YS.PAGED_ITEM_MODELS,e=>this.listInternal(e),await this.listInternal(n),n)},this.editImage=async e=>{const t={model:e.model,prompt:e.prompt,referenceImages:[],config:e.config};return e.referenceImages&&e.referenceImages&&(t.referenceImages=e.referenceImages.map(e=>e.toReferenceImageAPI())),await this.editImageInternal(t)},this.upscaleImage=async e=>{let t={numberOfImages:1,mode:"upscale"};e.config&&(t=Object.assign(Object.assign({},t),e.config));const n={model:e.model,image:e.image,upscaleFactor:e.upscaleFactor,config:t};return await this.upscaleImageInternal(n)},this.generateVideos=async e=>{var t,n,i,r,o,s;if((e.prompt||e.image||e.video)&&e.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||((null===(t=e.video)||void 0===t?void 0:t.uri)&&(null===(n=e.video)||void 0===n?void 0:n.videoBytes)?e.video={uri:e.video.uri,mimeType:e.video.mimeType}:(null===(r=null===(i=e.source)||void 0===i?void 0:i.video)||void 0===r?void 0:r.uri)&&(null===(s=null===(o=e.source)||void 0===o?void 0:o.video)||void 0===s?void 0:s.videoBytes)&&(e.source.video={uri:e.source.video.uri,mimeType:e.source.video.mimeType})),await this.generateVideosInternal(e)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var t,n,i;const r=null===(t=e.config)||void 0===t?void 0:t.tools;if(!r)return e;const o=await Promise.all(r.map(async e=>{if(ZT(e)){const t=e;return await t.tool()}return e})),s={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:o})};if(s.config.tools=o,e.config&&e.config.tools&&VT(e.config.tools)){const t=null!==(i=null===(n=e.config.httpOptions)||void 0===n?void 0:n.headers)&&void 0!==i?i:{};let r=Object.assign({},t);0===Object.keys(r).length&&(r=this.apiClient.getDefaultHeaders()),zT(r),s.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:r})}return s}async initAfcToolsMap(e){var t,n,i;const r=new Map;for(const o of null!==(n=null===(t=e.config)||void 0===t?void 0:t.tools)&&void 0!==n?n:[])if(ZT(o)){const e=o,t=await e.tool();for(const n of null!==(i=t.functionDeclarations)&&void 0!==i?i:[]){if(!n.name)throw new Error("Function declaration name is required.");if(r.has(n.name))throw new Error(`Duplicate tool declaration name: ${n.name}`);r.set(n.name,e)}}return r}async processAfcStream(e){var t,n,i;const r=null!==(i=null===(n=null===(t=e.config)||void 0===t?void 0:t.automaticFunctionCalling)||void 0===n?void 0:n.maximumRemoteCalls)&&void 0!==i?i:10;let o=!1,s=0;return function(e,t,n){return Ab(this,arguments,function*(){for(var i,a,l,u,c,d;s<r;){o&&(s++,o=!1);const g=yield Mb(e.processParamsMaybeAddMcpUsage(n)),v=yield Mb(e.generateContentStreamInternal(g)),_=[],y=[];try{for(var h,p=!0,f=(a=void 0,Rb(v));!(i=(h=yield Mb(f.next())).done);p=!0){u=h.value,p=!1;const e=u;if(yield yield Mb(e),e.candidates&&(null===(c=e.candidates[0])||void 0===c?void 0:c.content)){y.push(e.candidates[0].content);for(const n of null!==(d=e.candidates[0].content.parts)&&void 0!==d?d:[])if(s<r&&n.functionCall){if(!n.functionCall.name)throw new Error("Function call name was not returned by the model.");if(!t.has(n.functionCall.name))throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${t.keys()}, mising tool: ${n.functionCall.name}`);{const e=yield Mb(t.get(n.functionCall.name).callTool([n.functionCall]));_.push(...e)}}}}}catch(m){a={error:m}}finally{try{p||i||!(l=f.return)||(yield Mb(l.call(f)))}finally{if(a)throw a.error}}if(!(_.length>0))break;{o=!0;const e=new $S;e.candidates=[{content:{role:"user",parts:_}}],yield yield Mb(e);const t=[];t.push(...y),t.push({role:"user",parts:_});const i=FE(n.contents).concat(t);n.contents=i}}})}(this,await this.initAfcToolsMap(e),e)}async generateContentInternal(e){var t,n,i,r;let o,s="",a={};if(this.apiClient.isVertexAI()){const i=tT(this.apiClient,e);return s=Ly("{model}:generateContent",i._url),a=i._query,delete i._url,delete i._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(i),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),o.then(e=>{const t=iT(e),n=new $S;return Object.assign(n,t),n})}{const t=eT(this.apiClient,e);return s=Ly("{model}:generateContent",t._url),a=t._query,delete t._url,delete t._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(i=e.config)||void 0===i?void 0:i.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),o.then(e=>{const t=nT(e),n=new $S;return Object.assign(n,t),n})}}async generateContentStreamInternal(e){var t,n,i,r;let o,s="",a={};if(this.apiClient.isVertexAI()){const i=tT(this.apiClient,e);s=Ly("{model}:streamGenerateContent?alt=sse",i._url),a=i._query,delete i._url,delete i._query;return o=this.apiClient.requestStream({path:s,queryParams:a,body:JSON.stringify(i),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}),o.then(function(e){return Ab(this,arguments,function*(){var t,n,i,r;try{for(var o,s=!0,a=Rb(e);!(t=(o=yield Mb(a.next())).done);s=!0){r=o.value,s=!1;const e=r,t=iT(yield Mb(e.json()));t.sdkHttpResponse={headers:e.headers};const n=new $S;Object.assign(n,t),yield yield Mb(n)}}catch(l){n={error:l}}finally{try{s||t||!(i=a.return)||(yield Mb(i.call(a)))}finally{if(n)throw n.error}}})})}{const t=eT(this.apiClient,e);s=Ly("{model}:streamGenerateContent?alt=sse",t._url),a=t._query,delete t._url,delete t._query;return o=this.apiClient.requestStream({path:s,queryParams:a,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(i=e.config)||void 0===i?void 0:i.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}),o.then(function(e){return Ab(this,arguments,function*(){var t,n,i,r;try{for(var o,s=!0,a=Rb(e);!(t=(o=yield Mb(a.next())).done);s=!0){r=o.value,s=!1;const e=r,t=nT(yield Mb(e.json()));t.sdkHttpResponse={headers:e.headers};const n=new $S;Object.assign(n,t),yield yield Mb(n)}}catch(l){n={error:l}}finally{try{s||t||!(i=a.return)||(yield Mb(i.call(a)))}finally{if(n)throw n.error}}})})}}async embedContent(e){var t,n,i,r;let o,s="",a={};if(this.apiClient.isVertexAI()){const i=$b(this.apiClient,e);return s=Ly("{model}:predict",i._url),a=i._query,delete i._url,delete i._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(i),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),o.then(e=>{const t=function(e){const t={},n=Uy(e,["sdkHttpResponse"]);null!=n&&Dy(t,["sdkHttpResponse"],n);const i=Uy(e,["predictions[]","embeddings"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>jb(e))),Dy(t,["embeddings"],e)}const r=Uy(e,["metadata"]);return null!=r&&Dy(t,["metadata"],r),t}(e),n=new ZS;return Object.assign(n,t),n})}{const t=Jb(this.apiClient,e);return s=Ly("{model}:batchEmbedContents",t._url),a=t._query,delete t._url,delete t._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(i=e.config)||void 0===i?void 0:i.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),o.then(e=>{const t=function(e){const t={},n=Uy(e,["sdkHttpResponse"]);null!=n&&Dy(t,["sdkHttpResponse"],n);const i=Uy(e,["embeddings"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),Dy(t,["embeddings"],e)}const r=Uy(e,["metadata"]);return null!=r&&Dy(t,["metadata"],r),t}(e),n=new ZS;return Object.assign(n,t),n})}}async generateImagesInternal(e){var t,n,i,r;let o,s="",a={};if(this.apiClient.isVertexAI()){const i=oT(this.apiClient,e);return s=Ly("{model}:predict",i._url),a=i._query,delete i._url,delete i._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(i),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),o.then(e=>{const t=function(e){const t={},n=Uy(e,["sdkHttpResponse"]);null!=n&&Dy(t,["sdkHttpResponse"],n);const i=Uy(e,["predictions"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>pT(e))),Dy(t,["generatedImages"],e)}const r=Uy(e,["positivePromptSafetyAttributes"]);return null!=r&&Dy(t,["positivePromptSafetyAttributes"],bT(r)),t}(e),n=new QS;return Object.assign(n,t),n})}{const t=rT(this.apiClient,e);return s=Ly("{model}:predict",t._url),a=t._query,delete t._url,delete t._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(i=e.config)||void 0===i?void 0:i.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),o.then(e=>{const t=sT(e),n=new QS;return Object.assign(n,t),n})}}async editImageInternal(e){var t,n;let i,r="",o={};if(this.apiClient.isVertexAI()){const s=Kb(this.apiClient,e);return r=Ly("{model}:predict",s._url),o=s._query,delete s._url,delete s._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),i.then(e=>{const t=function(e){const t={},n=Uy(e,["sdkHttpResponse"]);null!=n&&Dy(t,["sdkHttpResponse"],n);const i=Uy(e,["predictions"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>pT(e))),Dy(t,["generatedImages"],e)}return t}(e),n=new eE;return Object.assign(n,t),n})}throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,n;let i,r="",o={};if(this.apiClient.isVertexAI()){const s=CT(this.apiClient,e);return r=Ly("{model}:predict",s._url),o=s._query,delete s._url,delete s._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),i.then(e=>{const t=function(e){const t={},n=Uy(e,["sdkHttpResponse"]);null!=n&&Dy(t,["sdkHttpResponse"],n);const i=Uy(e,["predictions"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>pT(e))),Dy(t,["generatedImages"],e)}return t}(e),n=new tE;return Object.assign(n,t),n})}throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var t,n;let i,r="",o={};if(this.apiClient.isVertexAI()){const s=ST(this.apiClient,e);return r=Ly("{model}:predict",s._url),o=s._query,delete s._url,delete s._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),i.then(e=>{const t=function(e){const t={},n=Uy(e,["predictions"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>pT(e))),Dy(t,["generatedImages"],e)}return t}(e),n=new nE;return Object.assign(n,t),n})}throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var t,n;let i,r="",o={};if(this.apiClient.isVertexAI()){const s=TT(this.apiClient,e);return r=Ly("{model}:predict",s._url),o=s._query,delete s._url,delete s._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),i.then(e=>{const t=wT(e),n=new iE;return Object.assign(n,t),n})}throw new Error("This method is only supported by the Vertex AI.")}async get(e){var t,n,i,r;let o,s="",a={};if(this.apiClient.isVertexAI()){const i=function(e,t){const n={},i=Uy(t,["model"]);return null!=i&&Dy(n,["_url","name"],wE(e,i)),n}(this.apiClient,e);return s=Ly("{name}",i._url),a=i._query,delete i._url,delete i._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(i),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),o.then(e=>xT(e))}{const t=function(e,t){const n={},i=Uy(t,["model"]);return null!=i&&Dy(n,["_url","name"],wE(e,i)),n}(this.apiClient,e);return s=Ly("{name}",t._url),a=t._query,delete t._url,delete t._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(i=e.config)||void 0===i?void 0:i.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()),o.then(e=>yT(e))}}async listInternal(e){var t,n,i,r;let o,s="",a={};if(this.apiClient.isVertexAI()){const i=_T(this.apiClient,e);return s=Ly("{models_url}",i._url),a=i._query,delete i._url,delete i._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(i),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),o.then(e=>{const t=function(e){const t={},n=Uy(e,["sdkHttpResponse"]);null!=n&&Dy(t,["sdkHttpResponse"],n);const i=Uy(e,["nextPageToken"]);null!=i&&Dy(t,["nextPageToken"],i);const r=Uy(e,["_self"]);if(null!=r){let e=JE(r);Array.isArray(e)&&(e=e.map(e=>xT(e))),Dy(t,["models"],e)}return t}(e),n=new rE;return Object.assign(n,t),n})}{const t=vT(this.apiClient,e);return s=Ly("{models_url}",t._url),a=t._query,delete t._url,delete t._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(i=e.config)||void 0===i?void 0:i.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),o.then(e=>{const t=function(e){const t={},n=Uy(e,["sdkHttpResponse"]);null!=n&&Dy(t,["sdkHttpResponse"],n);const i=Uy(e,["nextPageToken"]);null!=i&&Dy(t,["nextPageToken"],i);const r=Uy(e,["_self"]);if(null!=r){let e=JE(r);Array.isArray(e)&&(e=e.map(e=>yT(e))),Dy(t,["models"],e)}return t}(e),n=new rE;return Object.assign(n,t),n})}}async update(e){var t,n,i,r;let o,s="",a={};if(this.apiClient.isVertexAI()){const i=RT(this.apiClient,e);return s=Ly("{model}",i._url),a=i._query,delete i._url,delete i._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(i),httpMethod:"PATCH",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),o.then(e=>xT(e))}{const t=AT(this.apiClient,e);return s=Ly("{name}",t._url),a=t._query,delete t._url,delete t._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(t),httpMethod:"PATCH",httpOptions:null===(i=e.config)||void 0===i?void 0:i.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()),o.then(e=>yT(e))}}async delete(e){var t,n,i,r;let o,s="",a={};if(this.apiClient.isVertexAI()){const i=function(e,t){const n={},i=Uy(t,["model"]);return null!=i&&Dy(n,["_url","name"],wE(e,i)),n}(this.apiClient,e);return s=Ly("{name}",i._url),a=i._query,delete i._url,delete i._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(i),httpMethod:"DELETE",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),o.then(e=>{const t=function(e){const t={},n=Uy(e,["sdkHttpResponse"]);return null!=n&&Dy(t,["sdkHttpResponse"],n),t}(e),n=new oE;return Object.assign(n,t),n})}{const t=function(e,t){const n={},i=Uy(t,["model"]);return null!=i&&Dy(n,["_url","name"],wE(e,i)),n}(this.apiClient,e);return s=Ly("{name}",t._url),a=t._query,delete t._url,delete t._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(t),httpMethod:"DELETE",httpOptions:null===(i=e.config)||void 0===i?void 0:i.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),o.then(e=>{const t=function(e){const t={},n=Uy(e,["sdkHttpResponse"]);return null!=n&&Dy(t,["sdkHttpResponse"],n),t}(e),n=new oE;return Object.assign(n,t),n})}}async countTokens(e){var t,n,i,r;let o,s="",a={};if(this.apiClient.isVertexAI()){const i=function(e,t){const n={},i=Uy(t,["model"]);null!=i&&Dy(n,["_url","model"],wE(e,i));const r=Uy(t,["contents"]);if(null!=r){let e=FE(r);Array.isArray(e)&&(e=e.map(e=>e)),Dy(n,["contents"],e)}const o=Uy(t,["config"]);return null!=o&&Xb(o,n),n}(this.apiClient,e);return s=Ly("{model}:countTokens",i._url),a=i._query,delete i._url,delete i._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(i),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),o.then(e=>{const t=function(e){const t={},n=Uy(e,["sdkHttpResponse"]);null!=n&&Dy(t,["sdkHttpResponse"],n);const i=Uy(e,["totalTokens"]);return null!=i&&Dy(t,["totalTokens"],i),t}(e),n=new sE;return Object.assign(n,t),n})}{const t=Yb(this.apiClient,e);return s=Ly("{model}:countTokens",t._url),a=t._query,delete t._url,delete t._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(i=e.config)||void 0===i?void 0:i.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),o.then(e=>{const t=function(e){const t={},n=Uy(e,["sdkHttpResponse"]);null!=n&&Dy(t,["sdkHttpResponse"],n);const i=Uy(e,["totalTokens"]);null!=i&&Dy(t,["totalTokens"],i);const r=Uy(e,["cachedContentTokenCount"]);return null!=r&&Dy(t,["cachedContentTokenCount"],r),t}(e),n=new sE;return Object.assign(n,t),n})}}async computeTokens(e){var t,n;let i,r="",o={};if(this.apiClient.isVertexAI()){const s=function(e,t){const n={},i=Uy(t,["model"]);null!=i&&Dy(n,["_url","model"],wE(e,i));const r=Uy(t,["contents"]);if(null!=r){let e=FE(r);Array.isArray(e)&&(e=e.map(e=>e)),Dy(n,["contents"],e)}return n}(this.apiClient,e);return r=Ly("{model}:computeTokens",s._url),o=s._query,delete s._url,delete s._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),i.then(e=>{const t=function(e){const t={},n=Uy(e,["sdkHttpResponse"]);null!=n&&Dy(t,["sdkHttpResponse"],n);const i=Uy(e,["tokensInfo"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),Dy(t,["tokensInfo"],e)}return t}(e),n=new aE;return Object.assign(n,t),n})}throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var t,n,i,r;let o,s="",a={};if(this.apiClient.isVertexAI()){const i=hT(this.apiClient,e);return s=Ly("{model}:predictLongRunning",i._url),a=i._query,delete i._url,delete i._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(i),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),o.then(e=>{const t=cT(e),n=new lE;return Object.assign(n,t),n})}{const t=dT(this.apiClient,e);return s=Ly("{model}:predictLongRunning",t._url),a=t._query,delete t._url,delete t._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(i=e.config)||void 0===i?void 0:i.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()),o.then(e=>{const t=uT(e),n=new lE;return Object.assign(n,t),n})}}}class nw extends Ny{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const t=e.operation,n=e.config;if(void 0===t.name||""===t.name)throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const e=t.name.split("/operations/")[0];let i;n&&"httpOptions"in n&&(i=n.httpOptions);const r=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:e,config:{httpOptions:i}});return t._fromAPIResponse({apiResponse:r,_isVertexAI:!0})}{const e=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:e,_isVertexAI:!1})}}async get(e){const t=e.operation,n=e.config;if(void 0===t.name||""===t.name)throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const e=t.name.split("/operations/")[0];let i;n&&"httpOptions"in n&&(i=n.httpOptions);const r=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:e,config:{httpOptions:i}});return t._fromAPIResponse({apiResponse:r,_isVertexAI:!0})}{const e=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:e,_isVertexAI:!1})}}async getVideosOperationInternal(e){var t,n,i,r;let o,s="",a={};if(this.apiClient.isVertexAI()){const i=function(e){const t={},n=Uy(e,["operationName"]);return null!=n&&Dy(t,["_url","operationName"],n),t}(e);return s=Ly("{operationName}",i._url),a=i._query,delete i._url,delete i._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(i),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),o}{const t=function(e){const t={},n=Uy(e,["operationName"]);return null!=n&&Dy(t,["_url","operationName"],n),t}(e);return s=Ly("{operationName}",t._url),a=t._query,delete t._url,delete t._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(i=e.config)||void 0===i?void 0:i.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()),o}}async fetchPredictVideosOperationInternal(e){var t,n;let i,r="",o={};if(this.apiClient.isVertexAI()){const s=function(e){const t={},n=Uy(e,["operationName"]);null!=n&&Dy(t,["operationName"],n);const i=Uy(e,["resourceName"]);return null!=i&&Dy(t,["_url","resourceName"],i),t}(e);return r=Ly("{resourceName}:fetchPredictOperation",s._url),o=s._query,delete s._url,delete s._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),i}throw new Error("This method is only supported by the Vertex AI.")}}function iw(e){const t={},n=Uy(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>function(e){const t={},n=Uy(e,["mediaResolution"]);null!=n&&Dy(t,["mediaResolution"],n);const i=Uy(e,["codeExecutionResult"]);null!=i&&Dy(t,["codeExecutionResult"],i);const r=Uy(e,["executableCode"]);null!=r&&Dy(t,["executableCode"],r);const o=Uy(e,["fileData"]);null!=o&&Dy(t,["fileData"],function(e){const t={};if(void 0!==Uy(e,["displayName"]))throw new Error("displayName parameter is not supported in Gemini API.");const n=Uy(e,["fileUri"]);null!=n&&Dy(t,["fileUri"],n);const i=Uy(e,["mimeType"]);null!=i&&Dy(t,["mimeType"],i);return t}(o));const s=Uy(e,["functionCall"]);null!=s&&Dy(t,["functionCall"],function(e){const t={},n=Uy(e,["id"]);null!=n&&Dy(t,["id"],n);const i=Uy(e,["args"]);null!=i&&Dy(t,["args"],i);const r=Uy(e,["name"]);null!=r&&Dy(t,["name"],r);if(void 0!==Uy(e,["partialArgs"]))throw new Error("partialArgs parameter is not supported in Gemini API.");if(void 0!==Uy(e,["willContinue"]))throw new Error("willContinue parameter is not supported in Gemini API.");return t}(s));const a=Uy(e,["functionResponse"]);null!=a&&Dy(t,["functionResponse"],a);const l=Uy(e,["inlineData"]);null!=l&&Dy(t,["inlineData"],function(e){const t={},n=Uy(e,["data"]);if(null!=n&&Dy(t,["data"],n),void 0!==Uy(e,["displayName"]))throw new Error("displayName parameter is not supported in Gemini API.");const i=Uy(e,["mimeType"]);return null!=i&&Dy(t,["mimeType"],i),t}(l));const u=Uy(e,["text"]);null!=u&&Dy(t,["text"],u);const c=Uy(e,["thought"]);null!=c&&Dy(t,["thought"],c);const d=Uy(e,["thoughtSignature"]);null!=d&&Dy(t,["thoughtSignature"],d);const h=Uy(e,["videoMetadata"]);null!=h&&Dy(t,["videoMetadata"],h);return t}(e))),Dy(t,["parts"],e)}const i=Uy(e,["role"]);return null!=i&&Dy(t,["role"],i),t}function rw(e,t,n){const i=Uy(t,["expireTime"]);void 0!==n&&null!=i&&Dy(n,["expireTime"],i);const r=Uy(t,["newSessionExpireTime"]);void 0!==n&&null!=r&&Dy(n,["newSessionExpireTime"],r);const o=Uy(t,["uses"]);void 0!==n&&null!=o&&Dy(n,["uses"],o);const s=Uy(t,["liveConnectConstraints"]);void 0!==n&&null!=s&&Dy(n,["bidiGenerateContentSetup"],function(e,t){const n={},i=Uy(t,["model"]);null!=i&&Dy(n,["setup","model"],wE(e,i));const r=Uy(t,["config"]);null!=r&&Dy(n,["config"],function(e,t){const n={},i=Uy(e,["generationConfig"]);void 0!==t&&null!=i&&Dy(t,["setup","generationConfig"],i);const r=Uy(e,["responseModalities"]);void 0!==t&&null!=r&&Dy(t,["setup","generationConfig","responseModalities"],r);const o=Uy(e,["temperature"]);void 0!==t&&null!=o&&Dy(t,["setup","generationConfig","temperature"],o);const s=Uy(e,["topP"]);void 0!==t&&null!=s&&Dy(t,["setup","generationConfig","topP"],s);const a=Uy(e,["topK"]);void 0!==t&&null!=a&&Dy(t,["setup","generationConfig","topK"],a);const l=Uy(e,["maxOutputTokens"]);void 0!==t&&null!=l&&Dy(t,["setup","generationConfig","maxOutputTokens"],l);const u=Uy(e,["mediaResolution"]);void 0!==t&&null!=u&&Dy(t,["setup","generationConfig","mediaResolution"],u);const c=Uy(e,["seed"]);void 0!==t&&null!=c&&Dy(t,["setup","generationConfig","seed"],c);const d=Uy(e,["speechConfig"]);void 0!==t&&null!=d&&Dy(t,["setup","generationConfig","speechConfig"],zE(d));const h=Uy(e,["thinkingConfig"]);void 0!==t&&null!=h&&Dy(t,["setup","generationConfig","thinkingConfig"],h);const p=Uy(e,["enableAffectiveDialog"]);void 0!==t&&null!=p&&Dy(t,["setup","generationConfig","enableAffectiveDialog"],p);const f=Uy(e,["systemInstruction"]);void 0!==t&&null!=f&&Dy(t,["setup","systemInstruction"],iw(UE(f)));const m=Uy(e,["tools"]);if(void 0!==t&&null!=m){let e=WE(m);Array.isArray(e)&&(e=e.map(e=>function(e){const t={};if(void 0!==Uy(e,["retrieval"]))throw new Error("retrieval parameter is not supported in Gemini API.");const n=Uy(e,["computerUse"]);null!=n&&Dy(t,["computerUse"],n);const i=Uy(e,["fileSearch"]);null!=i&&Dy(t,["fileSearch"],i);const r=Uy(e,["codeExecution"]);null!=r&&Dy(t,["codeExecution"],r);if(void 0!==Uy(e,["enterpriseWebSearch"]))throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const o=Uy(e,["functionDeclarations"]);if(null!=o){let e=o;Array.isArray(e)&&(e=e.map(e=>e)),Dy(t,["functionDeclarations"],e)}const s=Uy(e,["googleMaps"]);null!=s&&Dy(t,["googleMaps"],function(e){const t={};if(void 0!==Uy(e,["authConfig"]))throw new Error("authConfig parameter is not supported in Gemini API.");const n=Uy(e,["enableWidget"]);null!=n&&Dy(t,["enableWidget"],n);return t}(s));const a=Uy(e,["googleSearch"]);null!=a&&Dy(t,["googleSearch"],function(e){const t={};if(void 0!==Uy(e,["excludeDomains"]))throw new Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==Uy(e,["blockingConfidence"]))throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=Uy(e,["timeRangeFilter"]);null!=n&&Dy(t,["timeRangeFilter"],n);return t}(a));const l=Uy(e,["googleSearchRetrieval"]);null!=l&&Dy(t,["googleSearchRetrieval"],l);const u=Uy(e,["urlContext"]);null!=u&&Dy(t,["urlContext"],u);return t}(GE(e)))),Dy(t,["setup","tools"],e)}const g=Uy(e,["sessionResumption"]);void 0!==t&&null!=g&&Dy(t,["setup","sessionResumption"],function(e){const t={},n=Uy(e,["handle"]);null!=n&&Dy(t,["handle"],n);if(void 0!==Uy(e,["transparent"]))throw new Error("transparent parameter is not supported in Gemini API.");return t}(g));const v=Uy(e,["inputAudioTranscription"]);void 0!==t&&null!=v&&Dy(t,["setup","inputAudioTranscription"],v);const _=Uy(e,["outputAudioTranscription"]);void 0!==t&&null!=_&&Dy(t,["setup","outputAudioTranscription"],_);const y=Uy(e,["realtimeInputConfig"]);void 0!==t&&null!=y&&Dy(t,["setup","realtimeInputConfig"],y);const x=Uy(e,["contextWindowCompression"]);void 0!==t&&null!=x&&Dy(t,["setup","contextWindowCompression"],x);const S=Uy(e,["proactivity"]);void 0!==t&&null!=S&&Dy(t,["setup","proactivity"],S);if(void 0!==Uy(e,["explicitVadSignal"]))throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return n}(r,n));return n}(e,s));const a=Uy(t,["lockAdditionalFields"]);return void 0!==n&&null!=a&&Dy(n,["fieldMask"],a),{}}function ow(e,t){let n=null;const i=e.bidiGenerateContentSetup;if("object"==typeof i&&null!==i&&"setup"in i){const t=i.setup;"object"==typeof t&&null!==t?(e.bidiGenerateContentSetup=t,n=t):delete e.bidiGenerateContentSetup}else void 0!==i&&delete e.bidiGenerateContentSetup;const r=e.fieldMask;if(n){const i=function(e){const t=[];for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)){const i=e[n];if("object"==typeof i&&null!=i&&Object.keys(i).length>0){const e=Object.keys(i).map(e=>`${n}.${e}`);t.push(...e)}else t.push(n)}return t.join(",")}(n);if(Array.isArray(null==t?void 0:t.lockAdditionalFields)&&0===(null==t?void 0:t.lockAdditionalFields.length))i?e.fieldMask=i:delete e.fieldMask;else if((null==t?void 0:t.lockAdditionalFields)&&t.lockAdditionalFields.length>0&&null!==r&&Array.isArray(r)&&r.length>0){const t=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let n=[];r.length>0&&(n=r.map(e=>t.includes(e)?`generationConfig.${e}`:e));const o=[];i&&o.push(i),n.length>0&&o.push(...n),o.length>0?e.fieldMask=o.join(","):delete e.fieldMask}else delete e.fieldMask}else null!==r&&Array.isArray(r)&&r.length>0?e.fieldMask=r.join(","):delete e.fieldMask;return e}class sw extends Ny{constructor(e){super(),this.apiClient=e}async create(e){var t,n;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const s=function(e,t){const n={},i=Uy(t,["config"]);return null!=i&&Dy(n,["config"],rw(e,i,n)),n}(this.apiClient,e);r=Ly("auth_tokens",s._url),o=s._query,delete s.config,delete s._url,delete s._query;const a=ow(s,e.config);return i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),i.then(e=>e)}}}function aw(e){const t={},n=Uy(e,["name"]);null!=n&&Dy(t,["_url","name"],n);const i=Uy(e,["config"]);return null!=i&&function(e,t){const n=Uy(e,["force"]);void 0!==t&&null!=n&&Dy(t,["_query","force"],n)}(i,t),t}function lw(e){const t={},n=Uy(e,["parent"]);null!=n&&Dy(t,["_url","parent"],n);const i=Uy(e,["config"]);return null!=i&&function(e,t){const n=Uy(e,["pageSize"]);void 0!==t&&null!=n&&Dy(t,["_query","pageSize"],n);const i=Uy(e,["pageToken"]);void 0!==t&&null!=i&&Dy(t,["_query","pageToken"],i)}(i,t),t}class uw extends Ny{constructor(e){super(),this.apiClient=e,this.list=async e=>new fb(YS.PAGED_ITEM_DOCUMENTS,t=>this.listInternal({parent:e.parent,config:t.config}),await this.listInternal(e),e)}async get(e){var t,n;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const s=function(e){const t={},n=Uy(e,["name"]);return null!=n&&Dy(t,["_url","name"],n),t}(e);return r=Ly("{name}",s._url),o=s._query,delete s._url,delete s._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),i.then(e=>e)}}async delete(e){var t,n;let i="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const o=aw(e);i=Ly("{name}",o._url),r=o._query,delete o._url,delete o._query,await this.apiClient.request({path:i,queryParams:r,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal})}}async listInternal(e){var t,n;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const s=lw(e);return r=Ly("{parent}/documents",s._url),o=s._query,delete s._url,delete s._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),i.then(e=>{const t=function(e){const t={},n=Uy(e,["sdkHttpResponse"]);null!=n&&Dy(t,["sdkHttpResponse"],n);const i=Uy(e,["nextPageToken"]);null!=i&&Dy(t,["nextPageToken"],i);const r=Uy(e,["documents"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),Dy(t,["documents"],e)}return t}(e),n=new pE;return Object.assign(n,t),n})}}}class cw extends Ny{constructor(e,t=new uw(e)){super(),this.apiClient=e,this.documents=t,this.list=async(e={})=>new fb(YS.PAGED_ITEM_FILE_SEARCH_STORES,e=>this.listInternal(e),await this.listInternal(e),e)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var t,n;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const s=OT(e);return r=Ly("fileSearchStores",s._url),o=s._query,delete s._url,delete s._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),i.then(e=>e)}}async get(e){var t,n;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const s=function(e){const t={},n=Uy(e,["name"]);return null!=n&&Dy(t,["_url","name"],n),t}(e);return r=Ly("{name}",s._url),o=s._query,delete s._url,delete s._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),i.then(e=>e)}}async delete(e){var t,n;let i="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const o=NT(e);i=Ly("{name}",o._url),r=o._query,delete o._url,delete o._query,await this.apiClient.request({path:i,queryParams:r,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal})}}async listInternal(e){var t,n;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const s=UT(e);return r=Ly("fileSearchStores",s._url),o=s._query,delete s._url,delete s._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),i.then(e=>{const t=function(e){const t={},n=Uy(e,["sdkHttpResponse"]);null!=n&&Dy(t,["sdkHttpResponse"],n);const i=Uy(e,["nextPageToken"]);null!=i&&Dy(t,["nextPageToken"],i);const r=Uy(e,["fileSearchStores"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),Dy(t,["fileSearchStores"],e)}return t}(e),n=new fE;return Object.assign(n,t),n})}}async uploadToFileSearchStoreInternal(e){var t,n;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const s=function(e){const t={},n=Uy(e,["fileSearchStoreName"]);null!=n&&Dy(t,["_url","file_search_store_name"],n);const i=Uy(e,["config"]);return null!=i&&kT(i,t),t}(e);return r=Ly("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",s._url),o=s._query,delete s._url,delete s._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),i.then(e=>{const t=function(e){const t={},n=Uy(e,["sdkHttpResponse"]);return null!=n&&Dy(t,["sdkHttpResponse"],n),t}(e),n=new mE;return Object.assign(n,t),n})}}async importFile(e){var t,n;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const s=DT(e);return r=Ly("{file_search_store_name}:importFile",s._url),o=s._query,delete s._url,delete s._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()),i.then(e=>{const t=LT(e),n=new gE;return Object.assign(n,t),n})}}}let dw=function(){const{crypto:e}=globalThis;if(null==e?void 0:e.randomUUID)return dw=e.randomUUID.bind(e),e.randomUUID();const t=new Uint8Array(1),n=e?()=>e.getRandomValues(t)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(+e^n()&15>>+e/4).toString(16))};function hw(e){return"object"==typeof e&&null!==e&&("name"in e&&"AbortError"===e.name||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}const pw=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){const t=new Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch(t){}try{return new Error(JSON.stringify(e))}catch(n){}}return new Error(e)};class fw extends Error{}class mw extends fw{constructor(e,t,n,i){super(`${mw.makeMessage(e,t,n)}`),this.status=e,this.headers=i,this.error=t}static makeMessage(e,t,n){const i=(null==t?void 0:t.message)?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&i?`${e} ${i}`:e?`${e} status code (no body)`:i||"(no status code or body)"}static generate(e,t,n,i){if(!e||!i)return new vw({message:n,cause:pw(t)});const r=t;return 400===e?new yw(e,r,n,i):401===e?new xw(e,r,n,i):403===e?new Sw(e,r,n,i):404===e?new Ew(e,r,n,i):409===e?new bw(e,r,n,i):422===e?new Tw(e,r,n,i):429===e?new ww(e,r,n,i):e>=500?new Mw(e,r,n,i):new mw(e,r,n,i)}}class gw extends mw{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class vw extends mw{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class _w extends vw{constructor({message:e}={}){super({message:null!=e?e:"Request timed out."})}}class yw extends mw{}class xw extends mw{}class Sw extends mw{}class Ew extends mw{}class bw extends mw{}class Tw extends mw{}class ww extends mw{}class Mw extends mw{}const Aw=/^[a-z][a-z0-9+.-]*:/i;let Rw=e=>(Rw=Array.isArray,Rw(e));const Cw=Rw;const Iw="0.0.1";const Pw=()=>{var e,t,n,i,r;const o="undefined"!=typeof Deno&&null!=Deno.build?"deno":"undefined"!=typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===o)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Iw,"X-Stainless-OS":Nw(Deno.build.os),"X-Stainless-Arch":Ow(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:null!==(t=null===(e=Deno.version)||void 0===e?void 0:e.deno)&&void 0!==t?t:"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Iw,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===o)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Iw,"X-Stainless-OS":Nw(null!==(n=globalThis.process.platform)&&void 0!==n?n:"unknown"),"X-Stainless-Arch":Ow(null!==(i=globalThis.process.arch)&&void 0!==i?i:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":null!==(r=globalThis.process.version)&&void 0!==r?r:"unknown"};const s=function(){if("undefined"==typeof navigator||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:n}of e){const e=n.exec(navigator.userAgent);if(e){return{browser:t,version:`${e[1]||0}.${e[2]||0}.${e[3]||0}`}}}return null}();return s?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Iw,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${s.browser}`,"X-Stainless-Runtime-Version":s.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Iw,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};const Ow=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",Nw=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";let Lw;function Dw(...e){const t=globalThis.ReadableStream;if(void 0===t)throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function Uw(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return Dw({start(){},async pull(e){const{done:n,value:i}=await t.next();n?e.close():e.enqueue(i)},async cancel(){var e;await(null===(e=t.return)||void 0===e?void 0:e.call(t))}})}function kw(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const e=await t.read();return(null==e?void 0:e.done)&&t.releaseLock(),e}catch(BM){throw t.releaseLock(),BM}},async return(){const e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const Fw=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)}),Bw=()=>{var e;if("undefined"==typeof File){const{process:t}=globalThis,n="string"==typeof(null===(e=null==t?void 0:t.versions)||void 0===e?void 0:e.node)&&parseInt(t.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(n?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function Hw(e,t,n){return Bw(),new File(e,null!=t?t:"unknown_file",n)}const Vw=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer;async function zw(e){var t,n,i,r,o;let s=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)s.push(e);else if(Vw(e))s.push(e instanceof Blob?e:await e.arrayBuffer());else{if(!(e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator])(e)){const t=null===(o=null==e?void 0:e.constructor)||void 0===o?void 0:o.name;throw new Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:""}${function(e){if("object"!=typeof e||null===e)return"";const t=Object.getOwnPropertyNames(e);return`; props: [${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`)}try{for(var a,l=!0,u=Rb(e);!(t=(a=await u.next()).done);l=!0){r=a.value,l=!1;const e=r;s.push(...await zw(e))}}catch(c){n={error:c}}finally{try{l||t||!(i=u.return)||await i.call(u)}finally{if(n)throw n.error}}}return s}class Gw{constructor(e){this._client=e}}function Ww(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}Gw._key=[];const jw=Object.freeze(Object.create(null)),qw=((e=Ww)=>function(t,...n){if(1===t.length)return t[0];let i=!1;const r=[],o=t.reduce((t,o,s)=>{var a,l,u;/[?#]/.test(o)&&(i=!0);const c=n[s];let d=(i?encodeURIComponent:e)(""+c);return s!==n.length&&(null==c||"object"==typeof c&&c.toString===(null===(u=Object.getPrototypeOf(null!==(l=Object.getPrototypeOf(null!==(a=c.hasOwnProperty)&&void 0!==a?a:jw))&&void 0!==l?l:jw))||void 0===u?void 0:u.toString))&&(d=c+"",r.push({start:t.length+o.length,length:d.length,error:`Value of type ${Object.prototype.toString.call(c).slice(8,-1)} is not a valid path parameter`})),t+o+(s===n.length?"":d)},""),s=o.split(/[?#]/,1)[0],a=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let l;for(;null!==(l=a.exec(s));)r.push({start:l.index,length:l[0].length,error:`Value "${l[0]}" can't be safely passed as a path parameter`});if(r.sort((e,t)=>e.start-t.start),r.length>0){let e=0;const t=r.reduce((t,n)=>{const i=" ".repeat(n.start-e),r="^".repeat(n.length);return e=n.start+n.length,t+i+r},"");throw new fw(`Path parameters result in path with invalid segments:\n${r.map(e=>e.error).join("\n")}\n${o}\n${t}`)}return o})(Ww);class Xw extends Gw{create(e,t){var n;const{api_version:i=this._client.apiVersion}=e,r=Tb(e,["api_version"]);if("model"in r&&"agent_config"in r)throw new fw("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in r&&"generation_config"in r)throw new fw("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(qw`/${i}/interactions`,Object.assign(Object.assign({body:r},t),{stream:null!==(n=e.stream)&&void 0!==n&&n}))}delete(e,t={},n){const{api_version:i=this._client.apiVersion}=null!=t?t:{};return this._client.delete(qw`/${i}/interactions/${e}`,n)}cancel(e,t={},n){const{api_version:i=this._client.apiVersion}=null!=t?t:{};return this._client.post(qw`/${i}/interactions/${e}/cancel`,n)}get(e,t={},n){var i;const r=null!=t?t:{},{api_version:o=this._client.apiVersion}=r,s=Tb(r,["api_version"]);return this._client.get(qw`/${o}/interactions/${e}`,Object.assign(Object.assign({query:s},n),{stream:null!==(i=null==t?void 0:t.stream)&&void 0!==i&&i}))}}Xw._key=Object.freeze(["interactions"]);class Yw extends Xw{}let Kw,Jw;function $w(e){let t;return(null!=Kw?Kw:(t=new globalThis.TextEncoder,Kw=t.encode.bind(t)))(e)}function Zw(e){let t;return(null!=Jw?Jw:(t=new globalThis.TextDecoder,Jw=t.decode.bind(t)))(e)}class Qw{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(e){if(null==e)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?$w(e):e;this.buffer=function(e){let t=0;for(const r of e)t+=r.length;const n=new Uint8Array(t);let i=0;for(const r of e)n.set(r,i),i+=r.length;return n}([this.buffer,t]);const n=[];let i;for(;null!=(i=eM(this.buffer,this.carriageReturnIndex));){if(i.carriage&&null==this.carriageReturnIndex){this.carriageReturnIndex=i.index;continue}if(null!=this.carriageReturnIndex&&(i.index!==this.carriageReturnIndex+1||i.carriage)){n.push(Zw(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}const e=null!==this.carriageReturnIndex?i.preceding-1:i.preceding,t=Zw(this.buffer.subarray(0,e));n.push(t),this.buffer=this.buffer.subarray(i.index),this.carriageReturnIndex=null}return n}flush(){return this.buffer.length?this.decode("\n"):[]}}function eM(e,t){for(let n=null!=t?t:0;n<e.length;n++){if(10===e[n])return{preceding:n,index:n+1,carriage:!1};if(13===e[n])return{preceding:n,index:n+1,carriage:!0}}return null}function tM(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1])return t+2;if(13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return-1}Qw.NEWLINE_CHARS=new Set(["\n","\r"]),Qw.NEWLINE_REGEXP=/\r\n|[\n\r]/g;const nM={off:0,error:200,warn:300,info:400,debug:500},iM=(e,t,n)=>{var i,r;if(e)return i=nM,r=e,Object.prototype.hasOwnProperty.call(i,r)?e:void lM(n).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(nM))}`)};function rM(){}function oM(e,t,n){return!t||nM[e]>nM[n]?rM:t[e].bind(t)}const sM={error:rM,warn:rM,info:rM,debug:rM};let aM=new WeakMap;function lM(e){var t;const n=e.logger,i=null!==(t=e.logLevel)&&void 0!==t?t:"off";if(!n)return sM;const r=aM.get(n);if(r&&r[0]===i)return r[1];const o={error:oM("error",n,i),warn:oM("warn",n,i),info:oM("info",n,i),debug:oM("debug",n,i)};return aM.set(n,[i,o]),o}const uM=e=>(e.options&&(e.options=Object.assign({},e.options),delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,t])=>[e,"x-goog-api-key"===e.toLowerCase()||"authorization"===e.toLowerCase()||"cookie"===e.toLowerCase()||"set-cookie"===e.toLowerCase()?"***":t]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);class cM{constructor(e,t,n){this.iterator=e,this.controller=t,this.client=n}static fromSSEResponse(e,t,n){let i=!1;const r=n?lM(n):console;return new cM(function(){return Ab(this,arguments,function*(){var n,o,s,a;if(i)throw new fw("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let l=!1;try{try{for(var u,c=!0,d=Rb(function(e,t){return Ab(this,arguments,function*(){var n,i,r,o;if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new fw("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new fw("Attempted to iterate over a response with no body")}const s=new dM,a=new Qw,l=kw(e.body);try{for(var u,c=!0,d=Rb(function(e){return Ab(this,arguments,function*(){var t,n,i,r;let o=new Uint8Array;try{for(var s,a=!0,l=Rb(e);!(t=(s=yield Mb(l.next())).done);a=!0){r=s.value,a=!1;const e=r;if(null==e)continue;const t=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?$w(e):e;let n,i=new Uint8Array(o.length+t.length);for(i.set(o),i.set(t,o.length),o=i;-1!==(n=tM(o));)yield yield Mb(o.slice(0,n)),o=o.slice(n)}}catch(u){n={error:u}}finally{try{a||t||!(i=l.return)||(yield Mb(i.call(l)))}finally{if(n)throw n.error}}o.length>0&&(yield yield Mb(o))})}(l));!(n=(u=yield Mb(d.next())).done);c=!0){o=u.value,c=!1;const e=o;for(const t of a.decode(e)){const e=s.decode(t);e&&(yield yield Mb(e))}}}catch(h){i={error:h}}finally{try{c||n||!(r=d.return)||(yield Mb(r.call(d)))}finally{if(i)throw i.error}}for(const e of a.flush()){const t=s.decode(e);t&&(yield yield Mb(t))}})}(e,t));!(n=(u=yield Mb(d.next())).done);c=!0){a=u.value,c=!1;const e=a;if(!l)if(e.data.startsWith("[DONE]"))l=!0;else try{yield yield Mb(JSON.parse(e.data))}catch(BM){throw r.error("Could not parse message into JSON:",e.data),r.error("From chunk:",e.raw),BM}}}catch(h){o={error:h}}finally{try{c||n||!(s=d.return)||(yield Mb(s.call(d)))}finally{if(o)throw o.error}}l=!0}catch(BM){if(hw(BM))return yield Mb(void 0);throw BM}finally{l||t.abort()}})},t,n)}static fromReadableStream(e,t,n){let i=!1;return new cM(function(){return Ab(this,arguments,function*(){var n,r,o,s;if(i)throw new fw("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let a=!1;try{try{for(var l,u=!0,c=Rb(function(){return Ab(this,arguments,function*(){var t,n,i,r;const o=new Qw,s=kw(e);try{for(var a,l=!0,u=Rb(s);!(t=(a=yield Mb(u.next())).done);l=!0){r=a.value,l=!1;const e=r;for(const t of o.decode(e))yield yield Mb(t)}}catch(c){n={error:c}}finally{try{l||t||!(i=u.return)||(yield Mb(i.call(u)))}finally{if(n)throw n.error}}for(const e of o.flush())yield yield Mb(e)})}());!(n=(l=yield Mb(c.next())).done);u=!0){s=l.value,u=!1;const e=s;a||e&&(yield yield Mb(JSON.parse(e)))}}catch(d){r={error:d}}finally{try{u||n||!(o=c.return)||(yield Mb(o.call(c)))}finally{if(r)throw r.error}}a=!0}catch(BM){if(hw(BM))return yield Mb(void 0);throw BM}finally{a||t.abort()}})},t,n)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),i=i=>({next:()=>{if(0===i.length){const i=n.next();e.push(i),t.push(i)}return i.shift()}});return[new cM(()=>i(e),this.controller,this.client),new cM(()=>i(t),this.controller,this.client)]}toReadableStream(){const e=this;let t;return Dw({async start(){t=e[Symbol.asyncIterator]()},async pull(e){try{const{value:n,done:i}=await t.next();if(i)return e.close();const r=$w(JSON.stringify(n)+"\n");e.enqueue(r)}catch(n){e.error(n)}},async cancel(){var e;await(null===(e=t.return)||void 0===e?void 0:e.call(t))}})}}class dM{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,i]=function(e,t){const n=e.indexOf(t);if(-1!==n)return[e.substring(0,n),t,e.substring(n+t.length)];return[e,"",""]}(e,":");return i.startsWith(" ")&&(i=i.substring(1)),"event"===t?this.event=i:"data"===t&&this.data.push(i),null}}async function hM(e,t){const{response:n,requestLogID:i,retryOfRequestLogID:r,startTime:o}=t,s=await(async()=>{var i;if(t.options.stream)return lM(e).debug("response",n.status,n.url,n.headers,n.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(n,t.controller,e):cM.fromSSEResponse(n,t.controller,e);if(204===n.status)return null;if(t.options.__binaryResponse)return n;const r=n.headers.get("content-type"),o=null===(i=null==r?void 0:r.split(";")[0])||void 0===i?void 0:i.trim();if((null==o?void 0:o.includes("application/json"))||(null==o?void 0:o.endsWith("+json"))){return await n.json()}return await n.text()})();return lM(e).debug(`[${i}] response parsed`,uM({retryOfRequestLogID:r,url:n.url,status:n.status,body:s,durationMs:Date.now()-o})),s}class pM extends Promise{constructor(e,t,n=hM){super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=n,this.client=e}_thenUnwrap(e){return new pM(this.client,this.responsePromise,async(t,n)=>e(await this.parseResponse(t,n),n))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(this.client,e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}const fM=Symbol("brand.privateNullableHeaders");function*mM(e){if(!e)return;if(fM in e){const{values:t,nulls:n}=e;yield*t.entries();for(const e of n)yield[e,null];return}let t,n=!1;e instanceof Headers?t=e.entries():Cw(e)?t=e:(n=!0,t=Object.entries(null!=e?e:{}));for(let i of t){const e=i[0];if("string"!=typeof e)throw new TypeError("expected header name to be a string");const t=Cw(i[1])?i[1]:[i[1]];let r=!1;for(const i of t)void 0!==i&&(n&&!r&&(r=!0,yield[e,null]),yield[e,i])}}const gM=e=>{const t=new Headers,n=new Set;for(const i of e){const e=new Set;for(const[r,o]of mM(i)){const i=r.toLowerCase();e.has(i)||(t.delete(r),e.add(i)),null===o?(t.delete(r),n.add(i)):(t.append(r,o),n.delete(i))}}return{[fM]:!0,values:t,nulls:n}},vM=e=>{var t,n,i,r,o,s;return void 0!==globalThis.process?null!==(i=null===(n=null===(t=Cy)||void 0===t?void 0:t[e])||void 0===n?void 0:n.trim())&&void 0!==i?i:void 0:void 0!==globalThis.Deno?null===(s=null===(o=null===(r=globalThis.Deno.env)||void 0===r?void 0:r.get)||void 0===o?void 0:o.call(r,e))||void 0===s?void 0:s.trim():void 0};var _M;class yM{constructor(e){var t,n,i,r,o,s,a,{baseURL:l=vM("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:u=(null!==(t=vM("GEMINI_API_KEY"))&&void 0!==t?t:null),apiVersion:c="v1beta"}=e,d=Tb(e,["baseURL","apiKey","apiVersion"]);const h=Object.assign(Object.assign({apiKey:u,apiVersion:c},d),{baseURL:l||"https://generativelanguage.googleapis.com"});this.baseURL=h.baseURL,this.timeout=null!==(n=h.timeout)&&void 0!==n?n:yM.DEFAULT_TIMEOUT,this.logger=null!==(i=h.logger)&&void 0!==i?i:console;const p="warn";this.logLevel=p,this.logLevel=null!==(o=null!==(r=iM(h.logLevel,"ClientOptions.logLevel",this))&&void 0!==r?r:iM(vM("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))&&void 0!==o?o:p,this.fetchOptions=h.fetchOptions,this.maxRetries=null!==(s=h.maxRetries)&&void 0!==s?s:2,this.fetch=null!==(a=h.fetch)&&void 0!==a?a:function(){if("undefined"!=typeof fetch)return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),this.encoder=Fw,this._options=h,this.apiKey=u,this.apiVersion=c,this.clientAdapter=h.clientAdapter}withOptions(e){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),e))}baseURLOverridden(){return"https://generativelanguage.googleapis.com"!==this.baseURL}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){if(!e.has("authorization")&&!e.has("x-goog-api-key")&&!(this.apiKey&&e.get("x-goog-api-key")||t.has("x-goog-api-key")))throw new Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(e){const t=gM([e.headers]);if(!t.values.has("authorization")&&!t.values.has("x-goog-api-key"))return this.apiKey?gM([{"x-goog-api-key":this.apiKey}]):this.clientAdapter.isVertexAI()?gM([await this.clientAdapter.getAuthHeaders()]):void 0}stringifyQuery(e){return Object.entries(e).filter(([e,t])=>void 0!==t).map(([e,t])=>{if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;if(null===t)return`${encodeURIComponent(e)}=`;throw new fw(`Cannot stringify type ${typeof t}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${Iw}`}defaultIdempotencyKey(){return`stainless-node-retry-${dw()}`}makeStatusError(e,t,n,i){return mw.generate(e,t,n,i)}buildURL(e,t,n){const i=!this.baseURLOverridden()&&n||this.baseURL,r=(e=>Aw.test(e))(e)?new URL(e):new URL(i+(i.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),o=this.defaultQuery();return function(e){if(!e)return!0;for(const t in e)return!1;return!0}(o)||(t=Object.assign(Object.assign({},o),t)),"object"==typeof t&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}async prepareOptions(e){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!e.path.startsWith(`/${this.apiVersion}/projects/`)){const t=e.path.slice(this.apiVersion.length+1);e.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${t}`}}async prepareRequest(e,{url:t,options:n}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(n=>Object.assign({method:e,path:t},n)))}request(e,t=null){return new pM(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,n){var i,r,o;const s=await e,a=null!==(i=s.maxRetries)&&void 0!==i?i:this.maxRetries;null==t&&(t=a),await this.prepareOptions(s);const{req:l,url:u,timeout:c}=await this.buildRequest(s,{retryCount:a-t});await this.prepareRequest(l,{url:u,options:s});const d="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),h=void 0===n?"":`, retryOf: ${n}`,p=Date.now();if(lM(this).debug(`[${d}] sending request`,uM({retryOfRequestLogID:n,method:s.method,url:u,options:s,headers:l.headers})),null===(r=s.signal)||void 0===r?void 0:r.aborted)throw new gw;const f=new AbortController,m=await this.fetchWithTimeout(u,l,c,f).catch(pw),g=Date.now();if(m instanceof globalThis.Error){const e=`retrying, ${t} attempts remaining`;if(null===(o=s.signal)||void 0===o?void 0:o.aborted)throw new gw;const i=hw(m)||/timed? ?out/i.test(String(m)+("cause"in m?String(m.cause):""));if(t)return lM(this).info(`[${d}] connection ${i?"timed out":"failed"} - ${e}`),lM(this).debug(`[${d}] connection ${i?"timed out":"failed"} (${e})`,uM({retryOfRequestLogID:n,url:u,durationMs:g-p,message:m.message})),this.retryRequest(s,t,null!=n?n:d);if(lM(this).info(`[${d}] connection ${i?"timed out":"failed"} - error; no more retries left`),lM(this).debug(`[${d}] connection ${i?"timed out":"failed"} (error; no more retries left)`,uM({retryOfRequestLogID:n,url:u,durationMs:g-p,message:m.message})),i)throw new _w;throw new vw({cause:m})}const v=`[${d}${h}] ${l.method} ${u} ${m.ok?"succeeded":"failed"} with status ${m.status} in ${g-p}ms`;if(!m.ok){const e=await this.shouldRetry(m);if(t&&e){const e=`retrying, ${t} attempts remaining`;return await async function(e){var t,n;if(null===e||"object"!=typeof e)return;if(e[Symbol.asyncIterator])return void(await(null===(n=(t=e[Symbol.asyncIterator]()).return)||void 0===n?void 0:n.call(t)));const i=e.getReader(),r=i.cancel();i.releaseLock(),await r}(m.body),lM(this).info(`${v} - ${e}`),lM(this).debug(`[${d}] response error (${e})`,uM({retryOfRequestLogID:n,url:m.url,status:m.status,headers:m.headers,durationMs:g-p})),this.retryRequest(s,t,null!=n?n:d,m.headers)}const i=e?"error; no more retries left":"error; not retryable";lM(this).info(`${v} - ${i}`);const r=await m.text().catch(e=>pw(e).message),o=(e=>{try{return JSON.parse(e)}catch(t){return}})(r),a=o?void 0:r;lM(this).debug(`[${d}] response error (${i})`,uM({retryOfRequestLogID:n,url:m.url,status:m.status,headers:m.headers,message:a,durationMs:Date.now()-p}));throw this.makeStatusError(m.status,o,a,m.headers)}return lM(this).info(v),lM(this).debug(`[${d}] response start`,uM({retryOfRequestLogID:n,url:m.url,status:m.status,headers:m.headers,durationMs:g-p})),{response:m,options:s,controller:f,requestLogID:d,retryOfRequestLogID:n,startTime:p}}async fetchWithTimeout(e,t,n,i){const r=t||{},{signal:o,method:s}=r,a=Tb(r,["signal","method"]);o&&o.addEventListener("abort",()=>i.abort());const l=setTimeout(()=>i.abort(),n),u=globalThis.ReadableStream&&a.body instanceof globalThis.ReadableStream||"object"==typeof a.body&&null!==a.body&&Symbol.asyncIterator in a.body,c=Object.assign(Object.assign(Object.assign({signal:i.signal},u?{duplex:"half"}:{}),{method:"GET"}),a);s&&(c.method=s.toUpperCase());try{return await this.fetch.call(void 0,e,c)}finally{clearTimeout(l)}}async shouldRetry(e){const t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||(409===e.status||(429===e.status||e.status>=500)))}async retryRequest(e,t,n,i){var r;let o;const s=null==i?void 0:i.get("retry-after-ms");if(s){const e=parseFloat(s);Number.isNaN(e)||(o=e)}const a=null==i?void 0:i.get("retry-after");if(a&&!o){const e=parseFloat(a);o=Number.isNaN(e)?Date.parse(a)-Date.now():1e3*e}if(!(o&&0<=o&&o<6e4)){const n=null!==(r=e.maxRetries)&&void 0!==r?r:this.maxRetries;o=this.calculateDefaultRetryTimeoutMillis(t,n)}var l;return await(l=o,new Promise(e=>setTimeout(e,l))),this.makeRequest(e,t-1,n)}calculateDefaultRetryTimeoutMillis(e,t){const n=t-e;return Math.min(.5*Math.pow(2,n),8)*(1-.25*Math.random())*1e3}async buildRequest(e,{retryCount:t=0}={}){var n,i,r;const o=Object.assign({},e),{method:s,path:a,query:l,defaultBaseURL:u}=o,c=this.buildURL(a,l,u);"timeout"in o&&((e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new fw(`${e} must be an integer`);if(t<0)throw new fw(`${e} must be a positive integer`)})("timeout",o.timeout),o.timeout=null!==(n=o.timeout)&&void 0!==n?n:this.timeout;const{bodyHeaders:d,body:h}=this.buildBody({options:o}),p=await this.buildHeaders({options:e,method:s,bodyHeaders:d,retryCount:t});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:s,headers:p},o.signal&&{signal:o.signal}),globalThis.ReadableStream&&h instanceof globalThis.ReadableStream&&{duplex:"half"}),h&&{body:h}),null!==(i=this.fetchOptions)&&void 0!==i?i:{}),null!==(r=o.fetchOptions)&&void 0!==r?r:{}),url:c,timeout:o.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:n,retryCount:i}){let r={};this.idempotencyHeader&&"get"!==t&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),r[this.idempotencyHeader]=e.idempotencyKey);const o=await this.authHeaders(e);let s=gM([r,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(i)},e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{}),null!=Lw?Lw:Lw=Pw()),this._options.defaultHeaders,n,e.headers,o]);return this.validateHeaders(s),s.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};const n=gM([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||"string"==typeof e&&n.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:"object"==typeof e&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&"function"==typeof e.next)?{bodyHeaders:void 0,body:Uw(e)}:this.encoder({body:e,headers:n})}}yM.DEFAULT_TIMEOUT=6e4;class xM extends yM{constructor(){super(...arguments),this.interactions=new Yw(this)}}function SM(e,t){const n={},i=Uy(e,["baseModel"]);null!=i&&Dy(n,["baseModel"],i);const r=Uy(e,["preTunedModel"]);null!=r&&Dy(n,["preTunedModel"],r);const o=Uy(e,["trainingDataset"]);null!=o&&function(e){const t={};if(void 0!==Uy(e,["gcsUri"]))throw new Error("gcsUri parameter is not supported in Gemini API.");if(void 0!==Uy(e,["vertexDatasetResource"]))throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const n=Uy(e,["examples"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),Dy(t,["examples","examples"],e)}}(o);const s=Uy(e,["config"]);return null!=s&&function(e,t){const n={};if(void 0!==Uy(e,["validationDataset"]))throw new Error("validationDataset parameter is not supported in Gemini API.");const i=Uy(e,["tunedModelDisplayName"]);if(void 0!==t&&null!=i&&Dy(t,["displayName"],i),void 0!==Uy(e,["description"]))throw new Error("description parameter is not supported in Gemini API.");const r=Uy(e,["epochCount"]);void 0!==t&&null!=r&&Dy(t,["tuningTask","hyperparameters","epochCount"],r);const o=Uy(e,["learningRateMultiplier"]);if(null!=o&&Dy(n,["tuningTask","hyperparameters","learningRateMultiplier"],o),void 0!==Uy(e,["exportLastCheckpointOnly"]))throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(void 0!==Uy(e,["preTunedModelCheckpointId"]))throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(void 0!==Uy(e,["adapterSize"]))throw new Error("adapterSize parameter is not supported in Gemini API.");if(void 0!==Uy(e,["tuningMode"]))throw new Error("tuningMode parameter is not supported in Gemini API.");if(void 0!==Uy(e,["customBaseModel"]))throw new Error("customBaseModel parameter is not supported in Gemini API.");const s=Uy(e,["batchSize"]);void 0!==t&&null!=s&&Dy(t,["tuningTask","hyperparameters","batchSize"],s);const a=Uy(e,["learningRate"]);if(void 0!==t&&null!=a&&Dy(t,["tuningTask","hyperparameters","learningRate"],a),void 0!==Uy(e,["labels"]))throw new Error("labels parameter is not supported in Gemini API.");if(void 0!==Uy(e,["beta"]))throw new Error("beta parameter is not supported in Gemini API.");if(void 0!==Uy(e,["baseTeacherModel"]))throw new Error("baseTeacherModel parameter is not supported in Gemini API.");if(void 0!==Uy(e,["tunedTeacherModelSource"]))throw new Error("tunedTeacherModelSource parameter is not supported in Gemini API.");if(void 0!==Uy(e,["sftLossWeightMultiplier"]))throw new Error("sftLossWeightMultiplier parameter is not supported in Gemini API.");if(void 0!==Uy(e,["outputUri"]))throw new Error("outputUri parameter is not supported in Gemini API.")}(s,n),n}function EM(e,t){const n={},i=Uy(e,["baseModel"]);null!=i&&Dy(n,["baseModel"],i);const r=Uy(e,["preTunedModel"]);null!=r&&Dy(n,["preTunedModel"],r);const o=Uy(e,["trainingDataset"]);null!=o&&function(e,t,n){const i={};let r=Uy(n,["config","method"]);void 0===r&&(r="SUPERVISED_FINE_TUNING");if("SUPERVISED_FINE_TUNING"===r){const n=Uy(e,["gcsUri"]);void 0!==t&&null!=n&&Dy(t,["supervisedTuningSpec","trainingDatasetUri"],n)}else if("PREFERENCE_TUNING"===r){const n=Uy(e,["gcsUri"]);void 0!==t&&null!=n&&Dy(t,["preferenceOptimizationSpec","trainingDatasetUri"],n)}else if("DISTILLATION"===r){const n=Uy(e,["gcsUri"]);void 0!==t&&null!=n&&Dy(t,["distillationSpec","promptDatasetUri"],n)}let o=Uy(n,["config","method"]);void 0===o&&(o="SUPERVISED_FINE_TUNING");if("SUPERVISED_FINE_TUNING"===o){const n=Uy(e,["vertexDatasetResource"]);void 0!==t&&null!=n&&Dy(t,["supervisedTuningSpec","trainingDatasetUri"],n)}else if("PREFERENCE_TUNING"===o){const n=Uy(e,["vertexDatasetResource"]);void 0!==t&&null!=n&&Dy(t,["preferenceOptimizationSpec","trainingDatasetUri"],n)}else if("DISTILLATION"===o){const n=Uy(e,["vertexDatasetResource"]);void 0!==t&&null!=n&&Dy(t,["distillationSpec","promptDatasetUri"],n)}if(void 0!==Uy(e,["examples"]))throw new Error("examples parameter is not supported in Vertex AI.")}(o,n,t);const s=Uy(e,["config"]);return null!=s&&function(e,t,n){let i=Uy(n,["config","method"]);if(void 0===i&&(i="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===i){const n=Uy(e,["validationDataset"]);void 0!==t&&null!=n&&Dy(t,["supervisedTuningSpec"],AM(n))}else if("PREFERENCE_TUNING"===i){const n=Uy(e,["validationDataset"]);void 0!==t&&null!=n&&Dy(t,["preferenceOptimizationSpec"],AM(n))}else if("DISTILLATION"===i){const n=Uy(e,["validationDataset"]);void 0!==t&&null!=n&&Dy(t,["distillationSpec"],AM(n))}const r=Uy(e,["tunedModelDisplayName"]);void 0!==t&&null!=r&&Dy(t,["tunedModelDisplayName"],r);const o=Uy(e,["description"]);void 0!==t&&null!=o&&Dy(t,["description"],o);let s=Uy(n,["config","method"]);if(void 0===s&&(s="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===s){const n=Uy(e,["epochCount"]);void 0!==t&&null!=n&&Dy(t,["supervisedTuningSpec","hyperParameters","epochCount"],n)}else if("PREFERENCE_TUNING"===s){const n=Uy(e,["epochCount"]);void 0!==t&&null!=n&&Dy(t,["preferenceOptimizationSpec","hyperParameters","epochCount"],n)}else if("DISTILLATION"===s){const n=Uy(e,["epochCount"]);void 0!==t&&null!=n&&Dy(t,["distillationSpec","hyperParameters","epochCount"],n)}let a=Uy(n,["config","method"]);if(void 0===a&&(a="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===a){const n=Uy(e,["learningRateMultiplier"]);void 0!==t&&null!=n&&Dy(t,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],n)}else if("PREFERENCE_TUNING"===a){const n=Uy(e,["learningRateMultiplier"]);void 0!==t&&null!=n&&Dy(t,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],n)}else if("DISTILLATION"===a){const n=Uy(e,["learningRateMultiplier"]);void 0!==t&&null!=n&&Dy(t,["distillationSpec","hyperParameters","learningRateMultiplier"],n)}let l=Uy(n,["config","method"]);if(void 0===l&&(l="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===l){const n=Uy(e,["exportLastCheckpointOnly"]);void 0!==t&&null!=n&&Dy(t,["supervisedTuningSpec","exportLastCheckpointOnly"],n)}else if("PREFERENCE_TUNING"===l){const n=Uy(e,["exportLastCheckpointOnly"]);void 0!==t&&null!=n&&Dy(t,["preferenceOptimizationSpec","exportLastCheckpointOnly"],n)}else if("DISTILLATION"===l){const n=Uy(e,["exportLastCheckpointOnly"]);void 0!==t&&null!=n&&Dy(t,["distillationSpec","exportLastCheckpointOnly"],n)}let u=Uy(n,["config","method"]);if(void 0===u&&(u="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===u){const n=Uy(e,["adapterSize"]);void 0!==t&&null!=n&&Dy(t,["supervisedTuningSpec","hyperParameters","adapterSize"],n)}else if("PREFERENCE_TUNING"===u){const n=Uy(e,["adapterSize"]);void 0!==t&&null!=n&&Dy(t,["preferenceOptimizationSpec","hyperParameters","adapterSize"],n)}else if("DISTILLATION"===u){const n=Uy(e,["adapterSize"]);void 0!==t&&null!=n&&Dy(t,["distillationSpec","hyperParameters","adapterSize"],n)}let c=Uy(n,["config","method"]);if(void 0===c&&(c="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===c){const n=Uy(e,["tuningMode"]);void 0!==t&&null!=n&&Dy(t,["supervisedTuningSpec","tuningMode"],n)}const d=Uy(e,["customBaseModel"]);void 0!==t&&null!=d&&Dy(t,["customBaseModel"],d);let h=Uy(n,["config","method"]);if(void 0===h&&(h="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===h){const n=Uy(e,["batchSize"]);void 0!==t&&null!=n&&Dy(t,["supervisedTuningSpec","hyperParameters","batchSize"],n)}let p=Uy(n,["config","method"]);if(void 0===p&&(p="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===p){const n=Uy(e,["learningRate"]);void 0!==t&&null!=n&&Dy(t,["supervisedTuningSpec","hyperParameters","learningRate"],n)}const f=Uy(e,["labels"]);void 0!==t&&null!=f&&Dy(t,["labels"],f);const m=Uy(e,["beta"]);void 0!==t&&null!=m&&Dy(t,["preferenceOptimizationSpec","hyperParameters","beta"],m);const g=Uy(e,["baseTeacherModel"]);void 0!==t&&null!=g&&Dy(t,["distillationSpec","baseTeacherModel"],g);const v=Uy(e,["tunedTeacherModelSource"]);void 0!==t&&null!=v&&Dy(t,["distillationSpec","tunedTeacherModelSource"],v);const _=Uy(e,["sftLossWeightMultiplier"]);void 0!==t&&null!=_&&Dy(t,["distillationSpec","hyperParameters","sftLossWeightMultiplier"],_);const y=Uy(e,["outputUri"]);void 0!==t&&null!=y&&Dy(t,["outputUri"],y)}(s,n,t),n}function bM(e,t){const n={},i=Uy(e,["config"]);return null!=i&&function(e,t){const n=Uy(e,["pageSize"]);void 0!==t&&null!=n&&Dy(t,["_query","pageSize"],n);const i=Uy(e,["pageToken"]);void 0!==t&&null!=i&&Dy(t,["_query","pageToken"],i);const r=Uy(e,["filter"]);void 0!==t&&null!=r&&Dy(t,["_query","filter"],r)}(i,n),n}function TM(e,t){const n={},i=Uy(e,["config"]);return null!=i&&function(e,t){const n=Uy(e,["pageSize"]);void 0!==t&&null!=n&&Dy(t,["_query","pageSize"],n);const i=Uy(e,["pageToken"]);void 0!==t&&null!=i&&Dy(t,["_query","pageToken"],i);const r=Uy(e,["filter"]);void 0!==t&&null!=r&&Dy(t,["_query","filter"],r)}(i,n),n}function wM(e,t){const n={},i=Uy(e,["sdkHttpResponse"]);null!=i&&Dy(n,["sdkHttpResponse"],i);const r=Uy(e,["name"]);null!=r&&Dy(n,["name"],r);const o=Uy(e,["state"]);null!=o&&Dy(n,["state"],qE(o));const s=Uy(e,["createTime"]);null!=s&&Dy(n,["createTime"],s);const a=Uy(e,["tuningTask","startTime"]);null!=a&&Dy(n,["startTime"],a);const l=Uy(e,["tuningTask","completeTime"]);null!=l&&Dy(n,["endTime"],l);const u=Uy(e,["updateTime"]);null!=u&&Dy(n,["updateTime"],u);const c=Uy(e,["description"]);null!=c&&Dy(n,["description"],c);const d=Uy(e,["baseModel"]);null!=d&&Dy(n,["baseModel"],d);const h=Uy(e,["_self"]);return null!=h&&Dy(n,["tunedModel"],function(e){const t={},n=Uy(e,["name"]);null!=n&&Dy(t,["model"],n);const i=Uy(e,["name"]);return null!=i&&Dy(t,["endpoint"],i),t}(h)),n}function MM(e,t){const n={},i=Uy(e,["sdkHttpResponse"]);null!=i&&Dy(n,["sdkHttpResponse"],i);const r=Uy(e,["name"]);null!=r&&Dy(n,["name"],r);const o=Uy(e,["state"]);null!=o&&Dy(n,["state"],qE(o));const s=Uy(e,["createTime"]);null!=s&&Dy(n,["createTime"],s);const a=Uy(e,["startTime"]);null!=a&&Dy(n,["startTime"],a);const l=Uy(e,["endTime"]);null!=l&&Dy(n,["endTime"],l);const u=Uy(e,["updateTime"]);null!=u&&Dy(n,["updateTime"],u);const c=Uy(e,["error"]);null!=c&&Dy(n,["error"],c);const d=Uy(e,["description"]);null!=d&&Dy(n,["description"],d);const h=Uy(e,["baseModel"]);null!=h&&Dy(n,["baseModel"],h);const p=Uy(e,["tunedModel"]);null!=p&&Dy(n,["tunedModel"],p);const f=Uy(e,["preTunedModel"]);null!=f&&Dy(n,["preTunedModel"],f);const m=Uy(e,["supervisedTuningSpec"]);null!=m&&Dy(n,["supervisedTuningSpec"],m);const g=Uy(e,["preferenceOptimizationSpec"]);null!=g&&Dy(n,["preferenceOptimizationSpec"],g);const v=Uy(e,["distillationSpec"]);null!=v&&Dy(n,["distillationSpec"],v);const _=Uy(e,["tuningDataStats"]);null!=_&&Dy(n,["tuningDataStats"],_);const y=Uy(e,["encryptionSpec"]);null!=y&&Dy(n,["encryptionSpec"],y);const x=Uy(e,["partnerModelTuningSpec"]);null!=x&&Dy(n,["partnerModelTuningSpec"],x);const S=Uy(e,["customBaseModel"]);null!=S&&Dy(n,["customBaseModel"],S);const E=Uy(e,["experiment"]);null!=E&&Dy(n,["experiment"],E);const b=Uy(e,["labels"]);null!=b&&Dy(n,["labels"],b);const T=Uy(e,["outputUri"]);null!=T&&Dy(n,["outputUri"],T);const w=Uy(e,["pipelineJob"]);null!=w&&Dy(n,["pipelineJob"],w);const M=Uy(e,["serviceAccount"]);null!=M&&Dy(n,["serviceAccount"],M);const A=Uy(e,["tunedModelDisplayName"]);null!=A&&Dy(n,["tunedModelDisplayName"],A);const R=Uy(e,["veoTuningSpec"]);return null!=R&&Dy(n,["veoTuningSpec"],R),n}function AM(e,t){const n={},i=Uy(e,["gcsUri"]);null!=i&&Dy(n,["validationDatasetUri"],i);const r=Uy(e,["vertexDatasetResource"]);return null!=r&&Dy(n,["validationDatasetUri"],r),n}_M=xM,xM.GeminiNextGenAPIClient=_M,xM.GeminiNextGenAPIClientError=fw,xM.APIError=mw,xM.APIConnectionError=vw,xM.APIConnectionTimeoutError=_w,xM.APIUserAbortError=gw,xM.NotFoundError=Ew,xM.ConflictError=bw,xM.RateLimitError=ww,xM.BadRequestError=yw,xM.AuthenticationError=xw,xM.InternalServerError=Mw,xM.PermissionDeniedError=Sw,xM.UnprocessableEntityError=Tw,xM.toFile=async function(e,t,n){if(Bw(),(e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&Vw(e))(e=await e))return e instanceof File?e:Hw([await e.arrayBuffer()],e.name);if((e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob)(e)){const i=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),Hw(await zw(i),t,n)}const i=await zw(e);if(t||(t=function(e){return("object"==typeof e&&null!==e&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}(e)),!(null==n?void 0:n.type)){const e=i.find(e=>"object"==typeof e&&"type"in e&&e.type);"string"==typeof e&&(n=Object.assign(Object.assign({},n),{type:e}))}return Hw(i,t,n)},xM.Interactions=Yw;class RM extends Ny{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new fb(YS.PAGED_ITEM_TUNING_JOBS,e=>this.listInternal(e),await this.listInternal(e),e),this.get=async e=>await this.getInternal(e),this.tune=async e=>{var t;if(this.apiClient.isVertexAI()){if(e.baseModel.startsWith("projects/")){const n={tunedModelName:e.baseModel};(null===(t=e.config)||void 0===t?void 0:t.preTunedModelCheckpointId)&&(n.checkpointId=e.config.preTunedModelCheckpointId);const i=Object.assign(Object.assign({},e),{preTunedModel:n});return i.baseModel=void 0,await this.tuneInternal(i)}{const t=Object.assign({},e);return await this.tuneInternal(t)}}{const t=Object.assign({},e),n=await this.tuneMldevInternal(t);let i="";void 0!==n.metadata&&void 0!==n.metadata.tunedModel?i=n.metadata.tunedModel:void 0!==n.name&&n.name.includes("/operations/")&&(i=n.name.split("/operations/")[0]);return{name:i,state:Bx.JOB_STATE_QUEUED}}}}async getInternal(e){var t,n,i,r;let o,s="",a={};if(this.apiClient.isVertexAI()){const i=function(e){const t={},n=Uy(e,["name"]);return null!=n&&Dy(t,["_url","name"],n),t}(e);return s=Ly("{name}",i._url),a=i._query,delete i._url,delete i._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(i),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),o.then(e=>MM(e))}{const t=function(e){const t={},n=Uy(e,["name"]);return null!=n&&Dy(t,["_url","name"],n),t}(e);return s=Ly("{name}",t._url),a=t._query,delete t._url,delete t._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(i=e.config)||void 0===i?void 0:i.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),o.then(e=>wM(e))}}async listInternal(e){var t,n,i,r;let o,s="",a={};if(this.apiClient.isVertexAI()){const i=TM(e);return s=Ly("tuningJobs",i._url),a=i._query,delete i._url,delete i._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(i),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),o.then(e=>{const t=function(e){const t={},n=Uy(e,["sdkHttpResponse"]);null!=n&&Dy(t,["sdkHttpResponse"],n);const i=Uy(e,["nextPageToken"]);null!=i&&Dy(t,["nextPageToken"],i);const r=Uy(e,["tuningJobs"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>MM(e))),Dy(t,["tuningJobs"],e)}return t}(e),n=new uE;return Object.assign(n,t),n})}{const t=bM(e);return s=Ly("tunedModels",t._url),a=t._query,delete t._url,delete t._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(i=e.config)||void 0===i?void 0:i.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),o.then(e=>{const t=function(e){const t={},n=Uy(e,["sdkHttpResponse"]);null!=n&&Dy(t,["sdkHttpResponse"],n);const i=Uy(e,["nextPageToken"]);null!=i&&Dy(t,["nextPageToken"],i);const r=Uy(e,["tunedModels"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>wM(e))),Dy(t,["tuningJobs"],e)}return t}(e),n=new uE;return Object.assign(n,t),n})}}async cancel(e){var t,n,i,r;let o,s="",a={};if(this.apiClient.isVertexAI()){const i=function(e){const t={},n=Uy(e,["name"]);return null!=n&&Dy(t,["_url","name"],n),t}(e);return s=Ly("{name}:cancel",i._url),a=i._query,delete i._url,delete i._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(i),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),o.then(e=>{const t=function(e){const t={},n=Uy(e,["sdkHttpResponse"]);return null!=n&&Dy(t,["sdkHttpResponse"],n),t}(e),n=new cE;return Object.assign(n,t),n})}{const t=function(e){const t={},n=Uy(e,["name"]);return null!=n&&Dy(t,["_url","name"],n),t}(e);return s=Ly("{name}:cancel",t._url),a=t._query,delete t._url,delete t._query,o=this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(i=e.config)||void 0===i?void 0:i.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),o.then(e=>{const t=function(e){const t={},n=Uy(e,["sdkHttpResponse"]);return null!=n&&Dy(t,["sdkHttpResponse"],n),t}(e),n=new cE;return Object.assign(n,t),n})}}async tuneInternal(e){var t,n;let i,r="",o={};if(this.apiClient.isVertexAI()){const s=EM(e,e);return r=Ly("tuningJobs",s._url),o=s._query,delete s._url,delete s._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),i.then(e=>MM(e))}throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,n;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const s=SM(e);return r=Ly("tunedModels",s._url),o=s._query,delete s._url,delete s._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>{const n=t;return n.sdkHttpResponse={headers:e.headers},n})),i.then(e=>function(e){const t={},n=Uy(e,["sdkHttpResponse"]);null!=n&&Dy(t,["sdkHttpResponse"],n);const i=Uy(e,["name"]);null!=i&&Dy(t,["name"],i);const r=Uy(e,["metadata"]);null!=r&&Dy(t,["metadata"],r);const o=Uy(e,["done"]);null!=o&&Dy(t,["done"],o);const s=Uy(e,["error"]);return null!=s&&Dy(t,["error"],s),t}(e))}}}class CM{async download(e,t){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const IM="x-goog-upload-status";async function PM(e,t,n){var i,r;let o=0,s=0,a=new JS(new Response),l="upload";for(o=e.size;s<o;){const u=Math.min(8388608,o-s),c=e.slice(s,s+u);s+u>=o&&(l+=", finalize");let d=0,h=1e3;for(;d<3&&(a=await n.request({path:"",body:c,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:t,headers:{"X-Goog-Upload-Command":l,"X-Goog-Upload-Offset":String(s),"Content-Length":String(u)}}}),!(null===(i=null==a?void 0:a.headers)||void 0===i?void 0:i[IM]));)d++,await OM(h),h*=2;if(s+=u,"active"!==(null===(r=null==a?void 0:a.headers)||void 0===r?void 0:r[IM]))break;if(o<=s)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return a}function OM(e){return new Promise(t=>setTimeout(t,e))}class NM{async upload(e,t,n){if("string"==typeof e)throw new Error("File path is not supported in browser uploader.");return await async function(e,t,n){var i;const r=await PM(e,t,n),o=await(null==r?void 0:r.json());if("final"!==(null===(i=null==r?void 0:r.headers)||void 0===i?void 0:i[IM]))throw new Error("Failed to upload file: Upload status is not finalized.");return o.file}(e,t,n)}async uploadToFileSearchStore(e,t,n){if("string"==typeof e)throw new Error("File path is not supported in browser uploader.");return await async function(e,t,n){var i;const r=await PM(e,t,n),o=await(null==r?void 0:r.json());if("final"!==(null===(i=null==r?void 0:r.headers)||void 0===i?void 0:i[IM]))throw new Error("Failed to upload file: Upload status is not finalized.");const s=zy(o),a=new TE;return Object.assign(a,s),a}(e,t,n)}async stat(e){if("string"==typeof e)throw new Error("File path is not supported in browser uploader.");return await async function(e){return{size:e.size,type:e.type}}(e)}}class LM{create(e,t,n){return new DM(e,t,n)}}class DM{constructor(e,t,n){this.url=e,this.headers=t,this.callbacks=n}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(void 0===this.ws)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(void 0===this.ws)throw new Error("WebSocket is not connected");this.ws.close()}}const UM="x-goog-api-key";class kM{constructor(e){this.apiKey=e}async addAuthHeaders(e,t){if(null===e.get(UM)){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(UM,this.apiKey)}}}class FM{get interactions(){if(void 0!==this._interactions)return this._interactions;console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.");const e=this.httpOptions;(null==e?void 0:e.extraBody)&&console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");const t=new xM({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:null==e?void 0:e.timeout});return this._interactions=t.interactions,this._interactions}constructor(e){var t;if(null==e.apiKey)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=null!==(t=e.vertexai)&&void 0!==t&&t,this.apiKey=e.apiKey;const n=Oy(e.httpOptions,e.vertexai,void 0,void 0);n&&(e.httpOptions?e.httpOptions.baseUrl=n:e.httpOptions={baseUrl:n}),this.apiVersion=e.apiVersion,this.httpOptions=e.httpOptions;const i=new kM(this.apiKey);this.apiClient=new BT({auth:i,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:"gl-node/web",uploader:new NM,downloader:new CM}),this.models=new tw(this.apiClient),this.live=new YT(this.apiClient,i,new LM),this.batches=new mb(this.apiClient),this.chats=new Ob(this.models,this.apiClient),this.caches=new bb(this.apiClient),this.files=new Ub(this.apiClient),this.operations=new nw(this.apiClient),this.authTokens=new sw(this.apiClient),this.tunings=new RM(this.apiClient),this.fileSearchStores=new cw(this.apiClient)}}export{Yc as A,Gn as B,zc as C,Ry as D,ve as E,Kg as F,qa as G,ur as H,fo as I,Nn as J,br as K,hr as L,ju as M,Kl as N,Gi as O,Qr as P,Bn as Q,F as R,nl as S,Zg as T,Yr as U,Hn as V,tl as W,w as X,A as Y,Vr as a,Vc as b,iv as c,Kc as d,Pg as e,dc as f,lc as g,cc as h,sd as i,v as j,$f as k,Uf as l,Kf as m,or as n,Rc as o,_d as p,ud as q,cd as r,Sc as s,Ot as t,Bo as u,M as v,x_ as w,xv as x,T_ as y,FM as z};
